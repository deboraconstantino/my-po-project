import * as tslib_1 from "tslib";
import { Component, ViewChild } from '@angular/core';
import { browserLanguage, poLocaleDefault } from '../../utils/util';
import { PoDialogType } from './po-dialog.enum';
import { PoModalComponent } from '../../components/po-modal/po-modal.component';
export const poDialogAlertLiteralsDefault = {
    en: { ok: 'Ok' },
    es: { ok: 'Ok' },
    pt: { ok: 'Ok' },
    ru: { ok: 'Ок' }
};
export const poDialogConfirmLiteralsDefault = {
    en: { cancel: 'Cancel', confirm: 'Confirm' },
    es: { cancel: 'Cancelar', confirm: 'Confirmar' },
    pt: { cancel: 'Cancelar', confirm: 'Confirmar' },
    ru: { cancel: 'отменить', confirm: 'подтвердить' }
};
/**
 * @docsPrivate
 *
 * @description
 *
 * Componente que serve como container do po-dialog.service
 */
let PoDialogComponent = class PoDialogComponent {
    /**
     * @docsPrivate
     *
     * @description
     *
     * Componente que serve como container do po-dialog.service
     */
    constructor() {
        // Objeto primary do poModal
        this.primaryAction = { label: 'ok', action: () => { } };
    }
    ngOnDestroy() {
        this.closeSubscription.unsubscribe();
    }
    ngOnInit() {
        this.closeSubscription = this.poModal.onXClosed.subscribe(close => this.destroy());
    }
    // Fecha o poModal
    close() {
        this.poModal.close();
        this.destroy();
    }
    destroy() {
        if (this.componentRef) {
            this.componentRef.destroy();
        }
    }
    // Insere os valores recebidos de this.open para o poModal
    configDialog(primaryLabel, primaryAction, secondaryLabel, secondaryAction) {
        this.primaryAction = {
            label: primaryLabel,
            action: () => {
                if (primaryAction) {
                    primaryAction();
                }
                this.close();
            }
        };
        if (secondaryLabel) {
            this.secondaryAction = {
                label: secondaryLabel,
                action: () => {
                    if (secondaryAction) {
                        secondaryAction();
                    }
                    this.close();
                }
            };
        }
    }
    // Insere os valores recebidos de po-dialog.service de acordo com o tipo de diálago solicitado
    open(dialogOptions, dialogType, componentRef) {
        this.title = dialogOptions.title;
        this.message = dialogOptions.message;
        this.componentRef = componentRef;
        this.setDialogLiterals(dialogOptions, dialogType);
        switch (dialogType) {
            case PoDialogType.Confirm: {
                this.configDialog(this.literalsConfirm.confirm, dialogOptions.confirm, this.literalsConfirm.cancel, dialogOptions.cancel);
                break;
            }
            case PoDialogType.Alert: {
                this.configDialog(this.literalsAlert.ok, dialogOptions.ok);
                break;
            }
        }
        this.poModal.open();
    }
    setDialogLiterals(dialogOptions, dialogType) {
        const alertLiterals = poDialogAlertLiteralsDefault;
        const confirmLiterals = poDialogConfirmLiteralsDefault;
        const literals = dialogOptions.literals;
        if (dialogType === PoDialogType.Alert) {
            this.literalsAlert = Object.assign({}, alertLiterals[poLocaleDefault], alertLiterals[browserLanguage()], literals);
        }
        else {
            this.literalsConfirm = Object.assign({}, confirmLiterals[poLocaleDefault], confirmLiterals[browserLanguage()], literals);
        }
    }
};
tslib_1.__decorate([
    ViewChild(PoModalComponent, { static: true }),
    tslib_1.__metadata("design:type", PoModalComponent)
], PoDialogComponent.prototype, "poModal", void 0);
PoDialogComponent = tslib_1.__decorate([
    Component({
        template: "<po-modal\n  [p-title]=\"title\"\n  [p-primary-action]=\"primaryAction\"\n  [p-secondary-action]=\"secondaryAction\">\n  {{ message }}\n</po-modal>\n"
    })
], PoDialogComponent);
export { PoDialogComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZGlhbG9nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL3BvLWRpYWxvZy9wby1kaWFsb2cuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFtQyxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFJdEYsT0FBTyxFQUFFLGVBQWUsRUFBRSxlQUFlLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUtwRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFFaEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sOENBQThDLENBQUM7QUFFaEYsTUFBTSxDQUFDLE1BQU0sNEJBQTRCLEdBQUc7SUFDMUMsRUFBRSxFQUEwQixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7SUFDeEMsRUFBRSxFQUEwQixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7SUFDeEMsRUFBRSxFQUEwQixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7SUFDeEMsRUFBRSxFQUEwQixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7Q0FDekMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLDhCQUE4QixHQUFHO0lBQzVDLEVBQUUsRUFBNEIsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUU7SUFDdEUsRUFBRSxFQUE0QixFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRTtJQUMxRSxFQUFFLEVBQTRCLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFO0lBQzFFLEVBQUUsRUFBNEIsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUU7Q0FDN0UsQ0FBQztBQUVGOzs7Ozs7R0FNRztBQUtILElBQWEsaUJBQWlC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QUssWUFBWSxDQUFDLEtBQUssRUFBRTtZQUNyQyxJQUFJLENBQUMsYUFBYSxxQkFBTyxhQUFhLENBQUMsZUFBZSxDQUFDLEVBQUssYUFBYSxDQUFDLGVBQWUsRUFBRSxDQUFDLEVBQUssUUFBUSxDQUFDLENBQUM7U0FDNUc7YUFBTTtZQUNMLElBQUksQ0FBQyxlQUFlLHFCQUFPLGVBQWUsQ0FBQyxlQUFlLENBQUMsRUFBSyxlQUFlLENBQUMsZUFBZSxFQUFFLENBQUMsRUFBSyxRQUFRLENBQUMsQ0FBQztTQUNsSDtJQUNILENBQUM7Q0FDRixDQUFBO0FBN0dnRDtJQUE5QyxTQUFTLENBQUMsZ0JBQWdCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7c0NBQVUsZ0JBQWdCO2tEQUFDO0FBRjlELGlCQUFpQjtJQUg3QixTQUFTLENBQUM7UUFDVCxpS0FBeUM7S0FDMUMsQ0FBQztHQUNXLGlCQUFpQixDQStHN0I7U0EvR1ksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBDb21wb25lbnRSZWYsIE9uRGVzdHJveSwgT25Jbml0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IGJyb3dzZXJMYW5ndWFnZSwgcG9Mb2NhbGVEZWZhdWx0IH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbCc7XG5cbmltcG9ydCB7IFBvRGlhbG9nQWxlcnRMaXRlcmFscyB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1kaWFsb2ctYWxlcnQtbGl0ZXJhbHMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvRGlhbG9nQWxlcnRPcHRpb25zLCBQb0RpYWxvZ0NvbmZpcm1PcHRpb25zIH0gZnJvbSAnLi9pbnRlcmZhY2VzL3BvLWRpYWxvZy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9EaWFsb2dDb25maXJtTGl0ZXJhbHMgfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tZGlhbG9nLWNvbmZpcm0tbGl0ZXJhbHMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvRGlhbG9nVHlwZSB9IGZyb20gJy4vcG8tZGlhbG9nLmVudW0nO1xuaW1wb3J0IHsgUG9Nb2RhbEFjdGlvbiB9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMvcG8tbW9kYWwvcG8tbW9kYWwtYWN0aW9uLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb01vZGFsQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vY29tcG9uZW50cy9wby1tb2RhbC9wby1tb2RhbC5jb21wb25lbnQnO1xuXG5leHBvcnQgY29uc3QgcG9EaWFsb2dBbGVydExpdGVyYWxzRGVmYXVsdCA9IHtcbiAgZW46IDxQb0RpYWxvZ0FsZXJ0TGl0ZXJhbHM+IHsgb2s6ICdPaycgfSxcbiAgZXM6IDxQb0RpYWxvZ0FsZXJ0TGl0ZXJhbHM+IHsgb2s6ICdPaycgfSxcbiAgcHQ6IDxQb0RpYWxvZ0FsZXJ0TGl0ZXJhbHM+IHsgb2s6ICdPaycgfSxcbiAgcnU6IDxQb0RpYWxvZ0FsZXJ0TGl0ZXJhbHM+IHsgb2s6ICfQntC6JyB9XG59O1xuXG5leHBvcnQgY29uc3QgcG9EaWFsb2dDb25maXJtTGl0ZXJhbHNEZWZhdWx0ID0ge1xuICBlbjogPFBvRGlhbG9nQ29uZmlybUxpdGVyYWxzPiB7IGNhbmNlbDogJ0NhbmNlbCcsIGNvbmZpcm06ICdDb25maXJtJyB9LFxuICBlczogPFBvRGlhbG9nQ29uZmlybUxpdGVyYWxzPiB7IGNhbmNlbDogJ0NhbmNlbGFyJywgY29uZmlybTogJ0NvbmZpcm1hcicgfSxcbiAgcHQ6IDxQb0RpYWxvZ0NvbmZpcm1MaXRlcmFscz4geyBjYW5jZWw6ICdDYW5jZWxhcicsIGNvbmZpcm06ICdDb25maXJtYXInIH0sXG4gIHJ1OiA8UG9EaWFsb2dDb25maXJtTGl0ZXJhbHM+IHsgY2FuY2VsOiAn0L7RgtC80LXQvdC40YLRjCcsIGNvbmZpcm06ICfQv9C+0LTRgtCy0LXRgNC00LjRgtGMJyB9XG59O1xuXG4vKipcbiAqIEBkb2NzUHJpdmF0ZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIENvbXBvbmVudGUgcXVlIHNlcnZlIGNvbW8gY29udGFpbmVyIGRvIHBvLWRpYWxvZy5zZXJ2aWNlXG4gKi9cblxuQENvbXBvbmVudCh7XG4gIHRlbXBsYXRlVXJsOiAnLi9wby1kaWFsb2cuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFBvRGlhbG9nQ29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95LCBPbkluaXQge1xuICAvLyBWaWV3Q2hpbGQgcGFyYSBvIHVzbyBkbyBwby1tb2RhbC5jb21wb25lbnRcbiAgQFZpZXdDaGlsZChQb01vZGFsQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KSBwb01vZGFsOiBQb01vZGFsQ29tcG9uZW50O1xuXG4gIC8vIFRpdGxlIGRvIHBvTW9kYWxcbiAgdGl0bGU6IHN0cmluZztcblxuICAvLyBNZXNzYWdlIGRvIHBvTW9kYWxcbiAgbWVzc2FnZTogc3RyaW5nO1xuXG4gIC8vIE9iamV0byBwcmltYXJ5IGRvIHBvTW9kYWxcbiAgcHJpbWFyeUFjdGlvbjogUG9Nb2RhbEFjdGlvbiA9IHsgbGFiZWw6ICdvaycsIGFjdGlvbjogKCkgPT4geyB9IH07XG5cbiAgLy8gT2JqZXRvIHNlY29uZGFyeSBkbyBwb01vZGFsXG4gIHNlY29uZGFyeUFjdGlvbjogUG9Nb2RhbEFjdGlvbjtcblxuICAvLyBMaXRlcmFpcyB1c2FkYXMgbm9zIGJvdMOjbyBkZSBhbGVydGEgZG8gcG9Nb2RhbFxuICBsaXRlcmFsc0FsZXJ0OiBQb0RpYWxvZ0FsZXJ0TGl0ZXJhbHM7XG5cbiAgLy8gTGl0ZXJhaXMgdXNhZGFzIG5vcyBib3TDtWVzIGRlIGNvbmZpcm1hw6fDo28gZG8gcG9Nb2RhbFxuICBsaXRlcmFsc0NvbmZpcm06IFBvRGlhbG9nQ29uZmlybUxpdGVyYWxzO1xuXG4gIC8vIEF0cmlidXRvIHBhcmEgYXJtYXplbmFyIGEgcmVmZXJlbmNpYSBkbyBjb21wb25lbnRlIGNyaWFkbyB2aWEgc2VydmnDp28uXG4gIHByaXZhdGUgY29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8UG9EaWFsb2dDb21wb25lbnQ+O1xuICBwcml2YXRlIGNsb3NlU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5jbG9zZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5jbG9zZVN1YnNjcmlwdGlvbiA9IHRoaXMucG9Nb2RhbC5vblhDbG9zZWQuc3Vic2NyaWJlKGNsb3NlID0+IHRoaXMuZGVzdHJveSgpKTtcbiAgfVxuXG4gICAgLy8gRmVjaGEgbyBwb01vZGFsXG4gIGNsb3NlKCk6IHZvaWQge1xuICAgIHRoaXMucG9Nb2RhbC5jbG9zZSgpO1xuICAgIHRoaXMuZGVzdHJveSgpO1xuICB9XG5cbiAgZGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5jb21wb25lbnRSZWYpIHtcbiAgICAgIHRoaXMuY29tcG9uZW50UmVmLmRlc3Ryb3koKTtcbiAgICB9XG4gIH1cblxuICAvLyBJbnNlcmUgb3MgdmFsb3JlcyByZWNlYmlkb3MgZGUgdGhpcy5vcGVuIHBhcmEgbyBwb01vZGFsXG4gIGNvbmZpZ0RpYWxvZyhwcmltYXJ5TGFiZWw/LCBwcmltYXJ5QWN0aW9uPywgc2Vjb25kYXJ5TGFiZWw/LCBzZWNvbmRhcnlBY3Rpb24/KSB7XG5cbiAgICB0aGlzLnByaW1hcnlBY3Rpb24gPSB7XG4gICAgICBsYWJlbDogcHJpbWFyeUxhYmVsLFxuICAgICAgYWN0aW9uOiAoKSA9PiB7XG4gICAgICAgICAgaWYgKHByaW1hcnlBY3Rpb24pIHtcbiAgICAgICAgICAgIHByaW1hcnlBY3Rpb24oKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBpZiAoc2Vjb25kYXJ5TGFiZWwpIHtcbiAgICAgIHRoaXMuc2Vjb25kYXJ5QWN0aW9uID0ge1xuICAgICAgICBsYWJlbDogc2Vjb25kYXJ5TGFiZWwsXG4gICAgICAgIGFjdGlvbjogKCkgPT4ge1xuICAgICAgICAgIGlmIChzZWNvbmRhcnlBY3Rpb24pIHtcbiAgICAgICAgICAgIHNlY29uZGFyeUFjdGlvbigpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLy8gSW5zZXJlIG9zIHZhbG9yZXMgcmVjZWJpZG9zIGRlIHBvLWRpYWxvZy5zZXJ2aWNlIGRlIGFjb3JkbyBjb20gbyB0aXBvIGRlIGRpw6FsYWdvIHNvbGljaXRhZG9cbiAgb3BlbihkaWFsb2dPcHRpb25zOiAoUG9EaWFsb2dDb25maXJtT3B0aW9ucyB8IFBvRGlhbG9nQWxlcnRPcHRpb25zKSxcbiAgICAgICBkaWFsb2dUeXBlOiBQb0RpYWxvZ1R5cGUsXG4gICAgICAgY29tcG9uZW50UmVmPzogQ29tcG9uZW50UmVmPFBvRGlhbG9nQ29tcG9uZW50Pik6IHZvaWQge1xuXG4gICAgdGhpcy50aXRsZSA9IGRpYWxvZ09wdGlvbnMudGl0bGU7XG4gICAgdGhpcy5tZXNzYWdlID0gZGlhbG9nT3B0aW9ucy5tZXNzYWdlO1xuXG4gICAgdGhpcy5jb21wb25lbnRSZWYgPSBjb21wb25lbnRSZWY7XG5cbiAgICB0aGlzLnNldERpYWxvZ0xpdGVyYWxzKGRpYWxvZ09wdGlvbnMsIGRpYWxvZ1R5cGUpO1xuXG4gICAgc3dpdGNoIChkaWFsb2dUeXBlKSB7XG4gICAgICBjYXNlIFBvRGlhbG9nVHlwZS5Db25maXJtOiB7XG4gICAgICAgIHRoaXMuY29uZmlnRGlhbG9nKFxuICAgICAgICAgIHRoaXMubGl0ZXJhbHNDb25maXJtLmNvbmZpcm0sICg8UG9EaWFsb2dDb25maXJtT3B0aW9ucz5kaWFsb2dPcHRpb25zKS5jb25maXJtLFxuICAgICAgICAgIHRoaXMubGl0ZXJhbHNDb25maXJtLmNhbmNlbCwgKDxQb0RpYWxvZ0NvbmZpcm1PcHRpb25zPmRpYWxvZ09wdGlvbnMpLmNhbmNlbCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBQb0RpYWxvZ1R5cGUuQWxlcnQ6IHtcbiAgICAgICAgdGhpcy5jb25maWdEaWFsb2codGhpcy5saXRlcmFsc0FsZXJ0Lm9rLCAoPFBvRGlhbG9nQWxlcnRPcHRpb25zPmRpYWxvZ09wdGlvbnMpLm9rKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5wb01vZGFsLm9wZW4oKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0RGlhbG9nTGl0ZXJhbHMoZGlhbG9nT3B0aW9uczogUG9EaWFsb2dDb25maXJtT3B0aW9ucyB8IFBvRGlhbG9nQWxlcnRPcHRpb25zLCBkaWFsb2dUeXBlOiBQb0RpYWxvZ1R5cGUpIHtcbiAgICBjb25zdCBhbGVydExpdGVyYWxzID0gcG9EaWFsb2dBbGVydExpdGVyYWxzRGVmYXVsdDtcbiAgICBjb25zdCBjb25maXJtTGl0ZXJhbHMgPSBwb0RpYWxvZ0NvbmZpcm1MaXRlcmFsc0RlZmF1bHQ7XG4gICAgY29uc3QgbGl0ZXJhbHMgPSBkaWFsb2dPcHRpb25zLmxpdGVyYWxzO1xuXG4gICAgaWYgKGRpYWxvZ1R5cGUgPT09IFBvRGlhbG9nVHlwZS5BbGVydCkge1xuICAgICAgdGhpcy5saXRlcmFsc0FsZXJ0ID0gey4uLmFsZXJ0TGl0ZXJhbHNbcG9Mb2NhbGVEZWZhdWx0XSwgLi4uYWxlcnRMaXRlcmFsc1ticm93c2VyTGFuZ3VhZ2UoKV0sIC4uLmxpdGVyYWxzfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5saXRlcmFsc0NvbmZpcm0gPSB7Li4uY29uZmlybUxpdGVyYWxzW3BvTG9jYWxlRGVmYXVsdF0sIC4uLmNvbmZpcm1MaXRlcmFsc1ticm93c2VyTGFuZ3VhZ2UoKV0sIC4uLmxpdGVyYWxzfTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==