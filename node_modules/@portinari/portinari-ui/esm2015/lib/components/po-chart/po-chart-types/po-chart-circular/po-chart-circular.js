import * as tslib_1 from "tslib";
import { Subject } from 'rxjs';
import { convertNumberToDecimal } from '../../../../utils/util';
import { poChartAngleStepInterval, poChartCompleteCircle, poChartDonutSerieWidth, poChartGaugeSerieWidth, poChartStartAngle } from './po-chart-circular.constant';
import { PoChartDynamicTypeComponent } from '../po-chart-dynamic-type.component';
import { PoChartType } from '../../enums/po-chart-type.enum';
import { PoSeriesTextBlack } from '../../po-chart-colors.constant';
const poChartBlackColor = '#000000';
const poChartWhiteColor = '#ffffff';
export class PoChartCircular extends PoChartDynamicTypeComponent {
    constructor(el, ngZone, renderer) {
        super();
        this.el = el;
        this.ngZone = ngZone;
        this.renderer = renderer;
        this.chartItemStartAngle = poChartStartAngle;
        this.windowResizeEmitter = new Subject();
        this.chartItemsEndAngleList = [];
        this.svgPathElementsList = [];
        this.svgTextElementsList = [];
    }
    set series(value) {
        this._series = this.getSeriesWithValue(value);
    }
    get series() {
        return this._series;
    }
    ngOnDestroy() {
        this.removeWindowResizeListener();
        this.removeWindowScrollListener();
        this.animationRunning = false;
    }
    ngOnInit() {
        this.chartInitSetup();
        this.setEventListeners();
    }
    removeTooltip() {
        if (this.tooltipElement) {
            this.renderer.addClass(this.tooltipElement, 'po-invisible');
        }
    }
    drawPath(path, chartItemStartAngle, chartItemEndAngle) {
        const largeArc = chartItemEndAngle - chartItemStartAngle > Math.PI;
        const sinAlpha = Math.sin(chartItemStartAngle);
        const cosAlpha = Math.cos(chartItemStartAngle);
        const sinBeta = Math.sin(chartItemEndAngle);
        const cosBeta = Math.cos(chartItemEndAngle);
        const startX = this.centerX + cosAlpha * this.centerX;
        const startY = this.centerX + sinAlpha * this.centerX;
        const endX = this.centerX + cosBeta * this.centerX;
        const endY = this.centerX + sinBeta * this.centerX;
        const startInnerX = this.centerX + cosAlpha * this.innerRadius;
        const startInnerY = this.centerX + sinAlpha * this.innerRadius;
        const endInnerX = this.centerX + cosBeta * this.innerRadius;
        const endInnerY = this.centerX + sinBeta * this.innerRadius;
        const halfGaugeCoordinates = [
            'M', startX, startY,
            'A', this.centerX, this.centerX, 0, '0,1', endX, endY,
            'A', 1, 1, 0, '0,1', endInnerX, endInnerY,
            'A', this.innerRadius, this.innerRadius, 0, '0,0', startInnerX, startInnerY,
            'A', 1, 1, 0, '0,1', startX, startY,
            'Z'
        ].join(' ');
        const pathCoordinates = [
            'M', startX, startY,
            'A', this.centerX, this.centerX, 0, largeArc ? '1,1' : '0,1', endX, endY,
            'L', endInnerX, endInnerY,
            'A', this.innerRadius, this.innerRadius, 0, largeArc ? '1,0' : '0,0', startInnerX, startInnerY,
            'Z'
        ].join(' ');
        return path.setAttribute('d', this.isChartGaugeType ? halfGaugeCoordinates : pathCoordinates);
    }
    getSeriesWithValue(series) {
        const newSeries = [];
        series.forEach((serie, index) => {
            if (serie.value > 0) {
                newSeries.push(Object.assign({}, serie, { color: this.colors[index] }));
            }
        });
        return newSeries;
    }
    animationSetup() {
        this.chartItemEndAngle = this.chartItemsEndAngleList[0];
        this.animationRunning = true;
        this.drawPathInit();
    }
    appendGaugeBackgroundPathElement(svgPathsWrapper) {
        const svgPath = this.renderer.createElement('svg:path', 'svg');
        this.renderer.setAttribute(svgPath, 'class', 'po-chart-gauge-base-path');
        svgPathsWrapper.appendChild(svgPath);
        this.renderer.appendChild(this.svgElement, svgPathsWrapper);
    }
    calculateAngleRadians() {
        this.series.forEach((serie, index) => this.chartItemsEndAngleList[index] = this.calculateEndAngle(serie.value, this.totalValue));
    }
    calculateCurrentEndAngle(angleCurrentPosition) {
        const isSerieDrawCompleted = this.chartItemStartAngle + angleCurrentPosition > this.chartItemStartAngle + this.chartItemEndAngle;
        if (isSerieDrawCompleted) {
            return (this.chartItemStartAngle + this.chartItemEndAngle) - poChartCompleteCircle;
        }
        else {
            return this.chartItemStartAngle + angleCurrentPosition;
        }
    }
    calculateEndAngle(value, totalValue) {
        const endAngle = value / totalValue * (Math.PI * 2);
        return this.isChartGaugeType ? (endAngle / 2) : endAngle;
    }
    calculateSVGDimensions() {
        this.calculateSVGContainerDimensions(this.chartWrapper, this.chartHeader, this.chartLegend);
        this.innerRadius = this.setInnerRadius(this.type);
    }
    changeTooltipPosition(event) {
        if (this.tooltipElement && this.tooltipElement.classList.contains('po-invisible')) {
            this.showTooltip();
        }
        const tooltipPositions = this.setTooltipPositions(event);
        this.renderer.setStyle(this.tooltipElement, 'left', `${tooltipPositions.left}px`);
        this.renderer.setStyle(this.tooltipElement, 'top', `${tooltipPositions.top}px`);
    }
    chartInitSetup() {
        this.calculateSVGDimensions();
        this.calculateTotalValue();
        this.calculateAngleRadians();
        this.createSVGElements();
        this.animationSetup();
    }
    checkingIfScrollsWithPoPage() {
        const poPageContent = document.getElementsByClassName('po-page-content');
        return poPageContent.length ? poPageContent[0] : window;
    }
    createPath(serie, svgPathsWrapper) {
        const svgPath = this.renderer.createElement('svg:path', 'svg');
        this.renderer.setAttribute(svgPath, 'class', 'po-path-item');
        this.renderer.setAttribute(svgPath, 'fill', serie.color);
        this.setElementAttributes(svgPath, serie);
        svgPathsWrapper.appendChild(svgPath);
        this.renderer.appendChild(this.svgElement, svgPathsWrapper);
        this.svgPathElementsList.push(svgPath);
    }
    createPaths() {
        const svgPathsWrapper = this.renderer.createElement('svg:g', 'svg');
        if (this.isChartGaugeType) {
            this.appendGaugeBackgroundPathElement(svgPathsWrapper);
            // Tratamento para evitar que o path desenhe os arcos referentes ao border radius do path.
            if (this.isSerieValueEqualZero()) {
                return;
            }
        }
        this.series.forEach(serie => this.createPath(serie, svgPathsWrapper));
    }
    createText(serie) {
        const { value } = serie;
        const svgG = this.renderer.createElement('svg:g', 'svg');
        const svgText = this.renderer.createElement('svg:text', 'svg');
        const fontSize = this.getFontSize();
        const textColor = this.getTextColor(serie.color);
        svgText.textContent = this.getPercentValue(value, this.totalValue) + '%';
        this.renderer.setAttribute(svgText, 'class', 'po-path-item');
        this.renderer.setAttribute(svgText, 'fill', textColor);
        this.renderer.setAttribute(svgText, 'font-size', fontSize);
        this.renderer.setAttribute(svgText, 'fill-opacity', '0');
        this.setElementAttributes(svgText, serie);
        this.renderer.appendChild(svgG, svgText);
        this.renderer.appendChild(this.svgElement, svgG);
        this.svgTextElementsList.push(svgText);
    }
    createTexts() {
        if (this.type === PoChartType.Donut) {
            this.series.forEach(serie => this.createText(serie));
        }
    }
    createSVGElements() {
        const viewBoxHeight = this.isChartGaugeType ? this.centerX + (this.centerX * poChartGaugeSerieWidth) : this.chartWrapper;
        const preserveAspectRatio = this.isChartGaugeType ? 'xMidYMax' : 'xMidYMin';
        this.svgElement = this.renderer.createElement('svg:svg', 'svg');
        this.renderer.setAttribute(this.svgElement, 'viewBox', `0 0 ${this.chartWrapper} ${viewBoxHeight}`);
        this.renderer.setAttribute(this.svgElement, 'preserveAspectRatio', `${preserveAspectRatio} meet`);
        this.renderer.setAttribute(this.svgElement, 'class', 'po-chart-svg-element');
        this.renderer.setAttribute(this.svgElement, 'width', `${this.centerX}`);
        this.renderer.setAttribute(this.svgElement, 'height', `${this.svgHeight}`);
        this.svgContainer.nativeElement.appendChild(this.svgElement);
        this.createPaths();
        this.createTexts();
    }
    drawPathInit() {
        if (!this.animationRunning) {
            return;
        }
        else {
            this.ngZone.runOutsideAngular(() => this.drawSeries());
        }
    }
    drawSeries(currentSerieIndex = 0, angleCurrentPosition = 0) {
        const isFinishedDrawingCurrentSeries = angleCurrentPosition > this.chartItemEndAngle;
        const isFinishedDrawingAllSeries = currentSerieIndex === this.svgPathElementsList.length;
        if (isFinishedDrawingAllSeries) {
            return;
        }
        if (isFinishedDrawingCurrentSeries) {
            this.chartItemStartAngle = this.chartItemStartAngle + this.chartItemEndAngle;
            currentSerieIndex++;
            this.chartItemEndAngle = this.chartItemsEndAngleList[currentSerieIndex];
            angleCurrentPosition = 0;
        }
        else {
            angleCurrentPosition += poChartAngleStepInterval;
            this.drawPath(this.svgPathElementsList[currentSerieIndex], this.chartItemStartAngle, this.calculateCurrentEndAngle(angleCurrentPosition));
            this.setTextProperties(this.svgTextElementsList[currentSerieIndex], this.chartItemStartAngle, this.calculateCurrentEndAngle(angleCurrentPosition));
        }
        window.requestAnimationFrame(this.drawSeries.bind(this, currentSerieIndex, angleCurrentPosition));
    }
    emitEventOnEnter(event) {
        this.onSerieHover.next(event);
    }
    getFontSize() {
        const fontSizePorcent = 0.04;
        const fontSize = fontSizePorcent * this.chartWrapper;
        return `${fontSize.toFixed(0)}px`;
    }
    getPercentValue(value, totalValue) {
        const percentValue = (value / totalValue) * 100;
        const floatPercentValue = convertNumberToDecimal(percentValue, 2);
        return String(floatPercentValue).replace('.', ',');
    }
    getTextColor(color) {
        if (PoSeriesTextBlack.includes(color)) {
            return poChartBlackColor;
        }
        return poChartWhiteColor;
    }
    getTooltipValue(value) {
        if (this.type === PoChartType.Pie) {
            return value.toString();
        }
        return this.getPercentValue(value, this.totalValue) + '%';
    }
    isSerieValueEqualZero() {
        return this.series.length && this.series[0].value === 0;
    }
    onMouseClick() {
        let serieOnClick;
        if (this.isChartGaugeType) {
            const _a = this.series[0], { color } = _a, serie = tslib_1.__rest(_a, ["color"]);
            serieOnClick = serie;
        }
        else {
            serieOnClick = { category: this.chartElementCategory, value: this.chartElementValue };
        }
        this.onSerieClick.next(serieOnClick);
    }
    onMouseEnter(event) {
        let serieOnEnter;
        if (!this.isChartGaugeType) {
            this.tooltipElement = this.chartBody.nativeElement.lastChild;
            this.chartElementCategory = event.target.getAttributeNS(null, 'data-tooltip-category');
            this.chartElementValue = event.target.getAttributeNS(null, 'data-tooltip-value');
            this.tooltipText = event.target.getAttributeNS(null, 'data-tooltip-text');
            this.showTooltip();
            this.changeTooltipPosition(event);
            serieOnEnter = { category: this.chartElementCategory, value: this.chartElementValue };
        }
        else {
            const _a = this.series[0], { color } = _a, serie = tslib_1.__rest(_a, ["color"]);
            this.chartElementDescription = event.target.getAttributeNS(null, 'data-tooltip-category');
            serieOnEnter = serie;
        }
        this.emitEventOnEnter(serieOnEnter);
    }
    onWindowResize() {
        this.calculateSVGDimensions();
        this.renderer.setAttribute(this.svgElement, 'width', `${this.centerX}`);
        this.renderer.setAttribute(this.svgElement, 'height', `${this.svgHeight}`);
        this.windowResizeEmitter.next();
    }
    removeWindowResizeListener() {
        if (this.windowResizeListener) {
            this.windowResizeListener();
        }
    }
    removeWindowScrollListener() {
        if (this.windowScrollListener) {
            this.windowScrollListener();
        }
    }
    setEventListeners() {
        let chartSeries = this.el.nativeElement.querySelectorAll('.po-path-item');
        chartSeries = Array.from(chartSeries);
        chartSeries.forEach(serie => {
            this.renderer.listen(serie, 'click', this.onMouseClick.bind(this));
            this.renderer.listen(serie, 'mouseenter', this.onMouseEnter.bind(this));
            if (!this.isChartGaugeType) {
                this.renderer.listen(serie, 'mousemove', this.changeTooltipPosition.bind(this));
                this.renderer.listen(serie, 'mouseleave', this.removeTooltip.bind(this));
            }
        });
        this.windowResizeListener = this.renderer.listen(window, 'resize', this.onWindowResize.bind(this));
        this.windowScrollListener = this.renderer.listen(this.checkingIfScrollsWithPoPage(), 'scroll', this.removeTooltip.bind(this));
    }
    setInnerRadius(type) {
        let serieWidth;
        switch (type) {
            case PoChartType.Donut: {
                serieWidth = poChartDonutSerieWidth;
                break;
            }
            case PoChartType.Gauge: {
                serieWidth = poChartGaugeSerieWidth;
                break;
            }
            case PoChartType.Pie: {
                return 0;
            }
        }
        return this.centerX - (this.centerX * serieWidth);
    }
    setTextProperties(text, startAngle, endAngle) {
        if (this.type === PoChartType.Donut) {
            // utilizado para recuperar o angulo do meio, entre o inicio e fim para centralizar o texto
            const centerAngle = (startAngle + endAngle) / 2;
            const textBox = text.getBBox();
            const halfTextWidth = textBox.width / 2;
            const halfTextHeight = textBox.height / 2;
            // radius interno (circulo branco) + a metade da diferen√ßa entre tamanho do centro e radius interno
            const radius = this.innerRadius + (this.centerX - this.innerRadius) / 2;
            const xCoordinate = radius * Math.cos(centerAngle) + this.centerX - (halfTextWidth);
            const yCoordinate = radius * Math.sin(centerAngle) + this.centerX + (halfTextHeight / 2);
            text.setAttribute('x', xCoordinate);
            text.setAttribute('y', yCoordinate);
            text.setAttribute('fill-opacity', '1');
        }
    }
    setTooltipPositions(event) {
        const displacement = 8;
        return {
            left: event.clientX - this.tooltipElement.offsetWidth / 2,
            top: event.clientY - this.tooltipElement.offsetHeight - displacement
        };
    }
    setElementAttributes(svgElement, serie) {
        const { value, category, tooltip, description } = serie;
        this.renderer.setAttribute(svgElement, 'data-tooltip-value', `${value}`);
        if (this.isChartGaugeType) {
            this.renderer.setAttribute(svgElement, 'data-tooltip-description', description);
        }
        else {
            const tooltipValue = this.getTooltipValue(value);
            this.renderer.setAttribute(svgElement, 'data-tooltip-category', category);
            this.renderer.setAttribute(svgElement, 'data-tooltip-text', tooltip || `${category}: ${tooltipValue}`);
        }
    }
    showTooltip() {
        this.renderer.removeClass(this.tooltipElement, 'po-invisible');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtY2lyY3VsYXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9ydGluYXJpL3BvcnRpbmFyaS11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWNoYXJ0L3BvLWNoYXJ0LXR5cGVzL3BvLWNoYXJ0LWNpcmN1bGFyL3BvLWNoYXJ0LWNpcmN1bGFyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRS9CLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRWhFLE9BQU8sRUFDTCx3QkFBd0IsRUFDeEIscUJBQXFCLEVBQ3JCLHNCQUFzQixFQUN0QixzQkFBc0IsRUFFdEIsaUJBQWlCLEVBQ2xCLE1BQU0sOEJBQThCLENBQUM7QUFDdEMsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFFakYsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBSTdELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRW5FLE1BQU0saUJBQWlCLEdBQUcsU0FBUyxDQUFDO0FBQ3BDLE1BQU0saUJBQWlCLEdBQUcsU0FBUyxDQUFDO0FBRXBDLE1BQU0sT0FBTyxlQUFnQixTQUFRLDJCQUEyQjtJQXNCOUQsWUFBc0IsRUFBYyxFQUFVLE1BQWMsRUFBVSxRQUFtQjtRQUN2RixLQUFLLEVBQUUsQ0FBQztRQURZLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQXBCekYsd0JBQW1CLEdBQUcsaUJBQWlCLENBQUM7UUFDeEMsd0JBQW1CLEdBQWlCLElBQUksT0FBTyxFQUFFLENBQUM7UUFPMUMsMkJBQXNCLEdBQWtCLEVBQUUsQ0FBQztRQUMzQyx3QkFBbUIsR0FBa0IsRUFBRSxDQUFDO1FBQ3hDLHdCQUFtQixHQUFr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QUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxXQUFXLEdBQUcsQ0FBQztZQUN6RCxHQUFHLEVBQUUsS0FBSyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLFlBQVksR0FBRyxZQUFZO1NBQ3JFLENBQUM7SUFDSixDQUFDO0lBRU8sb0JBQW9CLENBQUMsVUFBVSxFQUFFLEtBQUs7UUFDNUMsTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxHQUFHLEtBQUssQ0FBQztRQUV4RCxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsb0JBQW9CLEVBQUUsR0FBRyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBRXpFLElBQUksSUFBSSxDQUFDLGdCQUFnQixFQUFFO1lBQ3pCLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSwwQkFBMEIsRUFBRSxXQUFXLENBQUMsQ0FBQztTQUNqRjthQUFNO1lBQ0wsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUVqRCxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsdUJBQXVCLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDMUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFLG1CQUFtQixFQUFFLE9BQU8sSUFBSSxHQUFHLFFBQVEsS0FBSyxZQUFZLEVBQUUsQ0FBQyxDQUFDO1NBQ3hHO0lBRUgsQ0FBQztJQUVPLFdBQVc7UUFDakIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxjQUFjLENBQUMsQ0FBQztJQUNqRSxDQUFDO0NBRUYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbGVtZW50UmVmLCBOZ1pvbmUsIE9uRGVzdHJveSwgT25Jbml0LCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgY29udmVydE51bWJlclRvRGVjaW1hbCB9IGZyb20gJy4uLy4uLy4uLy4uL3V0aWxzL3V0aWwnO1xuXG5pbXBvcnQge1xuICBwb0NoYXJ0QW5nbGVTdGVwSW50ZXJ2YWwsXG4gIHBvQ2hhcnRDb21wbGV0ZUNpcmNsZSxcbiAgcG9DaGFydERvbnV0U2VyaWVXaWR0aCxcbiAgcG9DaGFydEdhdWdlU2VyaWVXaWR0aCxcbiAgcG9DaGFydFBhZGRpbmcsXG4gIHBvQ2hhcnRTdGFydEFuZ2xlXG59IGZyb20gJy4vcG8tY2hhcnQtY2lyY3VsYXIuY29uc3RhbnQnO1xuaW1wb3J0IHsgUG9DaGFydER5bmFtaWNUeXBlQ29tcG9uZW50IH0gZnJvbSAnLi4vcG8tY2hhcnQtZHluYW1pYy10eXBlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb0NoYXJ0R2F1Z2VTZXJpZSB9IGZyb20gJy4uL3BvLWNoYXJ0LWdhdWdlL3BvLWNoYXJ0LWdhdWdlLXNlcmllcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9DaGFydFR5cGUgfSBmcm9tICcuLi8uLi9lbnVtcy9wby1jaGFydC10eXBlLmVudW0nO1xuaW1wb3J0IHsgUG9DaXJjdWxhckNoYXJ0U2VyaWVzIH0gZnJvbSAnLi9wby1jaGFydC1jaXJjdWxhci1zZXJpZXMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvRG9udXRDaGFydFNlcmllcyB9IGZyb20gJy4uL3BvLWNoYXJ0LWRvbnV0L3BvLWNoYXJ0LWRvbnV0LXNlcmllcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9QaWVDaGFydFNlcmllcyB9IGZyb20gJy4uL3BvLWNoYXJ0LXBpZS9wby1jaGFydC1waWUtc2VyaWVzLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb1Nlcmllc1RleHRCbGFjayB9IGZyb20gJy4uLy4uL3BvLWNoYXJ0LWNvbG9ycy5jb25zdGFudCc7XG5cbmNvbnN0IHBvQ2hhcnRCbGFja0NvbG9yID0gJyMwMDAwMDAnO1xuY29uc3QgcG9DaGFydFdoaXRlQ29sb3IgPSAnI2ZmZmZmZic7XG5cbmV4cG9ydCBjbGFzcyBQb0NoYXJ0Q2lyY3VsYXIgZXh0ZW5kcyBQb0NoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3ksIE9uSW5pdCB7XG5cbiAgY2hhcnRJdGVtU3RhcnRBbmdsZSA9IHBvQ2hhcnRTdGFydEFuZ2xlO1xuICB3aW5kb3dSZXNpemVFbWl0dGVyOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdCgpO1xuXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogdXNlLXR5cGUtYWxpYXNcbiAgcHJvdGVjdGVkIF9zZXJpZXM6IEFycmF5PFBvUGllQ2hhcnRTZXJpZXMgfCBQb0RvbnV0Q2hhcnRTZXJpZXMgfCBQb0NoYXJ0R2F1Z2VTZXJpZT47XG5cbiAgcHJpdmF0ZSBhbmltYXRpb25SdW5uaW5nOiBib29sZWFuO1xuICBwcml2YXRlIGNoYXJ0SXRlbUVuZEFuZ2xlOiBudW1iZXI7XG4gIHByaXZhdGUgY2hhcnRJdGVtc0VuZEFuZ2xlTGlzdDogQXJyYXk8bnVtYmVyPiA9IFtdO1xuICBwcml2YXRlIHN2Z1BhdGhFbGVtZW50c0xpc3Q6IEFycmF5PHN0cmluZz4gPSBbXTtcbiAgcHJpdmF0ZSBzdmdUZXh0RWxlbWVudHNMaXN0OiBBcnJheTxzdHJpbmc+ID0gW107XG5cbiAgc2V0IHNlcmllcyh2YWx1ZTogQXJyYXk8UG9QaWVDaGFydFNlcmllcyB8IFBvRG9udXRDaGFydFNlcmllcyB8IFBvQ2hhcnRHYXVnZVNlcmllPikge1xuICAgIHRoaXMuX3NlcmllcyA9IHRoaXMuZ2V0U2VyaWVzV2l0aFZhbHVlKHZhbHVlKTtcbiAgfVxuXG4gIGdldCBzZXJpZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NlcmllcztcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSwgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMucmVtb3ZlV2luZG93UmVzaXplTGlzdGVuZXIoKTtcbiAgICB0aGlzLnJlbW92ZVdpbmRvd1Njcm9sbExpc3RlbmVyKCk7XG4gICAgdGhpcy5hbmltYXRpb25SdW5uaW5nID0gZmFsc2U7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmNoYXJ0SW5pdFNldHVwKCk7XG4gICAgdGhpcy5zZXRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgcmVtb3ZlVG9vbHRpcCgpIHtcbiAgICBpZiAodGhpcy50b29sdGlwRWxlbWVudCkge1xuICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLnRvb2x0aXBFbGVtZW50LCAncG8taW52aXNpYmxlJyk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIGRyYXdQYXRoKHBhdGgsIGNoYXJ0SXRlbVN0YXJ0QW5nbGUsIGNoYXJ0SXRlbUVuZEFuZ2xlKSB7XG4gICAgY29uc3QgbGFyZ2VBcmMgPSBjaGFydEl0ZW1FbmRBbmdsZSAtIGNoYXJ0SXRlbVN0YXJ0QW5nbGUgPiBNYXRoLlBJO1xuXG4gICAgY29uc3Qgc2luQWxwaGEgPSBNYXRoLnNpbihjaGFydEl0ZW1TdGFydEFuZ2xlKTtcbiAgICBjb25zdCBjb3NBbHBoYSA9IE1hdGguY29zKGNoYXJ0SXRlbVN0YXJ0QW5nbGUpO1xuXG4gICAgY29uc3Qgc2luQmV0YSA9IE1hdGguc2luKGNoYXJ0SXRlbUVuZEFuZ2xlKTtcbiAgICBjb25zdCBjb3NCZXRhID0gTWF0aC5jb3MoY2hhcnRJdGVtRW5kQW5nbGUpO1xuXG4gICAgY29uc3Qgc3RhcnRYID0gdGhpcy5jZW50ZXJYICsgY29zQWxwaGEgKiB0aGlzLmNlbnRlclg7XG4gICAgY29uc3Qgc3RhcnRZID0gdGhpcy5jZW50ZXJYICsgc2luQWxwaGEgKiB0aGlzLmNlbnRlclg7XG5cbiAgICBjb25zdCBlbmRYID0gdGhpcy5jZW50ZXJYICsgY29zQmV0YSAqIHRoaXMuY2VudGVyWDtcbiAgICBjb25zdCBlbmRZID0gdGhpcy5jZW50ZXJYICsgc2luQmV0YSAqIHRoaXMuY2VudGVyWDtcblxuICAgIGNvbnN0IHN0YXJ0SW5uZXJYID0gdGhpcy5jZW50ZXJYICsgY29zQWxwaGEgKiB0aGlzLmlubmVyUmFkaXVzO1xuICAgIGNvbnN0IHN0YXJ0SW5uZXJZID0gdGhpcy5jZW50ZXJYICsgc2luQWxwaGEgKiB0aGlzLmlubmVyUmFkaXVzO1xuXG4gICAgY29uc3QgZW5kSW5uZXJYID0gdGhpcy5jZW50ZXJYICsgY29zQmV0YSAqIHRoaXMuaW5uZXJSYWRpdXM7XG4gICAgY29uc3QgZW5kSW5uZXJZID0gdGhpcy5jZW50ZXJYICsgc2luQmV0YSAqIHRoaXMuaW5uZXJSYWRpdXM7XG5cbiAgICBjb25zdCBoYWxmR2F1Z2VDb29yZGluYXRlcyA9IFtcbiAgICAgICdNJywgc3RhcnRYLCBzdGFydFksXG4gICAgICAnQScsIHRoaXMuY2VudGVyWCwgdGhpcy5jZW50ZXJYLCAwLCAnMCwxJywgZW5kWCwgZW5kWSxcbiAgICAgICdBJywgMSwgMSwgMCwgJzAsMScsIGVuZElubmVyWCwgZW5kSW5uZXJZLFxuICAgICAgJ0EnLCB0aGlzLmlubmVyUmFkaXVzLCB0aGlzLmlubmVyUmFkaXVzLCAwLCAnMCwwJywgc3RhcnRJbm5lclgsIHN0YXJ0SW5uZXJZLFxuICAgICAgJ0EnLCAxLCAxLCAwLCAnMCwxJywgc3RhcnRYLCBzdGFydFksXG4gICAgICAnWiddLmpvaW4oJyAnKTtcblxuICAgIGNvbnN0IHBhdGhDb29yZGluYXRlcyA9IFtcbiAgICAgICdNJywgc3RhcnRYLCBzdGFydFksXG4gICAgICAnQScsIHRoaXMuY2VudGVyWCwgdGhpcy5jZW50ZXJYLCAwLCBsYXJnZUFyYyA/ICcxLDEnIDogJzAsMScsIGVuZFgsIGVuZFksXG4gICAgICAnTCcsIGVuZElubmVyWCwgZW5kSW5uZXJZLFxuICAgICAgJ0EnLCB0aGlzLmlubmVyUmFkaXVzLCB0aGlzLmlubmVyUmFkaXVzLCAwLCBsYXJnZUFyYyA/ICcxLDAnIDogJzAsMCcsIHN0YXJ0SW5uZXJYLCBzdGFydElubmVyWSxcbiAgICAgICdaJ10uam9pbignICcpO1xuXG4gICAgcmV0dXJuIHBhdGguc2V0QXR0cmlidXRlKCdkJywgdGhpcy5pc0NoYXJ0R2F1Z2VUeXBlID8gaGFsZkdhdWdlQ29vcmRpbmF0ZXMgOiBwYXRoQ29vcmRpbmF0ZXMpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldFNlcmllc1dpdGhWYWx1ZShzZXJpZXM6IEFycmF5PFBvQ2lyY3VsYXJDaGFydFNlcmllcyB8IFBvQ2hhcnRHYXVnZVNlcmllPikge1xuICAgIGNvbnN0IG5ld1NlcmllcyA9IFtdO1xuXG4gICAgc2VyaWVzLmZvckVhY2goKHNlcmllLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKHNlcmllLnZhbHVlID4gMCkge1xuICAgICAgICBuZXdTZXJpZXMucHVzaCh7IC4uLnNlcmllLCBjb2xvcjogdGhpcy5jb2xvcnNbaW5kZXhdIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5ld1NlcmllcztcbiAgfVxuXG4gIHByaXZhdGUgYW5pbWF0aW9uU2V0dXAoKSB7XG4gICAgdGhpcy5jaGFydEl0ZW1FbmRBbmdsZSA9IHRoaXMuY2hhcnRJdGVtc0VuZEFuZ2xlTGlzdFswXTtcbiAgICB0aGlzLmFuaW1hdGlvblJ1bm5pbmcgPSB0cnVlO1xuICAgIHRoaXMuZHJhd1BhdGhJbml0KCk7XG4gIH1cblxuICBwcml2YXRlIGFwcGVuZEdhdWdlQmFja2dyb3VuZFBhdGhFbGVtZW50KHN2Z1BhdGhzV3JhcHBlcjogYW55KSB7XG4gICAgY29uc3Qgc3ZnUGF0aCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3ZnOnBhdGgnLCAnc3ZnJyk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnUGF0aCwgJ2NsYXNzJywgJ3BvLWNoYXJ0LWdhdWdlLWJhc2UtcGF0aCcpO1xuICAgIHN2Z1BhdGhzV3JhcHBlci5hcHBlbmRDaGlsZChzdmdQYXRoKTtcbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMuc3ZnRWxlbWVudCwgc3ZnUGF0aHNXcmFwcGVyKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQW5nbGVSYWRpYW5zKCkge1xuICAgIHRoaXMuc2VyaWVzLmZvckVhY2goKHNlcmllLCBpbmRleCkgPT5cbiAgICAgIHRoaXMuY2hhcnRJdGVtc0VuZEFuZ2xlTGlzdFtpbmRleF0gPSB0aGlzLmNhbGN1bGF0ZUVuZEFuZ2xlKHNlcmllLnZhbHVlLCB0aGlzLnRvdGFsVmFsdWUpXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQ3VycmVudEVuZEFuZ2xlKGFuZ2xlQ3VycmVudFBvc2l0aW9uOiBudW1iZXIpIHtcbiAgICBjb25zdCBpc1NlcmllRHJhd0NvbXBsZXRlZCA9IHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSArIGFuZ2xlQ3VycmVudFBvc2l0aW9uID4gdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlICsgdGhpcy5jaGFydEl0ZW1FbmRBbmdsZTtcblxuICAgIGlmIChpc1NlcmllRHJhd0NvbXBsZXRlZCkge1xuICAgICAgcmV0dXJuICh0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgKyB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlKSAtIHBvQ2hhcnRDb21wbGV0ZUNpcmNsZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSArIGFuZ2xlQ3VycmVudFBvc2l0aW9uO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlRW5kQW5nbGUodmFsdWU6IG51bWJlciwgdG90YWxWYWx1ZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBjb25zdCBlbmRBbmdsZSA9IHZhbHVlIC8gdG90YWxWYWx1ZSAqIChNYXRoLlBJICogMik7XG5cbiAgICByZXR1cm4gdGhpcy5pc0NoYXJ0R2F1Z2VUeXBlID8gKGVuZEFuZ2xlIC8gMikgOiBlbmRBbmdsZTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlU1ZHRGltZW5zaW9ucygpIHtcbiAgICB0aGlzLmNhbGN1bGF0ZVNWR0NvbnRhaW5lckRpbWVuc2lvbnModGhpcy5jaGFydFdyYXBwZXIsIHRoaXMuY2hhcnRIZWFkZXIsIHRoaXMuY2hhcnRMZWdlbmQpO1xuXG4gICAgdGhpcy5pbm5lclJhZGl1cyA9IHRoaXMuc2V0SW5uZXJSYWRpdXModGhpcy50eXBlKTtcbiAgfVxuXG4gIHByaXZhdGUgY2hhbmdlVG9vbHRpcFBvc2l0aW9uKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgaWYgKHRoaXMudG9vbHRpcEVsZW1lbnQgJiYgdGhpcy50b29sdGlwRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ3BvLWludmlzaWJsZScpKSB7XG4gICAgICB0aGlzLnNob3dUb29sdGlwKCk7XG4gICAgfVxuXG4gICAgY29uc3QgdG9vbHRpcFBvc2l0aW9ucyA9IHRoaXMuc2V0VG9vbHRpcFBvc2l0aW9ucyhldmVudCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnRvb2x0aXBFbGVtZW50LCAnbGVmdCcsIGAke3Rvb2x0aXBQb3NpdGlvbnMubGVmdH1weGApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy50b29sdGlwRWxlbWVudCwgJ3RvcCcsIGAke3Rvb2x0aXBQb3NpdGlvbnMudG9wfXB4YCk7XG4gIH1cblxuICBwcml2YXRlIGNoYXJ0SW5pdFNldHVwKCkge1xuICAgIHRoaXMuY2FsY3VsYXRlU1ZHRGltZW5zaW9ucygpO1xuICAgIHRoaXMuY2FsY3VsYXRlVG90YWxWYWx1ZSgpO1xuICAgIHRoaXMuY2FsY3VsYXRlQW5nbGVSYWRpYW5zKCk7XG4gICAgdGhpcy5jcmVhdGVTVkdFbGVtZW50cygpO1xuICAgIHRoaXMuYW5pbWF0aW9uU2V0dXAoKTtcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tpbmdJZlNjcm9sbHNXaXRoUG9QYWdlKCkge1xuICAgIGNvbnN0IHBvUGFnZUNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdwby1wYWdlLWNvbnRlbnQnKTtcblxuICAgIHJldHVybiBwb1BhZ2VDb250ZW50Lmxlbmd0aCA/IHBvUGFnZUNvbnRlbnRbMF0gOiB3aW5kb3c7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVBhdGgoc2VyaWU6IFBvQ2lyY3VsYXJDaGFydFNlcmllcyB8IFBvQ2hhcnRHYXVnZVNlcmllLCBzdmdQYXRoc1dyYXBwZXI6IGFueSkge1xuICAgIGNvbnN0IHN2Z1BhdGggPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpwYXRoJywgJ3N2ZycpO1xuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnUGF0aCwgJ2NsYXNzJywgJ3BvLXBhdGgtaXRlbScpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1BhdGgsICdmaWxsJywgc2VyaWUuY29sb3IpO1xuXG4gICAgdGhpcy5zZXRFbGVtZW50QXR0cmlidXRlcyhzdmdQYXRoLCBzZXJpZSk7XG5cbiAgICBzdmdQYXRoc1dyYXBwZXIuYXBwZW5kQ2hpbGQoc3ZnUGF0aCk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMuc3ZnRWxlbWVudCwgc3ZnUGF0aHNXcmFwcGVyKTtcblxuICAgIHRoaXMuc3ZnUGF0aEVsZW1lbnRzTGlzdC5wdXNoKHN2Z1BhdGgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQYXRocygpIHtcbiAgICBjb25zdCBzdmdQYXRoc1dyYXBwZXIgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpnJywgJ3N2ZycpO1xuXG4gICAgaWYgKHRoaXMuaXNDaGFydEdhdWdlVHlwZSkge1xuICAgICAgdGhpcy5hcHBlbmRHYXVnZUJhY2tncm91bmRQYXRoRWxlbWVudChzdmdQYXRoc1dyYXBwZXIpO1xuICAgICAgLy8gVHJhdGFtZW50byBwYXJhIGV2aXRhciBxdWUgbyBwYXRoIGRlc2VuaGUgb3MgYXJjb3MgcmVmZXJlbnRlcyBhbyBib3JkZXIgcmFkaXVzIGRvIHBhdGguXG4gICAgICBpZiAodGhpcy5pc1NlcmllVmFsdWVFcXVhbFplcm8oKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zZXJpZXMuZm9yRWFjaChzZXJpZSA9PiB0aGlzLmNyZWF0ZVBhdGgoc2VyaWUsIHN2Z1BhdGhzV3JhcHBlcikpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVUZXh0KHNlcmllOiBQb0NpcmN1bGFyQ2hhcnRTZXJpZXMgfCBQb0NoYXJ0R2F1Z2VTZXJpZSkge1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IHNlcmllO1xuXG4gICAgY29uc3Qgc3ZnRyA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3ZnOmcnLCAnc3ZnJyk7XG4gICAgY29uc3Qgc3ZnVGV4dCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3ZnOnRleHQnLCAnc3ZnJyk7XG5cbiAgICBjb25zdCBmb250U2l6ZSA9IHRoaXMuZ2V0Rm9udFNpemUoKTtcbiAgICBjb25zdCB0ZXh0Q29sb3IgPSB0aGlzLmdldFRleHRDb2xvcihzZXJpZS5jb2xvcik7XG5cbiAgICBzdmdUZXh0LnRleHRDb250ZW50ID0gdGhpcy5nZXRQZXJjZW50VmFsdWUodmFsdWUsIHRoaXMudG90YWxWYWx1ZSkgKyAnJScgO1xuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnVGV4dCwgJ2NsYXNzJywgJ3BvLXBhdGgtaXRlbScpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1RleHQsICdmaWxsJywgdGV4dENvbG9yKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdUZXh0LCAnZm9udC1zaXplJywgZm9udFNpemUpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1RleHQsICdmaWxsLW9wYWNpdHknLCAnMCcpO1xuXG4gICAgdGhpcy5zZXRFbGVtZW50QXR0cmlidXRlcyhzdmdUZXh0LCBzZXJpZSk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHN2Z0csIHN2Z1RleHQpO1xuXG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLnN2Z0VsZW1lbnQsIHN2Z0cpO1xuICAgIHRoaXMuc3ZnVGV4dEVsZW1lbnRzTGlzdC5wdXNoKHN2Z1RleHQpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVUZXh0cygpIHtcbiAgICBpZiAodGhpcy50eXBlID09PSBQb0NoYXJ0VHlwZS5Eb251dCkge1xuICAgICAgdGhpcy5zZXJpZXMuZm9yRWFjaChzZXJpZSA9PiB0aGlzLmNyZWF0ZVRleHQoc2VyaWUpKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVNWR0VsZW1lbnRzKCkge1xuICAgIGNvbnN0IHZpZXdCb3hIZWlnaHQgPSB0aGlzLmlzQ2hhcnRHYXVnZVR5cGUgPyB0aGlzLmNlbnRlclggKyAodGhpcy5jZW50ZXJYICogcG9DaGFydEdhdWdlU2VyaWVXaWR0aCkgOiB0aGlzLmNoYXJ0V3JhcHBlcjtcbiAgICBjb25zdCBwcmVzZXJ2ZUFzcGVjdFJhdGlvID0gdGhpcy5pc0NoYXJ0R2F1Z2VUeXBlID8gJ3hNaWRZTWF4JyA6ICd4TWlkWU1pbic7XG5cbiAgICB0aGlzLnN2Z0VsZW1lbnQgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpzdmcnLCAnc3ZnJyk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICd2aWV3Qm94JywgYDAgMCAke3RoaXMuY2hhcnRXcmFwcGVyfSAke3ZpZXdCb3hIZWlnaHR9YCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAncHJlc2VydmVBc3BlY3RSYXRpbycsIGAke3ByZXNlcnZlQXNwZWN0UmF0aW99IG1lZXRgKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICdjbGFzcycsICdwby1jaGFydC1zdmctZWxlbWVudCcpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ3dpZHRoJywgYCR7dGhpcy5jZW50ZXJYfWApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ2hlaWdodCcsIGAke3RoaXMuc3ZnSGVpZ2h0fWApO1xuXG4gICAgdGhpcy5zdmdDb250YWluZXIubmF0aXZlRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnN2Z0VsZW1lbnQpO1xuXG4gICAgdGhpcy5jcmVhdGVQYXRocygpO1xuICAgIHRoaXMuY3JlYXRlVGV4dHMoKTtcbiAgfVxuXG4gIHByaXZhdGUgZHJhd1BhdGhJbml0KCkge1xuICAgIGlmICghdGhpcy5hbmltYXRpb25SdW5uaW5nKSB7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuZHJhd1NlcmllcygpKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGRyYXdTZXJpZXMoY3VycmVudFNlcmllSW5kZXg6IG51bWJlciA9IDAsIGFuZ2xlQ3VycmVudFBvc2l0aW9uOiBudW1iZXIgPSAwKSB7XG4gICAgY29uc3QgaXNGaW5pc2hlZERyYXdpbmdDdXJyZW50U2VyaWVzID0gYW5nbGVDdXJyZW50UG9zaXRpb24gPiB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlO1xuICAgIGNvbnN0IGlzRmluaXNoZWREcmF3aW5nQWxsU2VyaWVzID0gY3VycmVudFNlcmllSW5kZXggPT09IHRoaXMuc3ZnUGF0aEVsZW1lbnRzTGlzdC5sZW5ndGg7XG5cbiAgICBpZiAoIGlzRmluaXNoZWREcmF3aW5nQWxsU2VyaWVzICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICggaXNGaW5pc2hlZERyYXdpbmdDdXJyZW50U2VyaWVzICkge1xuXG4gICAgICB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgPSB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgKyB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlO1xuICAgICAgY3VycmVudFNlcmllSW5kZXgrKztcbiAgICAgIHRoaXMuY2hhcnRJdGVtRW5kQW5nbGUgPSB0aGlzLmNoYXJ0SXRlbXNFbmRBbmdsZUxpc3RbY3VycmVudFNlcmllSW5kZXhdO1xuICAgICAgYW5nbGVDdXJyZW50UG9zaXRpb24gPSAwO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIGFuZ2xlQ3VycmVudFBvc2l0aW9uICs9IHBvQ2hhcnRBbmdsZVN0ZXBJbnRlcnZhbDtcblxuICAgICAgdGhpcy5kcmF3UGF0aChcbiAgICAgICAgdGhpcy5zdmdQYXRoRWxlbWVudHNMaXN0W2N1cnJlbnRTZXJpZUluZGV4XSxcbiAgICAgICAgdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlLFxuICAgICAgICB0aGlzLmNhbGN1bGF0ZUN1cnJlbnRFbmRBbmdsZShhbmdsZUN1cnJlbnRQb3NpdGlvbilcbiAgICAgICk7XG5cbiAgICAgIHRoaXMuc2V0VGV4dFByb3BlcnRpZXMoXG4gICAgICAgIHRoaXMuc3ZnVGV4dEVsZW1lbnRzTGlzdFtjdXJyZW50U2VyaWVJbmRleF0sXG4gICAgICAgIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSxcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVDdXJyZW50RW5kQW5nbGUoYW5nbGVDdXJyZW50UG9zaXRpb24pXG4gICAgICApO1xuICAgIH1cblxuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5kcmF3U2VyaWVzLmJpbmQodGhpcywgY3VycmVudFNlcmllSW5kZXgsIGFuZ2xlQ3VycmVudFBvc2l0aW9uKSk7XG4gIH1cblxuICBwcml2YXRlIGVtaXRFdmVudE9uRW50ZXIoZXZlbnQ6IFBvRG9udXRDaGFydFNlcmllcyB8IFBvUGllQ2hhcnRTZXJpZXMgfCBQb0NoYXJ0R2F1Z2VTZXJpZSkge1xuICAgIHRoaXMub25TZXJpZUhvdmVyLm5leHQoZXZlbnQpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRGb250U2l6ZSgpIHtcbiAgICBjb25zdCBmb250U2l6ZVBvcmNlbnQgPSAwLjA0O1xuXG4gICAgY29uc3QgZm9udFNpemUgPSBmb250U2l6ZVBvcmNlbnQgKiB0aGlzLmNoYXJ0V3JhcHBlcjtcblxuICAgIHJldHVybiBgJHtmb250U2l6ZS50b0ZpeGVkKDApfXB4YDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UGVyY2VudFZhbHVlKHZhbHVlOiBudW1iZXIsIHRvdGFsVmFsdWU6IG51bWJlcikge1xuICAgIGNvbnN0IHBlcmNlbnRWYWx1ZSA9ICh2YWx1ZSAvIHRvdGFsVmFsdWUpICogMTAwO1xuXG4gICAgY29uc3QgZmxvYXRQZXJjZW50VmFsdWUgPSBjb252ZXJ0TnVtYmVyVG9EZWNpbWFsKHBlcmNlbnRWYWx1ZSwgMik7XG5cbiAgICByZXR1cm4gU3RyaW5nKGZsb2F0UGVyY2VudFZhbHVlKS5yZXBsYWNlKCcuJywgJywnKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VGV4dENvbG9yKGNvbG9yOiBzdHJpbmcpIHtcbiAgICBpZiAoUG9TZXJpZXNUZXh0QmxhY2suaW5jbHVkZXMoY29sb3IpKSB7XG4gICAgICByZXR1cm4gcG9DaGFydEJsYWNrQ29sb3I7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBvQ2hhcnRXaGl0ZUNvbG9yO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUb29sdGlwVmFsdWUodmFsdWU6IG51bWJlcikge1xuICAgIGlmICh0aGlzLnR5cGUgPT09IFBvQ2hhcnRUeXBlLlBpZSkge1xuICAgICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuZ2V0UGVyY2VudFZhbHVlKHZhbHVlLCB0aGlzLnRvdGFsVmFsdWUpICsgJyUnO1xuICB9XG5cbiAgcHJpdmF0ZSBpc1NlcmllVmFsdWVFcXVhbFplcm8oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc2VyaWVzLmxlbmd0aCAmJiB0aGlzLnNlcmllc1swXS52YWx1ZSA9PT0gMDtcbiAgfVxuXG4gIHByaXZhdGUgb25Nb3VzZUNsaWNrKCkge1xuICAgIGxldCBzZXJpZU9uQ2xpY2s6IFBvRG9udXRDaGFydFNlcmllcyB8IFBvUGllQ2hhcnRTZXJpZXMgfCBQb0NoYXJ0R2F1Z2VTZXJpZTtcblxuICAgIGlmICh0aGlzLmlzQ2hhcnRHYXVnZVR5cGUpIHtcbiAgICAgIGNvbnN0IHsgY29sb3IsIC4uLnNlcmllIH0gPSB0aGlzLnNlcmllc1swXTtcbiAgICAgIHNlcmllT25DbGljayA9IHNlcmllO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZXJpZU9uQ2xpY2sgPSB7IGNhdGVnb3J5OiB0aGlzLmNoYXJ0RWxlbWVudENhdGVnb3J5LCB2YWx1ZTogdGhpcy5jaGFydEVsZW1lbnRWYWx1ZSB9O1xuICAgIH1cblxuICAgIHRoaXMub25TZXJpZUNsaWNrLm5leHQoc2VyaWVPbkNsaWNrKTtcbiAgfVxuXG4gIHByaXZhdGUgb25Nb3VzZUVudGVyKGV2ZW50KSB7XG4gICAgbGV0IHNlcmllT25FbnRlcjogUG9Eb251dENoYXJ0U2VyaWVzIHwgUG9QaWVDaGFydFNlcmllcyB8IFBvQ2hhcnRHYXVnZVNlcmllO1xuXG4gICAgaWYgKCF0aGlzLmlzQ2hhcnRHYXVnZVR5cGUpIHtcbiAgICAgIHRoaXMudG9vbHRpcEVsZW1lbnQgPSB0aGlzLmNoYXJ0Qm9keS5uYXRpdmVFbGVtZW50Lmxhc3RDaGlsZDtcbiAgICAgIHRoaXMuY2hhcnRFbGVtZW50Q2F0ZWdvcnkgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlTlMobnVsbCwgJ2RhdGEtdG9vbHRpcC1jYXRlZ29yeScpO1xuICAgICAgdGhpcy5jaGFydEVsZW1lbnRWYWx1ZSA9IGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGVOUyhudWxsLCAnZGF0YS10b29sdGlwLXZhbHVlJyk7XG4gICAgICB0aGlzLnRvb2x0aXBUZXh0ID0gZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZU5TKG51bGwsICdkYXRhLXRvb2x0aXAtdGV4dCcpO1xuICAgICAgdGhpcy5zaG93VG9vbHRpcCgpO1xuICAgICAgdGhpcy5jaGFuZ2VUb29sdGlwUG9zaXRpb24oZXZlbnQpO1xuXG4gICAgICBzZXJpZU9uRW50ZXIgPSB7IGNhdGVnb3J5OiB0aGlzLmNoYXJ0RWxlbWVudENhdGVnb3J5LCB2YWx1ZTogdGhpcy5jaGFydEVsZW1lbnRWYWx1ZSB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB7IGNvbG9yLCAuLi5zZXJpZSB9ID0gdGhpcy5zZXJpZXNbMF07XG5cbiAgICAgIHRoaXMuY2hhcnRFbGVtZW50RGVzY3JpcHRpb24gPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlTlMobnVsbCwgJ2RhdGEtdG9vbHRpcC1jYXRlZ29yeScpO1xuICAgICAgc2VyaWVPbkVudGVyID0gc2VyaWU7XG4gICAgfVxuXG4gICAgdGhpcy5lbWl0RXZlbnRPbkVudGVyKHNlcmllT25FbnRlcik7XG4gIH1cblxuICBwcml2YXRlIG9uV2luZG93UmVzaXplKCkge1xuICAgIHRoaXMuY2FsY3VsYXRlU1ZHRGltZW5zaW9ucygpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ3dpZHRoJywgYCR7dGhpcy5jZW50ZXJYfWApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ2hlaWdodCcsIGAke3RoaXMuc3ZnSGVpZ2h0fWApO1xuICAgIHRoaXMud2luZG93UmVzaXplRW1pdHRlci5uZXh0KCk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZVdpbmRvd1Jlc2l6ZUxpc3RlbmVyKCkge1xuICAgIGlmICh0aGlzLndpbmRvd1Jlc2l6ZUxpc3RlbmVyKSB7XG4gICAgICB0aGlzLndpbmRvd1Jlc2l6ZUxpc3RlbmVyKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVXaW5kb3dTY3JvbGxMaXN0ZW5lcigpIHtcbiAgICBpZiAodGhpcy53aW5kb3dTY3JvbGxMaXN0ZW5lcikge1xuICAgICAgdGhpcy53aW5kb3dTY3JvbGxMaXN0ZW5lcigpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgbGV0IGNoYXJ0U2VyaWVzOiBBcnJheTxzdHJpbmc+ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wby1wYXRoLWl0ZW0nKTtcbiAgICBjaGFydFNlcmllcyA9IEFycmF5LmZyb20oY2hhcnRTZXJpZXMpO1xuICAgIGNoYXJ0U2VyaWVzLmZvckVhY2goc2VyaWUgPT4ge1xuICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4oc2VyaWUsICdjbGljaycsIHRoaXMub25Nb3VzZUNsaWNrLmJpbmQodGhpcykpO1xuICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4oc2VyaWUsICdtb3VzZWVudGVyJywgdGhpcy5vbk1vdXNlRW50ZXIuYmluZCh0aGlzKSk7XG5cbiAgICAgIGlmICghdGhpcy5pc0NoYXJ0R2F1Z2VUeXBlKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHNlcmllLCAnbW91c2Vtb3ZlJywgdGhpcy5jaGFuZ2VUb29sdGlwUG9zaXRpb24uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHNlcmllLCAnbW91c2VsZWF2ZScsIHRoaXMucmVtb3ZlVG9vbHRpcC5iaW5kKHRoaXMpKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbih3aW5kb3csICdyZXNpemUnLCB0aGlzLm9uV2luZG93UmVzaXplLmJpbmQodGhpcykpO1xuICAgIHRoaXMud2luZG93U2Nyb2xsTGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmNoZWNraW5nSWZTY3JvbGxzV2l0aFBvUGFnZSgpLCAnc2Nyb2xsJywgdGhpcy5yZW1vdmVUb29sdGlwLmJpbmQodGhpcykpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRJbm5lclJhZGl1cyh0eXBlOiBQb0NoYXJ0VHlwZSkge1xuICAgIGxldCBzZXJpZVdpZHRoO1xuXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIFBvQ2hhcnRUeXBlLkRvbnV0OiB7XG4gICAgICAgIHNlcmllV2lkdGggPSBwb0NoYXJ0RG9udXRTZXJpZVdpZHRoO1xuXG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBQb0NoYXJ0VHlwZS5HYXVnZToge1xuICAgICAgICBzZXJpZVdpZHRoID0gcG9DaGFydEdhdWdlU2VyaWVXaWR0aDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFBvQ2hhcnRUeXBlLlBpZToge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5jZW50ZXJYIC0gKHRoaXMuY2VudGVyWCAqIHNlcmllV2lkdGgpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRUZXh0UHJvcGVydGllcyh0ZXh0LCBzdGFydEFuZ2xlOiBudW1iZXIsIGVuZEFuZ2xlOiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy50eXBlID09PSBQb0NoYXJ0VHlwZS5Eb251dCkge1xuICAgICAgLy8gdXRpbGl6YWRvIHBhcmEgcmVjdXBlcmFyIG8gYW5ndWxvIGRvIG1laW8sIGVudHJlIG8gaW5pY2lvIGUgZmltIHBhcmEgY2VudHJhbGl6YXIgbyB0ZXh0b1xuICAgICAgY29uc3QgY2VudGVyQW5nbGUgPSAoc3RhcnRBbmdsZSArIGVuZEFuZ2xlKSAvIDI7XG4gICAgICBjb25zdCB0ZXh0Qm94ID0gdGV4dC5nZXRCQm94KCk7XG5cbiAgICAgIGNvbnN0IGhhbGZUZXh0V2lkdGggPSB0ZXh0Qm94LndpZHRoIC8gMjtcbiAgICAgIGNvbnN0IGhhbGZUZXh0SGVpZ2h0ID0gdGV4dEJveC5oZWlnaHQgLyAyO1xuXG4gICAgICAvLyByYWRpdXMgaW50ZXJubyAoY2lyY3VsbyBicmFuY28pICsgYSBtZXRhZGUgZGEgZGlmZXJlbsOnYSBlbnRyZSB0YW1hbmhvIGRvIGNlbnRybyBlIHJhZGl1cyBpbnRlcm5vXG4gICAgICBjb25zdCByYWRpdXMgPSB0aGlzLmlubmVyUmFkaXVzICsgKHRoaXMuY2VudGVyWCAtIHRoaXMuaW5uZXJSYWRpdXMpIC8gMjtcblxuICAgICAgY29uc3QgeENvb3JkaW5hdGUgPSByYWRpdXMgKiBNYXRoLmNvcyhjZW50ZXJBbmdsZSkgKyB0aGlzLmNlbnRlclggLSAoaGFsZlRleHRXaWR0aCk7XG4gICAgICBjb25zdCB5Q29vcmRpbmF0ZSA9IHJhZGl1cyAqIE1hdGguc2luKGNlbnRlckFuZ2xlKSArIHRoaXMuY2VudGVyWCArIChoYWxmVGV4dEhlaWdodCAvIDIpO1xuICAgICAgdGV4dC5zZXRBdHRyaWJ1dGUoJ3gnLCB4Q29vcmRpbmF0ZSk7XG4gICAgICB0ZXh0LnNldEF0dHJpYnV0ZSgneScsIHlDb29yZGluYXRlKTtcbiAgICAgIHRleHQuc2V0QXR0cmlidXRlKCdmaWxsLW9wYWNpdHknLCAnMScpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0VG9vbHRpcFBvc2l0aW9ucyhldmVudDogTW91c2VFdmVudCkge1xuICAgIGNvbnN0IGRpc3BsYWNlbWVudDogbnVtYmVyID0gODtcblxuICAgIHJldHVybiB7XG4gICAgICBsZWZ0OiBldmVudC5jbGllbnRYIC0gdGhpcy50b29sdGlwRWxlbWVudC5vZmZzZXRXaWR0aCAvIDIsXG4gICAgICB0b3A6IGV2ZW50LmNsaWVudFkgLSB0aGlzLnRvb2x0aXBFbGVtZW50Lm9mZnNldEhlaWdodCAtIGRpc3BsYWNlbWVudFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIHNldEVsZW1lbnRBdHRyaWJ1dGVzKHN2Z0VsZW1lbnQsIHNlcmllKSB7XG4gICAgY29uc3QgeyB2YWx1ZSwgY2F0ZWdvcnksIHRvb2x0aXAsIGRlc2NyaXB0aW9uIH0gPSBzZXJpZTtcblxuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z0VsZW1lbnQsICdkYXRhLXRvb2x0aXAtdmFsdWUnLCBgJHt2YWx1ZX1gKTtcblxuICAgIGlmICh0aGlzLmlzQ2hhcnRHYXVnZVR5cGUpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z0VsZW1lbnQsICdkYXRhLXRvb2x0aXAtZGVzY3JpcHRpb24nLCBkZXNjcmlwdGlvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHRvb2x0aXBWYWx1ZSA9IHRoaXMuZ2V0VG9vbHRpcFZhbHVlKHZhbHVlKTtcblxuICAgICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnRWxlbWVudCwgJ2RhdGEtdG9vbHRpcC1jYXRlZ29yeScsIGNhdGVnb3J5KTtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z0VsZW1lbnQsICdkYXRhLXRvb2x0aXAtdGV4dCcsIHRvb2x0aXAgfHwgYCR7Y2F0ZWdvcnl9OiAke3Rvb2x0aXBWYWx1ZX1gKTtcbiAgICB9XG5cbiAgfVxuXG4gIHByaXZhdGUgc2hvd1Rvb2x0aXAoKSB7XG4gICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLnRvb2x0aXBFbGVtZW50LCAncG8taW52aXNpYmxlJyk7XG4gIH1cblxufVxuIl19