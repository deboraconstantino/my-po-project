import * as tslib_1 from "tslib";
import { Component, ElementRef, EventEmitter, HostListener, Input, Output, ViewChild } from '@angular/core';
import { PoMultiselectSearchComponent } from './../po-multiselect-search/po-multiselect-search.component';
/**
 * @docsPrivate
 *
 * @description
 *
 * Componente que construíra o dropdown, contendo o campo de pesquisa e os itens para seleção.
 */
let PoMultiselectDropdownComponent = class PoMultiselectDropdownComponent {
    /**
     * @docsPrivate
     *
     * @description
     *
     * Componente que construíra o dropdown, contendo o campo de pesquisa e os itens para seleção.
     */
    constructor() {
        this.scrollTop = 0;
        this.show = false;
        this.haveOptions = false;
        /** Propriedade que indica se o campo de pesquisa deverá ser escondido. */
        this.hideSearch = false;
        /** Propriedade que recebe a lista de opções selecionadas. */
        this.selectedValues = [];
        /** Propriedade que recebe a lista de opções que deverão ser criadas no dropdown. */
        this.options = [];
        /** Evento disparado a cada tecla digitada na pesquisa. */
        this.changeSearch = new EventEmitter();
        /** Evento disparado a cada alteração na lista das opções selecionadas. */
        this.change = new EventEmitter();
        /**
         * Evento disparado quando for detectada uma ação que necessite fechar o dropdown.
         * Por exemplo, no caso de ser teclado TAB dentro do dropdown, então é disparado este evento
         * para notificar o componente principal que deve fechar o dropdown.
         */
        this.closeDropdown = new EventEmitter();
    }
    scrollTo(index) {
        this.scrollTop = (index <= 2) ? 0 : (index * 44) - 88;
    }
    isSelectedItem(option) {
        return this.selectedValues.some(selectedItem => selectedItem === option.value);
    }
    clickItem(check, option) {
        this.updateSelectedValues(check, option);
        if (!this.hideSearch) {
            this.searchElement.setFocus();
        }
    }
    updateSelectedValues(checked, option) {
        if (checked) {
            this.selectedValues.push(option.value);
        }
        else {
            const indexSelectedValues = this.selectedValues.indexOf(option.value);
            this.selectedValues.splice(indexSelectedValues, 1);
        }
        this.change.emit(this.selectedValues);
    }
    callChangeSearch(event) {
        this.changeSearch.emit(event);
    }
    onKeydown(event) {
        if (event.keyCode === 9) {
            this.closeDropdown.emit();
        }
    }
    controlVisibility(toOpen) {
        this.show = toOpen;
        this.checkInitialOptions();
        setTimeout(() => {
            if (toOpen && this.searchElement && !this.hideSearch) {
                this.searchElement.setFocus();
                this.searchElement.clean();
            }
        });
    }
    checkInitialOptions() {
        if (this.options.length) {
            this.haveOptions = true;
        }
    }
};
tslib_1.__decorate([
    Input('p-hide-search'),
    tslib_1.__metadata("design:type", Boolean)
], PoMultiselectDropdownComponent.prototype, "hideSearch", void 0);
tslib_1.__decorate([
    Input('p-literals'),
    tslib_1.__metadata("design:type", Object)
], PoMultiselectDropdownComponent.prototype, "literals", void 0);
tslib_1.__decorate([
    Input('p-placeholder-search'),
    tslib_1.__metadata("design:type", String)
], PoMultiselectDropdownComponent.prototype, "placeholderSearch", void 0);
tslib_1.__decorate([
    Input('p-selected-values'),
    tslib_1.__metadata("design:type", Array)
], PoMultiselectDropdownComponent.prototype, "selectedValues", void 0);
tslib_1.__decorate([
    Input('p-options'),
    tslib_1.__metadata("design:type", Array)
], PoMultiselectDropdownComponent.prototype, "options", void 0);
tslib_1.__decorate([
    Output('p-change-search'),
    tslib_1.__metadata("design:type", Object)
], PoMultiselectDropdownComponent.prototype, "changeSearch", void 0);
tslib_1.__decorate([
    Output('p-change'),
    tslib_1.__metadata("design:type", Object)
], PoMultiselectDropdownComponent.prototype, "change", void 0);
tslib_1.__decorate([
    Output('p-close-dropdown'),
    tslib_1.__metadata("design:type", Object)
], PoMultiselectDropdownComponent.prototype, "closeDropdown", void 0);
tslib_1.__decorate([
    ViewChild('container', { read: ElementRef, static: true }),
    tslib_1.__metadata("design:type", ElementRef)
], PoMultiselectDropdownComponent.prototype, "container", void 0);
tslib_1.__decorate([
    ViewChild('ulElement', { read: ElementRef, static: true }),
    tslib_1.__metadata("design:type", ElementRef)
], PoMultiselectDropdownComponent.prototype, "ulElement", void 0);
tslib_1.__decorate([
    ViewChild('searchElement', { static: false }),
    tslib_1.__metadata("design:type", PoMultiselectSearchComponent)
], PoMultiselectDropdownComponent.prototype, "searchElement", void 0);
tslib_1.__decorate([
    HostListener('keydown', ['$event']),
    tslib_1.__metadata("design:type", Function),
    tslib_1.__metadata("design:paramtypes", [Object]),
    tslib_1.__metadata("design:returntype", void 0)
], PoMultiselectDropdownComponent.prototype, "onKeydown", null);
PoMultiselectDropdownComponent = tslib_1.__decorate([
    Component({
        selector: 'po-multiselect-dropdown',
        template: "<div #container class=\"po-multiselect-container\" [hidden]=\"!show\">\n\n  <po-multiselect-search #searchElement\n    *ngIf=\"!hideSearch && haveOptions\"\n    [p-literals]=\"literals\"\n    [p-placeholder]=\"placeholderSearch\"\n    (p-change)=\"callChangeSearch($event)\">\n  </po-multiselect-search>\n\n  <ul class=\"po-multiselect-items-container\" [scrollTop]=\"scrollTop\" #ulElement>\n    <div *ngIf=\"!options.length\" class=\"po-multiselect-container-no-data po-text-center\">\n      <span> {{ literals.noData }}</span>\n    </div>\n\n    <po-multiselect-item *ngFor=\"let option of options\"\n      [p-label]=\"option.label\"\n      [p-selected]=\"isSelectedItem(option)\"\n      (p-change)=\"clickItem($event, option)\">\n    </po-multiselect-item>\n  </ul>\n</div>\n"
    })
], PoMultiselectDropdownComponent);
export { PoMultiselectDropdownComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbXVsdGlzZWxlY3QtZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvcnRpbmFyaS9wb3J0aW5hcmktdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wby1maWVsZC9wby1tdWx0aXNlbGVjdC9wby1tdWx0aXNlbGVjdC1kcm9wZG93bi9wby1tdWx0aXNlbGVjdC1kcm9wZG93bi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFJNUcsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sNERBQTRELENBQUM7QUFFMUc7Ozs7OztHQU1HO0FBS0gsSUFBYSw4QkFBOEIsR0FBM0MsTUFBYSw4QkFBOEI7SUFYM0M7Ozs7OztPQU1HO0lBQ0g7UUFNRSxjQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsU0FBSSxHQUFZLEtBQUssQ0FBQztRQUN0QixnQkFBVyxHQUFZLEtBQUssQ0FBQztRQUU3QiwwRUFBMEU7UUFDbEQsZUFBVSxHQUFhLEtBQUssQ0FBQztRQVFyRCw2REFBNkQ7UUFDakMsbUJBQWMsR0FBZSxFQUFFLENBQUM7UUFFNUQsb0ZBQW9GO1FBQ2hFLFlBQU8sR0FBK0IsRUFBRSxDQUFDO1FBRTdELDBEQUEwRDtRQUMvQixpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFN0QsMEVBQTBFO1FBQ3RELFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRWhEOzs7O1dBSUc7UUFDeUIsa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBOERqRSxDQUFDO0lBeERDLFFBQVEsQ0FBQyxLQUFLO1FBQ1osSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENB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UyxDQUFDLFdBQVcsRUFBRSxFQUFDLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDO3NDQUFZLFVBQVU7aUVBQUM7QUFDbEM7SUFBOUMsU0FBUyxDQUFDLGVBQWUsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsQ0FBQztzQ0FBZ0IsNEJBQTRCO3FFQUFDO0FBa0MzRjtJQURDLFlBQVksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQzs7OzsrREFLbkM7QUExRVUsOEJBQThCO0lBSjFDLFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSx5QkFBeUI7UUFDbkMsdXhCQUF1RDtLQUN4RCxDQUFDO0dBQ1csOEJBQThCLENBOEYxQztTQTlGWSw4QkFBOEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSG9zdExpc3RlbmVyLCBJbnB1dCwgT3V0cHV0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgUG9NdWx0aXNlbGVjdExpdGVyYWxzIH0gZnJvbSAnLi4vLi4vaW5kZXgnO1xuaW1wb3J0IHsgUG9NdWx0aXNlbGVjdE9wdGlvbiB9IGZyb20gJy4uL3BvLW11bHRpc2VsZWN0LW9wdGlvbi5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9NdWx0aXNlbGVjdFNlYXJjaENvbXBvbmVudCB9IGZyb20gJy4vLi4vcG8tbXVsdGlzZWxlY3Qtc2VhcmNoL3BvLW11bHRpc2VsZWN0LXNlYXJjaC5jb21wb25lbnQnO1xuXG4vKipcbiAqIEBkb2NzUHJpdmF0ZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIENvbXBvbmVudGUgcXVlIGNvbnN0cnXDrXJhIG8gZHJvcGRvd24sIGNvbnRlbmRvIG8gY2FtcG8gZGUgcGVzcXVpc2EgZSBvcyBpdGVucyBwYXJhIHNlbGXDp8Ojby5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tbXVsdGlzZWxlY3QtZHJvcGRvd24nLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tbXVsdGlzZWxlY3QtZHJvcGRvd24uY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFBvTXVsdGlzZWxlY3REcm9wZG93bkNvbXBvbmVudCB7XG5cbiAgc2Nyb2xsVG9wID0gMDtcbiAgc2hvdzogYm9vbGVhbiA9IGZhbHNlO1xuICBoYXZlT3B0aW9uczogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKiBQcm9wcmllZGFkZSBxdWUgaW5kaWNhIHNlIG8gY2FtcG8gZGUgcGVzcXVpc2EgZGV2ZXLDoSBzZXIgZXNjb25kaWRvLiAqL1xuICBASW5wdXQoJ3AtaGlkZS1zZWFyY2gnKSBoaWRlU2VhcmNoPzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKiBQcm9wcmllZGFkZSBxdWUgcXVlIHJlY2ViZSBhcyBsaXRlcmFpcyBkZWZpbmlkYXMgbm8gY29tcG9uZW50ZSBgcG8tbXVsdGlzZWxlY3RgLiAqL1xuICBASW5wdXQoJ3AtbGl0ZXJhbHMnKSBsaXRlcmFscz86IFBvTXVsdGlzZWxlY3RMaXRlcmFscztcblxuICAvKiogUGxhY2Vob2xkZXIgZG8gY2FtcG8gZGUgcGVzcXVpc2EuICovXG4gIEBJbnB1dCgncC1wbGFjZWhvbGRlci1zZWFyY2gnKSBwbGFjZWhvbGRlclNlYXJjaDogc3RyaW5nO1xuXG4gIC8qKiBQcm9wcmllZGFkZSBxdWUgcmVjZWJlIGEgbGlzdGEgZGUgb3DDp8O1ZXMgc2VsZWNpb25hZGFzLiAqL1xuICBASW5wdXQoJ3Atc2VsZWN0ZWQtdmFsdWVzJykgc2VsZWN0ZWRWYWx1ZXM6IEFycmF5PGFueT4gPSBbXTtcblxuICAvKiogUHJvcHJpZWRhZGUgcXVlIHJlY2ViZSBhIGxpc3RhIGRlIG9ww6fDtWVzIHF1ZSBkZXZlcsOjbyBzZXIgY3JpYWRhcyBubyBkcm9wZG93bi4gKi9cbiAgQElucHV0KCdwLW9wdGlvbnMnKSBvcHRpb25zOiBBcnJheTxQb011bHRpc2VsZWN0T3B0aW9uPiA9IFtdO1xuXG4gIC8qKiBFdmVudG8gZGlzcGFyYWRvIGEgY2FkYSB0ZWNsYSBkaWdpdGFkYSBuYSBwZXNxdWlzYS4gKi9cbiAgQE91dHB1dCgncC1jaGFuZ2Utc2VhcmNoJykgY2hhbmdlU2VhcmNoID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8qKiBFdmVudG8gZGlzcGFyYWRvIGEgY2FkYSBhbHRlcmHDp8OjbyBuYSBsaXN0YSBkYXMgb3DDp8O1ZXMgc2VsZWNpb25hZGFzLiAqL1xuICBAT3V0cHV0KCdwLWNoYW5nZScpIGNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAvKipcbiAgICogRXZlbnRvIGRpc3BhcmFkbyBxdWFuZG8gZm9yIGRldGVjdGFkYSB1bWEgYcOnw6NvIHF1ZSBuZWNlc3NpdGUgZmVjaGFyIG8gZHJvcGRvd24uXG4gICAqIFBvciBleGVtcGxvLCBubyBjYXNvIGRlIHNlciB0ZWNsYWRvIFRBQiBkZW50cm8gZG8gZHJvcGRvd24sIGVudMOjbyDDqSBkaXNwYXJhZG8gZXN0ZSBldmVudG9cbiAgICogcGFyYSBub3RpZmljYXIgbyBjb21wb25lbnRlIHByaW5jaXBhbCBxdWUgZGV2ZSBmZWNoYXIgbyBkcm9wZG93bi5cbiAgICovXG4gIEBPdXRwdXQoJ3AtY2xvc2UtZHJvcGRvd24nKSBjbG9zZURyb3Bkb3duID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIEBWaWV3Q2hpbGQoJ2NvbnRhaW5lcicsIHsgcmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiB0cnVlIH0pIGNvbnRhaW5lcjogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgndWxFbGVtZW50Jywge3JlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogdHJ1ZSB9KSB1bEVsZW1lbnQ6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ3NlYXJjaEVsZW1lbnQnLCB7IHN0YXRpYzogZmFsc2UgfSkgc2VhcmNoRWxlbWVudDogUG9NdWx0aXNlbGVjdFNlYXJjaENvbXBvbmVudDtcblxuICBzY3JvbGxUbyhpbmRleCkge1xuICAgIHRoaXMuc2Nyb2xsVG9wID0gKGluZGV4IDw9IDIpID8gMCA6IChpbmRleCAqIDQ0KSAtIDg4O1xuICB9XG5cbiAgaXNTZWxlY3RlZEl0ZW0ob3B0aW9uOiBQb011bHRpc2VsZWN0T3B0aW9uKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRWYWx1ZXMuc29tZShzZWxlY3RlZEl0ZW0gPT4gc2VsZWN0ZWRJdGVtID09PSBvcHRpb24udmFsdWUpO1xuICB9XG5cbiAgY2xpY2tJdGVtKGNoZWNrLCBvcHRpb24pIHtcbiAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkVmFsdWVzKGNoZWNrLCBvcHRpb24pO1xuXG4gICAgaWYgKCF0aGlzLmhpZGVTZWFyY2gpIHtcbiAgICAgIHRoaXMuc2VhcmNoRWxlbWVudC5zZXRGb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZVNlbGVjdGVkVmFsdWVzKGNoZWNrZWQsIG9wdGlvbikge1xuICAgIGlmIChjaGVja2VkKSB7XG4gICAgICB0aGlzLnNlbGVjdGVkVmFsdWVzLnB1c2gob3B0aW9uLnZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgaW5kZXhTZWxlY3RlZFZhbHVlcyA9IHRoaXMuc2VsZWN0ZWRWYWx1ZXMuaW5kZXhPZihvcHRpb24udmFsdWUpO1xuICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlcy5zcGxpY2UoaW5kZXhTZWxlY3RlZFZhbHVlcywgMSk7XG4gICAgfVxuXG4gICAgdGhpcy5jaGFuZ2UuZW1pdCh0aGlzLnNlbGVjdGVkVmFsdWVzKTtcbiAgfVxuXG4gIGNhbGxDaGFuZ2VTZWFyY2goZXZlbnQpIHtcbiAgICB0aGlzLmNoYW5nZVNlYXJjaC5lbWl0KGV2ZW50KTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2tleWRvd24nLCBbJyRldmVudCddKVxuICBvbktleWRvd24oZXZlbnQ6IGFueSkge1xuICAgIGlmIChldmVudC5rZXlDb2RlID09PSA5KSB7XG4gICAgICB0aGlzLmNsb3NlRHJvcGRvd24uZW1pdCgpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnRyb2xWaXNpYmlsaXR5KHRvT3Blbikge1xuICAgIHRoaXMuc2hvdyA9IHRvT3BlbjtcbiAgICB0aGlzLmNoZWNrSW5pdGlhbE9wdGlvbnMoKTtcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKHRvT3BlbiAmJiB0aGlzLnNlYXJjaEVsZW1lbnQgJiYgIXRoaXMuaGlkZVNlYXJjaCkge1xuICAgICAgICB0aGlzLnNlYXJjaEVsZW1lbnQuc2V0Rm9jdXMoKTtcbiAgICAgICAgdGhpcy5zZWFyY2hFbGVtZW50LmNsZWFuKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNoZWNrSW5pdGlhbE9wdGlvbnMoKSB7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuaGF2ZU9wdGlvbnMgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG59XG4iXX0=