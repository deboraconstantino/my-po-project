import * as tslib_1 from "tslib";
import { EventEmitter, Input, Output } from '@angular/core';
import { convertToBoolean, convertToInt, uuid } from './../../../utils/util';
import { InputBoolean } from '../../../decorators';
import { requiredFailed } from '../validators';
const poCheckboxGroupColumnsDefaultLength = 6;
const poCheckboxGroupColumnsTotalLength = 12;
/**
 * @description
 *
 * O componente `po-checkbox-group` exibe uma lista de múltipla escolha onde o usuário pode marcar e desmarcar,
 * utilizando a tecla de espaço ou o clique do mouse, várias opções.
 *
 * > Para seleção única, utilize o [**Portinari Radio Group**](/documentation/po-radio-group).
 *
 * Por padrão, o po-checkbox-group retorna um array com os valores dos itens selecionados para o model.
 *
 * ```
 * favorites = ['PO', 'Angular'];
 * ```
 *
 * Na maioria das situações, o array com os objetos setados já atende as necessidades mas, caso o desenvolvedor
 * tenha necessidade de usar um valor indeterminado (`null`), ou seja, nem marcado (`true`) e nem desmarcado (`false`),
 * deve setar a propriedade `p-indeterminate` como `true`.
 *
 * Nesse caso, o po-checkbox-group vai retornar um objeto com todas as opções disponíveis e seus valores.
 *
 * ```
 * favorites = {
 *  PO: true,
 *  Angular: true,
 *  VueJS: false,
 *  React: null // indeterminado
 * };
 * ```
 */
export class PoCheckboxGroupBaseComponent {
    constructor() {
        this.checkedOptions = {};
        this.checkedOptionsList = [];
        this.mdColumns = poCheckboxGroupColumnsDefaultLength;
        this._columns = poCheckboxGroupColumnsDefaultLength;
        this._disabled = false;
        this._indeterminate = false;
        this._required = false;
        /**
         * @optional
         *
         * @description
         *
         * Aplica foco no elemento ao ser iniciado.
         *
         * > Caso mais de um elemento seja configurado com essa propriedade, apenas o último elemento declarado com ela terá o foco.
         *
         * @default `false`
         */
        this.autoFocus = false;
        // Função para atualizar o `ngModel` do componente, necessário quando não for utilizado dentro da tag form.
        this.ngModelChange = new EventEmitter();
        /** Evento disparado ao alterar valor do campo */
        this.change = new EventEmitter();
    }
    /**
     * @optional
     *
     * @description
     *
     * Possibilita definir a quantidade de colunas para exibição dos itens do *checkbox*.
     * - É possível exibir as opções entre `1` e `4` colunas.
     * - Para resolução `sm` a colunagem invariavelmente passa para `1` coluna.
     * - Quando se trata de resolução `md` e o valor estabelecido para colunas for superior a `2`,
     * o *grid system* será composto por `2` colunas.
     * - Para evitar a quebra de linha, prefira a utilização de `1` coluna para opções com textos grandes.
     *
     * @default `2`
     *
     */
    set columns(value) {
        const columns = convertToInt(value, poCheckboxGroupColumnsDefaultLength);
        this._columns = this.getGridSystemColumns(columns, 4);
        this.mdColumns = this.getGridSystemColumns(columns, 2);
    }
    get columns() {
        return this._columns;
    }
    /**
     * @optional
     *
     * @description
     *
     * Desabilita todos os itens do checkbox.
     *
     * @default `false`
     */
    set disabled(value) {
        this._disabled = convertToBoolean(value);
        this.validateModel(this.checkIndeterminate());
    }
    get disabled() {
        return this._disabled;
    }
    /**
     * @optional
     *
     * @description
     *
     * Caso exista a necessidade de usar o valor indeterminado (`null`) dentro da lista de opções, é necessário setar
     * a propriedade `p-indeterminate` como `true`, por padrão essa propriedade vem desabilitada (`false`).
     *
     * Quando essa propriedade é setada como `true`, o *po-checkbox-group* passa a devolver um objeto completo para o
     * `ngModel`, diferente do array que contém apenas os valores selecionados.
     *
     * @default `false`
     */
    set indeterminate(indeterminate) {
        this._indeterminate = convertToBoolean(indeterminate);
    }
    get indeterminate() {
        return this._indeterminate;
    }
    /**
     * @optional
     *
     * @description
     * Lista de opções que serão exibidas
     * Nesta propriedade deve ser definido um array de objetos que implementam a interface PoCheckboxGroupOption
     */
    set options(value) {
        this._options = Array.isArray(value) ? value : [];
        this.removeDuplicatedOptions();
        this.setCheckboxGroupOptionsView(this.options);
    }
    get options() {
        return this._options;
    }
    /**
     * @optional
     *
     * @description
     *
     * Define que o campo será obrigatório.
     *
     * @default `false`
     */
    set required(required) {
        this._required = convertToBoolean(required);
        this.validateModel(this.checkIndeterminate());
    }
    get required() {
        return this._required;
    }
    changeValue() {
        const value = this.checkIndeterminate();
        if (this.propagateChange) {
            this.propagateChange(value);
        }
        else {
            this.ngModelChange.emit(value);
        }
        this.change.emit(value);
    }
    checkIndeterminate() {
        return this.indeterminate ? this.checkedOptions : this.checkedOptionsList;
    }
    checkOption(value) {
        if (!this._disabled && !value.disabled) {
            this.checkOptionModel(value);
            this.changeValue();
        }
    }
    registerOnChange(fn) {
        this.propagateChange = fn;
    }
    registerOnTouched(fn) { }
    writeValue(optionsModel) {
        if (optionsModel && this.checkedOptions !== optionsModel) {
            this.generateCheckOptions(optionsModel);
        }
        else {
            this.checkedOptionsList = [];
            this.checkedOptions = {};
        }
    }
    registerOnValidatorChange(fn) {
        this.validatorChange = fn;
    }
    validate(abstractControl) {
        if ((!this.indeterminate && requiredFailed(this.required, this.disabled, abstractControl.value)) || this.isInvalidIndeterminate()) {
            return {
                required: {
                    valid: false,
                }
            };
        }
    }
    validateModel(model) {
        if (this.validatorChange) {
            this.validatorChange(model);
        }
    }
    checkColumnsRange(columns, maxColumns) {
        const minColumns = 1;
        return columns >= minColumns && columns <= maxColumns;
    }
    checkOptionModel(optionChecked) {
        this.checkedOptions[optionChecked.value] = !this.checkedOptions[optionChecked.value];
        if (!this.indeterminate && this.checkedOptionsList.includes(optionChecked.value)) {
            this.checkedOptionsList.splice(this.checkedOptionsList.indexOf(optionChecked.value), 1);
        }
        else if (!this.indeterminate) {
            this.checkedOptionsList.push(optionChecked.value);
        }
    }
    generateCheckOptions(optionsModel) {
        this.checkedOptions = {};
        if (optionsModel instanceof Array) {
            this.checkedOptionsList = optionsModel;
            this.options.forEach((option) => {
                this.checkedOptions[option.value] = optionsModel.includes(option.value);
            });
        }
        else {
            this.options.forEach((option) => {
                optionsModel[option.value] = optionsModel[option.value] === undefined ? false : optionsModel[option.value];
                this.checkedOptions = optionsModel;
            });
        }
    }
    getGridSystemColumns(columns, maxColumns) {
        const gridSystemColumns = poCheckboxGroupColumnsTotalLength / columns;
        return this.checkColumnsRange(columns, maxColumns) ? gridSystemColumns : poCheckboxGroupColumnsDefaultLength;
    }
    isInvalidIndeterminate() {
        if (this.indeterminate && this.required && this.checkedOptions) {
            return Object.values(this.checkedOptions).every(value => value === false);
        }
        return false;
    }
    removeDuplicatedOptions() {
        this.options.forEach((option, index) => {
            const duplicatedIndex = this.options.findIndex((optionFind) => optionFind.value === option.value) === index;
            if (!duplicatedIndex) {
                this.options.splice(this.options.indexOf(option), 1);
            }
        });
    }
    setCheckboxGroupOptionsView(optionsList) {
        this.checkboxGroupOptionsView = optionsList.map(option => {
            return Object.assign({}, option, { id: uuid() });
        });
    }
}
tslib_1.__decorate([
    Input('p-auto-focus'), InputBoolean(),
    tslib_1.__metadata("design:type", Boolean)
], PoCheckboxGroupBaseComponent.prototype, "autoFocus", void 0);
tslib_1.__decorate([
    Input('name'),
    tslib_1.__metadata("design:type", String)
], PoCheckboxGroupBaseComponent.prototype, "name", void 0);
tslib_1.__decorate([
    Input('p-columns'),
    tslib_1.__metadata("design:type", Number),
    tslib_1.__metadata("design:paramtypes", [Number])
], PoCheckboxGroupBaseComponent.prototype, "columns", null);
tslib_1.__decorate([
    Input('p-disabled'),
    tslib_1.__metadata("design:type", Boolean),
    tslib_1.__metadata("design:paramtypes", [Boolean])
], PoCheckboxGroupBaseComponent.prototype, "disabled", null);
tslib_1.__decorate([
    Input('p-help'),
    tslib_1.__metadata("design:type", String)
], PoCheckboxGroupBaseComponent.prototype, "help", void 0);
tslib_1.__decorate([
    Input('p-indeterminate'),
    tslib_1.__metadata("design:type", Boolean),
    tslib_1.__metadata("design:paramtypes", [Boolean])
], PoCheckboxGroupBaseComponent.prototype, "indeterminate", null);
tslib_1.__decorate([
    Input('p-label'),
    tslib_1.__metadata("design:type", String)
], PoCheckboxGroupBaseComponent.prototype, "label", void 0);
tslib_1.__decorate([
    Input('p-optional'),
    tslib_1.__metadata("design:type", Boolean)
], PoCheckboxGroupBaseComponent.prototype, "optional", void 0);
tslib_1.__decorate([
    Input('p-options'),
    tslib_1.__metadata("design:type", Array),
    tslib_1.__metadata("design:paramtypes", [Array])
], PoCheckboxGroupBaseComponent.prototype, "options", null);
tslib_1.__decorate([
    Input('p-required'),
    tslib_1.__metadata("design:type", Boolean),
    tslib_1.__metadata("design:paramtypes", [Boolean])
], PoCheckboxGroupBaseComponent.prototype, "required", null);
tslib_1.__decorate([
    Output('ngModelChange'),
    tslib_1.__metadata("design:type", EventEmitter)
], PoCheckboxGroupBaseComponent.prototype, "ngModelChange", void 0);
tslib_1.__decorate([
    Output('p-change'),
    tslib_1.__metadata("design:type", EventEmitter)
], PoCheckboxGroupBaseComponent.prototype, "change", void 0);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hlY2tib3gtZ3JvdXAtYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9ydGluYXJpL3BvcnRpbmFyaS11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWZpZWxkL3BvLWNoZWNrYm94LWdyb3VwL3BvLWNoZWNrYm94LWdyb3VwLWJhc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFNUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUM3RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbkQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUsvQyxNQUFNLG1DQUFtQyxHQUFXLENBQUMsQ0FBQztBQUN0RCxNQUFNLGlDQUFpQyxHQUFXLEVBQUUsQ0FBQztBQUVyRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQTRCRztBQUNILE1BQU0sT0FBTyw0QkFBNEI7SUFBekM7UUFHRSxtQkFBYyxHQUFRLEVBQUUsQ0FBQztRQUN6Qix1QkFBa0IsR0FBUSxFQUFFLENBQUM7UUFDN0IsY0FBUyxHQUFXLG1DQUFtQyxDQUFDO1FBSWhELGFBQVEsR0FBVyxtQ0FBbUMsQ0FBQztRQUN2RCxjQUFTLEdBQWEsS0FBSyxDQUFDO1FBQzVCLG1CQUFjLEdBQWEsS0FBSyxDQUFDO1FBRWpDLGNBQVMsR0FBYSxLQUFLLENBQUM7UUFFcEM7Ozs7Ozs7Ozs7V0FVRztRQUNvQyxjQUFTLEdBQVksS0FBSyxDQUFDO1FBZ0lsRSwyR0FBMkc7UUFDbEYsa0JBQWEsR0FBdUIsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUVyRixpREFBaUQ7UUFDN0IsV0FBTSxHQUF1QixJQUFJLFlBQVksRUFBTyxDQUFDO0lB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QXlDO1FBQzNFLElBQUksQ0FBQyx3QkFBd0IsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ3ZELHlCQUFZLE1BQU0sSUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUc7UUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBRUY7QUFsUXdDO0lBQXRDLEtBQUssQ0FBQyxjQUFjLENBQUMsRUFBRSxZQUFZLEVBQUU7OytEQUE0QjtBQUduRDtJQUFkLEtBQUssQ0FBQyxNQUFNLENBQUM7OzBEQUFjO0FBaUJSO0lBQW5CLEtBQUssQ0FBQyxXQUFXLENBQUM7OzsyREFLbEI7QUFlb0I7SUFBcEIsS0FBSyxDQUFDLFlBQVksQ0FBQzs7OzREQUluQjtBQU9nQjtJQUFoQixLQUFLLENBQUMsUUFBUSxDQUFDOzswREFBZTtBQWVMO0lBQXpCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQzs7O2lFQUV4QjtBQU9pQjtJQUFqQixLQUFLLENBQUMsU0FBUyxDQUFDOzsyREFBZ0I7QUFlWjtJQUFwQixLQUFLLENBQUMsWUFBWSxDQUFDOzs4REFBbUI7QUFTbkI7SUFBbkIsS0FBSyxDQUFDLFdBQVcsQ0FBQztzQ0FBb0IsS0FBSzs2Q0FBTCxLQUFLOzJEQUkzQztBQWVvQjtJQUFwQixLQUFLLENBQUMsWUFBWSxDQUFDOzs7NERBSW5CO0FBT3dCO0lBQXhCLE1BQU0sQ0FBQyxlQUFlLENBQUM7c0NBQWlCLFlBQVk7bUVBQWdDO0FBR2pFO0lBQW5CLE1BQU0sQ0FBQyxVQUFVLENBQUM7c0NBQVUsWUFBWTs0REFBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBWYWxpZGF0b3IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgY29udmVydFRvQm9vbGVhbiwgY29udmVydFRvSW50LCB1dWlkIH0gZnJvbSAnLi8uLi8uLi8uLi91dGlscy91dGlsJztcbmltcG9ydCB7IElucHV0Qm9vbGVhbiB9IGZyb20gJy4uLy4uLy4uL2RlY29yYXRvcnMnO1xuaW1wb3J0IHsgcmVxdWlyZWRGYWlsZWQgfSBmcm9tICcuLi92YWxpZGF0b3JzJztcblxuaW1wb3J0IHsgUG9DaGVja2JveEdyb3VwT3B0aW9uIH0gZnJvbSAnLi9pbnRlcmZhY2VzL3BvLWNoZWNrYm94LWdyb3VwLW9wdGlvbi5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9DaGVja2JveEdyb3VwT3B0aW9uVmlldyB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1jaGVja2JveC1ncm91cC1vcHRpb24tdmlldy5pbnRlcmZhY2UnO1xuXG5jb25zdCBwb0NoZWNrYm94R3JvdXBDb2x1bW5zRGVmYXVsdExlbmd0aDogbnVtYmVyID0gNjtcbmNvbnN0IHBvQ2hlY2tib3hHcm91cENvbHVtbnNUb3RhbExlbmd0aDogbnVtYmVyID0gMTI7XG5cbi8qKlxuICogQGRlc2NyaXB0aW9uXG4gKlxuICogTyBjb21wb25lbnRlIGBwby1jaGVja2JveC1ncm91cGAgZXhpYmUgdW1hIGxpc3RhIGRlIG3Dumx0aXBsYSBlc2NvbGhhIG9uZGUgbyB1c3XDoXJpbyBwb2RlIG1hcmNhciBlIGRlc21hcmNhcixcbiAqIHV0aWxpemFuZG8gYSB0ZWNsYSBkZSBlc3Bhw6dvIG91IG8gY2xpcXVlIGRvIG1vdXNlLCB2w6FyaWFzIG9ww6fDtWVzLlxuICpcbiAqID4gUGFyYSBzZWxlw6fDo28gw7puaWNhLCB1dGlsaXplIG8gWyoqUG9ydGluYXJpIFJhZGlvIEdyb3VwKipdKC9kb2N1bWVudGF0aW9uL3BvLXJhZGlvLWdyb3VwKS5cbiAqXG4gKiBQb3IgcGFkcsOjbywgbyBwby1jaGVja2JveC1ncm91cCByZXRvcm5hIHVtIGFycmF5IGNvbSBvcyB2YWxvcmVzIGRvcyBpdGVucyBzZWxlY2lvbmFkb3MgcGFyYSBvIG1vZGVsLlxuICpcbiAqIGBgYFxuICogZmF2b3JpdGVzID0gWydQTycsICdBbmd1bGFyJ107XG4gKiBgYGBcbiAqXG4gKiBOYSBtYWlvcmlhIGRhcyBzaXR1YcOnw7VlcywgbyBhcnJheSBjb20gb3Mgb2JqZXRvcyBzZXRhZG9zIGrDoSBhdGVuZGUgYXMgbmVjZXNzaWRhZGVzIG1hcywgY2FzbyBvIGRlc2Vudm9sdmVkb3JcbiAqIHRlbmhhIG5lY2Vzc2lkYWRlIGRlIHVzYXIgdW0gdmFsb3IgaW5kZXRlcm1pbmFkbyAoYG51bGxgKSwgb3Ugc2VqYSwgbmVtIG1hcmNhZG8gKGB0cnVlYCkgZSBuZW0gZGVzbWFyY2FkbyAoYGZhbHNlYCksXG4gKiBkZXZlIHNldGFyIGEgcHJvcHJpZWRhZGUgYHAtaW5kZXRlcm1pbmF0ZWAgY29tbyBgdHJ1ZWAuXG4gKlxuICogTmVzc2UgY2FzbywgbyBwby1jaGVja2JveC1ncm91cCB2YWkgcmV0b3JuYXIgdW0gb2JqZXRvIGNvbSB0b2RhcyBhcyBvcMOnw7VlcyBkaXNwb27DrXZlaXMgZSBzZXVzIHZhbG9yZXMuXG4gKlxuICogYGBgXG4gKiBmYXZvcml0ZXMgPSB7XG4gKiAgUE86IHRydWUsXG4gKiAgQW5ndWxhcjogdHJ1ZSxcbiAqICBWdWVKUzogZmFsc2UsXG4gKiAgUmVhY3Q6IG51bGwgLy8gaW5kZXRlcm1pbmFkb1xuICogfTtcbiAqIGBgYFxuICovXG5leHBvcnQgY2xhc3MgUG9DaGVja2JveEdyb3VwQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBWYWxpZGF0b3Ige1xuXG4gIGNoZWNrYm94R3JvdXBPcHRpb25zVmlldzogQXJyYXk8UG9DaGVja2JveEdyb3VwT3B0aW9uVmlldz47XG4gIGNoZWNrZWRPcHRpb25zOiBhbnkgPSB7fTtcbiAgY2hlY2tlZE9wdGlvbnNMaXN0OiBhbnkgPSBbXTtcbiAgbWRDb2x1bW5zOiBudW1iZXIgPSBwb0NoZWNrYm94R3JvdXBDb2x1bW5zRGVmYXVsdExlbmd0aDtcbiAgcHJvcGFnYXRlQ2hhbmdlOiBhbnk7XG4gIHZhbGlkYXRvckNoYW5nZTogYW55O1xuXG4gIHByaXZhdGUgX2NvbHVtbnM6IG51bWJlciA9IHBvQ2hlY2tib3hHcm91cENvbHVtbnNEZWZhdWx0TGVuZ3RoO1xuICBwcml2YXRlIF9kaXNhYmxlZD86IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfaW5kZXRlcm1pbmF0ZT86IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfb3B0aW9ucz86IEFycmF5PFBvQ2hlY2tib3hHcm91cE9wdGlvbj47XG4gIHByaXZhdGUgX3JlcXVpcmVkPzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEFwbGljYSBmb2NvIG5vIGVsZW1lbnRvIGFvIHNlciBpbmljaWFkby5cbiAgICpcbiAgICogPiBDYXNvIG1haXMgZGUgdW0gZWxlbWVudG8gc2VqYSBjb25maWd1cmFkbyBjb20gZXNzYSBwcm9wcmllZGFkZSwgYXBlbmFzIG8gw7psdGltbyBlbGVtZW50byBkZWNsYXJhZG8gY29tIGVsYSB0ZXLDoSBvIGZvY28uXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgncC1hdXRvLWZvY3VzJykgQElucHV0Qm9vbGVhbigpIGF1dG9Gb2N1czogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKiBOb21lIGRvcyBjaGVja2JveGVzICovXG4gIEBJbnB1dCgnbmFtZScpIG5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBQb3NzaWJpbGl0YSBkZWZpbmlyIGEgcXVhbnRpZGFkZSBkZSBjb2x1bmFzIHBhcmEgZXhpYmnDp8OjbyBkb3MgaXRlbnMgZG8gKmNoZWNrYm94Ki5cbiAgICogLSDDiSBwb3Nzw612ZWwgZXhpYmlyIGFzIG9ww6fDtWVzIGVudHJlIGAxYCBlIGA0YCBjb2x1bmFzLlxuICAgKiAtIFBhcmEgcmVzb2x1w6fDo28gYHNtYCBhIGNvbHVuYWdlbSBpbnZhcmlhdmVsbWVudGUgcGFzc2EgcGFyYSBgMWAgY29sdW5hLlxuICAgKiAtIFF1YW5kbyBzZSB0cmF0YSBkZSByZXNvbHXDp8OjbyBgbWRgIGUgbyB2YWxvciBlc3RhYmVsZWNpZG8gcGFyYSBjb2x1bmFzIGZvciBzdXBlcmlvciBhIGAyYCxcbiAgICogbyAqZ3JpZCBzeXN0ZW0qIHNlcsOhIGNvbXBvc3RvIHBvciBgMmAgY29sdW5hcy5cbiAgICogLSBQYXJhIGV2aXRhciBhIHF1ZWJyYSBkZSBsaW5oYSwgcHJlZmlyYSBhIHV0aWxpemHDp8OjbyBkZSBgMWAgY29sdW5hIHBhcmEgb3DDp8O1ZXMgY29tIHRleHRvcyBncmFuZGVzLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgMmBcbiAgICpcbiAgICovXG4gIEBJbnB1dCgncC1jb2x1bW5zJykgc2V0IGNvbHVtbnModmFsdWU6IG51bWJlcikge1xuICAgIGNvbnN0IGNvbHVtbnMgPSBjb252ZXJ0VG9JbnQodmFsdWUsIHBvQ2hlY2tib3hHcm91cENvbHVtbnNEZWZhdWx0TGVuZ3RoKTtcblxuICAgIHRoaXMuX2NvbHVtbnMgPSB0aGlzLmdldEdyaWRTeXN0ZW1Db2x1bW5zKGNvbHVtbnMsIDQpO1xuICAgIHRoaXMubWRDb2x1bW5zID0gdGhpcy5nZXRHcmlkU3lzdGVtQ29sdW1ucyhjb2x1bW5zLCAyKTtcbiAgfVxuXG4gIGdldCBjb2x1bW5zKCkge1xuICAgIHJldHVybiB0aGlzLl9jb2x1bW5zO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogRGVzYWJpbGl0YSB0b2RvcyBvcyBpdGVucyBkbyBjaGVja2JveC5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLWRpc2FibGVkJykgc2V0IGRpc2FibGVkKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5fZGlzYWJsZWQgPSBjb252ZXJ0VG9Cb29sZWFuKHZhbHVlKTtcblxuICAgIHRoaXMudmFsaWRhdGVNb2RlbCh0aGlzLmNoZWNrSW5kZXRlcm1pbmF0ZSgpKTtcbiAgfVxuXG4gIGdldCBkaXNhYmxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fZGlzYWJsZWQ7XG4gIH1cblxuICAvKiogVGV4dG8gZGUgYXBvaW8gZG8gY2FtcG8gKi9cbiAgQElucHV0KCdwLWhlbHAnKSBoZWxwPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIENhc28gZXhpc3RhIGEgbmVjZXNzaWRhZGUgZGUgdXNhciBvIHZhbG9yIGluZGV0ZXJtaW5hZG8gKGBudWxsYCkgZGVudHJvIGRhIGxpc3RhIGRlIG9ww6fDtWVzLCDDqSBuZWNlc3PDoXJpbyBzZXRhclxuICAgKiBhIHByb3ByaWVkYWRlIGBwLWluZGV0ZXJtaW5hdGVgIGNvbW8gYHRydWVgLCBwb3IgcGFkcsOjbyBlc3NhIHByb3ByaWVkYWRlIHZlbSBkZXNhYmlsaXRhZGEgKGBmYWxzZWApLlxuICAgKlxuICAgKiBRdWFuZG8gZXNzYSBwcm9wcmllZGFkZSDDqSBzZXRhZGEgY29tbyBgdHJ1ZWAsIG8gKnBvLWNoZWNrYm94LWdyb3VwKiBwYXNzYSBhIGRldm9sdmVyIHVtIG9iamV0byBjb21wbGV0byBwYXJhIG9cbiAgICogYG5nTW9kZWxgLCBkaWZlcmVudGUgZG8gYXJyYXkgcXVlIGNvbnTDqW0gYXBlbmFzIG9zIHZhbG9yZXMgc2VsZWNpb25hZG9zLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICBASW5wdXQoJ3AtaW5kZXRlcm1pbmF0ZScpIHNldCBpbmRldGVybWluYXRlKGluZGV0ZXJtaW5hdGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9pbmRldGVybWluYXRlID0gY29udmVydFRvQm9vbGVhbihpbmRldGVybWluYXRlKTtcbiAgfVxuXG4gIGdldCBpbmRldGVybWluYXRlKCkge1xuICAgIHJldHVybiB0aGlzLl9pbmRldGVybWluYXRlO1xuICB9XG5cbiAgLyoqIExhYmVsIGRvIGNhbXBvICovXG4gIEBJbnB1dCgncC1sYWJlbCcpIGxhYmVsPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERlZmluZSBzZSBhIGluZGljYcOnw6NvIGRlIGNhbXBvIG9wY2lvbmFsIHNlcsOhIGV4aWJpZGEuXG4gICAqXG4gICAqID4gTsOjbyBzZXLDoSBleGliaWRhIGEgaW5kaWNhw6fDo28gc2U6XG4gICAqIC0gTyBjYW1wbyBjb250ZXIgYHAtcmVxdWlyZWRgO1xuICAgKiAtIE7Do28gcG9zc3VpciBgcC1oZWxwYCBlL291IGBwLWxhYmVsYC5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLW9wdGlvbmFsJykgb3B0aW9uYWw6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogTGlzdGEgZGUgb3DDp8O1ZXMgcXVlIHNlcsOjbyBleGliaWRhc1xuICAgKiBOZXN0YSBwcm9wcmllZGFkZSBkZXZlIHNlciBkZWZpbmlkbyB1bSBhcnJheSBkZSBvYmpldG9zIHF1ZSBpbXBsZW1lbnRhbSBhIGludGVyZmFjZSBQb0NoZWNrYm94R3JvdXBPcHRpb25cbiAgICovXG4gIEBJbnB1dCgncC1vcHRpb25zJykgc2V0IG9wdGlvbnModmFsdWU6IEFycmF5PFBvQ2hlY2tib3hHcm91cE9wdGlvbj4pIHtcbiAgICB0aGlzLl9vcHRpb25zID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZSA6IFtdO1xuICAgIHRoaXMucmVtb3ZlRHVwbGljYXRlZE9wdGlvbnMoKTtcbiAgICB0aGlzLnNldENoZWNrYm94R3JvdXBPcHRpb25zVmlldyh0aGlzLm9wdGlvbnMpO1xuICB9XG5cbiAgZ2V0IG9wdGlvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX29wdGlvbnM7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBEZWZpbmUgcXVlIG8gY2FtcG8gc2Vyw6Egb2JyaWdhdMOzcmlvLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICBASW5wdXQoJ3AtcmVxdWlyZWQnKSBzZXQgcmVxdWlyZWQocmVxdWlyZWQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9yZXF1aXJlZCA9IGNvbnZlcnRUb0Jvb2xlYW4ocmVxdWlyZWQpO1xuXG4gICAgdGhpcy52YWxpZGF0ZU1vZGVsKHRoaXMuY2hlY2tJbmRldGVybWluYXRlKCkpO1xuICB9XG5cbiAgZ2V0IHJlcXVpcmVkKCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1aXJlZDtcbiAgfVxuXG4gIC8vIEZ1bsOnw6NvIHBhcmEgYXR1YWxpemFyIG8gYG5nTW9kZWxgIGRvIGNvbXBvbmVudGUsIG5lY2Vzc8OhcmlvIHF1YW5kbyBuw6NvIGZvciB1dGlsaXphZG8gZGVudHJvIGRhIHRhZyBmb3JtLlxuICBAT3V0cHV0KCduZ01vZGVsQ2hhbmdlJykgbmdNb2RlbENoYW5nZT86IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgLyoqIEV2ZW50byBkaXNwYXJhZG8gYW8gYWx0ZXJhciB2YWxvciBkbyBjYW1wbyAqL1xuICBAT3V0cHV0KCdwLWNoYW5nZScpIGNoYW5nZT86IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgY2hhbmdlVmFsdWUoKSB7XG5cbiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuY2hlY2tJbmRldGVybWluYXRlKCk7XG5cbiAgICBpZiAodGhpcy5wcm9wYWdhdGVDaGFuZ2UpIHtcbiAgICAgIHRoaXMucHJvcGFnYXRlQ2hhbmdlKHZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uZ01vZGVsQ2hhbmdlLmVtaXQodmFsdWUpO1xuICAgIH1cblxuICAgIHRoaXMuY2hhbmdlLmVtaXQodmFsdWUpO1xuICB9XG5cbiAgY2hlY2tJbmRldGVybWluYXRlKCkge1xuICAgIHJldHVybiB0aGlzLmluZGV0ZXJtaW5hdGUgPyB0aGlzLmNoZWNrZWRPcHRpb25zIDogdGhpcy5jaGVja2VkT3B0aW9uc0xpc3Q7XG4gIH1cblxuICBjaGVja09wdGlvbih2YWx1ZTogUG9DaGVja2JveEdyb3VwT3B0aW9uKSB7XG4gICAgaWYgKCF0aGlzLl9kaXNhYmxlZCAmJiAhdmFsdWUuZGlzYWJsZWQpIHtcbiAgICAgIHRoaXMuY2hlY2tPcHRpb25Nb2RlbCh2YWx1ZSk7XG4gICAgICB0aGlzLmNoYW5nZVZhbHVlKCk7XG4gICAgfVxuICB9XG5cbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5wcm9wYWdhdGVDaGFuZ2UgPSBmbjtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpOiB2b2lkIHsgfVxuXG4gIHdyaXRlVmFsdWUob3B0aW9uc01vZGVsOiBhbnkpIHtcbiAgICBpZiAob3B0aW9uc01vZGVsICYmIHRoaXMuY2hlY2tlZE9wdGlvbnMgIT09IG9wdGlvbnNNb2RlbCkge1xuICAgICAgdGhpcy5nZW5lcmF0ZUNoZWNrT3B0aW9ucyhvcHRpb25zTW9kZWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNoZWNrZWRPcHRpb25zTGlzdCA9IFtdO1xuICAgICAgdGhpcy5jaGVja2VkT3B0aW9ucyA9IHt9O1xuICAgIH1cbiAgfVxuXG4gIHJlZ2lzdGVyT25WYWxpZGF0b3JDaGFuZ2UoZm46ICgpID0+IHZvaWQpIHtcbiAgICB0aGlzLnZhbGlkYXRvckNoYW5nZSA9IGZuO1xuICB9XG5cbiAgdmFsaWRhdGUoYWJzdHJhY3RDb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueTsgfSB7XG5cbiAgICBpZiAoKCF0aGlzLmluZGV0ZXJtaW5hdGUgJiYgcmVxdWlyZWRGYWlsZWQodGhpcy5yZXF1aXJlZCwgdGhpcy5kaXNhYmxlZCwgYWJzdHJhY3RDb250cm9sLnZhbHVlKSkgfHwgdGhpcy5pc0ludmFsaWRJbmRldGVybWluYXRlKCkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJlcXVpcmVkOiB7XG4gICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cblxuICB9XG5cbiAgcHJvdGVjdGVkIHZhbGlkYXRlTW9kZWwobW9kZWw6IGFueSkge1xuICAgIGlmICh0aGlzLnZhbGlkYXRvckNoYW5nZSkge1xuICAgICAgdGhpcy52YWxpZGF0b3JDaGFuZ2UobW9kZWwpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tDb2x1bW5zUmFuZ2UoY29sdW1ucywgbWF4Q29sdW1ucyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG1pbkNvbHVtbnMgPSAxO1xuXG4gICAgcmV0dXJuIGNvbHVtbnMgPj0gbWluQ29sdW1ucyAmJiBjb2x1bW5zIDw9IG1heENvbHVtbnM7XG4gIH1cblxuICBwcml2YXRlIGNoZWNrT3B0aW9uTW9kZWwob3B0aW9uQ2hlY2tlZDogUG9DaGVja2JveEdyb3VwT3B0aW9uKSB7XG4gICAgdGhpcy5jaGVja2VkT3B0aW9uc1tvcHRpb25DaGVja2VkLnZhbHVlXSA9ICF0aGlzLmNoZWNrZWRPcHRpb25zW29wdGlvbkNoZWNrZWQudmFsdWVdO1xuXG4gICAgaWYgKCF0aGlzLmluZGV0ZXJtaW5hdGUgJiYgdGhpcy5jaGVja2VkT3B0aW9uc0xpc3QuaW5jbHVkZXMob3B0aW9uQ2hlY2tlZC52YWx1ZSkpIHtcbiAgICAgIHRoaXMuY2hlY2tlZE9wdGlvbnNMaXN0LnNwbGljZSh0aGlzLmNoZWNrZWRPcHRpb25zTGlzdC5pbmRleE9mKG9wdGlvbkNoZWNrZWQudmFsdWUpLCAxKTtcblxuICAgIH0gZWxzZSBpZiAoIXRoaXMuaW5kZXRlcm1pbmF0ZSkge1xuICAgICAgdGhpcy5jaGVja2VkT3B0aW9uc0xpc3QucHVzaChvcHRpb25DaGVja2VkLnZhbHVlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlQ2hlY2tPcHRpb25zKG9wdGlvbnNNb2RlbDogYW55KSB7XG5cbiAgICB0aGlzLmNoZWNrZWRPcHRpb25zID0ge307XG5cbiAgICBpZiAob3B0aW9uc01vZGVsIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIHRoaXMuY2hlY2tlZE9wdGlvbnNMaXN0ID0gb3B0aW9uc01vZGVsO1xuXG4gICAgICB0aGlzLm9wdGlvbnMuZm9yRWFjaCgob3B0aW9uOiBQb0NoZWNrYm94R3JvdXBPcHRpb24pID0+IHtcbiAgICAgICAgdGhpcy5jaGVja2VkT3B0aW9uc1tvcHRpb24udmFsdWVdID0gb3B0aW9uc01vZGVsLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5vcHRpb25zLmZvckVhY2goKG9wdGlvbjogUG9DaGVja2JveEdyb3VwT3B0aW9uKSA9PiB7XG4gICAgICAgIG9wdGlvbnNNb2RlbFtvcHRpb24udmFsdWVdID0gb3B0aW9uc01vZGVsW29wdGlvbi52YWx1ZV0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogb3B0aW9uc01vZGVsW29wdGlvbi52YWx1ZV07XG4gICAgICAgIHRoaXMuY2hlY2tlZE9wdGlvbnMgPSBvcHRpb25zTW9kZWw7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldEdyaWRTeXN0ZW1Db2x1bW5zKGNvbHVtbnM6IG51bWJlciwgbWF4Q29sdW1uczogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBjb25zdCBncmlkU3lzdGVtQ29sdW1ucyA9IHBvQ2hlY2tib3hHcm91cENvbHVtbnNUb3RhbExlbmd0aCAvIGNvbHVtbnM7XG5cbiAgICByZXR1cm4gdGhpcy5jaGVja0NvbHVtbnNSYW5nZShjb2x1bW5zLCBtYXhDb2x1bW5zKSA/IGdyaWRTeXN0ZW1Db2x1bW5zIDogcG9DaGVja2JveEdyb3VwQ29sdW1uc0RlZmF1bHRMZW5ndGg7XG4gIH1cblxuICBwcml2YXRlIGlzSW52YWxpZEluZGV0ZXJtaW5hdGUoKSB7XG4gICAgaWYgKHRoaXMuaW5kZXRlcm1pbmF0ZSAmJiB0aGlzLnJlcXVpcmVkICYmIHRoaXMuY2hlY2tlZE9wdGlvbnMpIHtcbiAgICAgIHJldHVybiAoPGFueT5PYmplY3QpLnZhbHVlcyh0aGlzLmNoZWNrZWRPcHRpb25zKS5ldmVyeSh2YWx1ZSA9PiB2YWx1ZSA9PT0gZmFsc2UpO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUR1cGxpY2F0ZWRPcHRpb25zKCkge1xuICAgIHRoaXMub3B0aW9ucy5mb3JFYWNoKChvcHRpb24sIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBkdXBsaWNhdGVkSW5kZXggPSB0aGlzLm9wdGlvbnMuZmluZEluZGV4KChvcHRpb25GaW5kOiBhbnkpID0+IG9wdGlvbkZpbmQudmFsdWUgPT09IG9wdGlvbi52YWx1ZSkgPT09IGluZGV4O1xuICAgICAgaWYgKCFkdXBsaWNhdGVkSW5kZXgpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLnNwbGljZSh0aGlzLm9wdGlvbnMuaW5kZXhPZihvcHRpb24pLCAxKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0Q2hlY2tib3hHcm91cE9wdGlvbnNWaWV3KG9wdGlvbnNMaXN0OiBBcnJheTxQb0NoZWNrYm94R3JvdXBPcHRpb24+KSB7XG4gICAgdGhpcy5jaGVja2JveEdyb3VwT3B0aW9uc1ZpZXcgPSBvcHRpb25zTGlzdC5tYXAob3B0aW9uID0+IHtcbiAgICAgIHJldHVybiB7IC4uLm9wdGlvbiwgaWQ6IHV1aWQoKSB9O1xuICAgIH0pO1xuICB9XG5cbn1cbiJdfQ==