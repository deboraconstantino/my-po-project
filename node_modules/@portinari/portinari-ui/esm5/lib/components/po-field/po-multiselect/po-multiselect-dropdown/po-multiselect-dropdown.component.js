import * as tslib_1 from "tslib";
import { Component, ElementRef, EventEmitter, HostListener, Input, Output, ViewChild } from '@angular/core';
import { PoMultiselectSearchComponent } from './../po-multiselect-search/po-multiselect-search.component';
/**
 * @docsPrivate
 *
 * @description
 *
 * Componente que construíra o dropdown, contendo o campo de pesquisa e os itens para seleção.
 */
var PoMultiselectDropdownComponent = /** @class */ (function () {
    function PoMultiselectDropdownComponent() {
        this.scrollTop = 0;
        this.show = false;
        this.haveOptions = false;
        /** Propriedade que indica se o campo de pesquisa deverá ser escondido. */
        this.hideSearch = false;
        /** Propriedade que recebe a lista de opções selecionadas. */
        this.selectedValues = [];
        /** Propriedade que recebe a lista de opções que deverão ser criadas no dropdown. */
        this.options = [];
        /** Evento disparado a cada tecla digitada na pesquisa. */
        this.changeSearch = new EventEmitter();
        /** Evento disparado a cada alteração na lista das opções selecionadas. */
        this.change = new EventEmitter();
        /**
         * Evento disparado quando for detectada uma ação que necessite fechar o dropdown.
         * Por exemplo, no caso de ser teclado TAB dentro do dropdown, então é disparado este evento
         * para notificar o componente principal que deve fechar o dropdown.
         */
        this.closeDropdown = new EventEmitter();
    }
    PoMultiselectDropdownComponent.prototype.scrollTo = function (index) {
        this.scrollTop = (index <= 2) ? 0 : (index * 44) - 88;
    };
    PoMultiselectDropdownComponent.prototype.isSelectedItem = function (option) {
        return this.selectedValues.some(function (selectedItem) { return selectedItem === option.value; });
    };
    PoMultiselectDropdownComponent.prototype.clickItem = function (check, option) {
        this.updateSelectedValues(check, option);
        if (!this.hideSearch) {
            this.searchElement.setFocus();
        }
    };
    PoMultiselectDropdownComponent.prototype.updateSelectedValues = function (checked, option) {
        if (checked) {
            this.selectedValues.push(option.value);
        }
        else {
            var indexSelectedValues = this.selectedValues.indexOf(option.value);
            this.selectedValues.splice(indexSelectedValues, 1);
        }
        this.change.emit(this.selectedValues);
    };
    PoMultiselectDropdownComponent.prototype.callChangeSearch = function (event) {
        this.changeSearch.emit(event);
    };
    PoMultiselectDropdownComponent.prototype.onKeydown = function (event) {
        if (event.keyCode === 9) {
            this.closeDropdown.emit();
        }
    };
    PoMultiselectDropdownComponent.prototype.controlVisibility = function (toOpen) {
        var _this = this;
        this.show = toOpen;
        this.checkInitialOptions();
        setTimeout(function () {
            if (toOpen && _this.searchElement && !_this.hideSearch) {
                _this.searchElement.setFocus();
                _this.searchElement.clean();
            }
        });
    };
    PoMultiselectDropdownComponent.prototype.checkInitialOptions = function () {
        if (this.options.length) {
            this.haveOptions = true;
        }
    };
    tslib_1.__decorate([
        Input('p-hide-search'),
        tslib_1.__metadata("design:type", Boolean)
    ], PoMultiselectDropdownComponent.prototype, "hideSearch", void 0);
    tslib_1.__decorate([
        Input('p-literals'),
        tslib_1.__metadata("design:type", Object)
    ], PoMultiselectDropdownComponent.prototype, "literals", void 0);
    tslib_1.__decorate([
        Input('p-placeholder-search'),
        tslib_1.__metadata("design:type", String)
    ], PoMultiselectDropdownComponent.prototype, "placeholderSearch", void 0);
    tslib_1.__decorate([
        Input('p-selected-values'),
        tslib_1.__metadata("design:type", Array)
    ], PoMultiselectDropdownComponent.prototype, "selectedValues", void 0);
    tslib_1.__decorate([
        Input('p-options'),
        tslib_1.__metadata("design:type", Array)
    ], PoMultiselectDropdownComponent.prototype, "options", void 0);
    tslib_1.__decorate([
        Output('p-change-search'),
        tslib_1.__metadata("design:type", Object)
    ], PoMultiselectDropdownComponent.prototype, "changeSearch", void 0);
    tslib_1.__decorate([
        Output('p-change'),
        tslib_1.__metadata("design:type", Object)
    ], PoMultiselectDropdownComponent.prototype, "change", void 0);
    tslib_1.__decorate([
        Output('p-close-dropdown'),
        tslib_1.__metadata("design:type", Object)
    ], PoMultiselectDropdownComponent.prototype, "closeDropdown", void 0);
    tslib_1.__decorate([
        ViewChild('container', { read: ElementRef, static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], PoMultiselectDropdownComponent.prototype, "container", void 0);
    tslib_1.__decorate([
        ViewChild('ulElement', { read: ElementRef, static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], PoMultiselectDropdownComponent.prototype, "ulElement", void 0);
    tslib_1.__decorate([
        ViewChild('searchElement', { static: false }),
        tslib_1.__metadata("design:type", PoMultiselectSearchComponent)
    ], PoMultiselectDropdownComponent.prototype, "searchElement", void 0);
    tslib_1.__decorate([
        HostListener('keydown', ['$event']),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [Object]),
        tslib_1.__metadata("design:returntype", void 0)
    ], PoMultiselectDropdownComponent.prototype, "onKeydown", null);
    PoMultiselectDropdownComponent = tslib_1.__decorate([
        Component({
            selector: 'po-multiselect-dropdown',
            template: "<div #container class=\"po-multiselect-container\" [hidden]=\"!show\">\n\n  <po-multiselect-search #searchElement\n    *ngIf=\"!hideSearch && haveOptions\"\n    [p-literals]=\"literals\"\n    [p-placeholder]=\"placeholderSearch\"\n    (p-change)=\"callChangeSearch($event)\">\n  </po-multiselect-search>\n\n  <ul class=\"po-multiselect-items-container\" [scrollTop]=\"scrollTop\" #ulElement>\n    <div *ngIf=\"!options.length\" class=\"po-multiselect-container-no-data po-text-center\">\n      <span> {{ literals.noData }}</span>\n    </div>\n\n    <po-multiselect-item *ngFor=\"let option of options\"\n      [p-label]=\"option.label\"\n      [p-selected]=\"isSelectedItem(option)\"\n      (p-change)=\"clickItem($event, option)\">\n    </po-multiselect-item>\n  </ul>\n</div>\n"
        })
    ], PoMultiselectDropdownComponent);
    return PoMultiselectDropdownComponent;
}());
export { PoMultiselectDropdownComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbXVsdGlzZWxlY3QtZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvcnRpbmFyaS9wb3J0aW5hcmktdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wby1maWVsZC9wby1tdWx0aXNlbGVjdC9wby1tdWx0aXNlbGVjdC1kcm9wZG93bi9wby1tdWx0aXNlbGVjdC1kcm9wZG93bi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFJNUcsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sNERBQTRELENBQUM7QUFFMUc7Ozs7OztHQU1HO0FBS0g7SUFKQTtRQU1FLGNBQVMsR0FBRyxDQUFDLENBQUM7UUFDZCxTQUFJLEdBQVksS0FBSyxDQUFDO1FBQ3RCLGdCQUFXLEdBQVksS0FBSyxDQUFDO1FBRTdCLDBFQUEwRTtRQUNsRCxlQUFVLEdBQWEsS0FBSyxDQUFDO1FBUXJELDZEQUE2RDtRQUNqQyxtQkFBYyxHQUFlLEVBQUUsQ0FBQztRQUU1RCxvRkFBb0Y7UUFDaEUsWUFBTyxHQUErQixFQUFFLENBQUM7UUFFN0QsMERBQTBEO1FBQy9CLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUU3RCwwRUFBMEU7UUFDdEQsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFaEQ7Ozs7V0FJRztRQUN5QixrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7SUE4RGpFLENBQUM7SUF4REMsaURBQVEsR0FBUixVQUFTLEtBQUs7UUFDWixJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLEVB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QTFELFNBQVMsQ0FBQyxXQUFXLEVBQUUsRUFBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQzswQ0FBWSxVQUFVO3FFQUFDO0lBQ2xDO1FBQTlDLFNBQVMsQ0FBQyxlQUFlLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUM7MENBQWdCLDRCQUE0Qjt5RUFBQztJQWtDM0Y7UUFEQyxZQUFZLENBQUMsU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7Ozs7bUVBS25DO0lBMUVVLDhCQUE4QjtRQUoxQyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUseUJBQXlCO1lBQ25DLHV4QkFBdUQ7U0FDeEQsQ0FBQztPQUNXLDhCQUE4QixDQThGMUM7SUFBRCxxQ0FBQztDQUFBLEFBOUZELElBOEZDO1NBOUZZLDhCQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBIb3N0TGlzdGVuZXIsIElucHV0LCBPdXRwdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBQb011bHRpc2VsZWN0TGl0ZXJhbHMgfSBmcm9tICcuLi8uLi9pbmRleCc7XG5pbXBvcnQgeyBQb011bHRpc2VsZWN0T3B0aW9uIH0gZnJvbSAnLi4vcG8tbXVsdGlzZWxlY3Qtb3B0aW9uLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb011bHRpc2VsZWN0U2VhcmNoQ29tcG9uZW50IH0gZnJvbSAnLi8uLi9wby1tdWx0aXNlbGVjdC1zZWFyY2gvcG8tbXVsdGlzZWxlY3Qtc2VhcmNoLmNvbXBvbmVudCc7XG5cbi8qKlxuICogQGRvY3NQcml2YXRlXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKlxuICogQ29tcG9uZW50ZSBxdWUgY29uc3RydcOtcmEgbyBkcm9wZG93biwgY29udGVuZG8gbyBjYW1wbyBkZSBwZXNxdWlzYSBlIG9zIGl0ZW5zIHBhcmEgc2VsZcOnw6NvLlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby1tdWx0aXNlbGVjdC1kcm9wZG93bicsXG4gIHRlbXBsYXRlVXJsOiAnLi9wby1tdWx0aXNlbGVjdC1kcm9wZG93bi5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUG9NdWx0aXNlbGVjdERyb3Bkb3duQ29tcG9uZW50IHtcblxuICBzY3JvbGxUb3AgPSAwO1xuICBzaG93OiBib29sZWFuID0gZmFsc2U7XG4gIGhhdmVPcHRpb25zOiBib29sZWFuID0gZmFsc2U7XG5cbiAgLyoqIFByb3ByaWVkYWRlIHF1ZSBpbmRpY2Egc2UgbyBjYW1wbyBkZSBwZXNxdWlzYSBkZXZlcsOhIHNlciBlc2NvbmRpZG8uICovXG4gIEBJbnB1dCgncC1oaWRlLXNlYXJjaCcpIGhpZGVTZWFyY2g/OiBib29sZWFuID0gZmFsc2U7XG5cbiAgLyoqIFByb3ByaWVkYWRlIHF1ZSBxdWUgcmVjZWJlIGFzIGxpdGVyYWlzIGRlZmluaWRhcyBubyBjb21wb25lbnRlIGBwby1tdWx0aXNlbGVjdGAuICovXG4gIEBJbnB1dCgncC1saXRlcmFscycpIGxpdGVyYWxzPzogUG9NdWx0aXNlbGVjdExpdGVyYWxzO1xuXG4gIC8qKiBQbGFjZWhvbGRlciBkbyBjYW1wbyBkZSBwZXNxdWlzYS4gKi9cbiAgQElucHV0KCdwLXBsYWNlaG9sZGVyLXNlYXJjaCcpIHBsYWNlaG9sZGVyU2VhcmNoOiBzdHJpbmc7XG5cbiAgLyoqIFByb3ByaWVkYWRlIHF1ZSByZWNlYmUgYSBsaXN0YSBkZSBvcMOnw7VlcyBzZWxlY2lvbmFkYXMuICovXG4gIEBJbnB1dCgncC1zZWxlY3RlZC12YWx1ZXMnKSBzZWxlY3RlZFZhbHVlczogQXJyYXk8YW55PiA9IFtdO1xuXG4gIC8qKiBQcm9wcmllZGFkZSBxdWUgcmVjZWJlIGEgbGlzdGEgZGUgb3DDp8O1ZXMgcXVlIGRldmVyw6NvIHNlciBjcmlhZGFzIG5vIGRyb3Bkb3duLiAqL1xuICBASW5wdXQoJ3Atb3B0aW9ucycpIG9wdGlvbnM6IEFycmF5PFBvTXVsdGlzZWxlY3RPcHRpb24+ID0gW107XG5cbiAgLyoqIEV2ZW50byBkaXNwYXJhZG8gYSBjYWRhIHRlY2xhIGRpZ2l0YWRhIG5hIHBlc3F1aXNhLiAqL1xuICBAT3V0cHV0KCdwLWNoYW5nZS1zZWFyY2gnKSBjaGFuZ2VTZWFyY2ggPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgLyoqIEV2ZW50byBkaXNwYXJhZG8gYSBjYWRhIGFsdGVyYcOnw6NvIG5hIGxpc3RhIGRhcyBvcMOnw7VlcyBzZWxlY2lvbmFkYXMuICovXG4gIEBPdXRwdXQoJ3AtY2hhbmdlJykgY2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8qKlxuICAgKiBFdmVudG8gZGlzcGFyYWRvIHF1YW5kbyBmb3IgZGV0ZWN0YWRhIHVtYSBhw6fDo28gcXVlIG5lY2Vzc2l0ZSBmZWNoYXIgbyBkcm9wZG93bi5cbiAgICogUG9yIGV4ZW1wbG8sIG5vIGNhc28gZGUgc2VyIHRlY2xhZG8gVEFCIGRlbnRybyBkbyBkcm9wZG93biwgZW50w6NvIMOpIGRpc3BhcmFkbyBlc3RlIGV2ZW50b1xuICAgKiBwYXJhIG5vdGlmaWNhciBvIGNvbXBvbmVudGUgcHJpbmNpcGFsIHF1ZSBkZXZlIGZlY2hhciBvIGRyb3Bkb3duLlxuICAgKi9cbiAgQE91dHB1dCgncC1jbG9zZS1kcm9wZG93bicpIGNsb3NlRHJvcGRvd24gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQFZpZXdDaGlsZCgnY29udGFpbmVyJywgeyByZWFkOiBFbGVtZW50UmVmLCBzdGF0aWM6IHRydWUgfSkgY29udGFpbmVyOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCd1bEVsZW1lbnQnLCB7cmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiB0cnVlIH0pIHVsRWxlbWVudDogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnc2VhcmNoRWxlbWVudCcsIHsgc3RhdGljOiBmYWxzZSB9KSBzZWFyY2hFbGVtZW50OiBQb011bHRpc2VsZWN0U2VhcmNoQ29tcG9uZW50O1xuXG4gIHNjcm9sbFRvKGluZGV4KSB7XG4gICAgdGhpcy5zY3JvbGxUb3AgPSAoaW5kZXggPD0gMikgPyAwIDogKGluZGV4ICogNDQpIC0gODg7XG4gIH1cblxuICBpc1NlbGVjdGVkSXRlbShvcHRpb246IFBvTXVsdGlzZWxlY3RPcHRpb24pIHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFZhbHVlcy5zb21lKHNlbGVjdGVkSXRlbSA9PiBzZWxlY3RlZEl0ZW0gPT09IG9wdGlvbi52YWx1ZSk7XG4gIH1cblxuICBjbGlja0l0ZW0oY2hlY2ssIG9wdGlvbikge1xuICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRWYWx1ZXMoY2hlY2ssIG9wdGlvbik7XG5cbiAgICBpZiAoIXRoaXMuaGlkZVNlYXJjaCkge1xuICAgICAgdGhpcy5zZWFyY2hFbGVtZW50LnNldEZvY3VzKCk7XG4gICAgfVxuICB9XG5cbiAgdXBkYXRlU2VsZWN0ZWRWYWx1ZXMoY2hlY2tlZCwgb3B0aW9uKSB7XG4gICAgaWYgKGNoZWNrZWQpIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMucHVzaChvcHRpb24udmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBpbmRleFNlbGVjdGVkVmFsdWVzID0gdGhpcy5zZWxlY3RlZFZhbHVlcy5pbmRleE9mKG9wdGlvbi52YWx1ZSk7XG4gICAgICB0aGlzLnNlbGVjdGVkVmFsdWVzLnNwbGljZShpbmRleFNlbGVjdGVkVmFsdWVzLCAxKTtcbiAgICB9XG5cbiAgICB0aGlzLmNoYW5nZS5lbWl0KHRoaXMuc2VsZWN0ZWRWYWx1ZXMpO1xuICB9XG5cbiAgY2FsbENoYW5nZVNlYXJjaChldmVudCkge1xuICAgIHRoaXMuY2hhbmdlU2VhcmNoLmVtaXQoZXZlbnQpO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcigna2V5ZG93bicsIFsnJGV2ZW50J10pXG4gIG9uS2V5ZG93bihldmVudDogYW55KSB7XG4gICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDkpIHtcbiAgICAgIHRoaXMuY2xvc2VEcm9wZG93bi5lbWl0KCk7XG4gICAgfVxuICB9XG5cbiAgY29udHJvbFZpc2liaWxpdHkodG9PcGVuKSB7XG4gICAgdGhpcy5zaG93ID0gdG9PcGVuO1xuICAgIHRoaXMuY2hlY2tJbml0aWFsT3B0aW9ucygpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAodG9PcGVuICYmIHRoaXMuc2VhcmNoRWxlbWVudCAmJiAhdGhpcy5oaWRlU2VhcmNoKSB7XG4gICAgICAgIHRoaXMuc2VhcmNoRWxlbWVudC5zZXRGb2N1cygpO1xuICAgICAgICB0aGlzLnNlYXJjaEVsZW1lbnQuY2xlYW4oKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tJbml0aWFsT3B0aW9ucygpIHtcbiAgICBpZiAodGhpcy5vcHRpb25zLmxlbmd0aCkge1xuICAgICAgdGhpcy5oYXZlT3B0aW9ucyA9IHRydWU7XG4gICAgfVxuICB9XG5cbn1cbiJdfQ==