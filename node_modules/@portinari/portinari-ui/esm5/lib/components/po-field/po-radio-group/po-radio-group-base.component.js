import * as tslib_1 from "tslib";
import { EventEmitter, Input, Output } from '@angular/core';
import { convertToBoolean, convertToInt, removeDuplicatedOptions } from '../../../utils/util';
import { InputBoolean } from '../../../decorators';
import { requiredFailed } from '../validators';
var poRadioGroupColumnsDefaultLength = 6;
var poRadioGroupColumnsTotalLength = 12;
/**
 * @description
 *
 * O componente `po-radio-group` deve ser utilizado para disponibilizar múltiplas opções ao usuário, permitindo a ele que
 * selecione apenas uma delas. Seu uso é recomendado para um número pequeno de opções, caso contrário, recomenda-se o uso
 * do [**po-combo**](/documentation/po-combo) ou [**po-select**](/documentation/po-select).
 *
 * Este não é um componente de multiseleção, se for este o caso, deve-se utilizar o
 * [**po-checkbox-group**](/documentation/po-checkbox-group).
 *
 * > Ao passar um valor para o *model* que não esteja na lista de opções, o mesmo será definido como `undefined`.
 */
var PoRadioGroupBaseComponent = /** @class */ (function () {
    function PoRadioGroupBaseComponent() {
        this._columns = poRadioGroupColumnsDefaultLength;
        this._disabled = false;
        this._required = false;
        this.mdColumns = poRadioGroupColumnsDefaultLength;
        this.onChangePropagate = null;
        /**
         * @optional
         *
         * @description
         *
         * Aplica foco no elemento ao ser iniciado.
         *
         * > Caso mais de um elemento seja configurado com essa propriedade, apenas o último elemento declarado com ela terá o foco.
         *
         * @default `false`
         */
        this.autoFocus = false;
        /** Evento ao alterar valor do campo. */
        this.change = new EventEmitter();
    }
    Object.defineProperty(PoRadioGroupBaseComponent.prototype, "columns", {
        get: function () {
            return this._columns;
        },
        /**
         * @optional
         *
         * @description
         *
         * Define a quantidade de colunas para exibição das opções.
         *
         * **Considerações:**
         *  - É possível exibir as opções entre `1` e `4` colunas.
         *  - O número máximo de colunas é invariável nas seguintes resoluções:
         *    + `sm`: `1`
         *    + `md`: `2`
         *
         * @default `2`
         */
        set: function (value) {
            var columns = convertToInt(value, poRadioGroupColumnsDefaultLength);
            this._columns = this.getGridSystemColumns(columns, 4);
            this.mdColumns = this.getGridSystemColumns(columns, 2);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoRadioGroupBaseComponent.prototype, "disabled", {
        get: function () {
            return this._disabled;
        },
        /**
         * @optional
         *
         * @description
         *
         * Indica que o campo será desabilitado.
         *
         * @default `false`
         */
        set: function (disabled) {
            this._disabled = convertToBoolean(disabled);
            this.validateModel();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoRadioGroupBaseComponent.prototype, "required", {
        get: function () {
            return this._required;
        },
        /**
         * @optional
         *
         * @description
         *
         * Indica que o campo será obrigatório.
         *
         * @default `false`
         */
        set: function (required) {
            this._required = convertToBoolean(required);
            this.validateModel();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoRadioGroupBaseComponent.prototype, "options", {
        get: function () {
            return this._options;
        },
        /**
         * Lista de opções que serão exibidas.
         * Nesta propriedade deve ser definido um array de objetos que implementam a interface PoRadioGroupOption.
         */
        set: function (value) {
            this._options = value;
            removeDuplicatedOptions(this.options);
        },
        enumerable: true,
        configurable: true
    });
    // Função que controla quando deve ser emitido onChange e atualiza o Model
    PoRadioGroupBaseComponent.prototype.changeValue = function (changedValue) {
        if (this.onChangePropagate) {
            this.onChangePropagate(changedValue);
        }
        if (this.value !== changedValue) {
            this.change.emit(changedValue);
        }
        this.value = changedValue;
    };
    PoRadioGroupBaseComponent.prototype.registerOnChange = function (fn) {
        this.onChangePropagate = fn;
    };
    PoRadioGroupBaseComponent.prototype.registerOnTouched = function (fn) { };
    PoRadioGroupBaseComponent.prototype.registerOnValidatorChange = function (fn) {
        this.validatorChange = fn;
    };
    PoRadioGroupBaseComponent.prototype.validate = function (abstractControl) {
        if (requiredFailed(this.required, this.disabled, abstractControl.value)) {
            return {
                required: {
                    valid: false,
                }
            };
        }
    };
    PoRadioGroupBaseComponent.prototype.writeValue = function (modelValue) {
        this.value = modelValue;
        // Busca radio com o valor especificado
        var element = this.getElementByValue(modelValue);
        if (!element && this.onChangePropagate) {
            this.value = undefined;
            this.onChangePropagate(this.value);
        }
    };
    PoRadioGroupBaseComponent.prototype.checkColumnsRange = function (columns, maxColumns) {
        var minColumns = 1;
        return columns >= minColumns && columns <= maxColumns;
    };
    PoRadioGroupBaseComponent.prototype.getGridSystemColumns = function (columns, maxColumns) {
        var gridSystemColumns = poRadioGroupColumnsTotalLength / columns;
        return this.checkColumnsRange(columns, maxColumns) ? gridSystemColumns : poRadioGroupColumnsDefaultLength;
    };
    PoRadioGroupBaseComponent.prototype.validateModel = function () {
        if (this.validatorChange) {
            this.validatorChange();
        }
    };
    tslib_1.__decorate([
        Input('p-auto-focus'), InputBoolean(),
        tslib_1.__metadata("design:type", Boolean)
    ], PoRadioGroupBaseComponent.prototype, "autoFocus", void 0);
    tslib_1.__decorate([
        Input('name'),
        tslib_1.__metadata("design:type", String)
    ], PoRadioGroupBaseComponent.prototype, "name", void 0);
    tslib_1.__decorate([
        Input('p-columns'),
        tslib_1.__metadata("design:type", Number),
        tslib_1.__metadata("design:paramtypes", [Number])
    ], PoRadioGroupBaseComponent.prototype, "columns", null);
    tslib_1.__decorate([
        Input('p-disabled'),
        tslib_1.__metadata("design:type", Boolean),
        tslib_1.__metadata("design:paramtypes", [Boolean])
    ], PoRadioGroupBaseComponent.prototype, "disabled", null);
    tslib_1.__decorate([
        Input('p-required'),
        tslib_1.__metadata("design:type", Boolean),
        tslib_1.__metadata("design:paramtypes", [Boolean])
    ], PoRadioGroupBaseComponent.prototype, "required", null);
    tslib_1.__decorate([
        Input('p-options'),
        tslib_1.__metadata("design:type", Array),
        tslib_1.__metadata("design:paramtypes", [Array])
    ], PoRadioGroupBaseComponent.prototype, "options", null);
    tslib_1.__decorate([
        Input('p-optional'),
        tslib_1.__metadata("design:type", Boolean)
    ], PoRadioGroupBaseComponent.prototype, "optional", void 0);
    tslib_1.__decorate([
        Output('p-change'),
        tslib_1.__metadata("design:type", EventEmitter)
    ], PoRadioGroupBaseComponent.prototype, "change", void 0);
    return PoRadioGroupBaseComponent;
}());
export { PoRadioGroupBaseComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcmFkaW8tZ3JvdXAtYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9ydGluYXJpL3BvcnRpbmFyaS11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWZpZWxkL3BvLXJhZGlvLWdyb3VwL3BvLXJhZGlvLWdyb3VwLWJhc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFNUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSx1QkFBdUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzlGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSS9DLElBQU0sZ0NBQWdDLEdBQVcsQ0FBQyxDQUFDO0FBQ25ELElBQU0sOEJBQThCLEdBQVcsRUFBRSxDQUFDO0FBRWxEOzs7Ozs7Ozs7OztHQVdHO0FBQ0g7SUFBQTtRQUVVLGFBQVEsR0FBVyxnQ0FBZ0MsQ0FBQztRQUNwRCxjQUFTLEdBQWEsS0FBSyxDQUFDO1FBRTVCLGNBQVMsR0FBYSxLQUFLLENBQUM7UUFFcEMsY0FBUyxHQUFXLGdDQUFnQyxDQUFDO1FBRzdDLHNCQUFpQixHQUFRLElBQUksQ0FBQztRQUd0Qzs7Ozs7Ozs7OztXQVVHO1FBQ29DLGNBQVMsR0FBWSxLQUFLLENBQUM7UUFnR2xFLHdDQUF3QztRQUNwQixXQUFNLEdBQXVCLElBQUksWUFBWSxFQUFPLENBQUM7SUFxRTNFLENBQUM7SUFsSnFCLHNCQUFJLDhDQUFPO2FBTy9CO1lBQ0UsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQ3ZCLENBQUM7UUF4QkQ7Ozs7Ozs7Ozs7Ozs7O1dBY0c7YUFDaUIsVUFBWSxLQUFhO1lBQzNDLElBQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxL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QUFPLE9BQU8sSUFBSSxVQUFVLElBQUksT0FBTyxJQUFJLFVBQVUsQ0FBQztJQUN4RCxDQUFDO0lBRU8sd0RBQW9CLEdBQTVCLFVBQTZCLE9BQWUsRUFBRSxVQUFrQjtRQUM5RCxJQUFNLGlCQUFpQixHQUFHLDhCQUE4QixHQUFHLE9BQU8sQ0FBQztRQUVuRSxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxnQ0FBZ0MsQ0FBQztJQUM1RyxDQUFDO0lBRU8saURBQWEsR0FBckI7UUFDRSxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDeEIsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1NBQ3hCO0lBQ0gsQ0FBQztJQXBLc0M7UUFBdEMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxFQUFFLFlBQVksRUFBRTs7Z0VBQTRCO0lBR25EO1FBQWQsS0FBSyxDQUFDLE1BQU0sQ0FBQzs7MkRBQWM7SUFpQlI7UUFBbkIsS0FBSyxDQUFDLFdBQVcsQ0FBQzs7OzREQUtsQjtJQWVvQjtRQUFwQixLQUFLLENBQUMsWUFBWSxDQUFDOzs7NkRBSW5CO0lBZW9CO1FBQXBCLEtBQUssQ0FBQyxZQUFZLENBQUM7Ozs2REFJbkI7SUFVbUI7UUFBbkIsS0FBSyxDQUFDLFdBQVcsQ0FBQzswQ0FBb0IsS0FBSztpREFBTCxLQUFLOzREQUczQztJQWtCb0I7UUFBcEIsS0FBSyxDQUFDLFlBQVksQ0FBQzs7K0RBQW1CO0lBR25CO1FBQW5CLE1BQU0sQ0FBQyxVQUFVLENBQUM7MENBQVUsWUFBWTs2REFBZ0M7SUFxRTNFLGdDQUFDO0NBQUEsQUE5TEQsSUE4TEM7U0E5THFCLHlCQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgQ29udHJvbFZhbHVlQWNjZXNzb3IsIFZhbGlkYXRvciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlciwgSW5wdXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBjb252ZXJ0VG9Cb29sZWFuLCBjb252ZXJ0VG9JbnQsIHJlbW92ZUR1cGxpY2F0ZWRPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdXRpbCc7XG5pbXBvcnQgeyBJbnB1dEJvb2xlYW4gfSBmcm9tICcuLi8uLi8uLi9kZWNvcmF0b3JzJztcbmltcG9ydCB7IHJlcXVpcmVkRmFpbGVkIH0gZnJvbSAnLi4vdmFsaWRhdG9ycyc7XG5cbmltcG9ydCB7IFBvUmFkaW9Hcm91cE9wdGlvbiB9IGZyb20gJy4vcG8tcmFkaW8tZ3JvdXAtb3B0aW9uLmludGVyZmFjZSc7XG5cbmNvbnN0IHBvUmFkaW9Hcm91cENvbHVtbnNEZWZhdWx0TGVuZ3RoOiBudW1iZXIgPSA2O1xuY29uc3QgcG9SYWRpb0dyb3VwQ29sdW1uc1RvdGFsTGVuZ3RoOiBudW1iZXIgPSAxMjtcblxuLyoqXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBPIGNvbXBvbmVudGUgYHBvLXJhZGlvLWdyb3VwYCBkZXZlIHNlciB1dGlsaXphZG8gcGFyYSBkaXNwb25pYmlsaXphciBtw7psdGlwbGFzIG9ww6fDtWVzIGFvIHVzdcOhcmlvLCBwZXJtaXRpbmRvIGEgZWxlIHF1ZVxuICogc2VsZWNpb25lIGFwZW5hcyB1bWEgZGVsYXMuIFNldSB1c28gw6kgcmVjb21lbmRhZG8gcGFyYSB1bSBuw7ptZXJvIHBlcXVlbm8gZGUgb3DDp8O1ZXMsIGNhc28gY29udHLDoXJpbywgcmVjb21lbmRhLXNlIG8gdXNvXG4gKiBkbyBbKipwby1jb21ibyoqXSgvZG9jdW1lbnRhdGlvbi9wby1jb21ibykgb3UgWyoqcG8tc2VsZWN0KipdKC9kb2N1bWVudGF0aW9uL3BvLXNlbGVjdCkuXG4gKlxuICogRXN0ZSBuw6NvIMOpIHVtIGNvbXBvbmVudGUgZGUgbXVsdGlzZWxlw6fDo28sIHNlIGZvciBlc3RlIG8gY2FzbywgZGV2ZS1zZSB1dGlsaXphciBvXG4gKiBbKipwby1jaGVja2JveC1ncm91cCoqXSgvZG9jdW1lbnRhdGlvbi9wby1jaGVja2JveC1ncm91cCkuXG4gKlxuICogPiBBbyBwYXNzYXIgdW0gdmFsb3IgcGFyYSBvICptb2RlbCogcXVlIG7Do28gZXN0ZWphIG5hIGxpc3RhIGRlIG9ww6fDtWVzLCBvIG1lc21vIHNlcsOhIGRlZmluaWRvIGNvbW8gYHVuZGVmaW5lZGAuXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBQb1JhZGlvR3JvdXBCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIFZhbGlkYXRvciB7XG5cbiAgcHJpdmF0ZSBfY29sdW1uczogbnVtYmVyID0gcG9SYWRpb0dyb3VwQ29sdW1uc0RlZmF1bHRMZW5ndGg7XG4gIHByaXZhdGUgX2Rpc2FibGVkPzogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIF9vcHRpb25zOiBBcnJheTxQb1JhZGlvR3JvdXBPcHRpb24+O1xuICBwcml2YXRlIF9yZXF1aXJlZD86IGJvb2xlYW4gPSBmYWxzZTtcblxuICBtZENvbHVtbnM6IG51bWJlciA9IHBvUmFkaW9Hcm91cENvbHVtbnNEZWZhdWx0TGVuZ3RoO1xuICB2YWx1ZTogYW55O1xuXG4gIHByaXZhdGUgb25DaGFuZ2VQcm9wYWdhdGU6IGFueSA9IG51bGw7XG4gIHByaXZhdGUgdmFsaWRhdG9yQ2hhbmdlO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEFwbGljYSBmb2NvIG5vIGVsZW1lbnRvIGFvIHNlciBpbmljaWFkby5cbiAgICpcbiAgICogPiBDYXNvIG1haXMgZGUgdW0gZWxlbWVudG8gc2VqYSBjb25maWd1cmFkbyBjb20gZXNzYSBwcm9wcmllZGFkZSwgYXBlbmFzIG8gw7psdGltbyBlbGVtZW50byBkZWNsYXJhZG8gY29tIGVsYSB0ZXLDoSBvIGZvY28uXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgncC1hdXRvLWZvY3VzJykgQElucHV0Qm9vbGVhbigpIGF1dG9Gb2N1czogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKiBOb21lIGRhcyBvcMOnw7Vlcy4gKi9cbiAgQElucHV0KCduYW1lJykgbmFtZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERlZmluZSBhIHF1YW50aWRhZGUgZGUgY29sdW5hcyBwYXJhIGV4aWJpw6fDo28gZGFzIG9ww6fDtWVzLlxuICAgKlxuICAgKiAqKkNvbnNpZGVyYcOnw7VlczoqKlxuICAgKiAgLSDDiSBwb3Nzw612ZWwgZXhpYmlyIGFzIG9ww6fDtWVzIGVudHJlIGAxYCBlIGA0YCBjb2x1bmFzLlxuICAgKiAgLSBPIG7Dum1lcm8gbcOheGltbyBkZSBjb2x1bmFzIMOpIGludmFyacOhdmVsIG5hcyBzZWd1aW50ZXMgcmVzb2x1w6fDtWVzOlxuICAgKiAgICArIGBzbWA6IGAxYFxuICAgKiAgICArIGBtZGA6IGAyYFxuICAgKlxuICAgKiBAZGVmYXVsdCBgMmBcbiAgICovXG4gIEBJbnB1dCgncC1jb2x1bW5zJykgc2V0IGNvbHVtbnModmFsdWU6IG51bWJlcikge1xuICAgIGNvbnN0IGNvbHVtbnMgPSBjb252ZXJ0VG9JbnQodmFsdWUsIHBvUmFkaW9Hcm91cENvbHVtbnNEZWZhdWx0TGVuZ3RoKTtcblxuICAgIHRoaXMuX2NvbHVtbnMgPSB0aGlzLmdldEdyaWRTeXN0ZW1Db2x1bW5zKGNvbHVtbnMsIDQpO1xuICAgIHRoaXMubWRDb2x1bW5zID0gdGhpcy5nZXRHcmlkU3lzdGVtQ29sdW1ucyhjb2x1bW5zLCAyKTtcbiAgfVxuXG4gIGdldCBjb2x1bW5zKCkge1xuICAgIHJldHVybiB0aGlzLl9jb2x1bW5zO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogSW5kaWNhIHF1ZSBvIGNhbXBvIHNlcsOhIGRlc2FiaWxpdGFkby5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLWRpc2FibGVkJykgc2V0IGRpc2FibGVkKGRpc2FibGVkOiBib29sZWFuKSB7XG4gICAgdGhpcy5fZGlzYWJsZWQgPSBjb252ZXJ0VG9Cb29sZWFuKGRpc2FibGVkKTtcblxuICAgIHRoaXMudmFsaWRhdGVNb2RlbCgpO1xuICB9XG5cbiAgZ2V0IGRpc2FibGVkKCkge1xuICAgIHJldHVybiB0aGlzLl9kaXNhYmxlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEluZGljYSBxdWUgbyBjYW1wbyBzZXLDoSBvYnJpZ2F0w7NyaW8uXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgncC1yZXF1aXJlZCcpIHNldCByZXF1aXJlZChyZXF1aXJlZDogYm9vbGVhbikge1xuICAgIHRoaXMuX3JlcXVpcmVkID0gY29udmVydFRvQm9vbGVhbihyZXF1aXJlZCk7XG5cbiAgICB0aGlzLnZhbGlkYXRlTW9kZWwoKTtcbiAgfVxuXG4gIGdldCByZXF1aXJlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWlyZWQ7XG4gIH1cblxuICAvKipcbiAgICogTGlzdGEgZGUgb3DDp8O1ZXMgcXVlIHNlcsOjbyBleGliaWRhcy5cbiAgICogTmVzdGEgcHJvcHJpZWRhZGUgZGV2ZSBzZXIgZGVmaW5pZG8gdW0gYXJyYXkgZGUgb2JqZXRvcyBxdWUgaW1wbGVtZW50YW0gYSBpbnRlcmZhY2UgUG9SYWRpb0dyb3VwT3B0aW9uLlxuICAgKi9cbiAgQElucHV0KCdwLW9wdGlvbnMnKSBzZXQgb3B0aW9ucyh2YWx1ZTogQXJyYXk8UG9SYWRpb0dyb3VwT3B0aW9uPikge1xuICAgIHRoaXMuX29wdGlvbnMgPSB2YWx1ZTtcbiAgICByZW1vdmVEdXBsaWNhdGVkT3B0aW9ucyh0aGlzLm9wdGlvbnMpO1xuICB9XG4gIGdldCBvcHRpb25zKCkge1xuICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogRGVmaW5lIHNlIGEgaW5kaWNhw6fDo28gZGUgY2FtcG8gb3BjaW9uYWwgc2Vyw6EgZXhpYmlkYS5cbiAgICpcbiAgICogPiBOw6NvIHNlcsOhIGV4aWJpZGEgYSBpbmRpY2HDp8OjbyBzZTpcbiAgICogLSBPIGNhbXBvIGNvbnRlciBgcC1yZXF1aXJlZGA7XG4gICAqIC0gTsOjbyBwb3NzdWlyIGBwLWhlbHBgIGUvb3UgYHAtbGFiZWxgLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICBASW5wdXQoJ3Atb3B0aW9uYWwnKSBvcHRpb25hbDogYm9vbGVhbjtcblxuICAvKiogRXZlbnRvIGFvIGFsdGVyYXIgdmFsb3IgZG8gY2FtcG8uICovXG4gIEBPdXRwdXQoJ3AtY2hhbmdlJykgY2hhbmdlPzogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAvLyBEZXZlIHJldG9ybmFyIG8gdmFsb3IgZWxlbWVudG8gcXVlIGNvbnTDqW0gbyB2YWxvciBwYXNzYWRvIHBvciBwYXLDom1ldHJvXG4gIGFic3RyYWN0IGdldEVsZW1lbnRCeVZhbHVlKHZhbHVlOiBhbnkpOiBhbnk7XG5cbiAgLy8gRnVuw6fDo28gcXVlIGNvbnRyb2xhIHF1YW5kbyBkZXZlIHNlciBlbWl0aWRvIG9uQ2hhbmdlIGUgYXR1YWxpemEgbyBNb2RlbFxuICBjaGFuZ2VWYWx1ZShjaGFuZ2VkVmFsdWU6IGFueSkge1xuICAgIGlmICh0aGlzLm9uQ2hhbmdlUHJvcGFnYXRlKSB7XG4gICAgICB0aGlzLm9uQ2hhbmdlUHJvcGFnYXRlKGNoYW5nZWRWYWx1ZSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMudmFsdWUgIT09IGNoYW5nZWRWYWx1ZSkge1xuICAgICAgdGhpcy5jaGFuZ2UuZW1pdChjaGFuZ2VkVmFsdWUpO1xuICAgIH1cblxuICAgIHRoaXMudmFsdWUgPSBjaGFuZ2VkVmFsdWU7XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpIHtcbiAgICB0aGlzLm9uQ2hhbmdlUHJvcGFnYXRlID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KSB7IH1cblxuICByZWdpc3Rlck9uVmFsaWRhdG9yQ2hhbmdlKGZuOiBhbnkpIHtcbiAgICB0aGlzLnZhbGlkYXRvckNoYW5nZSA9IGZuO1xuICB9XG5cbiAgdmFsaWRhdGUoYWJzdHJhY3RDb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueTsgfSB7XG5cbiAgICBpZiAocmVxdWlyZWRGYWlsZWQodGhpcy5yZXF1aXJlZCwgdGhpcy5kaXNhYmxlZCwgYWJzdHJhY3RDb250cm9sLnZhbHVlKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVxdWlyZWQ6IHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuXG4gIH1cblxuICB3cml0ZVZhbHVlKG1vZGVsVmFsdWU6IGFueSkge1xuICAgIHRoaXMudmFsdWUgPSBtb2RlbFZhbHVlO1xuXG4gICAgLy8gQnVzY2EgcmFkaW8gY29tIG8gdmFsb3IgZXNwZWNpZmljYWRvXG4gICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZ2V0RWxlbWVudEJ5VmFsdWUobW9kZWxWYWx1ZSk7XG4gICAgaWYgKCFlbGVtZW50ICYmIHRoaXMub25DaGFuZ2VQcm9wYWdhdGUpIHtcbiAgICAgIHRoaXMudmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLm9uQ2hhbmdlUHJvcGFnYXRlKHRoaXMudmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tDb2x1bW5zUmFuZ2UoY29sdW1ucywgbWF4Q29sdW1ucyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG1pbkNvbHVtbnMgPSAxO1xuXG4gICAgcmV0dXJuIGNvbHVtbnMgPj0gbWluQ29sdW1ucyAmJiBjb2x1bW5zIDw9IG1heENvbHVtbnM7XG4gIH1cblxuICBwcml2YXRlIGdldEdyaWRTeXN0ZW1Db2x1bW5zKGNvbHVtbnM6IG51bWJlciwgbWF4Q29sdW1uczogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBjb25zdCBncmlkU3lzdGVtQ29sdW1ucyA9IHBvUmFkaW9Hcm91cENvbHVtbnNUb3RhbExlbmd0aCAvIGNvbHVtbnM7XG5cbiAgICByZXR1cm4gdGhpcy5jaGVja0NvbHVtbnNSYW5nZShjb2x1bW5zLCBtYXhDb2x1bW5zKSA/IGdyaWRTeXN0ZW1Db2x1bW5zIDogcG9SYWRpb0dyb3VwQ29sdW1uc0RlZmF1bHRMZW5ndGg7XG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlTW9kZWwoKSB7XG4gICAgaWYgKHRoaXMudmFsaWRhdG9yQ2hhbmdlKSB7XG4gICAgICB0aGlzLnZhbGlkYXRvckNoYW5nZSgpO1xuICAgIH1cbiAgfVxuXG59XG4iXX0=