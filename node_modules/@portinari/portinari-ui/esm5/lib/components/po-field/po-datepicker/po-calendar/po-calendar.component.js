import * as tslib_1 from "tslib";
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { isMobile, setYearFrom0To100, validateDateRange } from '../../../../utils/util';
import { PoCalendarLangService } from './po-calendar.lang.service';
import { PoCalendarService } from './po-calendar.service';
var poCalendarLocaleDefault = 'pt';
var poCalendarLocales = ['pt', 'en', 'es'];
/**
 * @docsPrivate
 *
 * @description
 *
 * Componente de calendário de uso interno
 */
var PoCalendarComponent = /** @class */ (function () {
    function PoCalendarComponent(poCalendarService, poCalendarLangService) {
        this.poCalendarService = poCalendarService;
        this.poCalendarLangService = poCalendarLangService;
        this.dayVisible = false;
        this.displayMonths = Array();
        this.displayWeedDays = Array();
        this.monthVisible = false;
        this.overlayInvisible = true;
        this.visible = false;
        this.yearVisible = false;
        this.isMobile = isMobile;
        this.today = new Date();
        this.selectedDateChange = new EventEmitter();
        this.submit = new EventEmitter();
    }
    Object.defineProperty(PoCalendarComponent.prototype, "dateEnd", {
        get: function () {
            return this._dateEnd;
        },
        /**
         * @optional
         *
         * @description
         *
         * Data máxima possível de ser selecionada no calendário.
         */
        set: function (val) {
            if (val && val instanceof Date) {
                var year = val.getFullYear();
                var month = val.getMonth();
                var day = val.getDate();
                var date = new Date(year, month, day, 23, 59, 59);
                setYearFrom0To100(date, year);
                this._dateEnd = date;
            }
            else {
                this._dateEnd = undefined;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoCalendarComponent.prototype, "locale", {
        get: function () {
            return this._locale;
        },
        /**
         * @optional
         *
         * @description
         *
         * Idioma do calendário.
         *
         * Valores válidos:
         *  - `pt`
         *  - `en`
         *  - `es`
         */
        set: function (locale) {
            this._locale = poCalendarLocales.includes(locale) ? locale : poCalendarLocaleDefault;
            this.initializeLanguage();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoCalendarComponent.prototype, "selectedDate", {
        get: function () {
            return this._selectedDate;
        },
        /**
         * @optional
         *
         * @description
         *
         * Data selecionada no calendário.
         */
        set: function (selectedDate) {
            this._selectedDate = selectedDate && selectedDate instanceof Date ? selectedDate : undefined;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoCalendarComponent.prototype, "dateStart", {
        get: function () {
            return this._dateStart;
        },
        /**
         * @optional
         *
         * @description
         *
         * Data mínima possível de ser selecionada no calendário.
         */
        set: function (val) {
            if (val && val instanceof Date) {
                var year = val.getFullYear();
                var month = val.getMonth();
                var day = val.getDate();
                var date = new Date(year, month, day, 0, 0, 0);
                setYearFrom0To100(date, year);
                this._dateStart = date;
            }
            else {
                this._dateStart = undefined;
            }
        },
        enumerable: true,
        configurable: true
    });
    PoCalendarComponent.prototype.close = function () {
        this.overlayInvisible = true;
        this.visible = false;
    };
    // Obtém um array de todos os anos desta década
    PoCalendarComponent.prototype.getArrayDecade = function (year) {
        this.displayDecade = Array();
        if (year % 10 !== 0) {
            while (year % 10 !== 0) {
                year--;
            }
        }
        this.updateDecade(year);
    };
    PoCalendarComponent.prototype.getBackgroundColor = function (displayValue, propertyValue) {
        return (displayValue === propertyValue) ? 'po-calendar-box-background-selected' : 'po-calendar-box-background';
    };
    PoCalendarComponent.prototype.getDayBackgroundColor = function (date) {
        if (this.equalsDate(date, this.selectedDate)) {
            return 'po-calendar-box-background-selected';
        }
        else if (this.equalsDate(date, this.today)) {
            return 'po-calendar-box-background-today';
        }
        else if (date) {
            if (validateDateRange(date, this.dateStart, this.dateEnd)) {
                return 'po-calendar-box-background';
            }
            else {
                return 'po-calendar-box-background-disabled';
            }
        }
        else {
            return '';
        }
    };
    PoCalendarComponent.prototype.getDayForegroundColor = function (date) {
        if (this.equalsDate(date, this.selectedDate)) {
            return 'po-calendar-box-foreground-selected';
        }
        else if (this.equalsDate(date, this.today)) {
            return 'po-calendar-box-foreground-today';
        }
        else {
            if (validateDateRange(date, this.dateStart, this.dateEnd)) {
                return 'po-calendar-box-foreground';
            }
            else {
                return 'po-calendar-box-foreground-disabled';
            }
        }
    };
    PoCalendarComponent.prototype.getForegroundColor = function (displayValue, propertyValue) {
        return (displayValue === propertyValue) ? 'po-calendar-box-foreground-selected' : 'po-calendar-box-foreground';
    };
    PoCalendarComponent.prototype.getWordMonth = function () {
        return this.poCalendarLangService.getWordMonth();
    };
    PoCalendarComponent.prototype.getWordYear = function () {
        return this.poCalendarLangService.getWordYear();
    };
    PoCalendarComponent.prototype.init = function () {
        this.selectedDate ? this.updateDate(this.selectedDate) : this.updateDate(this.today);
        this.initializeLanguage();
        this.selectDay();
        if (this.isMobile()) {
            this.overlayInvisible = false;
        }
        this.visible = true;
    };
    PoCalendarComponent.prototype.initializeLanguage = function () {
        this.poCalendarLangService.setLanguage(this.locale);
        this.displayWeedDays = this.poCalendarLangService.getArrayWeekDays();
        this.displayMonths = this.poCalendarLangService.getArrayMonths();
    };
    PoCalendarComponent.prototype.onNextMonth = function () {
        if (this.displayMonthNumber < 11) {
            this.updateDisplay(this.displayYear, this.displayMonthNumber + 1);
        }
        else {
            this.updateDisplay(this.displayYear + 1, 0);
        }
    };
    PoCalendarComponent.prototype.onPrevMonth = function () {
        if (this.displayMonthNumber > 0) {
            this.updateDisplay(this.displayYear, this.displayMonthNumber - 1);
        }
        else {
            this.updateDisplay(this.displayYear - 1, 11);
        }
    };
    // Ao selecionar uma data
    PoCalendarComponent.prototype.onSelectDate = function (date) {
        if (validateDateRange(date, this.dateStart, this.dateEnd)) {
            this.selectedDate = date;
            this.selectedDateChange.emit(date);
            this.submit.emit(date);
        }
    };
    // Ao selecionar um mês
    PoCalendarComponent.prototype.onSelectMonth = function (year, month) {
        this.selectDay();
        this.updateDisplay(year, month);
    };
    // Ao selecionar um ano
    PoCalendarComponent.prototype.onSelectYear = function (year, month) {
        // Se veio da tela de seleção de mês
        this.lastDisplay === 'month' ? this.selectMonth() : this.selectDay();
        this.currentYear = year;
        this.updateDisplay(year, month);
    };
    PoCalendarComponent.prototype.selectDay = function () {
        this.dayVisible = true;
        this.monthVisible = false;
        this.yearVisible = false;
        this.lastDisplay = 'day';
    };
    PoCalendarComponent.prototype.selectMonth = function () {
        this.dayVisible = false;
        this.monthVisible = true;
        this.yearVisible = false;
        this.lastDisplay = 'month';
    };
    PoCalendarComponent.prototype.selectYear = function () {
        this.dayVisible = false;
        this.monthVisible = false;
        this.yearVisible = true;
    };
    PoCalendarComponent.prototype.setMobileVisualization = function () {
        return this.isMobile() ? 'po-calendar po-calendar-mobile' : 'po-calendar';
    };
    PoCalendarComponent.prototype.updateYear = function (value) {
        this.updateDisplay(this.displayYear + value, this.displayMonthNumber);
    };
    PoCalendarComponent.prototype.addAllYearsInDecade = function (year) {
        var i;
        for (i = year; i < year + 10; i++) {
            this.displayDecade.push(i);
        }
    };
    PoCalendarComponent.prototype.equalsDate = function (date1, date2) {
        try {
            return date1.getFullYear() === date2.getFullYear() &&
                date1.getMonth() === date2.getMonth() &&
                date1.getDate() === date2.getDate();
        }
        catch (error) {
            return false;
        }
    };
    PoCalendarComponent.prototype.updateDate = function (date) {
        this.currentMonthNumber = date.getMonth();
        this.currentYear = date.getFullYear();
        this.updateDisplay(this.currentYear, this.currentMonthNumber);
    };
    PoCalendarComponent.prototype.updateDecade = function (year) {
        this.addAllYearsInDecade(year);
        this.displayStartDecade = year;
        this.displayFinalDecade = year + 9;
    };
    PoCalendarComponent.prototype.updateDisplay = function (year, month) {
        var calendarArray = this.poCalendarService.monthDays(year, month);
        this.displayDays = [].concat.apply([], calendarArray);
        this.displayMonthNumber = month;
        this.displayMonth = this.displayMonths[month];
        this.displayYear = year;
        this.getArrayDecade(year);
    };
    PoCalendarComponent.ctorParameters = function () { return [
        { type: PoCalendarService },
        { type: PoCalendarLangService }
    ]; };
    tslib_1.__decorate([
        ViewChild('days', { read: ElementRef, static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], PoCalendarComponent.prototype, "elDays", void 0);
    tslib_1.__decorate([
        ViewChild('months', { read: ElementRef, static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], PoCalendarComponent.prototype, "elMonths", void 0);
    tslib_1.__decorate([
        ViewChild('years', { read: ElementRef, static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], PoCalendarComponent.prototype, "elYears", void 0);
    tslib_1.__decorate([
        Input('p-date-end'),
        tslib_1.__metadata("design:type", Date),
        tslib_1.__metadata("design:paramtypes", [Date])
    ], PoCalendarComponent.prototype, "dateEnd", null);
    tslib_1.__decorate([
        Input('p-locale'),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], PoCalendarComponent.prototype, "locale", null);
    tslib_1.__decorate([
        Input('p-selected-date'),
        tslib_1.__metadata("design:type", Date),
        tslib_1.__metadata("design:paramtypes", [Date])
    ], PoCalendarComponent.prototype, "selectedDate", null);
    tslib_1.__decorate([
        Input('p-date-start'),
        tslib_1.__metadata("design:type", Date),
        tslib_1.__metadata("design:paramtypes", [Date])
    ], PoCalendarComponent.prototype, "dateStart", null);
    tslib_1.__decorate([
        Output('p-selected-dateChange'),
        tslib_1.__metadata("design:type", Object)
    ], PoCalendarComponent.prototype, "selectedDateChange", void 0);
    tslib_1.__decorate([
        Output('p-submit'),
        tslib_1.__metadata("design:type", Object)
    ], PoCalendarComponent.prototype, "submit", void 0);
    PoCalendarComponent = tslib_1.__decorate([
        Component({
            selector: 'po-calendar',
            template: "<div class=\"po-calendar-overlay\" [class.po-invisible]=\"overlayInvisible\"></div>\n<div *ngIf=\"visible\" [ngClass]=\"setMobileVisualization()\">\n  <div *ngIf=\"dayVisible\" #days>\n    <div class=\"po-calendar-nav\">\n      <span (click)=\"onPrevMonth()\" class=\"po-calendar-nav-left po-icon po-icon-arrow-left\"></span>\n      <div class=\"po-calendar-nav-title\" attr-calendar>\n        <span class=\"po-clickable po-mr-1\" (click)=\"selectMonth()\">{{ displayMonth }}</span>\n        <span class=\"po-clickable\" (click)=\"selectYear()\">{{ displayYear }}</span>\n      </div>\n      <span (click)=\"onNextMonth()\" class=\"po-calendar-nav-right po-icon po-icon-arrow-right\"></span>\n    </div>\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\" *ngFor=\"let day of displayWeedDays\">\n            {{ day.toLowerCase() }}\n        </div>\n      </div>\n      <div class=\"po-calendar-content-list-day\">\n        <div *ngFor=\"let day of displayDays\" class=\"po-calendar-day po-calendar-box-background\" (click)=\"onSelectDate(day)\"\n          [ngClass]=\"getDayBackgroundColor(day)\">\n          <span *ngIf=\"day != 0\" [ngClass]=\"getDayForegroundColor(day)\">\n            {{ day.getDate() }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div *ngIf=\"monthVisible\" #months>\n    <div class=\"po-calendar-nav\">\n      <span (click)=\"updateYear(-1)\" class=\"po-calendar-nav-left po-icon po-icon-arrow-left\"></span>\n      <div class=\"po-calendar-nav-title\" attr-calendar>\n        <span class=\"po-clickable\" (click)=\"selectYear()\">{{ displayYear }}</span>\n      </div>\n      <span (click)=\"updateYear(1)\" class=\"po-calendar-nav-right po-icon po-icon-arrow-right\"></span>\n    </div>\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\">\n          {{ getWordMonth() }}\n        </div>\n      </div>\n      <div class=\"po-calendar-content-list-month\">\n        <div *ngFor=\"let month of displayMonths; let i = index;\" class=\"po-calendar-month\"\n        (click)=\"onSelectMonth(displayYear, i)\"\n        [ngClass]=\"getBackgroundColor(i, displayMonthNumber)\" attr-calendar>\n          <span [ngClass]=\"getForegroundColor(i, displayMonthNumber)\">\n            {{ month }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div *ngIf=\"yearVisible\" #years>\n    <div class=\"po-calendar-nav\">\n      <span (click)=\"updateYear(-10)\" class=\"po-calendar-nav-left po-icon po-icon-arrow-left\"></span>\n      <div class=\"po-calendar-nav-title\">\n        {{ displayStartDecade }} - {{ displayFinalDecade }}\n      </div>\n      <span (click)=\"updateYear(10)\" class=\"po-calendar-nav-right po-icon po-icon-arrow-right\"></span>\n    </div>\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\">\n          {{ getWordYear() }}\n        </div>\n      </div>\n      <div class=\"po-calendar-content-list-year\">\n        <div *ngFor=\"let year of displayDecade; let i = index;\" class=\"po-calendar-year\"\n        (click)=\"onSelectYear(year, displayMonthNumber)\"\n        [ngClass]=\"getBackgroundColor(year, currentYear)\" attr-calendar>\n          <span [ngClass]=\"getForegroundColor(year, currentYear)\">\n            {{ year }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\n",
            providers: [PoCalendarService, PoCalendarLangService]
        }),
        tslib_1.__metadata("design:paramtypes", [PoCalendarService,
            PoCalendarLangService])
    ], PoCalendarComponent);
    return PoCalendarComponent;
}());
export { PoCalendarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvcnRpbmFyaS9wb3J0aW5hcmktdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wby1maWVsZC9wby1kYXRlcGlja2VyL3BvLWNhbGVuZGFyL3BvLWNhbGVuZGFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTlGLE9BQU8sRUFBRSxRQUFRLEVBQUUsaUJBQWlCLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN4RixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUNuRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUUxRCxJQUFNLHVCQUF1QixHQUFHLElBQUksQ0FBQztBQUNyQyxJQUFNLGlCQUFpQixHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztBQUU3Qzs7Ozs7O0dBTUc7QUFNSDtJQXVIRSw2QkFDVSxpQkFBb0MsRUFDcEMscUJBQTRDO1FBRDVDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUF1QjtRQWpIdEQsZUFBVSxHQUFZLEtBQUssQ0FBQztRQU01QixrQkFBYSxHQUFlLEtBQUssRUFBRSxDQUFDO1FBRXBDLG9CQUFlLEdBQWUsS0FBSyxFQUFFLENBQUM7UUFFdEMsaUJBQVksR0FBWSxLQUFLLENBQUM7UUFDOUIscUJBQWdCLEdBQVksSUFBSSxDQUFDO1FBQ2pDLFlBQU8sR0FBWSxLQUFLLENBQUM7UUFDekIsZ0JBQVcsR0FBWSxLQUFLLENBQUM7UUFHckIsYUFBUSxHQUFRLFFBQVEsQ0FBQztRQUV6QixVQUFL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QVN2RDtRQUFwQixLQUFLLENBQUMsWUFBWSxDQUFDOzBDQUFrQixJQUFJO2lEQUFKLElBQUk7c0RBYXpDO0lBaUJrQjtRQUFsQixLQUFLLENBQUMsVUFBVSxDQUFDOzs7cURBR2pCO0lBWXlCO1FBQXpCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQzswQ0FBZ0MsSUFBSTtpREFBSixJQUFJOzJEQUU1RDtJQVlzQjtRQUF0QixLQUFLLENBQUMsY0FBYyxDQUFDOzBDQUFvQixJQUFJO2lEQUFKLElBQUk7d0RBYTdDO0lBS2dDO1FBQWhDLE1BQU0sQ0FBQyx1QkFBdUIsQ0FBQzs7bUVBQStDO0lBQzNEO1FBQW5CLE1BQU0sQ0FBQyxVQUFVLENBQUM7O3VEQUFtQztJQXJIM0MsbUJBQW1CO1FBTC9CLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxhQUFhO1lBQ3ZCLCs4R0FBMkM7WUFDM0MsU0FBUyxFQUFFLENBQUMsaUJBQWlCLEVBQUUscUJBQXFCLENBQUU7U0FDdkQsQ0FBQztpREF5SDZCLGlCQUFpQjtZQUNiLHFCQUFxQjtPQXpIM0MsbUJBQW1CLENBeVQvQjtJQUFELDBCQUFDO0NBQUEsQUF6VEQsSUF5VEM7U0F6VFksbUJBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBpc01vYmlsZSwgc2V0WWVhckZyb20wVG8xMDAsIHZhbGlkYXRlRGF0ZVJhbmdlIH0gZnJvbSAnLi4vLi4vLi4vLi4vdXRpbHMvdXRpbCc7XG5pbXBvcnQgeyBQb0NhbGVuZGFyTGFuZ1NlcnZpY2UgfSBmcm9tICcuL3BvLWNhbGVuZGFyLmxhbmcuc2VydmljZSc7XG5pbXBvcnQgeyBQb0NhbGVuZGFyU2VydmljZSB9IGZyb20gJy4vcG8tY2FsZW5kYXIuc2VydmljZSc7XG5cbmNvbnN0IHBvQ2FsZW5kYXJMb2NhbGVEZWZhdWx0ID0gJ3B0JztcbmNvbnN0IHBvQ2FsZW5kYXJMb2NhbGVzID0gWydwdCcsICdlbicsICdlcyddO1xuXG4vKipcbiAqIEBkb2NzUHJpdmF0ZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIENvbXBvbmVudGUgZGUgY2FsZW5kw6FyaW8gZGUgdXNvIGludGVybm9cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tY2FsZW5kYXInLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tY2FsZW5kYXIuY29tcG9uZW50Lmh0bWwnLFxuICBwcm92aWRlcnM6IFtQb0NhbGVuZGFyU2VydmljZSwgUG9DYWxlbmRhckxhbmdTZXJ2aWNlIF1cbn0pXG5leHBvcnQgY2xhc3MgUG9DYWxlbmRhckNvbXBvbmVudCB7XG5cbiAgcHJpdmF0ZSBfZGF0ZUVuZDogRGF0ZTtcbiAgcHJpdmF0ZSBfZGF0ZVN0YXJ0OiBEYXRlO1xuICBwcml2YXRlIF9sb2NhbGU6IHN0cmluZztcbiAgcHJpdmF0ZSBfc2VsZWN0ZWREYXRlPzogRGF0ZTtcblxuICBjdXJyZW50WWVhcjogbnVtYmVyO1xuICBkYXlWaXNpYmxlOiBib29sZWFuID0gZmFsc2U7XG4gIGRpc3BsYXlEYXlzOiBBcnJheTxudW1iZXI+O1xuICBkaXNwbGF5RGVjYWRlOiBBcnJheTxudW1iZXI+O1xuICBkaXNwbGF5RmluYWxEZWNhZGU6IG51bWJlcjtcbiAgZGlzcGxheU1vbnRoOiBhbnk7XG4gIGRpc3BsYXlNb250aE51bWJlcjogbnVtYmVyO1xuICBkaXNwbGF5TW9udGhzOiBBcnJheTxhbnk+ID0gQXJyYXkoKTtcbiAgZGlzcGxheVN0YXJ0RGVjYWRlOiBudW1iZXI7XG4gIGRpc3BsYXlXZWVkRGF5czogQXJyYXk8YW55PiA9IEFycmF5KCk7XG4gIGRpc3BsYXlZZWFyOiBudW1iZXI7XG4gIG1vbnRoVmlzaWJsZTogYm9vbGVhbiA9IGZhbHNlO1xuICBvdmVybGF5SW52aXNpYmxlOiBib29sZWFuID0gdHJ1ZTtcbiAgdmlzaWJsZTogYm9vbGVhbiA9IGZhbHNlO1xuICB5ZWFyVmlzaWJsZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIHByaXZhdGUgY3VycmVudE1vbnRoTnVtYmVyOiBudW1iZXI7XG4gIHByaXZhdGUgaXNNb2JpbGU6IGFueSA9IGlzTW9iaWxlO1xuICBwcml2YXRlIGxhc3REaXNwbGF5OiBzdHJpbmc7XG4gIHByaXZhdGUgdG9kYXk6IERhdGUgPSBuZXcgRGF0ZSgpO1xuXG4gIEBWaWV3Q2hpbGQoJ2RheXMnLCB7IHJlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogdHJ1ZSB9KSBlbERheXM6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ21vbnRocycsIHsgcmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiB0cnVlIH0pIGVsTW9udGhzOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCd5ZWFycycsIHsgcmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiB0cnVlIH0pIGVsWWVhcnM6IEVsZW1lbnRSZWY7XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogRGF0YSBtw6F4aW1hIHBvc3PDrXZlbCBkZSBzZXIgc2VsZWNpb25hZGEgbm8gY2FsZW5kw6FyaW8uXG4gICAqL1xuICBASW5wdXQoJ3AtZGF0ZS1lbmQnKSBzZXQgZGF0ZUVuZCh2YWw6IERhdGUpIHtcbiAgICBpZiAodmFsICYmIHZhbCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIGNvbnN0IHllYXIgPSB2YWwuZ2V0RnVsbFllYXIoKTtcbiAgICAgIGNvbnN0IG1vbnRoID0gdmFsLmdldE1vbnRoKCk7XG4gICAgICBjb25zdCBkYXkgPSB2YWwuZ2V0RGF0ZSgpO1xuXG4gICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoeWVhciwgbW9udGgsIGRheSwgMjMsIDU5LCA1OSk7XG4gICAgICBzZXRZZWFyRnJvbTBUbzEwMChkYXRlLCB5ZWFyKTtcblxuICAgICAgdGhpcy5fZGF0ZUVuZCA9IGRhdGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2RhdGVFbmQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG4gIGdldCBkYXRlRW5kKCkge1xuICAgIHJldHVybiB0aGlzLl9kYXRlRW5kO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogSWRpb21hIGRvIGNhbGVuZMOhcmlvLlxuICAgKlxuICAgKiBWYWxvcmVzIHbDoWxpZG9zOlxuICAgKiAgLSBgcHRgXG4gICAqICAtIGBlbmBcbiAgICogIC0gYGVzYFxuICAgKi9cbiAgQElucHV0KCdwLWxvY2FsZScpIHNldCBsb2NhbGUobG9jYWxlOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9sb2NhbGUgPSBwb0NhbGVuZGFyTG9jYWxlcy5pbmNsdWRlcyhsb2NhbGUpID8gbG9jYWxlIDogcG9DYWxlbmRhckxvY2FsZURlZmF1bHQ7XG4gICAgdGhpcy5pbml0aWFsaXplTGFuZ3VhZ2UoKTtcbiAgfVxuICBnZXQgbG9jYWxlKCkge1xuICAgIHJldHVybiB0aGlzLl9sb2NhbGU7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBEYXRhIHNlbGVjaW9uYWRhIG5vIGNhbGVuZMOhcmlvLlxuICAgKi9cbiAgQElucHV0KCdwLXNlbGVjdGVkLWRhdGUnKSBzZXQgc2VsZWN0ZWREYXRlKHNlbGVjdGVkRGF0ZTogRGF0ZSkge1xuICAgIHRoaXMuX3NlbGVjdGVkRGF0ZSAgPSBzZWxlY3RlZERhdGUgJiYgc2VsZWN0ZWREYXRlIGluc3RhbmNlb2YgRGF0ZSA/IHNlbGVjdGVkRGF0ZSA6IHVuZGVmaW5lZDtcbiAgfVxuICBnZXQgc2VsZWN0ZWREYXRlKCk6IERhdGUge1xuICAgIHJldHVybiB0aGlzLl9zZWxlY3RlZERhdGU7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBEYXRhIG3DrW5pbWEgcG9zc8OtdmVsIGRlIHNlciBzZWxlY2lvbmFkYSBubyBjYWxlbmTDoXJpby5cbiAgICovXG4gIEBJbnB1dCgncC1kYXRlLXN0YXJ0Jykgc2V0IGRhdGVTdGFydCh2YWw6IERhdGUpIHtcbiAgICBpZiAodmFsICYmIHZhbCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIGNvbnN0IHllYXIgPSB2YWwuZ2V0RnVsbFllYXIoKTtcbiAgICAgIGNvbnN0IG1vbnRoID0gdmFsLmdldE1vbnRoKCk7XG4gICAgICBjb25zdCBkYXkgPSB2YWwuZ2V0RGF0ZSgpO1xuXG4gICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoeWVhciwgbW9udGgsIGRheSwgMCwgMCwgMCk7XG4gICAgICBzZXRZZWFyRnJvbTBUbzEwMChkYXRlLCB5ZWFyKTtcblxuICAgICAgdGhpcy5fZGF0ZVN0YXJ0ID0gZGF0ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fZGF0ZVN0YXJ0ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuICBnZXQgZGF0ZVN0YXJ0KCkge1xuICAgIHJldHVybiB0aGlzLl9kYXRlU3RhcnQ7XG4gIH1cblxuICBAT3V0cHV0KCdwLXNlbGVjdGVkLWRhdGVDaGFuZ2UnKSBzZWxlY3RlZERhdGVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPERhdGU+KCk7XG4gIEBPdXRwdXQoJ3Atc3VibWl0Jykgc3VibWl0ID0gbmV3IEV2ZW50RW1pdHRlcjxEYXRlPigpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcG9DYWxlbmRhclNlcnZpY2U6IFBvQ2FsZW5kYXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgcG9DYWxlbmRhckxhbmdTZXJ2aWNlOiBQb0NhbGVuZGFyTGFuZ1NlcnZpY2UpIHtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMub3ZlcmxheUludmlzaWJsZSA9IHRydWU7XG4gICAgdGhpcy52aXNpYmxlID0gZmFsc2U7XG4gIH1cblxuICAvLyBPYnTDqW0gdW0gYXJyYXkgZGUgdG9kb3Mgb3MgYW5vcyBkZXN0YSBkw6ljYWRhXG4gIGdldEFycmF5RGVjYWRlKHllYXIpIHtcbiAgICB0aGlzLmRpc3BsYXlEZWNhZGUgPSBBcnJheSgpO1xuXG4gICAgaWYgKHllYXIgJSAxMCAhPT0gMCkge1xuICAgICAgd2hpbGUgKHllYXIgJSAxMCAhPT0gMCkge1xuICAgICAgICB5ZWFyLS07XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMudXBkYXRlRGVjYWRlKHllYXIpO1xuICB9XG5cbiAgZ2V0QmFja2dyb3VuZENvbG9yKGRpc3BsYXlWYWx1ZTogbnVtYmVyLCBwcm9wZXJ0eVZhbHVlOiBudW1iZXIpIHtcbiAgICByZXR1cm4gKGRpc3BsYXlWYWx1ZSA9PT0gcHJvcGVydHlWYWx1ZSkgPyAncG8tY2FsZW5kYXItYm94LWJhY2tncm91bmQtc2VsZWN0ZWQnIDogJ3BvLWNhbGVuZGFyLWJveC1iYWNrZ3JvdW5kJztcbiAgfVxuXG4gIGdldERheUJhY2tncm91bmRDb2xvcihkYXRlOiBEYXRlKSB7XG4gICAgaWYgKHRoaXMuZXF1YWxzRGF0ZShkYXRlLCB0aGlzLnNlbGVjdGVkRGF0ZSkpIHtcbiAgICAgIHJldHVybiAncG8tY2FsZW5kYXItYm94LWJhY2tncm91bmQtc2VsZWN0ZWQnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5lcXVhbHNEYXRlKGRhdGUsIHRoaXMudG9kYXkpKSB7XG4gICAgICByZXR1cm4gJ3BvLWNhbGVuZGFyLWJveC1iYWNrZ3JvdW5kLXRvZGF5JztcbiAgICB9IGVsc2UgaWYgKGRhdGUpIHtcbiAgICAgIGlmICh2YWxpZGF0ZURhdGVSYW5nZShkYXRlLCB0aGlzLmRhdGVTdGFydCwgdGhpcy5kYXRlRW5kKSkge1xuICAgICAgICByZXR1cm4gJ3BvLWNhbGVuZGFyLWJveC1iYWNrZ3JvdW5kJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAncG8tY2FsZW5kYXItYm94LWJhY2tncm91bmQtZGlzYWJsZWQnO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICB9XG5cbiAgZ2V0RGF5Rm9yZWdyb3VuZENvbG9yKGRhdGU6IERhdGUpIHtcbiAgICBpZiAodGhpcy5lcXVhbHNEYXRlKGRhdGUsIHRoaXMuc2VsZWN0ZWREYXRlKSkge1xuICAgICAgcmV0dXJuICdwby1jYWxlbmRhci1ib3gtZm9yZWdyb3VuZC1zZWxlY3RlZCc7XG4gICAgfSBlbHNlIGlmICh0aGlzLmVxdWFsc0RhdGUoZGF0ZSwgdGhpcy50b2RheSkpIHtcbiAgICAgIHJldHVybiAncG8tY2FsZW5kYXItYm94LWZvcmVncm91bmQtdG9kYXknO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodmFsaWRhdGVEYXRlUmFuZ2UoZGF0ZSwgdGhpcy5kYXRlU3RhcnQsIHRoaXMuZGF0ZUVuZCkpIHtcbiAgICAgICAgcmV0dXJuICdwby1jYWxlbmRhci1ib3gtZm9yZWdyb3VuZCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJ3BvLWNhbGVuZGFyLWJveC1mb3JlZ3JvdW5kLWRpc2FibGVkJztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBnZXRGb3JlZ3JvdW5kQ29sb3IoZGlzcGxheVZhbHVlOiBudW1iZXIsIHByb3BlcnR5VmFsdWU6IG51bWJlcikge1xuICAgIHJldHVybiAoZGlzcGxheVZhbHVlID09PSBwcm9wZXJ0eVZhbHVlKSA/ICdwby1jYWxlbmRhci1ib3gtZm9yZWdyb3VuZC1zZWxlY3RlZCcgOiAncG8tY2FsZW5kYXItYm94LWZvcmVncm91bmQnO1xuICB9XG5cbiAgZ2V0V29yZE1vbnRoKCkge1xuICAgIHJldHVybiB0aGlzLnBvQ2FsZW5kYXJMYW5nU2VydmljZS5nZXRXb3JkTW9udGgoKTtcbiAgfVxuXG4gIGdldFdvcmRZZWFyKCkge1xuICAgIHJldHVybiB0aGlzLnBvQ2FsZW5kYXJMYW5nU2VydmljZS5nZXRXb3JkWWVhcigpO1xuICB9XG5cbiAgaW5pdCgpIHtcbiAgICB0aGlzLnNlbGVjdGVkRGF0ZSA/IHRoaXMudXBkYXRlRGF0ZSh0aGlzLnNlbGVjdGVkRGF0ZSkgOiB0aGlzLnVwZGF0ZURhdGUodGhpcy50b2RheSk7XG5cbiAgICB0aGlzLmluaXRpYWxpemVMYW5ndWFnZSgpO1xuXG4gICAgdGhpcy5zZWxlY3REYXkoKTtcblxuICAgIGlmICh0aGlzLmlzTW9iaWxlKCkpIHtcbiAgICAgIHRoaXMub3ZlcmxheUludmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHRoaXMudmlzaWJsZSA9IHRydWU7XG4gIH1cblxuICBpbml0aWFsaXplTGFuZ3VhZ2UoKSB7XG4gICAgdGhpcy5wb0NhbGVuZGFyTGFuZ1NlcnZpY2Uuc2V0TGFuZ3VhZ2UodGhpcy5sb2NhbGUpO1xuICAgIHRoaXMuZGlzcGxheVdlZWREYXlzID0gdGhpcy5wb0NhbGVuZGFyTGFuZ1NlcnZpY2UuZ2V0QXJyYXlXZWVrRGF5cygpO1xuICAgIHRoaXMuZGlzcGxheU1vbnRocyA9IHRoaXMucG9DYWxlbmRhckxhbmdTZXJ2aWNlLmdldEFycmF5TW9udGhzKCk7XG4gIH1cblxuICBvbk5leHRNb250aCgpIHtcbiAgICBpZiAodGhpcy5kaXNwbGF5TW9udGhOdW1iZXIgPCAxMSkge1xuICAgICAgdGhpcy51cGRhdGVEaXNwbGF5KHRoaXMuZGlzcGxheVllYXIsIHRoaXMuZGlzcGxheU1vbnRoTnVtYmVyICsgMSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyICsgMSwgMCk7XG4gICAgfVxuICB9XG5cbiAgb25QcmV2TW9udGgoKSB7XG4gICAgaWYgKHRoaXMuZGlzcGxheU1vbnRoTnVtYmVyID4gMCkge1xuICAgICAgdGhpcy51cGRhdGVEaXNwbGF5KHRoaXMuZGlzcGxheVllYXIsIHRoaXMuZGlzcGxheU1vbnRoTnVtYmVyIC0gMSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyIC0gMSwgMTEpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEFvIHNlbGVjaW9uYXIgdW1hIGRhdGFcbiAgb25TZWxlY3REYXRlKGRhdGU6IERhdGUpIHtcbiAgICBpZiAodmFsaWRhdGVEYXRlUmFuZ2UoZGF0ZSwgdGhpcy5kYXRlU3RhcnQsIHRoaXMuZGF0ZUVuZCkpIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWREYXRlID0gZGF0ZTtcbiAgICAgIHRoaXMuc2VsZWN0ZWREYXRlQ2hhbmdlLmVtaXQoZGF0ZSk7XG4gICAgICB0aGlzLnN1Ym1pdC5lbWl0KGRhdGUpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEFvIHNlbGVjaW9uYXIgdW0gbcOqc1xuICBvblNlbGVjdE1vbnRoKHllYXI6IG51bWJlciwgbW9udGg6IG51bWJlcikge1xuICAgIHRoaXMuc2VsZWN0RGF5KCk7XG4gICAgdGhpcy51cGRhdGVEaXNwbGF5KHllYXIsIG1vbnRoKTtcbiAgfVxuXG4gIC8vIEFvIHNlbGVjaW9uYXIgdW0gYW5vXG4gIG9uU2VsZWN0WWVhcih5ZWFyOiBudW1iZXIsIG1vbnRoOiBudW1iZXIpIHtcbiAgICAvLyBTZSB2ZWlvIGRhIHRlbGEgZGUgc2VsZcOnw6NvIGRlIG3DqnNcbiAgICB0aGlzLmxhc3REaXNwbGF5ID09PSAnbW9udGgnID8gdGhpcy5zZWxlY3RNb250aCgpIDogdGhpcy5zZWxlY3REYXkoKTtcblxuICAgIHRoaXMuY3VycmVudFllYXIgPSB5ZWFyO1xuICAgIHRoaXMudXBkYXRlRGlzcGxheSh5ZWFyLCBtb250aCk7XG4gIH1cblxuICBzZWxlY3REYXkoKSB7XG4gICAgdGhpcy5kYXlWaXNpYmxlID0gdHJ1ZTtcbiAgICB0aGlzLm1vbnRoVmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMueWVhclZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLmxhc3REaXNwbGF5ID0gJ2RheSc7XG4gIH1cblxuICBzZWxlY3RNb250aCgpIHtcbiAgICB0aGlzLmRheVZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm1vbnRoVmlzaWJsZSA9IHRydWU7XG4gICAgdGhpcy55ZWFyVmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMubGFzdERpc3BsYXkgPSAnbW9udGgnO1xuICB9XG5cbiAgc2VsZWN0WWVhcigpIHtcbiAgICB0aGlzLmRheVZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm1vbnRoVmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMueWVhclZpc2libGUgPSB0cnVlO1xuICB9XG5cbiAgc2V0TW9iaWxlVmlzdWFsaXphdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5pc01vYmlsZSgpID8gJ3BvLWNhbGVuZGFyIHBvLWNhbGVuZGFyLW1vYmlsZScgOiAncG8tY2FsZW5kYXInO1xuICB9XG5cbiAgdXBkYXRlWWVhcih2YWx1ZTogbnVtYmVyKSB7XG4gICAgdGhpcy51cGRhdGVEaXNwbGF5KHRoaXMuZGlzcGxheVllYXIgKyB2YWx1ZSwgdGhpcy5kaXNwbGF5TW9udGhOdW1iZXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRBbGxZZWFyc0luRGVjYWRlKHllYXI6IG51bWJlcikge1xuICAgIGxldCBpO1xuICAgIGZvciAoaSA9IHllYXI7IGkgPCB5ZWFyICsgMTA7IGkrKykge1xuICAgICAgdGhpcy5kaXNwbGF5RGVjYWRlLnB1c2goaSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBlcXVhbHNEYXRlKGRhdGUxOiBEYXRlLCBkYXRlMjogRGF0ZSk6IGJvb2xlYW4ge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gZGF0ZTEuZ2V0RnVsbFllYXIoKSA9PT0gZGF0ZTIuZ2V0RnVsbFllYXIoKSAmJlxuICAgICAgICBkYXRlMS5nZXRNb250aCgpID09PSBkYXRlMi5nZXRNb250aCgpICYmXG4gICAgICAgIGRhdGUxLmdldERhdGUoKSA9PT0gZGF0ZTIuZ2V0RGF0ZSgpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVEYXRlKGRhdGU6IERhdGUpIHtcbiAgICB0aGlzLmN1cnJlbnRNb250aE51bWJlciA9IGRhdGUuZ2V0TW9udGgoKTtcbiAgICB0aGlzLmN1cnJlbnRZZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xuICAgIHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmN1cnJlbnRZZWFyLCB0aGlzLmN1cnJlbnRNb250aE51bWJlcik7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZURlY2FkZSh5ZWFyOiBudW1iZXIpIHtcbiAgICB0aGlzLmFkZEFsbFllYXJzSW5EZWNhZGUoeWVhcik7XG4gICAgdGhpcy5kaXNwbGF5U3RhcnREZWNhZGUgPSB5ZWFyO1xuICAgIHRoaXMuZGlzcGxheUZpbmFsRGVjYWRlID0geWVhciArIDk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZURpc3BsYXkoeWVhcjogbnVtYmVyLCBtb250aDogbnVtYmVyKSB7XG4gICAgY29uc3QgY2FsZW5kYXJBcnJheSA9IHRoaXMucG9DYWxlbmRhclNlcnZpY2UubW9udGhEYXlzKHllYXIsIG1vbnRoKTtcbiAgICB0aGlzLmRpc3BsYXlEYXlzID0gW10uY29uY2F0LmFwcGx5KFtdLCBjYWxlbmRhckFycmF5KTtcbiAgICB0aGlzLmRpc3BsYXlNb250aE51bWJlciA9IG1vbnRoO1xuICAgIHRoaXMuZGlzcGxheU1vbnRoID0gdGhpcy5kaXNwbGF5TW9udGhzW21vbnRoXTtcbiAgICB0aGlzLmRpc3BsYXlZZWFyID0geWVhcjtcbiAgICB0aGlzLmdldEFycmF5RGVjYWRlKHllYXIpO1xuICB9XG5cbn1cbiJdfQ==