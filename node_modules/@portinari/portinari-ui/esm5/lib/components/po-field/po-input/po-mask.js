/**
 * Para usar o po-mask é preciso instanciar esta classe passando a máscara como
 * primeiro parâmetro, e no segundo parâmetro, deve se informado true, caso queira
 * que o model seja formatado ou false para o que o model seja limpo.
 */
var PoMask = /** @class */ (function () {
    function PoMask(mask, formatModel) {
        this.mask = '';
        this.formatModel = false;
        // controle de posição
        this.initialPosition = 0;
        this.finalPosition = 0;
        this.pattern = '';
        this.mask = mask;
        this.formatModel = formatModel;
        this.pattern = this.getRegexFromMask(mask);
    }
    Object.defineProperty(PoMask.prototype, "getPattern", {
        get: function () {
            return this.pattern;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMask.prototype, "getValueToInput", {
        get: function () {
            return this.valueToInput;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMask.prototype, "setValueToInput", {
        set: function (value) {
            this.valueToInput = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMask.prototype, "getValueToModel", {
        get: function () {
            return this.valueToModel;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMask.prototype, "setValueToModel", {
        set: function (value) {
            this.valueToModel = value;
        },
        enumerable: true,
        configurable: true
    });
    PoMask.prototype.keyup = function ($event) {
        if (this.mask) {
            var value = $event.target.value;
            // formata o valor quando for colado com control + v e reposiciona o cursor
            if ($event.keyCode === 17 || $event.keyCode === 91) {
                $event.target.value = this.controlFormatting(value);
                this.resetPositions($event);
            }
            $event.preventDefault();
            switch ($event.keyCode) {
                case 37: // seta esquerda
                    if (this.initialPosition > 0) {
                        this.initialPosition--;
                    }
                    this.setPositionNotShiftKey($event);
                    this.setSelectionRange($event);
                    break;
                case 39: // seta direita
                    if (this.initialPosition < value.toString().length) {
                        this.initialPosition++;
                    }
                    this.setPositionNotShiftKey($event);
                    this.setSelectionRange($event);
                    break;
                case 35: // end
                    this.finalPosition = value.toString().length;
                    if ($event.shiftKey) {
                        this.setPositions($event);
                    }
                    else {
                        this.initialPosition = this.finalPosition;
                        this.setPositions($event);
                    }
                    break;
                case 36: // HOME
                    if ($event.shiftKey) {
                        this.finalPosition = this.initialPosition;
                        this.initialPosition = 0;
                        this.setPositions($event);
                    }
                    else {
                        this.initialPosition = 0;
                        this.finalPosition = 0;
                        this.setPositions($event);
                    }
                    break;
            }
        }
    };
    PoMask.prototype.setPositionNotShiftKey = function ($event) {
        if (!$event.shiftKey) {
            this.finalPosition = this.initialPosition;
        }
    };
    PoMask.prototype.setSelectionRange = function ($event) {
        if (this.initialPosition > this.finalPosition) {
            $event.target.setSelectionRange(this.finalPosition, this.initialPosition);
        }
        else {
            $event.target.setSelectionRange(this.initialPosition, this.finalPosition);
        }
    };
    PoMask.prototype.keydown = function ($event) {
        if (this.mask) {
            var value = $event.target.value;
            if ($event.keyCode === 9) {
                return;
            }
            if (!$event.ctrlKey && !$event.metaKey) {
                $event.preventDefault();
            }
            // Não faz nada quando for digitado CTRL ou COMMAND e V
            // Já está sendo tratado no evento keyup
            if ($event.ctrlKey || $event.metaKey && ($event.keyCode !== 86) ||
                ($event.keyCode >= 37 && $event.keyCode <= 40) || $event.keyCode === 16 || $event.keyCode === 9) {
                return;
            }
            // Valida a tecla digitada
            if (this.isKeyValid($event.keyCode)) {
                if (this.finalPosition === null) {
                    this.finalPosition = this.initialPosition;
                }
                this.revertPositions(this.initialPosition, this.finalPosition);
                switch ($event.keyCode) {
                    case 8: // backspace
                        this.getPosition($event);
                        if (this.initialPosition < 0) {
                            this.initialPosition = 0;
                            this.setPositions($event);
                        }
                        if (this.initialPosition === this.finalPosition) {
                            this.checkMaskBefore($event, -1);
                            if (this.initialPosition !== 0) {
                                value = value.slice(0, this.initialPosition - 1) + value.slice(this.finalPosition);
                                value = this.controlFormatting(value);
                                $event.target.value = value;
                                this.changePosition($event, -1);
                                this.checkMaskBefore($event, -1);
                                this.setPositions($event);
                                this.resetPositions($event);
                            }
                        }
                        else {
                            this.clearRangeSelection(value, $event, true);
                        }
                        this.setPositions($event);
                        break;
                    case 46: // delete
                        this.getPosition($event);
                        if (this.initialPosition === this.finalPosition) {
                            this.checkMaskAfter($event, 1);
                            value = value.slice(0, this.initialPosition) + value.slice(this.finalPosition + 1);
                            value = this.controlFormatting(value);
                            $event.target.value = value;
                            this.setPositions($event);
                            this.resetPositions($event);
                        }
                        else {
                            this.clearRangeSelection(value, $event, false);
                        }
                        this.setPositions($event);
                        break;
                    default: // qualquer outra tecla válida
                        value = value.slice(0, this.initialPosition) + $event.key + value.slice(this.finalPosition);
                        value = this.controlFormatting(value);
                        $event.target.value = value;
                        this.changePosition($event, 1);
                        this.checkMaskBefore($event, 1);
                        this.setPositions($event);
                        this.resetPositions($event);
                        this.setPositions($event);
                }
            }
        }
    };
    PoMask.prototype.clearRangeSelection = function (value, $event, isBackspace) {
        value = value.slice(0, this.initialPosition) + value.slice(this.finalPosition);
        value = this.controlFormatting(value);
        $event.target.value = value;
        if (isBackspace) {
            this.checkMaskBefore($event, -1);
        }
        this.setPositions($event);
        this.resetPositions($event);
    };
    // passa a posição do click para o controle de posição
    PoMask.prototype.click = function ($event) {
        this.initialPosition = $event.target.selectionStart;
        this.finalPosition = $event.target.selectionEnd;
    };
    PoMask.prototype.blur = function ($event) {
        // Se houver algum valor definido na máscara
        if (this.mask) {
            // pega o valor do campo, formata e passa para o model
            var value = $event.target.value;
            value = this.controlFormatting(value);
            $event.target.value = value;
        }
    };
    PoMask.prototype.revertPositions = function (initialPosition, finalPosition) {
        if (initialPosition > finalPosition) {
            // inverte o controle de posição caso o inicial esteja maior que o final
            var tempPosition = void 0;
            tempPosition = initialPosition;
            this.initialPosition = finalPosition;
            this.finalPosition = tempPosition;
        }
    };
    // reseta o controle de posição
    PoMask.prototype.resetPositions = function ($event) {
        this.initialPosition = $event.target.selectionStart;
        this.finalPosition = this.initialPosition;
    };
    // posiciona o cursor de acordo com o controle de posição
    PoMask.prototype.setPositions = function ($event) {
        $event.target.setSelectionRange(this.initialPosition, this.finalPosition);
    };
    // muda a posição do cursor e atualiza o controle de posição
    PoMask.prototype.changePosition = function ($event, value) {
        this.initialPosition = this.initialPosition + value;
        this.finalPosition = this.finalPosition + value;
        this.setPositions($event);
    };
    PoMask.prototype.getPosition = function ($event) {
        this.initialPosition = $event.target.selectionStart;
        this.finalPosition = $event.target.selectionEnd;
        this.setPositions($event);
    };
    // Método responsável por controlar a formatação e aplicar todas as máscara possíveis
    // quando houver valores opcionais (?)
    PoMask.prototype.controlFormatting = function (value) {
        // Se o valor for vazio, retorna vazio
        if (!value) {
            this.valueToInput = '';
            this.valueToModel = '';
            return '';
        }
        var valueProcessed;
        var maskTmp = this.mask;
        // Array que será usado para armazenar todas as máscaras possíveis para
        // quando houver um valor opcional (?)
        var arrMasks = [];
        var contMasks = 0;
        // Enquanto houver algum 9? na máscara
        while (this.hasOptionalNumber(maskTmp)) {
            arrMasks.push(maskTmp);
            maskTmp = this.replaceOptionalNumber(maskTmp);
        }
        arrMasks.push(maskTmp);
        // Inverte o array
        arrMasks.reverse();
        // Informa que a formatação ainda não chegou ao fim
        this.formattingEnds = false;
        while (!this.formattingEnds) {
            // Seta a formatação como terminada
            // Então o método formatValue irá setar como não terminado caso haja
            this.formattingEnds = true;
            // Se não existe mais nenhuma máscara possível, então encerra a formatação
            if (!arrMasks[contMasks]) {
                break;
            }
            // Chama a formatação passando a máscara e o valor
            valueProcessed = this.formatValue(value, arrMasks[contMasks]);
            contMasks++;
        }
        return valueProcessed;
    };
    // Função que formata a máscara com o valor passado
    PoMask.prototype.formatValue = function (value, mask) {
        // Remove as marcas de valor opciona (?)
        mask = mask.replace(/\?/g, '');
        // Substitui todos os caracteres que não são fixos da máscara por _
        var guide = mask.replace(this.listValidKeys(), '_');
        // Contador usado para percorrer o guide
        var contGuide = 0;
        // String final formatada
        var valueProcessed = '';
        // Remove do valor todos os caracteres fixos como ()/-+
        value = this.removeFormattingValue(value);
        // Percorre todo o valor e coloca a formatação de acordo com a máscara
        for (var i = 0; i < value.length; i++) {
            var charValue = value[i];
            // Se o guide acabou, seta a formatação como não terminada para que o método controlFormatting
            // tente formatar com outra possível máscara
            if (!guide[contGuide]) {
                this.formattingEnds = false;
                break;
            }
            // Percorre o Guide enquanto tem caracteres fixos
            while (this.isFixedCharacterGuide(guide[contGuide]) && guide[contGuide]) {
                valueProcessed += guide[contGuide];
                contGuide++;
            }
            // É um caracter válido de acordo com a máscara
            if (this.isKeyValidMask(charValue, mask[contGuide])) {
                valueProcessed += charValue;
                contGuide++;
            }
            else {
                // Se não é um caracter válido, deve interromper.
                break;
            }
        }
        if (this.formatModel) {
            this.valueToInput = valueProcessed;
            this.valueToModel = valueProcessed;
        }
        else {
            this.valueToInput = valueProcessed;
            this.valueToModel = this.removeFormattingValue(valueProcessed);
        }
        return valueProcessed;
    };
    // verifica se tem algum caracter de mascara antes do cursor
    PoMask.prototype.checkMaskBefore = function ($event, position) {
        if (this.isFixedCharacterGuide($event.target.value.toString().charAt(this.initialPosition - 1))) {
            this.changePosition($event, position);
            this.checkMaskBefore($event, position);
        }
    };
    // verifica se tem algum caracter de mascara depois do cursor
    PoMask.prototype.checkMaskAfter = function ($event, position) {
        if (this.isFixedCharacterGuide($event.target.value.toString().charAt(this.initialPosition))) {
            this.changePosition($event, position);
            this.checkMaskAfter($event, position);
        }
    };
    // Retorna a máscara sem um valor opcional
    PoMask.prototype.replaceOptionalNumber = function (mask) {
        var i = 9;
        while (i >= 0) {
            if (mask.indexOf(i + '?') > -1) {
                return mask.replace(i + '?', '');
            }
            i--;
        }
        return mask;
    };
    // Verifica se contém caracteres permitidos somente na máscara \/() +-
    PoMask.prototype.isFixedCharacterGuide = function (key) {
        return this.testRegex(key, this.getFixedCharacterGuide());
    };
    // Retorna caracteres permitidos somente na máscara \/() +-
    PoMask.prototype.getFixedCharacterGuide = function () {
        return /[\\\/() +-.\:]/g;
    };
    // Caracteres permitidos de serem digitados
    PoMask.prototype.listValidKeys = function () {
        return /[a-zA-Z0-9]/g;
    };
    // Se é um dígito válido
    PoMask.prototype.isKeyValid = function (keyCode) {
        return this.isKeyCodeValid(keyCode);
    };
    // Verifica se a tecla digitada é permitida
    // Permite apenas números, letras, backspace e del
    PoMask.prototype.isKeyCodeValid = function (keyCode) {
        return ((keyCode >= 48 && keyCode <= 57) ||
            (keyCode >= 65 && keyCode <= 90) ||
            (keyCode >= 96 && keyCode <= 105) ||
            (keyCode === 8) || keyCode === 9 ||
            (keyCode === 46));
    };
    // Se está de acordo com a máscara
    PoMask.prototype.isKeyValidMask = function (key, keyMask) {
        return this.testRegex(key, this.replaceMask(keyMask));
    };
    // Retorna se a chave foi aprovada pela expressão regular
    PoMask.prototype.testRegex = function (key, regex) {
        return regex.test(key);
    };
    // Remove a formatacão do valor
    // É possível ser melhorado para remover pontualmente os caracteres fixos de acordo com a máscara
    PoMask.prototype.removeFormattingValue = function (value) {
        return value.replace(this.getFixedCharacterGuide(), '');
    };
    // Verifica se contém valor opcional na máscara 0-9?
    PoMask.prototype.hasOptionalNumber = function (mask) {
        return mask.match(/\d\?/g);
    };
    // Retorna a expressão regular correspondente ao comando passado
    PoMask.prototype.replaceMask = function (char) {
        var regex = /./;
        switch (char) {
            case '0':
                regex = /[0]/;
                break;
            case '1':
                regex = /[0-1]/;
                break;
            case '2':
                regex = /[0-2]/;
                break;
            case '3':
                regex = /[0-3]/;
                break;
            case '4':
                regex = /[0-4]/;
                break;
            case '5':
                regex = /[0-5]/;
                break;
            case '6':
                regex = /[0-6]/;
                break;
            case '7':
                regex = /[0-7]/;
                break;
            case '8':
                regex = /[0-8]/;
                break;
            case '9':
                regex = /[0-9]/;
                break;
            case ' ':
                regex = /\s/;
                break;
            case '@':
                regex = /[a-zA-Z]/;
                break;
            case 'w':
                regex = /[a-zA-Z0-9]/;
                break;
        }
        return regex;
    };
    PoMask.prototype.getRegexFromMask = function (mask) {
        if (mask) {
            var pattern = void 0;
            if (this.formatModel) {
                pattern = mask.replace(/\\/g, '\\\\');
                pattern = pattern.replace(/\+/g, '\\+');
                pattern = pattern.replace(/\./g, '\\.');
                pattern = pattern.replace(/-/g, '-');
                pattern = pattern.replace(/\(/g, '\\(');
                pattern = pattern.replace(/\)/g, '\\)');
                pattern = pattern.replace(/\//g, '\\/');
                pattern = pattern.replace(/\s/g, '\\s');
                pattern = pattern.replace(/:/g, '\\:');
                pattern = pattern.replace(/\@(?!\s)/g, '\\w');
                pattern = pattern.replace(/\d/g, '\\w');
            }
            else {
                pattern = mask.replace(/\\/g, '');
                pattern = pattern.replace(/\+/g, '');
                pattern = pattern.replace(/\./g, '');
                pattern = pattern.replace(/-/g, '');
                pattern = pattern.replace(/\(/g, '');
                pattern = pattern.replace(/\)/g, '');
                pattern = pattern.replace(/\//g, '');
                pattern = pattern.replace(/\s/g, '');
                pattern = pattern.replace(/:/g, '');
                pattern = pattern.replace(/\@/g, '\\w');
                pattern = pattern.replace(/\d/g, '\\w');
            }
            return pattern;
        }
        else {
            return null;
        }
    };
    return PoMask;
}());
export { PoMask };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbWFzay5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tZmllbGQvcG8taW5wdXQvcG8tbWFzay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBQ0g7SUE4QkUsZ0JBQVksSUFBWSxFQUFFLFdBQW9CO1FBN0I5QyxTQUFJLEdBQVcsRUFBRSxDQUFDO1FBQ2xCLGdCQUFXLEdBQVksS0FBSyxDQUFDO1FBQzdCLHNCQUFzQjtRQUN0QixvQkFBZSxHQUFXLENBQUMsQ0FBQztRQUM1QixrQkFBYSxHQUFXLENBQUMsQ0FBQztRQUUxQixZQUFPLEdBQVcsRUFBRSxDQUFDO1FBd0JuQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUMvQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBMUJELHNCQUFJLDhCQUFVO2FBQWQ7WUFDRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDdEIsQ0FBQzs7O09BQUE7SUFHRCxzQkFBSSxtQ0FBZTthQUFuQjtZQUNFLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQztRQUMzQixDQUFDOzs7T0FBQTtJQUNELHNCQUFJLG1DQUFlO2FBQW5CLFVBQW9CLEtBQWE7WUFDL0IsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7UUFDNUIsQ0FBQzs7O09BQUE7SUFHRCxzQkFBSSxtQ0FBZTthQUFuQjtZQUNFLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQztRQUMzQixDQUFDOzs7T0FBQTtJQUNELHNCQUFJLG1DQUFlO2FBQW5CLFVBQW9CLEtBQWE7WUFDL0IsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7UUFDNUIsQ0FBQzs7O09BQUE7SUFVRCxzQkFBSyxH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QUFPLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dCQUNyQyxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQ3JDLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDckMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dCQUNwQyxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7Z0JBQ3hDLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQzthQUN6QztZQUNELE9BQU8sT0FBTyxDQUFDO1NBQ2hCO2FBQU07WUFDTCxPQUFPLElBQUksQ0FBQztTQUNiO0lBQ0gsQ0FBQztJQUVILGFBQUM7QUFBRCxDQUFDLEFBL2VELElBK2VDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQYXJhIHVzYXIgbyBwby1tYXNrIMOpIHByZWNpc28gaW5zdGFuY2lhciBlc3RhIGNsYXNzZSBwYXNzYW5kbyBhIG3DoXNjYXJhIGNvbW9cbiAqIHByaW1laXJvIHBhcsOibWV0cm8sIGUgbm8gc2VndW5kbyBwYXLDom1ldHJvLCBkZXZlIHNlIGluZm9ybWFkbyB0cnVlLCBjYXNvIHF1ZWlyYVxuICogcXVlIG8gbW9kZWwgc2VqYSBmb3JtYXRhZG8gb3UgZmFsc2UgcGFyYSBvIHF1ZSBvIG1vZGVsIHNlamEgbGltcG8uXG4gKi9cbmV4cG9ydCBjbGFzcyBQb01hc2sge1xuICBtYXNrOiBzdHJpbmcgPSAnJztcbiAgZm9ybWF0TW9kZWw6IGJvb2xlYW4gPSBmYWxzZTtcbiAgLy8gY29udHJvbGUgZGUgcG9zacOnw6NvXG4gIGluaXRpYWxQb3NpdGlvbjogbnVtYmVyID0gMDtcbiAgZmluYWxQb3NpdGlvbjogbnVtYmVyID0gMDtcblxuICBwYXR0ZXJuOiBzdHJpbmcgPSAnJztcbiAgZ2V0IGdldFBhdHRlcm4oKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5wYXR0ZXJuO1xuICB9XG5cbiAgdmFsdWVUb0lucHV0OiBzdHJpbmc7XG4gIGdldCBnZXRWYWx1ZVRvSW5wdXQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZVRvSW5wdXQ7XG4gIH1cbiAgc2V0IHNldFZhbHVlVG9JbnB1dCh2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy52YWx1ZVRvSW5wdXQgPSB2YWx1ZTtcbiAgfVxuXG4gIHZhbHVlVG9Nb2RlbDogc3RyaW5nO1xuICBnZXQgZ2V0VmFsdWVUb01vZGVsKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWVUb01vZGVsO1xuICB9XG4gIHNldCBzZXRWYWx1ZVRvTW9kZWwodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMudmFsdWVUb01vZGVsID0gdmFsdWU7XG4gIH1cblxuICBmb3JtYXR0aW5nRW5kczogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3RvcihtYXNrOiBzdHJpbmcsIGZvcm1hdE1vZGVsOiBib29sZWFuKSB7XG4gICAgdGhpcy5tYXNrID0gbWFzaztcbiAgICB0aGlzLmZvcm1hdE1vZGVsID0gZm9ybWF0TW9kZWw7XG4gICAgdGhpcy5wYXR0ZXJuID0gdGhpcy5nZXRSZWdleEZyb21NYXNrKG1hc2spO1xuICB9XG5cbiAga2V5dXAoJGV2ZW50OiBhbnkpIHtcbiAgICBpZiAodGhpcy5tYXNrKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9ICRldmVudC50YXJnZXQudmFsdWU7XG4gICAgICAvLyBmb3JtYXRhIG8gdmFsb3IgcXVhbmRvIGZvciBjb2xhZG8gY29tIGNvbnRyb2wgKyB2IGUgcmVwb3NpY2lvbmEgbyBjdXJzb3JcbiAgICAgIGlmICgkZXZlbnQua2V5Q29kZSA9PT0gMTcgfHwgJGV2ZW50LmtleUNvZGUgPT09IDkxKSB7XG4gICAgICAgICRldmVudC50YXJnZXQudmFsdWUgPSB0aGlzLmNvbnRyb2xGb3JtYXR0aW5nKHZhbHVlKTtcbiAgICAgICAgdGhpcy5yZXNldFBvc2l0aW9ucygkZXZlbnQpO1xuICAgICAgfVxuXG4gICAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgc3dpdGNoICgkZXZlbnQua2V5Q29kZSkge1xuICAgICAgICBjYXNlIDM3OiAvLyBzZXRhIGVzcXVlcmRhXG4gICAgICAgICAgaWYgKHRoaXMuaW5pdGlhbFBvc2l0aW9uID4gMCkge1xuICAgICAgICAgICAgdGhpcy5pbml0aWFsUG9zaXRpb24tLTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5zZXRQb3NpdGlvbk5vdFNoaWZ0S2V5KCRldmVudCk7XG4gICAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb25SYW5nZSgkZXZlbnQpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgMzk6IC8vIHNldGEgZGlyZWl0YVxuICAgICAgICAgIGlmICh0aGlzLmluaXRpYWxQb3NpdGlvbiA8IHZhbHVlLnRvU3RyaW5nKCkubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLmluaXRpYWxQb3NpdGlvbisrO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uTm90U2hpZnRLZXkoJGV2ZW50KTtcbiAgICAgICAgICB0aGlzLnNldFNlbGVjdGlvblJhbmdlKCRldmVudCk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAzNTogLy8gZW5kXG4gICAgICAgICAgdGhpcy5maW5hbFBvc2l0aW9uID0gdmFsdWUudG9TdHJpbmcoKS5sZW5ndGg7XG4gICAgICAgICAgaWYgKCRldmVudC5zaGlmdEtleSkge1xuICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvbnMoJGV2ZW50KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbml0aWFsUG9zaXRpb24gPSB0aGlzLmZpbmFsUG9zaXRpb247XG4gICAgICAgICAgICB0aGlzLnNldFBvc2l0aW9ucygkZXZlbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlIDM2OiAvLyBIT01FXG4gICAgICAgICAgaWYgKCRldmVudC5zaGlmdEtleSkge1xuICAgICAgICAgICAgdGhpcy5maW5hbFBvc2l0aW9uID0gdGhpcy5pbml0aWFsUG9zaXRpb247XG4gICAgICAgICAgICB0aGlzLmluaXRpYWxQb3NpdGlvbiA9IDA7XG4gICAgICAgICAgICB0aGlzLnNldFBvc2l0aW9ucygkZXZlbnQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmluaXRpYWxQb3NpdGlvbiA9IDA7XG4gICAgICAgICAgICB0aGlzLmZpbmFsUG9zaXRpb24gPSAwO1xuICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvbnMoJGV2ZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2V0UG9zaXRpb25Ob3RTaGlmdEtleSgkZXZlbnQ6IGFueSkge1xuICAgIGlmICghJGV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICB0aGlzLmZpbmFsUG9zaXRpb24gPSB0aGlzLmluaXRpYWxQb3NpdGlvbjtcbiAgICB9XG4gIH1cblxuICBzZXRTZWxlY3Rpb25SYW5nZSgkZXZlbnQ6IGFueSkge1xuICAgIGlmICh0aGlzLmluaXRpYWxQb3NpdGlvbiA+IHRoaXMuZmluYWxQb3NpdGlvbikge1xuICAgICAgJGV2ZW50LnRhcmdldC5zZXRTZWxlY3Rpb25SYW5nZSh0aGlzLmZpbmFsUG9zaXRpb24sIHRoaXMuaW5pdGlhbFBvc2l0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGV2ZW50LnRhcmdldC5zZXRTZWxlY3Rpb25SYW5nZSh0aGlzLmluaXRpYWxQb3NpdGlvbiwgdGhpcy5maW5hbFBvc2l0aW9uKTtcbiAgICB9XG4gIH1cblxuICBrZXlkb3duKCRldmVudDogYW55KSB7XG4gICAgaWYgKHRoaXMubWFzaykge1xuICAgICAgbGV0IHZhbHVlOiBzdHJpbmcgPSAkZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgICAgaWYgKCRldmVudC5rZXlDb2RlID09PSA5KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKCEkZXZlbnQuY3RybEtleSAmJiAhJGV2ZW50Lm1ldGFLZXkpIHtcbiAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG5cbiAgICAgIC8vIE7Do28gZmF6IG5hZGEgcXVhbmRvIGZvciBkaWdpdGFkbyBDVFJMIG91IENPTU1BTkQgZSBWXG4gICAgICAvLyBKw6EgZXN0w6Egc2VuZG8gdHJhdGFkbyBubyBldmVudG8ga2V5dXBcbiAgICAgIGlmICgkZXZlbnQuY3RybEtleSB8fCAkZXZlbnQubWV0YUtleSAmJiAoJGV2ZW50LmtleUNvZGUgIT09IDg2KSB8fFxuICAgICAgICAoJGV2ZW50LmtleUNvZGUgPj0gMzcgJiYgJGV2ZW50LmtleUNvZGUgPD0gNDApIHx8ICRldmVudC5rZXlDb2RlID09PSAxNiB8fCAkZXZlbnQua2V5Q29kZSA9PT0gOSApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGEgYSB0ZWNsYSBkaWdpdGFkYVxuICAgICAgaWYgKHRoaXMuaXNLZXlWYWxpZCgkZXZlbnQua2V5Q29kZSkpIHtcbiAgICAgICAgaWYgKHRoaXMuZmluYWxQb3NpdGlvbiA9PT0gbnVsbCkge1xuICAgICAgICAgIHRoaXMuZmluYWxQb3NpdGlvbiA9IHRoaXMuaW5pdGlhbFBvc2l0aW9uO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmV2ZXJ0UG9zaXRpb25zKHRoaXMuaW5pdGlhbFBvc2l0aW9uLCB0aGlzLmZpbmFsUG9zaXRpb24pO1xuXG4gICAgICAgIHN3aXRjaCAoJGV2ZW50LmtleUNvZGUpIHtcbiAgICAgICAgICBjYXNlIDg6IC8vIGJhY2tzcGFjZVxuICAgICAgICAgICAgdGhpcy5nZXRQb3NpdGlvbigkZXZlbnQpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaW5pdGlhbFBvc2l0aW9uIDwgMCkge1xuICAgICAgICAgICAgICB0aGlzLmluaXRpYWxQb3NpdGlvbiA9IDA7XG4gICAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb25zKCRldmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5pbml0aWFsUG9zaXRpb24gPT09IHRoaXMuZmluYWxQb3NpdGlvbikge1xuICAgICAgICAgICAgICB0aGlzLmNoZWNrTWFza0JlZm9yZSgkZXZlbnQsIC0xKTtcbiAgICAgICAgICAgICAgaWYgKHRoaXMuaW5pdGlhbFBvc2l0aW9uICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5zbGljZSgwLCB0aGlzLmluaXRpYWxQb3NpdGlvbiAtIDEpICsgdmFsdWUuc2xpY2UodGhpcy5maW5hbFBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMuY29udHJvbEZvcm1hdHRpbmcodmFsdWUpO1xuICAgICAgICAgICAgICAgICRldmVudC50YXJnZXQudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZVBvc2l0aW9uKCRldmVudCAsIC0xKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrTWFza0JlZm9yZSgkZXZlbnQsIC0xKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFBvc2l0aW9ucygkZXZlbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRQb3NpdGlvbnMoJGV2ZW50KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5jbGVhclJhbmdlU2VsZWN0aW9uKHZhbHVlLCAkZXZlbnQsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvbnMoJGV2ZW50KTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSA0NjogLy8gZGVsZXRlXG4gICAgICAgICAgICB0aGlzLmdldFBvc2l0aW9uKCRldmVudCk7XG4gICAgICAgICAgICBpZiAodGhpcy5pbml0aWFsUG9zaXRpb24gPT09IHRoaXMuZmluYWxQb3NpdGlvbikge1xuICAgICAgICAgICAgICB0aGlzLmNoZWNrTWFza0FmdGVyKCRldmVudCwgMSk7XG4gICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuc2xpY2UoMCwgdGhpcy5pbml0aWFsUG9zaXRpb24pICsgdmFsdWUuc2xpY2UodGhpcy5maW5hbFBvc2l0aW9uICsgMSk7XG4gICAgICAgICAgICAgIHZhbHVlID0gdGhpcy5jb250cm9sRm9ybWF0dGluZyh2YWx1ZSk7XG4gICAgICAgICAgICAgICRldmVudC50YXJnZXQudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvbnMoJGV2ZW50KTtcbiAgICAgICAgICAgICAgdGhpcy5yZXNldFBvc2l0aW9ucygkZXZlbnQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5jbGVhclJhbmdlU2VsZWN0aW9uKHZhbHVlLCAkZXZlbnQsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb25zKCRldmVudCk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGRlZmF1bHQ6IC8vIHF1YWxxdWVyIG91dHJhIHRlY2xhIHbDoWxpZGFcbiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuc2xpY2UoMCwgdGhpcy5pbml0aWFsUG9zaXRpb24pICsgJGV2ZW50LmtleSArIHZhbHVlLnNsaWNlKHRoaXMuZmluYWxQb3NpdGlvbik7XG4gICAgICAgICAgICB2YWx1ZSA9IHRoaXMuY29udHJvbEZvcm1hdHRpbmcodmFsdWUpO1xuICAgICAgICAgICAgJGV2ZW50LnRhcmdldC52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5jaGFuZ2VQb3NpdGlvbigkZXZlbnQsIDEpO1xuICAgICAgICAgICAgdGhpcy5jaGVja01hc2tCZWZvcmUoJGV2ZW50LCAxKTtcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb25zKCRldmVudCk7XG4gICAgICAgICAgICB0aGlzLnJlc2V0UG9zaXRpb25zKCRldmVudCk7XG4gICAgICAgICAgICB0aGlzLnNldFBvc2l0aW9ucygkZXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgY2xlYXJSYW5nZVNlbGVjdGlvbih2YWx1ZTogc3RyaW5nLCAkZXZlbnQ6IGFueSwgaXNCYWNrc3BhY2U6IGJvb2xlYW4pIHtcbiAgICB2YWx1ZSA9IHZhbHVlLnNsaWNlKDAsIHRoaXMuaW5pdGlhbFBvc2l0aW9uKSArIHZhbHVlLnNsaWNlKHRoaXMuZmluYWxQb3NpdGlvbik7XG4gICAgdmFsdWUgPSB0aGlzLmNvbnRyb2xGb3JtYXR0aW5nKHZhbHVlKTtcbiAgICAkZXZlbnQudGFyZ2V0LnZhbHVlID0gdmFsdWU7XG5cbiAgICBpZiAoaXNCYWNrc3BhY2UpIHtcbiAgICAgIHRoaXMuY2hlY2tNYXNrQmVmb3JlKCRldmVudCwgLTEpO1xuICAgIH1cblxuICAgIHRoaXMuc2V0UG9zaXRpb25zKCRldmVudCk7XG4gICAgdGhpcy5yZXNldFBvc2l0aW9ucygkZXZlbnQpO1xuICB9XG5cbiAgLy8gcGFzc2EgYSBwb3Npw6fDo28gZG8gY2xpY2sgcGFyYSBvIGNvbnRyb2xlIGRlIHBvc2nDp8Ojb1xuICBjbGljaygkZXZlbnQ6IGFueSkge1xuICAgIHRoaXMuaW5pdGlhbFBvc2l0aW9uID0gJGV2ZW50LnRhcmdldC5zZWxlY3Rpb25TdGFydDtcbiAgICB0aGlzLmZpbmFsUG9zaXRpb24gPSAkZXZlbnQudGFyZ2V0LnNlbGVjdGlvbkVuZDtcbiAgfVxuXG4gIGJsdXIoJGV2ZW50OiBhbnkpIHtcbiAgICAvLyBTZSBob3V2ZXIgYWxndW0gdmFsb3IgZGVmaW5pZG8gbmEgbcOhc2NhcmFcbiAgICBpZiAodGhpcy5tYXNrKSB7XG4gICAgICAvLyBwZWdhIG8gdmFsb3IgZG8gY2FtcG8sIGZvcm1hdGEgZSBwYXNzYSBwYXJhIG8gbW9kZWxcbiAgICAgIGxldCB2YWx1ZSA9ICRldmVudC50YXJnZXQudmFsdWU7XG4gICAgICB2YWx1ZSA9IHRoaXMuY29udHJvbEZvcm1hdHRpbmcodmFsdWUpO1xuICAgICAgJGV2ZW50LnRhcmdldC52YWx1ZSA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHJldmVydFBvc2l0aW9ucyhpbml0aWFsUG9zaXRpb246IG51bWJlciwgZmluYWxQb3NpdGlvbjogbnVtYmVyKSB7XG4gICAgaWYgKGluaXRpYWxQb3NpdGlvbiA+IGZpbmFsUG9zaXRpb24pIHtcbiAgICAgIC8vIGludmVydGUgbyBjb250cm9sZSBkZSBwb3Npw6fDo28gY2FzbyBvIGluaWNpYWwgZXN0ZWphIG1haW9yIHF1ZSBvIGZpbmFsXG4gICAgICBsZXQgdGVtcFBvc2l0aW9uO1xuICAgICAgdGVtcFBvc2l0aW9uID0gaW5pdGlhbFBvc2l0aW9uO1xuICAgICAgdGhpcy5pbml0aWFsUG9zaXRpb24gPSBmaW5hbFBvc2l0aW9uO1xuICAgICAgdGhpcy5maW5hbFBvc2l0aW9uID0gdGVtcFBvc2l0aW9uO1xuICAgIH1cbiAgfVxuXG4gIC8vIHJlc2V0YSBvIGNvbnRyb2xlIGRlIHBvc2nDp8Ojb1xuICByZXNldFBvc2l0aW9ucygkZXZlbnQ6IGFueSkge1xuICAgIHRoaXMuaW5pdGlhbFBvc2l0aW9uID0gJGV2ZW50LnRhcmdldC5zZWxlY3Rpb25TdGFydDtcbiAgICB0aGlzLmZpbmFsUG9zaXRpb24gPSB0aGlzLmluaXRpYWxQb3NpdGlvbjtcbiAgfVxuXG4gIC8vIHBvc2ljaW9uYSBvIGN1cnNvciBkZSBhY29yZG8gY29tIG8gY29udHJvbGUgZGUgcG9zacOnw6NvXG4gIHNldFBvc2l0aW9ucygkZXZlbnQ6IGFueSkge1xuICAgICRldmVudC50YXJnZXQuc2V0U2VsZWN0aW9uUmFuZ2UodGhpcy5pbml0aWFsUG9zaXRpb24sIHRoaXMuZmluYWxQb3NpdGlvbik7XG4gIH1cblxuICAvLyBtdWRhIGEgcG9zacOnw6NvIGRvIGN1cnNvciBlIGF0dWFsaXphIG8gY29udHJvbGUgZGUgcG9zacOnw6NvXG4gIGNoYW5nZVBvc2l0aW9uKCRldmVudDogYW55LCB2YWx1ZTogbnVtYmVyKSB7XG4gICAgdGhpcy5pbml0aWFsUG9zaXRpb24gPSB0aGlzLmluaXRpYWxQb3NpdGlvbiArIHZhbHVlO1xuICAgIHRoaXMuZmluYWxQb3NpdGlvbiA9IHRoaXMuZmluYWxQb3NpdGlvbiArIHZhbHVlO1xuICAgIHRoaXMuc2V0UG9zaXRpb25zKCRldmVudCk7XG4gIH1cblxuICBnZXRQb3NpdGlvbigkZXZlbnQ6IGFueSkge1xuICAgIHRoaXMuaW5pdGlhbFBvc2l0aW9uID0gJGV2ZW50LnRhcmdldC5zZWxlY3Rpb25TdGFydDtcbiAgICB0aGlzLmZpbmFsUG9zaXRpb24gPSAkZXZlbnQudGFyZ2V0LnNlbGVjdGlvbkVuZDtcbiAgICB0aGlzLnNldFBvc2l0aW9ucygkZXZlbnQpO1xuICB9XG5cbiAgLy8gTcOpdG9kbyByZXNwb25zw6F2ZWwgcG9yIGNvbnRyb2xhciBhIGZvcm1hdGHDp8OjbyBlIGFwbGljYXIgdG9kYXMgYXMgbcOhc2NhcmEgcG9zc8OtdmVpc1xuICAvLyBxdWFuZG8gaG91dmVyIHZhbG9yZXMgb3BjaW9uYWlzICg/KVxuICBjb250cm9sRm9ybWF0dGluZyh2YWx1ZTogc3RyaW5nKSB7XG4gICAgLy8gU2UgbyB2YWxvciBmb3IgdmF6aW8sIHJldG9ybmEgdmF6aW9cbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICB0aGlzLnZhbHVlVG9JbnB1dCA9ICcnO1xuICAgICAgdGhpcy52YWx1ZVRvTW9kZWwgPSAnJztcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG4gICAgbGV0IHZhbHVlUHJvY2Vzc2VkO1xuICAgIGxldCBtYXNrVG1wID0gdGhpcy5tYXNrO1xuXG4gICAgLy8gQXJyYXkgcXVlIHNlcsOhIHVzYWRvIHBhcmEgYXJtYXplbmFyIHRvZGFzIGFzIG3DoXNjYXJhcyBwb3Nzw612ZWlzIHBhcmFcbiAgICAvLyBxdWFuZG8gaG91dmVyIHVtIHZhbG9yIG9wY2lvbmFsICg/KVxuICAgIGNvbnN0IGFyck1hc2tzOiBBcnJheTxhbnk+ID0gW107XG4gICAgbGV0IGNvbnRNYXNrcyA9IDA7XG5cbiAgICAvLyBFbnF1YW50byBob3V2ZXIgYWxndW0gOT8gbmEgbcOhc2NhcmFcbiAgICB3aGlsZSAodGhpcy5oYXNPcHRpb25hbE51bWJlcihtYXNrVG1wKSkge1xuICAgICAgYXJyTWFza3MucHVzaChtYXNrVG1wKTtcbiAgICAgIG1hc2tUbXAgPSB0aGlzLnJlcGxhY2VPcHRpb25hbE51bWJlcihtYXNrVG1wKTtcbiAgICB9XG4gICAgYXJyTWFza3MucHVzaChtYXNrVG1wKTtcblxuICAgIC8vIEludmVydGUgbyBhcnJheVxuICAgIGFyck1hc2tzLnJldmVyc2UoKTtcblxuICAgIC8vIEluZm9ybWEgcXVlIGEgZm9ybWF0YcOnw6NvIGFpbmRhIG7Do28gY2hlZ291IGFvIGZpbVxuICAgIHRoaXMuZm9ybWF0dGluZ0VuZHMgPSBmYWxzZTtcblxuICAgIHdoaWxlICghdGhpcy5mb3JtYXR0aW5nRW5kcykge1xuICAgICAgLy8gU2V0YSBhIGZvcm1hdGHDp8OjbyBjb21vIHRlcm1pbmFkYVxuICAgICAgLy8gRW50w6NvIG8gbcOpdG9kbyBmb3JtYXRWYWx1ZSBpcsOhIHNldGFyIGNvbW8gbsOjbyB0ZXJtaW5hZG8gY2FzbyBoYWphXG4gICAgICB0aGlzLmZvcm1hdHRpbmdFbmRzID0gdHJ1ZTtcblxuICAgICAgLy8gU2UgbsOjbyBleGlzdGUgbWFpcyBuZW5odW1hIG3DoXNjYXJhIHBvc3PDrXZlbCwgZW50w6NvIGVuY2VycmEgYSBmb3JtYXRhw6fDo29cbiAgICAgIGlmICghYXJyTWFza3NbY29udE1hc2tzXSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgLy8gQ2hhbWEgYSBmb3JtYXRhw6fDo28gcGFzc2FuZG8gYSBtw6FzY2FyYSBlIG8gdmFsb3JcbiAgICAgIHZhbHVlUHJvY2Vzc2VkID0gdGhpcy5mb3JtYXRWYWx1ZSh2YWx1ZSwgYXJyTWFza3NbY29udE1hc2tzXSk7XG4gICAgICBjb250TWFza3MrKztcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWVQcm9jZXNzZWQ7XG4gIH1cblxuICAvLyBGdW7Dp8OjbyBxdWUgZm9ybWF0YSBhIG3DoXNjYXJhIGNvbSBvIHZhbG9yIHBhc3NhZG9cbiAgZm9ybWF0VmFsdWUodmFsdWU6IHN0cmluZywgbWFzazogc3RyaW5nKSB7XG5cbiAgICAvLyBSZW1vdmUgYXMgbWFyY2FzIGRlIHZhbG9yIG9wY2lvbmEgKD8pXG4gICAgbWFzayA9IG1hc2sucmVwbGFjZSgvXFw/L2csICcnKTtcblxuICAgIC8vIFN1YnN0aXR1aSB0b2RvcyBvcyBjYXJhY3RlcmVzIHF1ZSBuw6NvIHPDo28gZml4b3MgZGEgbcOhc2NhcmEgcG9yIF9cbiAgICBjb25zdCBndWlkZSA9IG1hc2sucmVwbGFjZSh0aGlzLmxpc3RWYWxpZEtleXMoKSwgJ18nKTtcblxuICAgIC8vIENvbnRhZG9yIHVzYWRvIHBhcmEgcGVyY29ycmVyIG8gZ3VpZGVcbiAgICBsZXQgY29udEd1aWRlOiBudW1iZXIgPSAwO1xuXG4gICAgLy8gU3RyaW5nIGZpbmFsIGZvcm1hdGFkYVxuICAgIGxldCB2YWx1ZVByb2Nlc3NlZDogc3RyaW5nID0gJyc7XG5cbiAgICAvLyBSZW1vdmUgZG8gdmFsb3IgdG9kb3Mgb3MgY2FyYWN0ZXJlcyBmaXhvcyBjb21vICgpLy0rXG4gICAgdmFsdWUgPSB0aGlzLnJlbW92ZUZvcm1hdHRpbmdWYWx1ZSh2YWx1ZSk7XG5cbiAgICAvLyBQZXJjb3JyZSB0b2RvIG8gdmFsb3IgZSBjb2xvY2EgYSBmb3JtYXRhw6fDo28gZGUgYWNvcmRvIGNvbSBhIG3DoXNjYXJhXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWx1ZS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgY2hhclZhbHVlID0gdmFsdWVbaV07XG5cbiAgICAgIC8vIFNlIG8gZ3VpZGUgYWNhYm91LCBzZXRhIGEgZm9ybWF0YcOnw6NvIGNvbW8gbsOjbyB0ZXJtaW5hZGEgcGFyYSBxdWUgbyBtw6l0b2RvIGNvbnRyb2xGb3JtYXR0aW5nXG4gICAgICAvLyB0ZW50ZSBmb3JtYXRhciBjb20gb3V0cmEgcG9zc8OtdmVsIG3DoXNjYXJhXG4gICAgICBpZiAoIWd1aWRlW2NvbnRHdWlkZV0pIHtcbiAgICAgICAgdGhpcy5mb3JtYXR0aW5nRW5kcyA9IGZhbHNlO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgLy8gUGVyY29ycmUgbyBHdWlkZSBlbnF1YW50byB0ZW0gY2FyYWN0ZXJlcyBmaXhvc1xuICAgICAgd2hpbGUgKHRoaXMuaXNGaXhlZENoYXJhY3Rlckd1aWRlKGd1aWRlW2NvbnRHdWlkZV0pICYmIGd1aWRlW2NvbnRHdWlkZV0pIHtcbiAgICAgICAgdmFsdWVQcm9jZXNzZWQgKz0gZ3VpZGVbY29udEd1aWRlXTtcbiAgICAgICAgY29udEd1aWRlKys7XG4gICAgICB9XG5cbiAgICAgIC8vIMOJIHVtIGNhcmFjdGVyIHbDoWxpZG8gZGUgYWNvcmRvIGNvbSBhIG3DoXNjYXJhXG4gICAgICBpZiAodGhpcy5pc0tleVZhbGlkTWFzayhjaGFyVmFsdWUsIG1hc2tbY29udEd1aWRlXSkpIHtcbiAgICAgICAgdmFsdWVQcm9jZXNzZWQgKz0gY2hhclZhbHVlO1xuICAgICAgICBjb250R3VpZGUrKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFNlIG7Do28gw6kgdW0gY2FyYWN0ZXIgdsOhbGlkbywgZGV2ZSBpbnRlcnJvbXBlci5cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZm9ybWF0TW9kZWwpIHtcbiAgICAgIHRoaXMudmFsdWVUb0lucHV0ID0gdmFsdWVQcm9jZXNzZWQ7XG4gICAgICB0aGlzLnZhbHVlVG9Nb2RlbCA9IHZhbHVlUHJvY2Vzc2VkO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnZhbHVlVG9JbnB1dCA9IHZhbHVlUHJvY2Vzc2VkO1xuICAgICAgdGhpcy52YWx1ZVRvTW9kZWwgPSB0aGlzLnJlbW92ZUZvcm1hdHRpbmdWYWx1ZSh2YWx1ZVByb2Nlc3NlZCk7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZVByb2Nlc3NlZDtcbiAgfVxuICAvLyB2ZXJpZmljYSBzZSB0ZW0gYWxndW0gY2FyYWN0ZXIgZGUgbWFzY2FyYSBhbnRlcyBkbyBjdXJzb3JcbiAgY2hlY2tNYXNrQmVmb3JlKCRldmVudDogYW55LCBwb3NpdGlvbjogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMuaXNGaXhlZENoYXJhY3Rlckd1aWRlKCRldmVudC50YXJnZXQudmFsdWUudG9TdHJpbmcoKS5jaGFyQXQodGhpcy5pbml0aWFsUG9zaXRpb24gLSAxKSkpIHtcbiAgICAgIHRoaXMuY2hhbmdlUG9zaXRpb24oJGV2ZW50LCBwb3NpdGlvbik7XG4gICAgICB0aGlzLmNoZWNrTWFza0JlZm9yZSgkZXZlbnQsIHBvc2l0aW9uKTtcbiAgICB9XG4gIH1cblxuICAvLyB2ZXJpZmljYSBzZSB0ZW0gYWxndW0gY2FyYWN0ZXIgZGUgbWFzY2FyYSBkZXBvaXMgZG8gY3Vyc29yXG4gIGNoZWNrTWFza0FmdGVyKCRldmVudDogYW55LCBwb3NpdGlvbjogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMuaXNGaXhlZENoYXJhY3Rlckd1aWRlKCRldmVudC50YXJnZXQudmFsdWUudG9TdHJpbmcoKS5jaGFyQXQodGhpcy5pbml0aWFsUG9zaXRpb24pKSkge1xuICAgICAgdGhpcy5jaGFuZ2VQb3NpdGlvbigkZXZlbnQsIHBvc2l0aW9uKTtcbiAgICAgIHRoaXMuY2hlY2tNYXNrQWZ0ZXIoJGV2ZW50LCBwb3NpdGlvbik7XG4gICAgfVxuICB9XG5cbiAgLy8gUmV0b3JuYSBhIG3DoXNjYXJhIHNlbSB1bSB2YWxvciBvcGNpb25hbFxuICByZXBsYWNlT3B0aW9uYWxOdW1iZXIobWFzazogc3RyaW5nKSB7XG4gICAgbGV0IGkgPSA5O1xuICAgIHdoaWxlIChpID49IDApIHtcbiAgICAgIGlmIChtYXNrLmluZGV4T2YoaSArICc/JykgPiAtMSkge1xuICAgICAgICByZXR1cm4gbWFzay5yZXBsYWNlKGkgKyAnPycsICcnKTtcbiAgICAgIH1cbiAgICAgIGktLTtcbiAgICB9XG4gICAgcmV0dXJuIG1hc2s7XG4gIH1cblxuICAvLyBWZXJpZmljYSBzZSBjb250w6ltIGNhcmFjdGVyZXMgcGVybWl0aWRvcyBzb21lbnRlIG5hIG3DoXNjYXJhIFxcLygpICstXG4gIGlzRml4ZWRDaGFyYWN0ZXJHdWlkZShrZXk6IGFueSkge1xuICAgIHJldHVybiB0aGlzLnRlc3RSZWdleChrZXksIHRoaXMuZ2V0Rml4ZWRDaGFyYWN0ZXJHdWlkZSgpKTtcbiAgfVxuXG4gIC8vIFJldG9ybmEgY2FyYWN0ZXJlcyBwZXJtaXRpZG9zIHNvbWVudGUgbmEgbcOhc2NhcmEgXFwvKCkgKy1cbiAgZ2V0Rml4ZWRDaGFyYWN0ZXJHdWlkZSgpIHtcbiAgICByZXR1cm4gL1tcXFxcXFwvKCkgKy0uXFw6XS9nO1xuICB9XG5cbiAgLy8gQ2FyYWN0ZXJlcyBwZXJtaXRpZG9zIGRlIHNlcmVtIGRpZ2l0YWRvc1xuICBsaXN0VmFsaWRLZXlzKCkge1xuICAgIHJldHVybiAvW2EtekEtWjAtOV0vZztcbiAgfVxuXG4gIC8vIFNlIMOpIHVtIGTDrWdpdG8gdsOhbGlkb1xuICBpc0tleVZhbGlkKGtleUNvZGU6IGFueSkge1xuICAgIHJldHVybiB0aGlzLmlzS2V5Q29kZVZhbGlkKGtleUNvZGUpO1xuICB9XG5cbiAgLy8gVmVyaWZpY2Egc2UgYSB0ZWNsYSBkaWdpdGFkYSDDqSBwZXJtaXRpZGFcbiAgLy8gUGVybWl0ZSBhcGVuYXMgbsO6bWVyb3MsIGxldHJhcywgYmFja3NwYWNlIGUgZGVsXG4gIGlzS2V5Q29kZVZhbGlkKGtleUNvZGU6IG51bWJlcikge1xuICAgIHJldHVybiAoXG4gICAgICAoa2V5Q29kZSA+PSA0OCAmJiBrZXlDb2RlIDw9IDU3KSB8fFxuICAgICAgKGtleUNvZGUgPj0gNjUgJiYga2V5Q29kZSA8PSA5MCkgfHxcbiAgICAgIChrZXlDb2RlID49IDk2ICYmIGtleUNvZGUgPD0gMTA1KSB8fFxuICAgICAgKGtleUNvZGUgPT09IDgpIHx8IGtleUNvZGUgPT09IDkgfHxcbiAgICAgIChrZXlDb2RlID09PSA0NilcbiAgICApO1xuICB9XG5cbiAgLy8gU2UgZXN0w6EgZGUgYWNvcmRvIGNvbSBhIG3DoXNjYXJhXG4gIGlzS2V5VmFsaWRNYXNrKGtleTogYW55LCBrZXlNYXNrOiBhbnkpIHtcbiAgICByZXR1cm4gdGhpcy50ZXN0UmVnZXgoa2V5LCB0aGlzLnJlcGxhY2VNYXNrKGtleU1hc2spKTtcbiAgfVxuXG4gIC8vIFJldG9ybmEgc2UgYSBjaGF2ZSBmb2kgYXByb3ZhZGEgcGVsYSBleHByZXNzw6NvIHJlZ3VsYXJcbiAgdGVzdFJlZ2V4KGtleTogYW55LCByZWdleDogYW55KSB7XG4gICAgcmV0dXJuIHJlZ2V4LnRlc3Qoa2V5KTtcbiAgfVxuXG4gIC8vIFJlbW92ZSBhIGZvcm1hdGFjw6NvIGRvIHZhbG9yXG4gIC8vIMOJIHBvc3PDrXZlbCBzZXIgbWVsaG9yYWRvIHBhcmEgcmVtb3ZlciBwb250dWFsbWVudGUgb3MgY2FyYWN0ZXJlcyBmaXhvcyBkZSBhY29yZG8gY29tIGEgbcOhc2NhcmFcbiAgcmVtb3ZlRm9ybWF0dGluZ1ZhbHVlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdmFsdWUucmVwbGFjZSh0aGlzLmdldEZpeGVkQ2hhcmFjdGVyR3VpZGUoKSwgJycpO1xuICB9XG5cbiAgLy8gVmVyaWZpY2Egc2UgY29udMOpbSB2YWxvciBvcGNpb25hbCBuYSBtw6FzY2FyYSAwLTk/XG4gIGhhc09wdGlvbmFsTnVtYmVyKG1hc2s6IHN0cmluZykge1xuICAgIHJldHVybiBtYXNrLm1hdGNoKC9cXGRcXD8vZyk7XG4gIH1cblxuICAvLyBSZXRvcm5hIGEgZXhwcmVzc8OjbyByZWd1bGFyIGNvcnJlc3BvbmRlbnRlIGFvIGNvbWFuZG8gcGFzc2Fkb1xuICByZXBsYWNlTWFzayhjaGFyOiBzdHJpbmcpIHtcbiAgICBsZXQgcmVnZXggPSAvLi87XG4gICAgc3dpdGNoIChjaGFyKSB7XG4gICAgICBjYXNlICcwJzogcmVnZXggPSAvWzBdLztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJzEnOiByZWdleCA9IC9bMC0xXS87XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICcyJzogcmVnZXggPSAvWzAtMl0vO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnMyc6IHJlZ2V4ID0gL1swLTNdLztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJzQnOiByZWdleCA9IC9bMC00XS87XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICc1JzogcmVnZXggPSAvWzAtNV0vO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnNic6IHJlZ2V4ID0gL1swLTZdLztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJzcnOiByZWdleCA9IC9bMC03XS87XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICc4JzogcmVnZXggPSAvWzAtOF0vO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnOSc6IHJlZ2V4ID0gL1swLTldLztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJyAnOiByZWdleCA9IC9cXHMvO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnQCc6IHJlZ2V4ID0gL1thLXpBLVpdLztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3cnOiByZWdleCA9IC9bYS16QS1aMC05XS87XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiByZWdleDtcbiAgfVxuXG4gIGdldFJlZ2V4RnJvbU1hc2sobWFzazogc3RyaW5nKSB7XG4gICAgaWYgKG1hc2spIHtcbiAgICAgIGxldCBwYXR0ZXJuO1xuICAgICAgaWYgKHRoaXMuZm9ybWF0TW9kZWwpIHtcbiAgICAgICAgcGF0dGVybiA9IG1hc2sucmVwbGFjZSgvXFxcXC9nLCAnXFxcXFxcXFwnKTtcbiAgICAgICAgcGF0dGVybiA9IHBhdHRlcm4ucmVwbGFjZSgvXFwrL2csICdcXFxcKycpO1xuICAgICAgICBwYXR0ZXJuID0gcGF0dGVybi5yZXBsYWNlKC9cXC4vZywgJ1xcXFwuJyk7XG4gICAgICAgIHBhdHRlcm4gPSBwYXR0ZXJuLnJlcGxhY2UoLy0vZywgJy0nKTtcbiAgICAgICAgcGF0dGVybiA9IHBhdHRlcm4ucmVwbGFjZSgvXFwoL2csICdcXFxcKCcpO1xuICAgICAgICBwYXR0ZXJuID0gcGF0dGVybi5yZXBsYWNlKC9cXCkvZywgJ1xcXFwpJyk7XG4gICAgICAgIHBhdHRlcm4gPSBwYXR0ZXJuLnJlcGxhY2UoL1xcLy9nLCAnXFxcXC8nKTtcbiAgICAgICAgcGF0dGVybiA9IHBhdHRlcm4ucmVwbGFjZSgvXFxzL2csICdcXFxccycpO1xuICAgICAgICBwYXR0ZXJuID0gcGF0dGVybi5yZXBsYWNlKC86L2csICdcXFxcOicpO1xuICAgICAgICBwYXR0ZXJuID0gcGF0dGVybi5yZXBsYWNlKC9cXEAoPyFcXHMpL2csICdcXFxcdycpO1xuICAgICAgICBwYXR0ZXJuID0gcGF0dGVybi5yZXBsYWNlKC9cXGQvZywgJ1xcXFx3Jyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYXR0ZXJuID0gbWFzay5yZXBsYWNlKC9cXFxcL2csICcnKTtcbiAgICAgICAgcGF0dGVybiA9IHBhdHRlcm4ucmVwbGFjZSgvXFwrL2csICcnKTtcbiAgICAgICAgcGF0dGVybiA9IHBhdHRlcm4ucmVwbGFjZSgvXFwuL2csICcnKTtcbiAgICAgICAgcGF0dGVybiA9IHBhdHRlcm4ucmVwbGFjZSgvLS9nLCAnJyk7XG4gICAgICAgIHBhdHRlcm4gPSBwYXR0ZXJuLnJlcGxhY2UoL1xcKC9nLCAnJyk7XG4gICAgICAgIHBhdHRlcm4gPSBwYXR0ZXJuLnJlcGxhY2UoL1xcKS9nLCAnJyk7XG4gICAgICAgIHBhdHRlcm4gPSBwYXR0ZXJuLnJlcGxhY2UoL1xcLy9nLCAnJyk7XG4gICAgICAgIHBhdHRlcm4gPSBwYXR0ZXJuLnJlcGxhY2UoL1xccy9nLCAnJyk7XG4gICAgICAgIHBhdHRlcm4gPSBwYXR0ZXJuLnJlcGxhY2UoLzovZywgJycpO1xuICAgICAgICBwYXR0ZXJuID0gcGF0dGVybi5yZXBsYWNlKC9cXEAvZywgJ1xcXFx3Jyk7XG4gICAgICAgIHBhdHRlcm4gPSBwYXR0ZXJuLnJlcGxhY2UoL1xcZC9nLCAnXFxcXHcnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwYXR0ZXJuO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxufVxuIl19