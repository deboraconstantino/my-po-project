import * as tslib_1 from "tslib";
import { EventEmitter, Input, Output } from '@angular/core';
import { convertToBoolean } from '../../../utils/util';
import { requiredFailed, maxlengpoailed, minlengpoailed, patternFailed } from './../validators';
import { InputBoolean } from '../../../decorators';
import { PoMask } from './po-mask';
/**
 * @description
 *
 * Este é um componente baseado em input, com várias propriedades do input nativo e outras
 * propriedades extras como: máscara, pattern, mensagem de erro e etc.
 * Você deve informar a variável que contém o valor como [(ngModel)]="variavel", para que o
 * input receba o valor da variável e para que ela receba as alterações do valor (two-way-databinding).
 * A propriedade name é obrigatória para que o formulário e o model funcionem corretamente.
 *
 * Importante:
 *
 * - Caso o input tenha um [(ngModel)] sem o atributo name, ocorrerá um erro de angular.
 * Então você precisa informar o atributo name ou o atributo [ngModelOptions]="{standalone: true}".
 * Exemplo: [(ngModel)]="pessoa.nome" [ngModelOptions]="{standalone: true}"
 */
var PoInputBaseComponent = /** @class */ (function () {
    function PoInputBaseComponent() {
        this._noAutocomplete = false;
        this._placeholder = '';
        this.passedWriteValue = false;
        /**
         * @optional
         *
         * @description
         *
         * Aplica foco no elemento ao ser iniciado.
         *
         * > Caso mais de um elemento seja configurado com essa propriedade, apenas o último elemento declarado com ela terá o foco.
         *
         * @default `false`
         */
        this.autoFocus = false;
        /**
         * @description
         *
         * Se verdadeiro, desabilita o campo.
         *
         * @default `false`
         */
        this.disabled = false;
        /** Indica que o campo será somente leitura. */
        this.readonly = false;
        /**
         * @description
         *
         * Indica que o campo será obrigatório.
         *
         * > Esta propriedade é desconsiderada quando o input está desabilitado `(p-disabled)`.
         *
         * @default `false`
         */
        this.required = false;
        /** Se verdadeiro, o campo receberá um botão para ser limpo. */
        this.clean = false;
        /**
         * @description
         *
         * Mensagem que será apresentada quando o `pattern` ou a máscara não for satisfeita.
         *
         * > Esta mensagem não é apresentada quando o campo estiver vazio, mesmo que ele seja requerido.
         */
        this.errorPattern = '';
        /**
         * @description
         *
         * Indica uma máscara para o campo. Exemplos: (+99) (99) 99999?-9999, 99999-999, 999.999.999-99.
         * A máscara gera uma validação automática do campo, podendo esta ser substituída por um REGEX específico
         * através da propriedade p-pattern.
         * O campo será sinalizado e o formulário ficará inválido quando o valor informado estiver fora do padrão definido,
         * mesmo quando desabilitado.
         */
        this.mask = '';
        /**
         * @description
         *
         * Indica se o `model` receberá o valor formatado pela máscara ou apenas o valor puro (sem formatação).
         *
         * @default `false`
         */
        this.maskFormatModel = false;
        /** Evento disparado ao sair do campo. */
        this.blur = new EventEmitter();
        /** Evento disparado ao entrar do campo. */
        this.enter = new EventEmitter();
        /** Evento disparado ao alterar valor e deixar o campo. */
        this.change = new EventEmitter();
        /** Evento disparado ao alterar valor do model. */
        this.changeModel = new EventEmitter();
        this.onChangePropagate = null;
        this.onTouched = null;
    }
    Object.defineProperty(PoInputBaseComponent.prototype, "noAutocomplete", {
        get: function () {
            return this._noAutocomplete;
        },
        /**
         * @optional
         *
         * @description
         *
         * Define a propriedade nativa `autocomplete` do campo como `off`.
         *
         * @default `false`
         */
        set: function (value) {
            this._noAutocomplete = convertToBoolean(value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoInputBaseComponent.prototype, "placeholder", {
        get: function () {
            return this._placeholder;
        },
        /**
         * @optional
         *
         * @description
         *
         * Mensagem que aparecerá enquanto o campo não estiver preenchido.
         *
         * @default ''
         */
        set: function (value) {
            this._placeholder = value || '';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoInputBaseComponent.prototype, "setDisabled", {
        set: function (disabled) {
            this.disabled = disabled === '' ? true : convertToBoolean(disabled);
            this.validateModel();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoInputBaseComponent.prototype, "setReadonly", {
        set: function (readonly) {
            this.readonly = readonly === '' ? true : convertToBoolean(readonly);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoInputBaseComponent.prototype, "setRequired", {
        set: function (required) {
            this.required = required === '' ? true : convertToBoolean(required);
            this.validateModel();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoInputBaseComponent.prototype, "oldfocus", {
        /**
         * @optional
         *
         * @deprecated 2.0.0
         * @description
         *
         * **Deprecated**
         *
         * > Esta propriedade está depreciada e será excluída na versão 2.0.0, utilize a propriedade `p-auto-focus`.
         *
         * Aplica foco no elemento ao ser iniciado.
         *
         * @default `false`
         */
        set: function (focus) {
            this.autoFocus = focus;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoInputBaseComponent.prototype, "setClean", {
        set: function (clean) {
            this.clean = clean === '' ? true : convertToBoolean(clean);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoInputBaseComponent.prototype, "setPattern", {
        set: function (pattern) {
            this.pattern = pattern;
            this.validateModel();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoInputBaseComponent.prototype, "maxlength", {
        get: function () {
            return this._maxlength;
        },
        /**
         * @optional
         *
         * @description
         *
         * Indica a quantidade máxima de caracteres que o campo aceita.
         */
        set: function (value) {
            if (!isNaN(parseInt(value, 10))) {
                this._maxlength = parseInt(value, 10);
                this.validateModel();
            }
            else if (!value) {
                this._maxlength = undefined;
                this.validateModel();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoInputBaseComponent.prototype, "minlength", {
        get: function () {
            return this._minlength;
        },
        /**
         * @optional
         *
         * @description
         *
         * Indica a quantidade mínima de caracteres que o campo aceita.
         */
        set: function (value) {
            if (!isNaN(parseInt(value, 10))) {
                this._minlength = parseInt(value, 10);
                this.validateModel();
            }
            else if (!value) {
                this._minlength = undefined;
                this.validateModel();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoInputBaseComponent.prototype, "setMask", {
        set: function (mask) {
            this.mask = mask;
            // Atualiza Máscara do Campo
            this.objMask = new PoMask(this.mask, this.maskFormatModel);
            this.validateModel();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoInputBaseComponent.prototype, "setMaskFormatModel", {
        set: function (maskFormatModel) {
            this.maskFormatModel = maskFormatModel === '' ? true : convertToBoolean(maskFormatModel);
            if (this.objMask instanceof PoMask) {
                this.objMask.formatModel = this.maskFormatModel;
                this.validateModel();
            }
        },
        enumerable: true,
        configurable: true
    });
    PoInputBaseComponent.prototype.callOnChange = function (value) {
        this.updateModel(value);
        this.controlChangeModelEmitter(value);
    };
    PoInputBaseComponent.prototype.callUpdateModelWithTimeout = function (value) {
        var _this = this;
        setTimeout(function () { return _this.updateModel(value); });
    };
    PoInputBaseComponent.prototype.controlChangeModelEmitter = function (value) {
        if (this.modelLastUpdate !== value) {
            this.changeModel.emit(value);
            this.modelLastUpdate = value;
        }
    };
    // Função implementada do ControlValueAccessor
    // Usada para interceptar as mudanças e não atualizar automaticamente o Model
    PoInputBaseComponent.prototype.registerOnChange = function (func) {
        this.onChangePropagate = func;
    };
    // Função implementada do ControlValueAccessor
    // Usada para interceptar as mudanças e não atualizar automaticamente o Model
    PoInputBaseComponent.prototype.registerOnTouched = function (func) {
        this.onTouched = func;
    };
    PoInputBaseComponent.prototype.registerOnValidatorChange = function (fn) {
        this.validatorChange = fn;
    };
    PoInputBaseComponent.prototype.updateModel = function (value) {
        // Quando o input não possui um formulário, então esta função não é registrada
        if (this.onChangePropagate) {
            this.onChangePropagate(value);
        }
    };
    PoInputBaseComponent.prototype.validate = function (c) {
        if (requiredFailed(this.required, this.disabled, this.getScreenValue())) {
            return { required: {
                    valid: false,
                } };
        }
        if (maxlengpoailed(this.maxlength, this.getScreenValue())) {
            return { maxlength: {
                    valid: false,
                } };
        }
        if (minlengpoailed(this.minlength, this.getScreenValue())) {
            return { minlength: {
                    valid: false,
                } };
        }
        if (patternFailed(this.pattern, c.value)) {
            this.validatePatternOnWriteValue(c.value);
            return { pattern: {
                    valid: false,
                } };
        }
        return this.extraValidation(c);
    };
    // Função implementada do ControlValueAccessor
    PoInputBaseComponent.prototype.writeValue = function (value) {
        this.writeValueModel(value);
    };
    PoInputBaseComponent.prototype.validateModel = function () {
        if (this.validatorChange) {
            this.validatorChange();
        }
    };
    // utilizado para validar o pattern na inicializacao, fazendo dessa forma o campo fica sujo (dirty).
    PoInputBaseComponent.prototype.validatePatternOnWriteValue = function (value) {
        var _this = this;
        if (value && this.passedWriteValue) {
            setTimeout(function () {
                _this.updateModel(value);
            });
            this.passedWriteValue = false;
        }
    };
    tslib_1.__decorate([
        Input('p-auto-focus'), InputBoolean(),
        tslib_1.__metadata("design:type", Boolean)
    ], PoInputBaseComponent.prototype, "autoFocus", void 0);
    tslib_1.__decorate([
        Input('p-icon'),
        tslib_1.__metadata("design:type", String)
    ], PoInputBaseComponent.prototype, "icon", void 0);
    tslib_1.__decorate([
        Input('p-label'),
        tslib_1.__metadata("design:type", String)
    ], PoInputBaseComponent.prototype, "label", void 0);
    tslib_1.__decorate([
        Input('p-help'),
        tslib_1.__metadata("design:type", String)
    ], PoInputBaseComponent.prototype, "help", void 0);
    tslib_1.__decorate([
        Input('name'),
        tslib_1.__metadata("design:type", String)
    ], PoInputBaseComponent.prototype, "name", void 0);
    tslib_1.__decorate([
        Input('p-no-autocomplete'),
        tslib_1.__metadata("design:type", Boolean),
        tslib_1.__metadata("design:paramtypes", [Boolean])
    ], PoInputBaseComponent.prototype, "noAutocomplete", null);
    tslib_1.__decorate([
        Input('p-placeholder'),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], PoInputBaseComponent.prototype, "placeholder", null);
    tslib_1.__decorate([
        Input('p-disabled'),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], PoInputBaseComponent.prototype, "setDisabled", null);
    tslib_1.__decorate([
        Input('p-readonly'),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], PoInputBaseComponent.prototype, "setReadonly", null);
    tslib_1.__decorate([
        Input('p-required'),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], PoInputBaseComponent.prototype, "setRequired", null);
    tslib_1.__decorate([
        Input('p-focus'),
        tslib_1.__metadata("design:type", Boolean),
        tslib_1.__metadata("design:paramtypes", [Boolean])
    ], PoInputBaseComponent.prototype, "oldfocus", null);
    tslib_1.__decorate([
        Input('p-clean'),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], PoInputBaseComponent.prototype, "setClean", null);
    tslib_1.__decorate([
        Input('p-pattern'),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], PoInputBaseComponent.prototype, "setPattern", null);
    tslib_1.__decorate([
        Input('p-error-pattern'),
        tslib_1.__metadata("design:type", String)
    ], PoInputBaseComponent.prototype, "errorPattern", void 0);
    tslib_1.__decorate([
        Input('p-maxlength'),
        tslib_1.__metadata("design:type", Number),
        tslib_1.__metadata("design:paramtypes", [Number])
    ], PoInputBaseComponent.prototype, "maxlength", null);
    tslib_1.__decorate([
        Input('p-minlength'),
        tslib_1.__metadata("design:type", Number),
        tslib_1.__metadata("design:paramtypes", [Number])
    ], PoInputBaseComponent.prototype, "minlength", null);
    tslib_1.__decorate([
        Input('p-mask'),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], PoInputBaseComponent.prototype, "setMask", null);
    tslib_1.__decorate([
        Input('p-mask-format-model'),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], PoInputBaseComponent.prototype, "setMaskFormatModel", null);
    tslib_1.__decorate([
        Input('p-optional'),
        tslib_1.__metadata("design:type", Boolean)
    ], PoInputBaseComponent.prototype, "optional", void 0);
    tslib_1.__decorate([
        Output('p-blur'),
        tslib_1.__metadata("design:type", EventEmitter)
    ], PoInputBaseComponent.prototype, "blur", void 0);
    tslib_1.__decorate([
        Output('p-enter'),
        tslib_1.__metadata("design:type", EventEmitter)
    ], PoInputBaseComponent.prototype, "enter", void 0);
    tslib_1.__decorate([
        Output('p-change'),
        tslib_1.__metadata("design:type", EventEmitter)
    ], PoInputBaseComponent.prototype, "change", void 0);
    tslib_1.__decorate([
        Output('p-change-model'),
        tslib_1.__metadata("design:type", EventEmitter)
    ], PoInputBaseComponent.prototype, "changeModel", void 0);
    return PoInputBaseComponent;
}());
export { PoInputBaseComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8taW5wdXQtYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9ydGluYXJpL3BvcnRpbmFyaS11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWZpZWxkL3BvLWlucHV0L3BvLWlucHV0LWJhc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHNUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGNBQWMsRUFBRSxjQUFjLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hHLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRW5DOzs7Ozs7Ozs7Ozs7OztHQWNHO0FBQ0g7SUFBQTtRQUlVLG9CQUFlLEdBQWEsS0FBSyxDQUFDO1FBQ2xDLGlCQUFZLEdBQVksRUFBRSxDQUFDO1FBRXpCLHFCQUFnQixHQUFZLEtBQUssQ0FBQztRQUc1Qzs7Ozs7Ozs7OztXQVVHO1FBQ29DLGNBQVMsR0FBWSxLQUFLLENBQUM7UUF1RGxFOzs7Ozs7V0FNRztRQUNILGFBQVEsR0FBYSxLQUFLLENBQUM7UUFPM0IsK0NBQStDO1FBQy9DLGFBQVEsR0FBYSxLQUFLLENBQUM7UUFLM0I7Ozs7Ozs7O1dBUUc7UUFDSCxhQUFRLEdBQWEsS0FBSyxDQUFDO1FBeUIzQiwrREFBK0Q7UUFDL0QsVUFBSyxHQUFhLEtBQUssQ0FBQztRQW1CeEI7Ozs7OztXQU1HO1FBQ3VCLGlCQUFZLEdBQVksRUFBRSxDQUFDO1FBZ0RyRDs7Ozs7Ozs7V0FRRztRQUNILFNBQUksR0FBWSxFQUFFLENBQUM7UUFVbkI7Ozs7OztXQU1HO1FBQ0gsb0JBQWUsR0FBYSxL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QyxhQUFhLENBQUM7Ozt5REFVcEI7SUFnQmdCO1FBQWhCLEtBQUssQ0FBQyxRQUFRLENBQUM7Ozt1REFPZjtJQVU2QjtRQUE3QixLQUFLLENBQUMscUJBQXFCLENBQUM7OztrRUFRNUI7SUFlb0I7UUFBcEIsS0FBSyxDQUFDLFlBQVksQ0FBQzs7MERBQW1CO0lBR3JCO1FBQWpCLE1BQU0sQ0FBQyxRQUFRLENBQUM7MENBQVEsWUFBWTtzREFBMkI7SUFHN0M7UUFBbEIsTUFBTSxDQUFDLFNBQVMsQ0FBQzswQ0FBUyxZQUFZO3VEQUEyQjtJQUc5QztRQUFuQixNQUFNLENBQUMsVUFBVSxDQUFDOzBDQUFVLFlBQVk7d0RBQTJCO0lBRzFDO1FBQXpCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQzswQ0FBZSxZQUFZOzZEQUEyQjtJQWtJakYsMkJBQUM7Q0FBQSxBQTdZRCxJQTZZQztTQTdZcUIsb0JBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBWYWxpZGF0b3IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5cbmltcG9ydCB7IGNvbnZlcnRUb0Jvb2xlYW4gfSBmcm9tICcuLi8uLi8uLi91dGlscy91dGlsJztcbmltcG9ydCB7IHJlcXVpcmVkRmFpbGVkLCBtYXhsZW5ncG9haWxlZCwgbWlubGVuZ3BvYWlsZWQsIHBhdHRlcm5GYWlsZWQgfSBmcm9tICcuLy4uL3ZhbGlkYXRvcnMnO1xuaW1wb3J0IHsgSW5wdXRCb29sZWFuIH0gZnJvbSAnLi4vLi4vLi4vZGVjb3JhdG9ycyc7XG5pbXBvcnQgeyBQb01hc2sgfSBmcm9tICcuL3BvLW1hc2snO1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIEVzdGUgw6kgdW0gY29tcG9uZW50ZSBiYXNlYWRvIGVtIGlucHV0LCBjb20gdsOhcmlhcyBwcm9wcmllZGFkZXMgZG8gaW5wdXQgbmF0aXZvIGUgb3V0cmFzXG4gKiBwcm9wcmllZGFkZXMgZXh0cmFzIGNvbW86IG3DoXNjYXJhLCBwYXR0ZXJuLCBtZW5zYWdlbSBkZSBlcnJvIGUgZXRjLlxuICogVm9jw6ogZGV2ZSBpbmZvcm1hciBhIHZhcmnDoXZlbCBxdWUgY29udMOpbSBvIHZhbG9yIGNvbW8gWyhuZ01vZGVsKV09XCJ2YXJpYXZlbFwiLCBwYXJhIHF1ZSBvXG4gKiBpbnB1dCByZWNlYmEgbyB2YWxvciBkYSB2YXJpw6F2ZWwgZSBwYXJhIHF1ZSBlbGEgcmVjZWJhIGFzIGFsdGVyYcOnw7VlcyBkbyB2YWxvciAodHdvLXdheS1kYXRhYmluZGluZykuXG4gKiBBIHByb3ByaWVkYWRlIG5hbWUgw6kgb2JyaWdhdMOzcmlhIHBhcmEgcXVlIG8gZm9ybXVsw6FyaW8gZSBvIG1vZGVsIGZ1bmNpb25lbSBjb3JyZXRhbWVudGUuXG4gKlxuICogSW1wb3J0YW50ZTpcbiAqXG4gKiAtIENhc28gbyBpbnB1dCB0ZW5oYSB1bSBbKG5nTW9kZWwpXSBzZW0gbyBhdHJpYnV0byBuYW1lLCBvY29ycmVyw6EgdW0gZXJybyBkZSBhbmd1bGFyLlxuICogRW50w6NvIHZvY8OqIHByZWNpc2EgaW5mb3JtYXIgbyBhdHJpYnV0byBuYW1lIG91IG8gYXRyaWJ1dG8gW25nTW9kZWxPcHRpb25zXT1cIntzdGFuZGFsb25lOiB0cnVlfVwiLlxuICogRXhlbXBsbzogWyhuZ01vZGVsKV09XCJwZXNzb2Eubm9tZVwiIFtuZ01vZGVsT3B0aW9uc109XCJ7c3RhbmRhbG9uZTogdHJ1ZX1cIlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgUG9JbnB1dEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgVmFsaWRhdG9yIHtcblxuICBwcml2YXRlIF9tYXhsZW5ndGg/OiBudW1iZXI7XG4gIHByaXZhdGUgX21pbmxlbmd0aD86IG51bWJlcjtcbiAgcHJpdmF0ZSBfbm9BdXRvY29tcGxldGU/OiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgX3BsYWNlaG9sZGVyPzogc3RyaW5nID0gJyc7XG5cbiAgcHJvdGVjdGVkIHBhc3NlZFdyaXRlVmFsdWU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJvdGVjdGVkIHZhbGlkYXRvckNoYW5nZTogYW55O1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEFwbGljYSBmb2NvIG5vIGVsZW1lbnRvIGFvIHNlciBpbmljaWFkby5cbiAgICpcbiAgICogPiBDYXNvIG1haXMgZGUgdW0gZWxlbWVudG8gc2VqYSBjb25maWd1cmFkbyBjb20gZXNzYSBwcm9wcmllZGFkZSwgYXBlbmFzIG8gw7psdGltbyBlbGVtZW50byBkZWNsYXJhZG8gY29tIGVsYSB0ZXLDoSBvIGZvY28uXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgncC1hdXRvLWZvY3VzJykgQElucHV0Qm9vbGVhbigpIGF1dG9Gb2N1czogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERlZmluZSBvIMOtY29uZSBxdWUgc2Vyw6EgZXhpYmlkbyBubyBpbsOtY2lvIGRvIGNhbXBvLlxuICAgKlxuICAgKiA+IFZlamEgYSBkaXNwb25pYmlsaWRhZGUgZGUgw61jb25lcyBlbSBbYmlibGlvdGVjYSBkZSDDrWNvbmVzXShndWlkZXMvaWNvbnMpLlxuICAgKi9cbiAgQElucHV0KCdwLWljb24nKSBpY29uPzogc3RyaW5nO1xuXG4gIC8qKiBSw7N0dWxvIGRvIGNhbXBvLiAqL1xuICBASW5wdXQoJ3AtbGFiZWwnKSBsYWJlbD86IHN0cmluZztcblxuICAvKiogVGV4dG8gZGUgYXBvaW8gZG8gY2FtcG8uICovXG4gIEBJbnB1dCgncC1oZWxwJykgaGVscD86IHN0cmluZztcblxuICAvKiogTm9tZSBlIGlkZW50aWZpY2Fkb3IgZG8gY2FtcG8uICovXG4gIEBJbnB1dCgnbmFtZScpIG5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBEZWZpbmUgYSBwcm9wcmllZGFkZSBuYXRpdmEgYGF1dG9jb21wbGV0ZWAgZG8gY2FtcG8gY29tbyBgb2ZmYC5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLW5vLWF1dG9jb21wbGV0ZScpIHNldCBub0F1dG9jb21wbGV0ZSh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX25vQXV0b2NvbXBsZXRlID0gY29udmVydFRvQm9vbGVhbih2YWx1ZSk7XG4gIH1cblxuICBnZXQgbm9BdXRvY29tcGxldGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX25vQXV0b2NvbXBsZXRlO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogTWVuc2FnZW0gcXVlIGFwYXJlY2Vyw6EgZW5xdWFudG8gbyBjYW1wbyBuw6NvIGVzdGl2ZXIgcHJlZW5jaGlkby5cbiAgICpcbiAgICogQGRlZmF1bHQgJydcbiAgICovXG4gIEBJbnB1dCgncC1wbGFjZWhvbGRlcicpIHNldCBwbGFjZWhvbGRlcih2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5fcGxhY2Vob2xkZXIgPSB2YWx1ZSB8fCAnJztcbiAgfVxuICBnZXQgcGxhY2Vob2xkZXIoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3BsYWNlaG9sZGVyO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBTZSB2ZXJkYWRlaXJvLCBkZXNhYmlsaXRhIG8gY2FtcG8uXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIGRpc2FibGVkPzogYm9vbGVhbiA9IGZhbHNlO1xuICBASW5wdXQoJ3AtZGlzYWJsZWQnKSBzZXQgc2V0RGlzYWJsZWQoZGlzYWJsZWQ6IHN0cmluZykge1xuICAgIHRoaXMuZGlzYWJsZWQgPSBkaXNhYmxlZCA9PT0gJycgPyB0cnVlIDogY29udmVydFRvQm9vbGVhbihkaXNhYmxlZCk7XG5cbiAgICB0aGlzLnZhbGlkYXRlTW9kZWwoKTtcbiAgfVxuXG4gIC8qKiBJbmRpY2EgcXVlIG8gY2FtcG8gc2Vyw6Egc29tZW50ZSBsZWl0dXJhLiAqL1xuICByZWFkb25seT86IGJvb2xlYW4gPSBmYWxzZTtcbiAgQElucHV0KCdwLXJlYWRvbmx5Jykgc2V0IHNldFJlYWRvbmx5KHJlYWRvbmx5OiBzdHJpbmcpIHtcbiAgICB0aGlzLnJlYWRvbmx5ID0gcmVhZG9ubHkgPT09ICcnID8gdHJ1ZSA6IGNvbnZlcnRUb0Jvb2xlYW4ocmVhZG9ubHkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBJbmRpY2EgcXVlIG8gY2FtcG8gc2Vyw6Egb2JyaWdhdMOzcmlvLlxuICAgKlxuICAgKiA+IEVzdGEgcHJvcHJpZWRhZGUgw6kgZGVzY29uc2lkZXJhZGEgcXVhbmRvIG8gaW5wdXQgZXN0w6EgZGVzYWJpbGl0YWRvIGAocC1kaXNhYmxlZClgLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICByZXF1aXJlZD86IGJvb2xlYW4gPSBmYWxzZTtcbiAgQElucHV0KCdwLXJlcXVpcmVkJykgc2V0IHNldFJlcXVpcmVkKHJlcXVpcmVkOiBzdHJpbmcpIHtcbiAgICB0aGlzLnJlcXVpcmVkID0gcmVxdWlyZWQgPT09ICcnID8gdHJ1ZSA6IGNvbnZlcnRUb0Jvb2xlYW4ocmVxdWlyZWQpO1xuXG4gICAgdGhpcy52YWxpZGF0ZU1vZGVsKCk7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXByZWNhdGVkIDIuMC4wXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiAqKkRlcHJlY2F0ZWQqKlxuICAgKlxuICAgKiA+IEVzdGEgcHJvcHJpZWRhZGUgZXN0w6EgZGVwcmVjaWFkYSBlIHNlcsOhIGV4Y2x1w61kYSBuYSB2ZXJzw6NvIDIuMC4wLCB1dGlsaXplIGEgcHJvcHJpZWRhZGUgYHAtYXV0by1mb2N1c2AuXG4gICAqXG4gICAqIEFwbGljYSBmb2NvIG5vIGVsZW1lbnRvIGFvIHNlciBpbmljaWFkby5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLWZvY3VzJykgc2V0IG9sZGZvY3VzKGZvY3VzOiBib29sZWFuKSB7XG4gICAgdGhpcy5hdXRvRm9jdXMgPSBmb2N1cztcbiAgfVxuXG4gIC8qKiBTZSB2ZXJkYWRlaXJvLCBvIGNhbXBvIHJlY2ViZXLDoSB1bSBib3TDo28gcGFyYSBzZXIgbGltcG8uICovXG4gIGNsZWFuPzogYm9vbGVhbiA9IGZhbHNlO1xuICBASW5wdXQoJ3AtY2xlYW4nKSBzZXQgc2V0Q2xlYW4oY2xlYW46IHN0cmluZykge1xuICAgIHRoaXMuY2xlYW4gPSBjbGVhbiA9PT0gJycgPyB0cnVlIDogY29udmVydFRvQm9vbGVhbihjbGVhbik7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEV4cHJlc3PDo28gcmVndWxhciBwYXJhIHZhbGlkYXIgbyBjYW1wby5cbiAgICogUXVhbmRvIG8gY2FtcG8gcG9zc3VpciB1bWEgbcOhc2NhcmEgYChwLW1hc2spYCBzZXLDoSBhdXRvbWF0aWNhbWVudGUgdmFsaWRhZG8gcG9yIGVsYSwgcG9yw6ltXG4gICAqIMOpIHBvc3PDrXZlbCBkZWZpbmlyIHVtIHAtcGF0dGVybiBwYXJhIHN1YnN0aXR1aXIgYSB2YWxpZGHDp8OjbyBkYSBtw6FzY2FyYS5cbiAgICovXG4gIHBhdHRlcm4/OiBzdHJpbmc7XG4gIEBJbnB1dCgncC1wYXR0ZXJuJykgc2V0IHNldFBhdHRlcm4ocGF0dGVybjogc3RyaW5nKSB7XG4gICAgdGhpcy5wYXR0ZXJuID0gcGF0dGVybjtcblxuICAgIHRoaXMudmFsaWRhdGVNb2RlbCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBNZW5zYWdlbSBxdWUgc2Vyw6EgYXByZXNlbnRhZGEgcXVhbmRvIG8gYHBhdHRlcm5gIG91IGEgbcOhc2NhcmEgbsOjbyBmb3Igc2F0aXNmZWl0YS5cbiAgICpcbiAgICogPiBFc3RhIG1lbnNhZ2VtIG7Do28gw6kgYXByZXNlbnRhZGEgcXVhbmRvIG8gY2FtcG8gZXN0aXZlciB2YXppbywgbWVzbW8gcXVlIGVsZSBzZWphIHJlcXVlcmlkby5cbiAgICovXG4gIEBJbnB1dCgncC1lcnJvci1wYXR0ZXJuJykgZXJyb3JQYXR0ZXJuPzogc3RyaW5nID0gJyc7XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogSW5kaWNhIGEgcXVhbnRpZGFkZSBtw6F4aW1hIGRlIGNhcmFjdGVyZXMgcXVlIG8gY2FtcG8gYWNlaXRhLlxuICAgKi9cbiAgQElucHV0KCdwLW1heGxlbmd0aCcpIHNldCBtYXhsZW5ndGgodmFsdWU6IG51bWJlcikge1xuICAgIGlmICghaXNOYU4ocGFyc2VJbnQoPGFueT4gdmFsdWUsIDEwKSkpIHtcbiAgICAgIHRoaXMuX21heGxlbmd0aCA9IHBhcnNlSW50KDxhbnk+IHZhbHVlLCAxMCk7XG5cbiAgICAgIHRoaXMudmFsaWRhdGVNb2RlbCgpO1xuICAgIH0gZWxzZSBpZiAoIXZhbHVlKSB7XG4gICAgICB0aGlzLl9tYXhsZW5ndGggPSB1bmRlZmluZWQ7XG5cbiAgICAgIHRoaXMudmFsaWRhdGVNb2RlbCgpO1xuICAgIH1cbiAgfVxuXG4gIGdldCBtYXhsZW5ndGgoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21heGxlbmd0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEluZGljYSBhIHF1YW50aWRhZGUgbcOtbmltYSBkZSBjYXJhY3RlcmVzIHF1ZSBvIGNhbXBvIGFjZWl0YS5cbiAgICovXG4gIEBJbnB1dCgncC1taW5sZW5ndGgnKSBzZXQgbWlubGVuZ3RoKHZhbHVlOiBudW1iZXIpIHtcbiAgICBpZiAoIWlzTmFOKHBhcnNlSW50KDxhbnk+IHZhbHVlLCAxMCkpKSB7XG4gICAgICB0aGlzLl9taW5sZW5ndGggPSBwYXJzZUludCg8YW55PiB2YWx1ZSwgMTApO1xuXG4gICAgICB0aGlzLnZhbGlkYXRlTW9kZWwoKTtcbiAgICB9IGVsc2UgaWYgKCF2YWx1ZSkge1xuICAgICAgdGhpcy5fbWlubGVuZ3RoID0gdW5kZWZpbmVkO1xuXG4gICAgICB0aGlzLnZhbGlkYXRlTW9kZWwoKTtcbiAgICB9XG4gIH1cblxuICBnZXQgbWlubGVuZ3RoKCkge1xuICAgIHJldHVybiB0aGlzLl9taW5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEluZGljYSB1bWEgbcOhc2NhcmEgcGFyYSBvIGNhbXBvLiBFeGVtcGxvczogKCs5OSkgKDk5KSA5OTk5OT8tOTk5OSwgOTk5OTktOTk5LCA5OTkuOTk5Ljk5OS05OS5cbiAgICogQSBtw6FzY2FyYSBnZXJhIHVtYSB2YWxpZGHDp8OjbyBhdXRvbcOhdGljYSBkbyBjYW1wbywgcG9kZW5kbyBlc3RhIHNlciBzdWJzdGl0dcOtZGEgcG9yIHVtIFJFR0VYIGVzcGVjw61maWNvXG4gICAqIGF0cmF2w6lzIGRhIHByb3ByaWVkYWRlIHAtcGF0dGVybi5cbiAgICogTyBjYW1wbyBzZXLDoSBzaW5hbGl6YWRvIGUgbyBmb3JtdWzDoXJpbyBmaWNhcsOhIGludsOhbGlkbyBxdWFuZG8gbyB2YWxvciBpbmZvcm1hZG8gZXN0aXZlciBmb3JhIGRvIHBhZHLDo28gZGVmaW5pZG8sXG4gICAqIG1lc21vIHF1YW5kbyBkZXNhYmlsaXRhZG8uXG4gICAqL1xuICBtYXNrPzogc3RyaW5nID0gJyc7XG4gIEBJbnB1dCgncC1tYXNrJykgc2V0IHNldE1hc2sobWFzazogc3RyaW5nKSB7XG4gICAgdGhpcy5tYXNrID0gbWFzaztcblxuICAgIC8vIEF0dWFsaXphIE3DoXNjYXJhIGRvIENhbXBvXG4gICAgdGhpcy5vYmpNYXNrID0gbmV3IFBvTWFzayh0aGlzLm1hc2ssIHRoaXMubWFza0Zvcm1hdE1vZGVsKTtcblxuICAgIHRoaXMudmFsaWRhdGVNb2RlbCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBJbmRpY2Egc2UgbyBgbW9kZWxgIHJlY2ViZXLDoSBvIHZhbG9yIGZvcm1hdGFkbyBwZWxhIG3DoXNjYXJhIG91IGFwZW5hcyBvIHZhbG9yIHB1cm8gKHNlbSBmb3JtYXRhw6fDo28pLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICBtYXNrRm9ybWF0TW9kZWw/OiBib29sZWFuID0gZmFsc2U7XG4gIEBJbnB1dCgncC1tYXNrLWZvcm1hdC1tb2RlbCcpIHNldCBzZXRNYXNrRm9ybWF0TW9kZWwobWFza0Zvcm1hdE1vZGVsOiBzdHJpbmcpIHtcbiAgICB0aGlzLm1hc2tGb3JtYXRNb2RlbCA9IG1hc2tGb3JtYXRNb2RlbCA9PT0gJycgPyB0cnVlIDogY29udmVydFRvQm9vbGVhbihtYXNrRm9ybWF0TW9kZWwpO1xuXG4gICAgaWYgKHRoaXMub2JqTWFzayBpbnN0YW5jZW9mIFBvTWFzaykge1xuICAgICAgdGhpcy5vYmpNYXNrLmZvcm1hdE1vZGVsID0gdGhpcy5tYXNrRm9ybWF0TW9kZWw7XG5cbiAgICAgIHRoaXMudmFsaWRhdGVNb2RlbCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERlZmluZSBzZSBhIGluZGljYcOnw6NvIGRlIGNhbXBvIG9wY2lvbmFsIHNlcsOhIGV4aWJpZGEuXG4gICAqXG4gICAqID4gTsOjbyBzZXLDoSBleGliaWRhIGEgaW5kaWNhw6fDo28gc2U6XG4gICAqIC0gTyBjYW1wbyBjb250ZXIgYHAtcmVxdWlyZWRgO1xuICAgKiAtIE7Do28gcG9zc3VpciBgcC1oZWxwYCBlL291IGBwLWxhYmVsYC5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLW9wdGlvbmFsJykgb3B0aW9uYWw6IGJvb2xlYW47XG5cbiAgLyoqIEV2ZW50byBkaXNwYXJhZG8gYW8gc2FpciBkbyBjYW1wby4gKi9cbiAgQE91dHB1dCgncC1ibHVyJykgYmx1cj86IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8qKiBFdmVudG8gZGlzcGFyYWRvIGFvIGVudHJhciBkbyBjYW1wby4gKi9cbiAgQE91dHB1dCgncC1lbnRlcicpIGVudGVyPzogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgLyoqIEV2ZW50byBkaXNwYXJhZG8gYW8gYWx0ZXJhciB2YWxvciBlIGRlaXhhciBvIGNhbXBvLiAqL1xuICBAT3V0cHV0KCdwLWNoYW5nZScpIGNoYW5nZT86IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8qKiBFdmVudG8gZGlzcGFyYWRvIGFvIGFsdGVyYXIgdmFsb3IgZG8gbW9kZWwuICovXG4gIEBPdXRwdXQoJ3AtY2hhbmdlLW1vZGVsJykgY2hhbmdlTW9kZWw/OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICB0eXBlOiBzdHJpbmc7XG5cbiAgb25DaGFuZ2VQcm9wYWdhdGU6IGFueSA9IG51bGw7XG4gIG9uVG91Y2hlZDogYW55ID0gbnVsbDtcbiAgb2JqTWFzazogYW55O1xuICBtb2RlbExhc3RVcGRhdGU6IGFueTtcblxuICBjYWxsT25DaGFuZ2UodmFsdWU6IGFueSkge1xuICAgIHRoaXMudXBkYXRlTW9kZWwodmFsdWUpO1xuXG4gICAgdGhpcy5jb250cm9sQ2hhbmdlTW9kZWxFbWl0dGVyKHZhbHVlKTtcbiAgfVxuXG4gIGNhbGxVcGRhdGVNb2RlbFdpdGhUaW1lb3V0KHZhbHVlKSB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnVwZGF0ZU1vZGVsKHZhbHVlKSk7XG4gIH1cblxuICBjb250cm9sQ2hhbmdlTW9kZWxFbWl0dGVyKHZhbHVlOiBhbnkpIHtcbiAgICBpZiAodGhpcy5tb2RlbExhc3RVcGRhdGUgIT09IHZhbHVlKSB7XG4gICAgICB0aGlzLmNoYW5nZU1vZGVsLmVtaXQodmFsdWUpO1xuICAgICAgdGhpcy5tb2RlbExhc3RVcGRhdGUgPSB2YWx1ZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRnVuw6fDo28gcXVlIGF0cmlidWkgZm9jbyBhbyBjb21wb25lbnRlLlxuICAgKlxuICAgKiBQYXJhIHV0aWxpesOhLWxhIMOpIG5lY2Vzc8OhcmlvIHRlciBhIGluc3TDom5jaWEgZG8gY29tcG9uZW50ZSBubyBET00sIHBvZGVuZG8gc2VyIHV0aWxpemFkbyBvIFZpZXdDaGlsZCBkYSBzZWd1aW50ZSBmb3JtYTpcbiAgICpcbiAgICogYGBgXG4gICAqIGltcG9ydCB7IFBvTm9tZURvQ29tcG9uZW50ZUNvbXBvbmVudCB9IGZyb20gJ0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpJztcbiAgICpcbiAgICogLi4uXG4gICAqXG4gICAqIEBWaWV3Q2hpbGQoUG9Ob21lRG9Db21wb25lbnRlQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KSBub21lRG9Db21wb25lbnRlOiBQb05vbWVEb0NvbXBvbmVudGVDb21wb25lbnQ7XG4gICAqXG4gICAqIGZvY3VzQ29tcG9uZW50KCkge1xuICAgKiAgIHRoaXMubm9tZURvQ29tcG9uZW50ZS5mb2N1cygpO1xuICAgKiB9XG4gICAqIGBgYFxuICAgKi9cbiAgYWJzdHJhY3QgZm9jdXMoKTogdm9pZDtcblxuICAvLyBGdW7Dp8OjbyBpbXBsZW1lbnRhZGEgZG8gQ29udHJvbFZhbHVlQWNjZXNzb3JcbiAgLy8gVXNhZGEgcGFyYSBpbnRlcmNlcHRhciBhcyBtdWRhbsOnYXMgZSBuw6NvIGF0dWFsaXphciBhdXRvbWF0aWNhbWVudGUgbyBNb2RlbFxuICByZWdpc3Rlck9uQ2hhbmdlKGZ1bmM6IGFueSk6IHZvaWQge1xuICAgIHRoaXMub25DaGFuZ2VQcm9wYWdhdGUgPSBmdW5jO1xuICB9XG5cbiAgLy8gRnVuw6fDo28gaW1wbGVtZW50YWRhIGRvIENvbnRyb2xWYWx1ZUFjY2Vzc29yXG4gIC8vIFVzYWRhIHBhcmEgaW50ZXJjZXB0YXIgYXMgbXVkYW7Dp2FzIGUgbsOjbyBhdHVhbGl6YXIgYXV0b21hdGljYW1lbnRlIG8gTW9kZWxcbiAgcmVnaXN0ZXJPblRvdWNoZWQoZnVuYzogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWQgPSBmdW5jO1xuICB9XG5cbiAgcmVnaXN0ZXJPblZhbGlkYXRvckNoYW5nZShmbjogKCkgPT4gdm9pZCkge1xuICAgIHRoaXMudmFsaWRhdG9yQ2hhbmdlID0gZm47XG4gIH1cblxuICB1cGRhdGVNb2RlbCh2YWx1ZTogYW55KSB7XG4gICAgLy8gUXVhbmRvIG8gaW5wdXQgbsOjbyBwb3NzdWkgdW0gZm9ybXVsw6FyaW8sIGVudMOjbyBlc3RhIGZ1bsOnw6NvIG7Do28gw6kgcmVnaXN0cmFkYVxuICAgIGlmICh0aGlzLm9uQ2hhbmdlUHJvcGFnYXRlKSB7XG4gICAgICB0aGlzLm9uQ2hhbmdlUHJvcGFnYXRlKHZhbHVlKTtcbiAgICB9XG4gIH1cblxuICB2YWxpZGF0ZShjOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueTsgfSB7XG5cbiAgICBpZiAocmVxdWlyZWRGYWlsZWQodGhpcy5yZXF1aXJlZCwgdGhpcy5kaXNhYmxlZCwgdGhpcy5nZXRTY3JlZW5WYWx1ZSgpKSkge1xuICAgICAgcmV0dXJuIHsgcmVxdWlyZWQ6IHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgfX07XG4gICAgfVxuXG4gICAgaWYgKG1heGxlbmdwb2FpbGVkKHRoaXMubWF4bGVuZ3RoLCB0aGlzLmdldFNjcmVlblZhbHVlKCkpKSB7XG4gICAgICByZXR1cm4geyBtYXhsZW5ndGg6IHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgfX07XG4gICAgfVxuXG4gICAgaWYgKG1pbmxlbmdwb2FpbGVkKHRoaXMubWlubGVuZ3RoLCB0aGlzLmdldFNjcmVlblZhbHVlKCkpKSB7XG4gICAgICByZXR1cm4geyBtaW5sZW5ndGg6IHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgfX07XG4gICAgfVxuXG4gICAgaWYgKHBhdHRlcm5GYWlsZWQodGhpcy5wYXR0ZXJuLCBjLnZhbHVlKSkge1xuICAgICAgdGhpcy52YWxpZGF0ZVBhdHRlcm5PbldyaXRlVmFsdWUoYy52YWx1ZSk7XG4gICAgICByZXR1cm4geyBwYXR0ZXJuOiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgIH19O1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmV4dHJhVmFsaWRhdGlvbihjKTtcbiAgfVxuXG4gIC8vIEZ1bsOnw6NvIGltcGxlbWVudGFkYSBkbyBDb250cm9sVmFsdWVBY2Nlc3NvclxuICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpIHtcbiAgICB0aGlzLndyaXRlVmFsdWVNb2RlbCh2YWx1ZSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgdmFsaWRhdGVNb2RlbCgpIHtcbiAgICBpZiAodGhpcy52YWxpZGF0b3JDaGFuZ2UpIHtcbiAgICAgIHRoaXMudmFsaWRhdG9yQ2hhbmdlKCk7XG4gICAgfVxuICB9XG5cbiAgLy8gTcOpdG9kbyBxdWUgcmVjZWJlcsOhIG8gdmFsb3IgZG8gbW9kZWxcbiAgYWJzdHJhY3Qgd3JpdGVWYWx1ZU1vZGVsKHZhbHVlOiBhbnkpOiB2b2lkO1xuXG4gIC8vIFZhbGlkYcOnw7VlcyBkbyBjYW1wb1xuICBhYnN0cmFjdCBleHRyYVZhbGlkYXRpb24oYzogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnk7IH07XG5cbiAgLy8gRGV2ZSByZXRvcm5hciBvIHZhbG9yIGRvIGNhbXBvXG4gIGFic3RyYWN0IGdldFNjcmVlblZhbHVlKCk6IHN0cmluZztcblxuICAvLyB1dGlsaXphZG8gcGFyYSB2YWxpZGFyIG8gcGF0dGVybiBuYSBpbmljaWFsaXphY2FvLCBmYXplbmRvIGRlc3NhIGZvcm1hIG8gY2FtcG8gZmljYSBzdWpvIChkaXJ0eSkuXG4gIHByaXZhdGUgdmFsaWRhdGVQYXR0ZXJuT25Xcml0ZVZhbHVlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICBpZiAodmFsdWUgJiYgdGhpcy5wYXNzZWRXcml0ZVZhbHVlKSB7XG5cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLnVwZGF0ZU1vZGVsKHZhbHVlKTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnBhc3NlZFdyaXRlVmFsdWUgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxufVxuIl19