import * as tslib_1 from "tslib";
import { Input } from '@angular/core';
import { convertToBoolean, isTypeof } from '../../../utils/util';
import { getGridColumnsClasses, isVisibleField } from '../po-dynamic.util';
/**
 *
 * @description
 *
 * Componente para listar dados dinamicamente a partir de uma lista de objetos.
 *
 * > Por padrão esse componente cria `po-info` para exibição, é possível criar `po-tag` passando a propriedade { tag: true }.
 *
 */
var PoDynamicViewBaseComponent = /** @class */ (function () {
    function PoDynamicViewBaseComponent(currencyPipe, datePipe, decimalPipe, timePipe, titleCasePipe, dynamicViewService) {
        this.currencyPipe = currencyPipe;
        this.datePipe = datePipe;
        this.decimalPipe = decimalPipe;
        this.timePipe = timePipe;
        this.titleCasePipe = titleCasePipe;
        this.dynamicViewService = dynamicViewService;
        this._fields = [];
        this._showAllValue = false;
        this._value = {};
        this.visibleFields = [];
    }
    Object.defineProperty(PoDynamicViewBaseComponent.prototype, "fields", {
        get: function () {
            return this._fields;
        },
        /**
         * @optional
         *
         * @description
         *
         * Lista de objetos que implementam a interface `PoDynamicView`.
         *
         * > Ex: `[ { property: 'age' } ]`
         *
         * Regras de tipagem e formatação dos valores exibidos:
         *
         * - Caso o *type* informado seja *currency* e não seja informado o *format* o mesmo recebe "'BRL', 'symbol', '1.2-2'"
         * como formato padrão.
         * - Caso o *type* informado seja *date* e não seja informado o *format* o mesmo recebe 'dd/MM/yyyy' como formato padrão.
         * - Caso o *type* informado seja *dateTime* e não seja informado o *format* o mesmo recebe 'dd/MM/yyyy HH:mm:ss' como formato padrão.
         * - Caso o *type* informado seja *number* e não seja informado o *format* o mesmo não será formatado.
         * - Caso o *type* informado seja *time* e não seja informado o *format* o mesmo recebe 'HH:mm:ss.ffffff' como formato padrão.
         *
         * > As propriedades informadas serão exibidas mesmo não contendo valor de referência no objeto da propriedade `p-value`.
         *
         * @default `[]`
         */
        set: function (fields) {
            this._fields = Array.isArray(fields) ? tslib_1.__spread(fields) : [];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoDynamicViewBaseComponent.prototype, "showAllValue", {
        get: function () {
            return this._showAllValue;
        },
        /**
         * @optional
         *
         * @description
         *
         * Indica se exibirá todas as informações contidas dentro do objeto informado na propriedade `p-value`.
         *
         * @default `false`
         */
        set: function (value) {
            this._showAllValue = convertToBoolean(value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoDynamicViewBaseComponent.prototype, "value", {
        get: function () {
            return this._value;
        },
        /**
         * @description
         *
         * Objeto que será utilizado para exibir as informações dinâmicas, o valor será recuperado através do atributo *property*
         * dos objetos contidos na propridade `p-fields`.
         *
         * > Ex: `{ age: '35' }`
         */
        set: function (value) {
            this._value = value && isTypeof(value, 'object') ? value : {};
        },
        enumerable: true,
        configurable: true
    });
    // retorna os fields com os valores recuperados do objeto value.
    PoDynamicViewBaseComponent.prototype.getConfiguredFields = function () {
        var _this = this;
        var newFields = [];
        this.fields.forEach(function (field) {
            if (isVisibleField(field)) {
                newFields.push(_this.createField(field));
            }
        });
        return newFields;
    };
    // retorna fields ligado ao value mais os atributos do value que não possuiam fields.
    PoDynamicViewBaseComponent.prototype.getMergedFields = function () {
        var _this = this;
        var mergedFields = tslib_1.__spread(this.getConfiguredFields());
        this.getValueFields().forEach(function (valueField) {
            var fieldIndex = mergedFields.findIndex(function (field) { return field.property === valueField.property; });
            var property = valueField.property;
            if (fieldIndex === -1) {
                mergedFields.push(_this.createField({ property: property }));
            }
        });
        return mergedFields;
    };
    // retorna o objeto value como fields.
    PoDynamicViewBaseComponent.prototype.getValueFields = function () {
        var _this = this;
        return Object.keys(this.value).map(function (property) {
            return _this.createField({ property: property });
        });
    };
    PoDynamicViewBaseComponent.prototype.createField = function (field) {
        var property = field.property;
        var value = this.transformValue(field.type, this.value[property], field.format);
        var classesGridColumns = getGridColumnsClasses(field.gridSmColumns, field.gridMdColumns, field.gridLgColumns, field.gridXlColumns, field.gridColumns);
        return tslib_1.__assign({ property: property,
            value: value, label: this.titleCasePipe.transform(property), cssClass: classesGridColumns }, field);
    };
    PoDynamicViewBaseComponent.prototype.transformValue = function (type, value, format) {
        var transformedValue = value;
        switch (type) {
            case 'currency':
                transformedValue = this.currencyPipe.transform(value, format || 'BRL', 'symbol', '1.2-2');
                break;
            case 'date':
                transformedValue = this.datePipe.transform(value, format || 'dd/MM/yyyy');
                break;
            case 'dateTime':
                transformedValue = this.datePipe.transform(value, format || 'dd/MM/yyyy HH:mm:ss');
                break;
            case 'number':
                transformedValue = this.decimalPipe.transform(value, format);
                break;
            case 'time':
                transformedValue = this.timePipe.transform(value, format || 'HH:mm:ss.ffffff');
                break;
        }
        return transformedValue;
    };
    tslib_1.__decorate([
        Input('p-fields'),
        tslib_1.__metadata("design:type", Array),
        tslib_1.__metadata("design:paramtypes", [Array])
    ], PoDynamicViewBaseComponent.prototype, "fields", null);
    tslib_1.__decorate([
        Input('p-show-all-value'),
        tslib_1.__metadata("design:type", Boolean),
        tslib_1.__metadata("design:paramtypes", [Boolean])
    ], PoDynamicViewBaseComponent.prototype, "showAllValue", null);
    tslib_1.__decorate([
        Input('p-load'),
        tslib_1.__metadata("design:type", Object)
    ], PoDynamicViewBaseComponent.prototype, "load", void 0);
    tslib_1.__decorate([
        Input('p-value'),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], PoDynamicViewBaseComponent.prototype, "value", null);
    return PoDynamicViewBaseComponent;
}());
export { PoDynamicViewBaseComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZHluYW1pYy12aWV3LWJhc2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvcnRpbmFyaS9wb3J0aW5hcmktdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wby1keW5hbWljL3BvLWR5bmFtaWMtdmlldy9wby1keW5hbWljLXZpZXctYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHdEMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFFBQVEsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBR2pFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUkzRTs7Ozs7Ozs7R0FRRztBQUNIO0lBMEdFLG9DQUNVLFlBQTBCLEVBQzFCLFFBQWtCLEVBQ2xCLFdBQXdCLEVBQ3hCLFFBQW9CLEVBQ3BCLGFBQTRCLEVBQzFCLGtCQUF3QztRQUwxQyxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ2xCLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQ3hCLGFBQVEsR0FBUixRQUFRLENBQVk7UUFDcEIsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDMUIsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFzQjtRQTlHNUMsWUFBTyxHQUE4QixFQUFFLENBQUM7UUFDeEMsa0JBQWEsR0FBWSxLQUFLLENBQUM7UUFDL0IsV0FBTSxHQUFHLEVBQUUsQ0FBQztRQUVwQixrQkFBYSxHQUFHLEVBQUUsQ0FBQztJQTBHcUMsQ0FBQztJQWxGdEMsc0JBQUksOENBQU07YUFJN0I7WUFDRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDdEIsQ0FBQztRQTVCRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O1dBcUJHO2FBQ2dCLFVBQVcsTUFBaUM7WUFDN0QsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENB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MUIsS0FBSyxDQUFDLGtCQUFrQixDQUFDOzs7a0VBRXpCO0lBdUNnQjtRQUFoQixLQUFLLENBQUMsUUFBUSxDQUFDOzs0REFBeUI7SUFVdkI7UUFBakIsS0FBSyxDQUFDLFNBQVMsQ0FBQzs7OzJEQUVoQjtJQTZGSCxpQ0FBQztDQUFBLEFBak1ELElBaU1DO1NBak1ZLDBCQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDdXJyZW5jeVBpcGUsIERhdGVQaXBlLCBEZWNpbWFsUGlwZSwgVGl0bGVDYXNlUGlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5cbmltcG9ydCB7IGNvbnZlcnRUb0Jvb2xlYW4sIGlzVHlwZW9mIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdXRpbCc7XG5pbXBvcnQgeyBQb1RpbWVQaXBlIH0gZnJvbSAnLi4vLi4vLi4vcGlwZXMvcG8tdGltZS9wby10aW1lLnBpcGUnO1xuXG5pbXBvcnQgeyBnZXRHcmlkQ29sdW1uc0NsYXNzZXMsIGlzVmlzaWJsZUZpZWxkIH0gZnJvbSAnLi4vcG8tZHluYW1pYy51dGlsJztcbmltcG9ydCB7IFBvRHluYW1pY1ZpZXdGaWVsZCB9IGZyb20gJy4vcG8tZHluYW1pYy12aWV3LWZpZWxkLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0R5bmFtaWNWaWV3U2VydmljZSB9IGZyb20gJy4vcG8tZHluYW1pYy12aWV3LnNlcnZpY2UnO1xuXG4vKipcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBDb21wb25lbnRlIHBhcmEgbGlzdGFyIGRhZG9zIGRpbmFtaWNhbWVudGUgYSBwYXJ0aXIgZGUgdW1hIGxpc3RhIGRlIG9iamV0b3MuXG4gKlxuICogPiBQb3IgcGFkcsOjbyBlc3NlIGNvbXBvbmVudGUgY3JpYSBgcG8taW5mb2AgcGFyYSBleGliacOnw6NvLCDDqSBwb3Nzw612ZWwgY3JpYXIgYHBvLXRhZ2AgcGFzc2FuZG8gYSBwcm9wcmllZGFkZSB7IHRhZzogdHJ1ZSB9LlxuICpcbiAqL1xuZXhwb3J0IGNsYXNzIFBvRHluYW1pY1ZpZXdCYXNlQ29tcG9uZW50IHtcblxuICBwcml2YXRlIF9maWVsZHM6IEFycmF5PFBvRHluYW1pY1ZpZXdGaWVsZD4gPSBbXTtcbiAgcHJpdmF0ZSBfc2hvd0FsbFZhbHVlOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgX3ZhbHVlID0ge307XG5cbiAgdmlzaWJsZUZpZWxkcyA9IFtdO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIExpc3RhIGRlIG9iamV0b3MgcXVlIGltcGxlbWVudGFtIGEgaW50ZXJmYWNlIGBQb0R5bmFtaWNWaWV3YC5cbiAgICpcbiAgICogPiBFeDogYFsgeyBwcm9wZXJ0eTogJ2FnZScgfSBdYFxuICAgKlxuICAgKiBSZWdyYXMgZGUgdGlwYWdlbSBlIGZvcm1hdGHDp8OjbyBkb3MgdmFsb3JlcyBleGliaWRvczpcbiAgICpcbiAgICogLSBDYXNvIG8gKnR5cGUqIGluZm9ybWFkbyBzZWphICpjdXJyZW5jeSogZSBuw6NvIHNlamEgaW5mb3JtYWRvIG8gKmZvcm1hdCogbyBtZXNtbyByZWNlYmUgXCInQlJMJywgJ3N5bWJvbCcsICcxLjItMidcIlxuICAgKiBjb21vIGZvcm1hdG8gcGFkcsOjby5cbiAgICogLSBDYXNvIG8gKnR5cGUqIGluZm9ybWFkbyBzZWphICpkYXRlKiBlIG7Do28gc2VqYSBpbmZvcm1hZG8gbyAqZm9ybWF0KiBvIG1lc21vIHJlY2ViZSAnZGQvTU0veXl5eScgY29tbyBmb3JtYXRvIHBhZHLDo28uXG4gICAqIC0gQ2FzbyBvICp0eXBlKiBpbmZvcm1hZG8gc2VqYSAqZGF0ZVRpbWUqIGUgbsOjbyBzZWphIGluZm9ybWFkbyBvICpmb3JtYXQqIG8gbWVzbW8gcmVjZWJlICdkZC9NTS95eXl5IEhIOm1tOnNzJyBjb21vIGZvcm1hdG8gcGFkcsOjby5cbiAgICogLSBDYXNvIG8gKnR5cGUqIGluZm9ybWFkbyBzZWphICpudW1iZXIqIGUgbsOjbyBzZWphIGluZm9ybWFkbyBvICpmb3JtYXQqIG8gbWVzbW8gbsOjbyBzZXLDoSBmb3JtYXRhZG8uXG4gICAqIC0gQ2FzbyBvICp0eXBlKiBpbmZvcm1hZG8gc2VqYSAqdGltZSogZSBuw6NvIHNlamEgaW5mb3JtYWRvIG8gKmZvcm1hdCogbyBtZXNtbyByZWNlYmUgJ0hIOm1tOnNzLmZmZmZmZicgY29tbyBmb3JtYXRvIHBhZHLDo28uXG4gICAqXG4gICAqID4gQXMgcHJvcHJpZWRhZGVzIGluZm9ybWFkYXMgc2Vyw6NvIGV4aWJpZGFzIG1lc21vIG7Do28gY29udGVuZG8gdmFsb3IgZGUgcmVmZXLDqm5jaWEgbm8gb2JqZXRvIGRhIHByb3ByaWVkYWRlIGBwLXZhbHVlYC5cbiAgICpcbiAgICogQGRlZmF1bHQgYFtdYFxuICAgKi9cbiAgQElucHV0KCdwLWZpZWxkcycpIHNldCBmaWVsZHMoZmllbGRzOiBBcnJheTxQb0R5bmFtaWNWaWV3RmllbGQ+KSB7XG4gICAgdGhpcy5fZmllbGRzID0gQXJyYXkuaXNBcnJheShmaWVsZHMpID8gWy4uLmZpZWxkc10gOiBbXTtcbiAgfVxuXG4gIGdldCBmaWVsZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZpZWxkcztcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEluZGljYSBzZSBleGliaXLDoSB0b2RhcyBhcyBpbmZvcm1hw6fDtWVzIGNvbnRpZGFzIGRlbnRybyBkbyBvYmpldG8gaW5mb3JtYWRvIG5hIHByb3ByaWVkYWRlIGBwLXZhbHVlYC5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLXNob3ctYWxsLXZhbHVlJykgc2V0IHNob3dBbGxWYWx1ZSh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX3Nob3dBbGxWYWx1ZSA9IGNvbnZlcnRUb0Jvb2xlYW4odmFsdWUpO1xuICB9XG5cbiAgZ2V0IHNob3dBbGxWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fc2hvd0FsbFZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogUG9zc2liaWxpdGEgZXhlY3V0YXIgdW1hIGZ1bsOnw6NvIHF1YW5kbyBvIGNvbXBvbmVudGUgw6kgaW5pY2lhbGl6YWRvLlxuICAgKlxuICAgKiBBIHByb3ByaWVkYWRlIGFjZWl0YSBvcyBzZWd1aW50ZXMgdGlwb3M6XG4gICAqIC0gKipTdHJpbmcqKjogRW5kcG9pbnQgdXNhZG8gcGVsbyBjb21wb25lbnRlIHBhcmEgcmVxdWlzacOnw6NvIHZpYSBgUE9TVGAuXG4gICAqIC0gKipGdW5jdGlvbioqOiBNw6l0b2RvIHF1ZSBzZXLDoSBleGVjdXRhZG8gbmEgaW5pY2lhbGl6YcOnw6NvIGRvIGNvbXBvbmVudGUuXG4gICAqXG4gICAqIFBhcmEgb3MgZG9pcyB0aXBvcyBkZSB1dGlsaXphw6fDo28gZGEgcHJvcHJpZWRhZGUgZXNwZXJhLXNlIG8gc2VndWludGUgcmV0b3JubzpcbiAgICpcbiAgICogYGBgXG4gICAqIHtcbiAgICogICB2YWx1ZToge1xuICAgKiAgICAgY25wajogJyoqKioqKioqKioqKioqJywgLy8gYWx0ZXJhIHZhbG9yIGRvIGNhbXBvXG4gICAqICAgICB1cGRhdGVkOiAobmV3IERhdGUoKSkudG9TdHJpbmcoKSAvLyBhdHJpYnVpIHZhbG9yIGFvIGNhbXBvIG5vdm9cbiAgICogICB9LFxuICAgKiAgIGZpZWxkczogW1xuICAgKiAgICAgeyBwcm9wZXJ0eTogJ2NucGonLCB0YWc6IHRydWUsIGludmVyc2U6IHRydWUgfSwgLy8gYXRyaWJ1aSBub3ZhcyBwcm9wcmllZGFkZXMgYW8gZmllbGRcbiAgICogICAgIHsgcHJvcGVydHk6ICd1cGRhdGVkJywgdGFnOiB0cnVlIH0gLy8gaW5jbHVpIGNhbXBvIG5vdm9cbiAgICogICBdXG4gICAqIH1cbiAgICogYGBgXG4gICAqID4gKip2YWx1ZSoqOiBhbnkgPSBhdHJpYnVpIG5vdm8gdmFsb3IgZG8gbW9kZWwuXG4gICAqXG4gICAqID4gKipmaWVsZHMqKjogYEFycmF5PFBvRHluYW1pY1ZpZXdGaWVsZD5gID0gTGlzdGEgZGUgY2FtcG9zIHF1ZSBkZXNlamEgYWx0ZXJhciBhcyBwcm9wcmllZGFkZXMsXG4gICAqIGNhc28gZW52aWFyIHVtIGNhbXBvIGEgbWFpcyBzZXLDoSBjcmlhZG8gdW0gbm92byBjYW1wby5cbiAgICpcbiAgICogLSBQYXJhIGVzY29uZGVyL3JlbW92ZXIgY2FtcG9zIHByZWNpc2EgaW5mb3JtYXIgbm8gZmllbGQgYSBwcm9wcmllZGFkZSBgdmlzaWJsZSA9IGZhbHNlYC5cbiAgICpcbiAgICovXG4gIEBJbnB1dCgncC1sb2FkJykgbG9hZDogc3RyaW5nIHwgRnVuY3Rpb247XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBPYmpldG8gcXVlIHNlcsOhIHV0aWxpemFkbyBwYXJhIGV4aWJpciBhcyBpbmZvcm1hw6fDtWVzIGRpbsOibWljYXMsIG8gdmFsb3Igc2Vyw6EgcmVjdXBlcmFkbyBhdHJhdsOpcyBkbyBhdHJpYnV0byAqcHJvcGVydHkqXG4gICAqIGRvcyBvYmpldG9zIGNvbnRpZG9zIG5hIHByb3ByaWRhZGUgYHAtZmllbGRzYC5cbiAgICpcbiAgICogPiBFeDogYHsgYWdlOiAnMzUnIH1gXG4gICAqL1xuICBASW5wdXQoJ3AtdmFsdWUnKSBzZXQgdmFsdWUodmFsdWU6IG9iamVjdCkge1xuICAgIHRoaXMuX3ZhbHVlID0gdmFsdWUgJiYgaXNUeXBlb2YodmFsdWUsICdvYmplY3QnKSA/IHZhbHVlIDoge307XG4gIH1cblxuICBnZXQgdmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjdXJyZW5jeVBpcGU6IEN1cnJlbmN5UGlwZSxcbiAgICBwcml2YXRlIGRhdGVQaXBlOiBEYXRlUGlwZSxcbiAgICBwcml2YXRlIGRlY2ltYWxQaXBlOiBEZWNpbWFsUGlwZSxcbiAgICBwcml2YXRlIHRpbWVQaXBlOiBQb1RpbWVQaXBlLFxuICAgIHByaXZhdGUgdGl0bGVDYXNlUGlwZTogVGl0bGVDYXNlUGlwZSxcbiAgICBwcm90ZWN0ZWQgZHluYW1pY1ZpZXdTZXJ2aWNlOiBQb0R5bmFtaWNWaWV3U2VydmljZSkgeyB9XG5cbiAgLy8gcmV0b3JuYSBvcyBmaWVsZHMgY29tIG9zIHZhbG9yZXMgcmVjdXBlcmFkb3MgZG8gb2JqZXRvIHZhbHVlLlxuICBwcm90ZWN0ZWQgZ2V0Q29uZmlndXJlZEZpZWxkcygpIHtcbiAgICBjb25zdCBuZXdGaWVsZHMgPSBbXTtcblxuICAgIHRoaXMuZmllbGRzLmZvckVhY2goZmllbGQgPT4ge1xuICAgICAgaWYgKGlzVmlzaWJsZUZpZWxkKGZpZWxkKSkge1xuICAgICAgICBuZXdGaWVsZHMucHVzaCh0aGlzLmNyZWF0ZUZpZWxkKGZpZWxkKSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmV3RmllbGRzO1xuICB9XG5cbiAgLy8gcmV0b3JuYSBmaWVsZHMgbGlnYWRvIGFvIHZhbHVlIG1haXMgb3MgYXRyaWJ1dG9zIGRvIHZhbHVlIHF1ZSBuw6NvIHBvc3N1aWFtIGZpZWxkcy5cbiAgcHJvdGVjdGVkIGdldE1lcmdlZEZpZWxkcygpIHtcbiAgICBjb25zdCBtZXJnZWRGaWVsZHMgPSBbLi4udGhpcy5nZXRDb25maWd1cmVkRmllbGRzKCldO1xuXG4gICAgdGhpcy5nZXRWYWx1ZUZpZWxkcygpLmZvckVhY2godmFsdWVGaWVsZCA9PiB7XG4gICAgICBjb25zdCBmaWVsZEluZGV4ID0gbWVyZ2VkRmllbGRzLmZpbmRJbmRleChmaWVsZCA9PiBmaWVsZC5wcm9wZXJ0eSA9PT0gdmFsdWVGaWVsZC5wcm9wZXJ0eSk7XG4gICAgICBjb25zdCBwcm9wZXJ0eSA9IHZhbHVlRmllbGQucHJvcGVydHk7XG5cbiAgICAgIGlmIChmaWVsZEluZGV4ID09PSAtMSkge1xuICAgICAgICBtZXJnZWRGaWVsZHMucHVzaCh0aGlzLmNyZWF0ZUZpZWxkKHsgcHJvcGVydHkgfSkpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG1lcmdlZEZpZWxkcztcbiAgfVxuXG4gIC8vIHJldG9ybmEgbyBvYmpldG8gdmFsdWUgY29tbyBmaWVsZHMuXG4gIHByb3RlY3RlZCBnZXRWYWx1ZUZpZWxkcygpIHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy52YWx1ZSkubWFwKHByb3BlcnR5ID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUZpZWxkKHsgcHJvcGVydHkgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUZpZWxkKGZpZWxkOiBQb0R5bmFtaWNWaWV3RmllbGQpIHtcbiAgICBjb25zdCBwcm9wZXJ0eSA9IGZpZWxkLnByb3BlcnR5O1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy50cmFuc2Zvcm1WYWx1ZShmaWVsZC50eXBlLCB0aGlzLnZhbHVlW3Byb3BlcnR5XSwgZmllbGQuZm9ybWF0KTtcblxuICAgIGNvbnN0IGNsYXNzZXNHcmlkQ29sdW1ucyA9IGdldEdyaWRDb2x1bW5zQ2xhc3NlcyhmaWVsZC5ncmlkU21Db2x1bW5zLFxuICAgICAgZmllbGQuZ3JpZE1kQ29sdW1ucyxcbiAgICAgIGZpZWxkLmdyaWRMZ0NvbHVtbnMsXG4gICAgICBmaWVsZC5ncmlkWGxDb2x1bW5zLFxuICAgICAgZmllbGQuZ3JpZENvbHVtbnMpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHByb3BlcnR5LFxuICAgICAgdmFsdWUsXG4gICAgICBsYWJlbDogdGhpcy50aXRsZUNhc2VQaXBlLnRyYW5zZm9ybShwcm9wZXJ0eSksXG4gICAgICBjc3NDbGFzczogY2xhc3Nlc0dyaWRDb2x1bW5zLFxuICAgICAgLi4uZmllbGRcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSB0cmFuc2Zvcm1WYWx1ZSh0eXBlOiBzdHJpbmcsIHZhbHVlLCBmb3JtYXQpIHtcbiAgICBsZXQgdHJhbnNmb3JtZWRWYWx1ZSA9IHZhbHVlO1xuXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlICdjdXJyZW5jeSc6XG4gICAgICAgIHRyYW5zZm9ybWVkVmFsdWUgPSB0aGlzLmN1cnJlbmN5UGlwZS50cmFuc2Zvcm0odmFsdWUsIGZvcm1hdCB8fCAnQlJMJywgJ3N5bWJvbCcsICcxLjItMicpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2RhdGUnOlxuICAgICAgICB0cmFuc2Zvcm1lZFZhbHVlID0gdGhpcy5kYXRlUGlwZS50cmFuc2Zvcm0odmFsdWUsIGZvcm1hdCB8fCAnZGQvTU0veXl5eScpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2RhdGVUaW1lJzpcbiAgICAgICAgdHJhbnNmb3JtZWRWYWx1ZSA9IHRoaXMuZGF0ZVBpcGUudHJhbnNmb3JtKHZhbHVlLCBmb3JtYXQgfHwgJ2RkL01NL3l5eXkgSEg6bW06c3MnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICB0cmFuc2Zvcm1lZFZhbHVlID0gdGhpcy5kZWNpbWFsUGlwZS50cmFuc2Zvcm0odmFsdWUsIGZvcm1hdCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndGltZSc6XG4gICAgICAgIHRyYW5zZm9ybWVkVmFsdWUgPSB0aGlzLnRpbWVQaXBlLnRyYW5zZm9ybSh2YWx1ZSwgZm9ybWF0IHx8ICdISDptbTpzcy5mZmZmZmYnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRyYW5zZm9ybWVkVmFsdWU7XG4gIH1cblxufVxuIl19