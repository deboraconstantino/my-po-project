import * as tslib_1 from "tslib";
import { Component, ChangeDetectorRef, OnChanges, QueryList, SimpleChanges, ViewChildren } from '@angular/core';
import { ControlContainer, NgForm } from '@angular/forms';
import { TitleCasePipe } from '@angular/common';
import { PoDynamicFormFieldsBaseComponent } from './po-dynamic-form-fields-base.component';
import { PoDynamicFormValidationService } from '../po-dynamic-form-validation/po-dynamic-form-validation.service';
/**
 * @docsPrivate
 *
 * @description
 *
 * Componente de criação dos campos dinâmicos.
 */
var PoDynamicFormFieldsComponent = /** @class */ (function (_super) {
    tslib_1.__extends(PoDynamicFormFieldsComponent, _super);
    function PoDynamicFormFieldsComponent(titleCasePipe, validationService, changes) {
        var _this = _super.call(this, titleCasePipe) || this;
        _this.validationService = validationService;
        _this.changes = changes;
        _this.previousValue = {};
        return _this;
    }
    PoDynamicFormFieldsComponent.prototype.ngOnChanges = function (changes) {
        if (changes.fields) {
            this.visibleFields = this.getVisibleFields();
        }
    };
    PoDynamicFormFieldsComponent.prototype.focus = function (property) {
        var foundComponent = this.components.find(function (component) { return component.name === property; });
        if (foundComponent) {
            foundComponent.focus();
        }
    };
    PoDynamicFormFieldsComponent.prototype.isDisabled = function (field) {
        return field.disabled || this.disabledForm;
    };
    PoDynamicFormFieldsComponent.prototype.onChangeField = function (visibleField) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var property, isChangedValueField, _a, changedField, changedFieldIndex;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        property = visibleField.property;
                        isChangedValueField = this.previousValue[property] !== this.value[property];
                        if (!isChangedValueField) return [3 /*break*/, 3];
                        _a = this.getField(property), changedField = _a.changedField, changedFieldIndex = _a.changedFieldIndex;
                        if (!changedField.validate) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.validateField(changedField, changedFieldIndex, visibleField)];
                    case 1:
                        _b.sent();
                        _b.label = 2;
                    case 2:
                        this.triggerValidationOnForm(changedFieldIndex);
                        _b.label = 3;
                    case 3:
                        this.previousValue[property] = this.value[property];
                        return [2 /*return*/];
                }
            });
        });
    };
    PoDynamicFormFieldsComponent.prototype.trackBy = function (index) {
        return index;
    };
    PoDynamicFormFieldsComponent.prototype.applyFieldValidation = function (index, validatedField) {
        var field = this.fields[index];
        this.fields[index] = tslib_1.__assign({}, field, validatedField.field);
        this.updateFields();
        if (validatedField.hasOwnProperty('value')) {
            this.value[field.property] = validatedField.value;
        }
        this.changes.detectChanges();
        if (validatedField.focus) {
            this.focus(field.property);
        }
    };
    PoDynamicFormFieldsComponent.prototype.getField = function (property) {
        var changedFieldIndex = this.fields.findIndex(function (field) { return field.property === property; });
        var changedField = this.fields[changedFieldIndex];
        return { changedField: changedField, changedFieldIndex: changedFieldIndex };
    };
    PoDynamicFormFieldsComponent.prototype.triggerValidationOnForm = function (changedFieldIndex) {
        var hasValidationForm = this.validate && this.formValidate.observers.length;
        if (hasValidationForm) {
            var updatedField = this.fields[changedFieldIndex];
            this.formValidate.emit(updatedField);
        }
    };
    PoDynamicFormFieldsComponent.prototype.updateFields = function () {
        this.fieldsChange.emit(this.fields);
        this.visibleFields = this.getVisibleFields();
    };
    PoDynamicFormFieldsComponent.prototype.validateField = function (field, fieldIndex, visibleField) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var value, previousDisabled, validatedField, _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        value = this.value[field.property];
                        previousDisabled = visibleField.disabled;
                        visibleField.disabled = true;
                        this.changes.detectChanges();
                        _b.label = 1;
                    case 1:
                        _b.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.validationService.sendFieldChange(field, value).toPromise()];
                    case 2:
                        validatedField = _b.sent();
                        this.applyFieldValidation(fieldIndex, validatedField);
                        return [3 /*break*/, 4];
                    case 3:
                        _a = _b.sent();
                        visibleField.disabled = previousDisabled;
                        return [3 /*break*/, 4];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    PoDynamicFormFieldsComponent.ctorParameters = function () { return [
        { type: TitleCasePipe },
        { type: PoDynamicFormValidationService },
        { type: ChangeDetectorRef }
    ]; };
    tslib_1.__decorate([
        ViewChildren('component'),
        tslib_1.__metadata("design:type", QueryList)
    ], PoDynamicFormFieldsComponent.prototype, "components", void 0);
    PoDynamicFormFieldsComponent = tslib_1.__decorate([
        Component({
            selector: 'po-dynamic-form-fields',
            template: "<div class=\"po-row\" *ngIf=\"visibleFields && visibleFields.length > 0\">\r\n  <ng-container *ngFor=\"let field of visibleFields; trackBy: trackBy\">\r\n\r\n    <po-divider *ngIf=\"field?.divider?.trim()\" class=\"po-sm-12\" [p-label]=\"field.divider\">\r\n    </po-divider>\r\n\r\n    <po-datepicker #component *ngIf=\"compareTo(field.control, 'datepicker')\"\r\n      [name]=\"field.property\"\r\n      [(ngModel)]=\"value[field.property]\"\r\n      [ngClass]=\"field.componentClass\"\r\n      p-clean\r\n      [p-disabled]=\"isDisabled(field)\"\r\n      [p-error-pattern]=\"field.errorMessage\"\r\n      [p-auto-focus]=\"field.focus\"\r\n      [p-help]=\"field.help\"\r\n      [p-label]=\"field.label\"\r\n      [p-max-date]=\"field.maxValue\"\r\n      [p-min-date]=\"field.minValue\"\r\n      [p-optional]=\"field.optional\"\r\n      [p-required]=\"field.required\"\r\n      (p-change)=\"onChangeField(field)\">\r\n    </po-datepicker>\r\n\r\n    <po-input #component *ngIf=\"compareTo(field.control, 'input')\"\r\n      [name]=\"field.property\"\r\n      [(ngModel)]=\"value[field.property]\"\r\n      [ngClass]=\"field.componentClass\"\r\n      p-clean\r\n      [p-disabled]=\"isDisabled(field)\"\r\n      [p-error-pattern]=\"field.errorMessage\"\r\n      [p-auto-focus]=\"field.focus\"\r\n      [p-help]=\"field.help\"\r\n      [p-label]=\"field.label\"\r\n      [p-mask]=\"field.mask\"\r\n      [p-maxlength]=\"field.maxLength\"\r\n      [p-minlength]=\"field.minLength\"\r\n      [p-optional]=\"field.optional\"\r\n      [p-pattern]=\"field.pattern\"\r\n      [p-required]=\"field.required\"\r\n      (p-change)=\"onChangeField(field)\">\r\n      </po-input>\r\n\r\n    <po-number #component *ngIf=\"compareTo(field.control, 'number')\"\r\n      [name]=\"field.property\"\r\n      [(ngModel)]=\"value[field.property]\"\r\n      [ngClass]=\"field.componentClass\"\r\n      p-clean\r\n      [p-disabled]=\"isDisabled(field)\"\r\n      [p-error-pattern]=\"field.errorMessage\"\r\n      [p-auto-focus]=\"field.focus\"\r\n      [p-help]=\"field.help\"\r\n      [p-label]=\"field.label\"\r\n      [p-min]=\"field.minValue\"\r\n      [p-max]=\"field.maxValue\"\r\n      [p-maxlength]=\"field.maxLength\"\r\n      [p-minlength]=\"field.minLength\"\r\n      [p-optional]=\"field.optional\"\r\n      [p-required]=\"field.required\"\r\n      (p-change)=\"onChangeField(field)\">\r\n    </po-number>\r\n\r\n    <po-decimal #component *ngIf=\"compareTo(field.control, 'decimal')\"\r\n      [name]=\"field.property\"\r\n      [(ngModel)]=\"value[field.property]\"\r\n      [ngClass]=\"field.componentClass\"\r\n      p-clean\r\n      [p-disabled]=\"isDisabled(field)\"\r\n      [p-auto-focus]=\"field.focus\"\r\n      [p-help]=\"field.help\"\r\n      [p-label]=\"field.label\"\r\n      [p-optional]=\"field.optional\"\r\n      [p-required]=\"field.required\"\r\n      (p-change)=\"onChangeField(field)\">\r\n    </po-decimal>\r\n\r\n    <po-select #component *ngIf=\"compareTo(field.control, 'select')\"\r\n      [name]=\"field.property\"\r\n      [(ngModel)]=\"value[field.property]\"\r\n      [ngClass]=\"field.componentClass\"\r\n      [p-auto-focus]=\"field.focus\"\r\n      [p-disabled]=\"isDisabled(field)\"\r\n      [p-help]=\"field.help\"\r\n      [p-label]=\"field.label\"\r\n      [p-optional]=\"field.optional\"\r\n      [p-options]=\"field.options\"\r\n      [p-required]=\"field.required\"\r\n      (p-change)=\"onChangeField(field)\">\r\n    </po-select>\r\n\r\n    <po-radio-group #component *ngIf=\"compareTo(field.control, 'radioGroup')\"\r\n      [name]=\"field.property\"\r\n      [(ngModel)]=\"value[field.property]\"\r\n      [ngClass]=\"field.componentClass\"\r\n      p-columns=\"3\"\r\n      [p-auto-focus]=\"field.focus\"\r\n      [p-disabled]=\"isDisabled(field)\"\r\n      [p-help]=\"field.help\"\r\n      [p-label]=\"field.label\"\r\n      [p-optional]=\"field.optional\"\r\n      [p-options]=\"field.options\"\r\n      [p-required]=\"field.required\"\r\n      (p-change)=\"onChangeField(field)\">\r\n    </po-radio-group>\r\n\r\n    <po-switch #component *ngIf=\"compareTo(field.control, 'switch')\"\r\n      [name]=\"field.property\"\r\n      [(ngModel)]=\"value[field.property]\"\r\n      [ngClass]=\"field.componentClass\"\r\n      [p-auto-focus]=\"field.focus\"\r\n      [p-disabled]=\"isDisabled(field)\"\r\n      [p-help]=\"field.help\"\r\n      [p-label]=\"field.label\"\r\n      [p-label-off]=\"field.booleanFalse\"\r\n      [p-label-on]=\"field.booleanTrue\"\r\n      (p-change)=\"onChangeField(field)\">\r\n    </po-switch>\r\n\r\n    <po-combo #component *ngIf=\"compareTo(field.control, 'combo')\"\r\n      [name]=\"field.property\"\r\n      [(ngModel)]=\"value[field.property]\"\r\n      [ngClass]=\"field.componentClass\"\r\n      [p-auto-focus]=\"field.focus\"\r\n      [p-disabled]=\"isDisabled(field)\"\r\n      [p-filter-params]=\"field.params\"\r\n      [p-filter-service]=\"field.optionsService\"\r\n      [p-help]=\"field.help\"\r\n      [p-label]=\"field.label\"\r\n      [p-optional]=\"field.optional\"\r\n      [p-required]=\"field.required\"\r\n      (p-change)=\"onChangeField(field)\">\r\n    </po-combo>\r\n\r\n    <po-lookup #component *ngIf=\"compareTo(field.control, 'lookup')\"\r\n      [name]=\"field.property\"\r\n      [(ngModel)]=\"value[field.property]\"\r\n      p-field-label=\"label\"\r\n      p-field-value=\"value\"\r\n      [ngClass]=\"field.componentClass\"\r\n      [p-columns]=\"field.columns\"\r\n      [p-disabled]=\"isDisabled(field)\"\r\n      [p-filter-params]=\"field.params\"\r\n      [p-filter-service]=\"field.searchService\"\r\n      [p-auto-focus]=\"field.focus\"\r\n      [p-help]=\"field.help\"\r\n      [p-label]=\"field.label\"\r\n      [p-optional]=\"field.optional\"\r\n      [p-required]=\"field.required\"\r\n      (p-change)=\"onChangeField(field)\">\r\n    </po-lookup>\r\n\r\n    <po-checkbox-group #component *ngIf=\"compareTo(field.control, 'checkboxGroup')\"\r\n      [name]=\"field.property\"\r\n      [(ngModel)]=\"value[field.property]\"\r\n      [ngClass]=\"field.componentClass\"\r\n      p-columns=\"3\"\r\n      [p-auto-focus]=\"field.focus\"\r\n      [p-disabled]=\"isDisabled(field)\"\r\n      [p-help]=\"field.help\"\r\n      [p-label]=\"field.label\"\r\n      [p-optional]=\"field.optional\"\r\n      [p-options]=\"field.options\"\r\n      [p-required]=\"field.required\"\r\n      (p-change)=\"onChangeField(field)\">\r\n    </po-checkbox-group>\r\n\r\n    <po-multiselect #component *ngIf=\"compareTo(field.control, 'multiselect')\"\r\n      [name]=\"field.property\"\r\n      [(ngModel)]=\"value[field.property]\"\r\n      [ngClass]=\"field.componentClass\"\r\n      [p-disabled]=\"isDisabled(field)\"\r\n      [p-auto-focus]=\"field.focus\"\r\n      [p-help]=\"field.help\"\r\n      [p-label]=\"field.label\"\r\n      [p-optional]=\"field.optional\"\r\n      [p-options]=\"field.options\"\r\n      [p-required]=\"field.required\"\r\n      (p-change)=\"onChangeField(field)\">\r\n    </po-multiselect>\r\n\r\n    <po-textarea #component *ngIf=\"compareTo(field.control, 'textarea')\"\r\n      [name]=\"field.property\"\r\n      [(ngModel)]=\"value[field.property]\"\r\n      [ngClass]=\"field.componentClass\"\r\n      [p-disabled]=\"isDisabled(field)\"\r\n      [p-auto-focus]=\"field.focus\"\r\n      [p-help]=\"field.help\"\r\n      [p-label]=\"field.label\"\r\n      [p-maxlength]=\"field.maxLength\"\r\n      [p-minlength]=\"field.minLength\"\r\n      [p-optional]=\"field.optional\"\r\n      [p-required]=\"field.required\"\r\n      [p-rows]=\"field.rows\"\r\n      (p-change)=\"onChangeField(field)\">\r\n    </po-textarea>\r\n\r\n    <po-password #component *ngIf=\"compareTo(field.control, 'password')\"\r\n      [name]=\"field.property\"\r\n      [(ngModel)]=\"value[field.property]\"\r\n      [ngClass]=\"field.componentClass\"\r\n      p-clean\r\n      [p-disabled]=\"isDisabled(field)\"\r\n      [p-error-pattern]=\"field.errorMessage\"\r\n      [p-auto-focus]=\"field.focus\"\r\n      [p-help]=\"field.help\"\r\n      [p-label]=\"field.label\"\r\n      [p-maxlength]=\"field.maxLength\"\r\n      [p-minlength]=\"field.minLength\"\r\n      [p-optional]=\"field.optional\"\r\n      [p-pattern]=\"field.pattern\"\r\n      [p-required]=\"field.required\"\r\n      (p-change)=\"onChangeField(field)\">\r\n    </po-password>\r\n\r\n  </ng-container>\r\n</div>\r\n",
            viewProviders: [{ provide: ControlContainer, useExisting: NgForm }],
            providers: [PoDynamicFormValidationService]
        }),
        tslib_1.__metadata("design:paramtypes", [TitleCasePipe, PoDynamicFormValidationService, ChangeDetectorRef])
    ], PoDynamicFormFieldsComponent);
    return PoDynamicFormFieldsComponent;
}(PoDynamicFormFieldsBaseComponent));
export { PoDynamicFormFieldsComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZHluYW1pYy1mb3JtLWZpZWxkcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9ydGluYXJpL3BvcnRpbmFyaS11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWR5bmFtaWMvcG8tZHluYW1pYy1mb3JtL3BvLWR5bmFtaWMtZm9ybS1maWVsZHMvcG8tZHluYW1pYy1mb3JtLWZpZWxkcy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxhQUFhLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2hILE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMxRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFHaEQsT0FBTyxFQUFFLGdDQUFnQyxFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFFM0YsT0FBTyxFQUFFLDhCQUE4QixFQUFFLE1BQU0sa0VBQWtFLENBQUM7QUFFbEg7Ozs7OztHQU1HO0FBT0g7SUFBa0Qsd0RBQWdDO0lBTWhGLHNDQUFZLGFBQTRCLEVBQVUsaUJBQWlELEVBQVUsT0FBMEI7UUFBdkksWUFDRSxrQkFBTSxhQUFhLENBQUMsU0FDckI7UUFGaUQsdUJBQWlCLEdBQWpCLGlCQUFpQixDQUFnQztRQUFVLGFBQU8sR0FBUCxPQUFPLENBQW1CO1FBRi9ILG1CQUFhLEdBQUcsRUFBRSxDQUFDOztJQUkzQixDQUFDO0lBRUQsa0RBQVcsR0FBWCxVQUFZLE9BQXNCO1FBQ2hDLElBQUksT0FBTyxDQUFDLE1BQU0sRUFBRTtZQUNsQixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1NBQzlDO0lBQ0gsQ0FBQztJQUVELDRDQUFLLEdBQUwsVUFBTSxRQUFnQjtRQUNwQixJQUFNLGNBQWMsR0FB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QzlDLENBQUM7aURBTzJCLGFBQWEsRUFBNkIsOEJBQThCLEVBQW1CLGlCQUFpQjtPQU41SCw0QkFBNEIsQ0F3R3hDO0lBQUQsbUNBQUM7Q0FBQSxBQXhHRCxDQUFrRCxnQ0FBZ0MsR0F3R2pGO1NBeEdZLDRCQUE0QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ2hhbmdlRGV0ZWN0b3JSZWYsIE9uQ2hhbmdlcywgUXVlcnlMaXN0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGRyZW4gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ29udHJvbENvbnRhaW5lciwgTmdGb3JtIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBUaXRsZUNhc2VQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuXHJcbmltcG9ydCB7IFBvRHluYW1pY0Zvcm1GaWVsZCB9IGZyb20gJy4uL3BvLWR5bmFtaWMtZm9ybS1maWVsZC5pbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBQb0R5bmFtaWNGb3JtRmllbGRzQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tZHluYW1pYy1mb3JtLWZpZWxkcy1iYXNlLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFBvRHluYW1pY0Zvcm1GaWVsZFZhbGlkYXRpb24gfSBmcm9tICcuLi9wby1keW5hbWljLWZvcm0tdmFsaWRhdGlvbi9wby1keW5hbWljLWZvcm0tZmllbGQtdmFsaWRhdGlvbi5pbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBQb0R5bmFtaWNGb3JtVmFsaWRhdGlvblNlcnZpY2UgfSBmcm9tICcuLi9wby1keW5hbWljLWZvcm0tdmFsaWRhdGlvbi9wby1keW5hbWljLWZvcm0tdmFsaWRhdGlvbi5zZXJ2aWNlJztcclxuXHJcbi8qKlxyXG4gKiBAZG9jc1ByaXZhdGVcclxuICpcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqXHJcbiAqIENvbXBvbmVudGUgZGUgY3JpYcOnw6NvIGRvcyBjYW1wb3MgZGluw6JtaWNvcy5cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAncG8tZHluYW1pYy1mb3JtLWZpZWxkcycsXHJcbiAgdGVtcGxhdGVVcmw6ICdwby1keW5hbWljLWZvcm0tZmllbGRzLmNvbXBvbmVudC5odG1sJyxcclxuICB2aWV3UHJvdmlkZXJzOiBbIHsgcHJvdmlkZTogQ29udHJvbENvbnRhaW5lciwgdXNlRXhpc3Rpbmc6IE5nRm9ybSB9IF0sXHJcbiAgcHJvdmlkZXJzOiBbIFBvRHluYW1pY0Zvcm1WYWxpZGF0aW9uU2VydmljZSBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBQb0R5bmFtaWNGb3JtRmllbGRzQ29tcG9uZW50IGV4dGVuZHMgUG9EeW5hbWljRm9ybUZpZWxkc0Jhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xyXG5cclxuICBAVmlld0NoaWxkcmVuKCdjb21wb25lbnQnKSBjb21wb25lbnRzOiBRdWVyeUxpc3Q8eyBuYW1lOiBzdHJpbmcsIGZvY3VzOiAoKSA9PiB2b2lkIH0+O1xyXG5cclxuICBwcml2YXRlIHByZXZpb3VzVmFsdWUgPSB7fTtcclxuXHJcbiAgY29uc3RydWN0b3IodGl0bGVDYXNlUGlwZTogVGl0bGVDYXNlUGlwZSwgcHJpdmF0ZSB2YWxpZGF0aW9uU2VydmljZTogUG9EeW5hbWljRm9ybVZhbGlkYXRpb25TZXJ2aWNlLCBwcml2YXRlIGNoYW5nZXM6IENoYW5nZURldGVjdG9yUmVmKSB7XHJcbiAgICBzdXBlcih0aXRsZUNhc2VQaXBlKTtcclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIGlmIChjaGFuZ2VzLmZpZWxkcykge1xyXG4gICAgICB0aGlzLnZpc2libGVGaWVsZHMgPSB0aGlzLmdldFZpc2libGVGaWVsZHMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZvY3VzKHByb3BlcnR5OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGZvdW5kQ29tcG9uZW50ID0gdGhpcy5jb21wb25lbnRzLmZpbmQoY29tcG9uZW50ID0+IGNvbXBvbmVudC5uYW1lID09PSBwcm9wZXJ0eSk7XHJcbiAgICBpZiAoZm91bmRDb21wb25lbnQpIHtcclxuICAgICAgZm91bmRDb21wb25lbnQuZm9jdXMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlzRGlzYWJsZWQoZmllbGQ6IFBvRHluYW1pY0Zvcm1GaWVsZCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIGZpZWxkLmRpc2FibGVkIHx8IHRoaXMuZGlzYWJsZWRGb3JtO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgb25DaGFuZ2VGaWVsZCh2aXNpYmxlRmllbGQ6IFBvRHluYW1pY0Zvcm1GaWVsZCkge1xyXG4gICAgY29uc3QgeyBwcm9wZXJ0eSB9ID0gdmlzaWJsZUZpZWxkO1xyXG4gICAgY29uc3QgaXNDaGFuZ2VkVmFsdWVGaWVsZCA9IHRoaXMucHJldmlvdXNWYWx1ZVtwcm9wZXJ0eV0gIT09IHRoaXMudmFsdWVbcHJvcGVydHldO1xyXG5cclxuICAgIGlmIChpc0NoYW5nZWRWYWx1ZUZpZWxkKSB7XHJcblxyXG4gICAgICBjb25zdCB7IGNoYW5nZWRGaWVsZCwgY2hhbmdlZEZpZWxkSW5kZXggfSA9IHRoaXMuZ2V0RmllbGQocHJvcGVydHkpO1xyXG5cclxuICAgICAgaWYgKGNoYW5nZWRGaWVsZC52YWxpZGF0ZSkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMudmFsaWRhdGVGaWVsZChjaGFuZ2VkRmllbGQsIGNoYW5nZWRGaWVsZEluZGV4LCB2aXNpYmxlRmllbGQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLnRyaWdnZXJWYWxpZGF0aW9uT25Gb3JtKGNoYW5nZWRGaWVsZEluZGV4KTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnByZXZpb3VzVmFsdWVbcHJvcGVydHldID0gdGhpcy52YWx1ZVtwcm9wZXJ0eV07XHJcbiAgfVxyXG5cclxuICB0cmFja0J5KGluZGV4KSB7XHJcbiAgICByZXR1cm4gaW5kZXg7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFwcGx5RmllbGRWYWxpZGF0aW9uKGluZGV4OiBudW1iZXIsIHZhbGlkYXRlZEZpZWxkOiBQb0R5bmFtaWNGb3JtRmllbGRWYWxpZGF0aW9uKSB7XHJcbiAgICBjb25zdCBmaWVsZCA9IHRoaXMuZmllbGRzW2luZGV4XTtcclxuXHJcbiAgICB0aGlzLmZpZWxkc1tpbmRleF0gPSB7IC4uLmZpZWxkLCAuLi52YWxpZGF0ZWRGaWVsZC5maWVsZCB9O1xyXG4gICAgdGhpcy51cGRhdGVGaWVsZHMoKTtcclxuXHJcbiAgICBpZiAodmFsaWRhdGVkRmllbGQuaGFzT3duUHJvcGVydHkoJ3ZhbHVlJykpIHtcclxuICAgICAgdGhpcy52YWx1ZVtmaWVsZC5wcm9wZXJ0eV0gPSB2YWxpZGF0ZWRGaWVsZC52YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNoYW5nZXMuZGV0ZWN0Q2hhbmdlcygpO1xyXG5cclxuICAgIGlmICh2YWxpZGF0ZWRGaWVsZC5mb2N1cykge1xyXG4gICAgICB0aGlzLmZvY3VzKGZpZWxkLnByb3BlcnR5KTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEZpZWxkKHByb3BlcnR5OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGNoYW5nZWRGaWVsZEluZGV4ID0gdGhpcy5maWVsZHMuZmluZEluZGV4KGZpZWxkID0+IGZpZWxkLnByb3BlcnR5ID09PSBwcm9wZXJ0eSk7XHJcbiAgICBjb25zdCBjaGFuZ2VkRmllbGQgPSB0aGlzLmZpZWxkc1tjaGFuZ2VkRmllbGRJbmRleF07XHJcblxyXG4gICAgcmV0dXJuIHsgY2hhbmdlZEZpZWxkLCBjaGFuZ2VkRmllbGRJbmRleCB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB0cmlnZ2VyVmFsaWRhdGlvbk9uRm9ybShjaGFuZ2VkRmllbGRJbmRleDogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBoYXNWYWxpZGF0aW9uRm9ybSA9IHRoaXMudmFsaWRhdGUgJiYgdGhpcy5mb3JtVmFsaWRhdGUub2JzZXJ2ZXJzLmxlbmd0aDtcclxuXHJcbiAgICBpZiAoaGFzVmFsaWRhdGlvbkZvcm0pIHtcclxuICAgICAgY29uc3QgdXBkYXRlZEZpZWxkID0gdGhpcy5maWVsZHNbY2hhbmdlZEZpZWxkSW5kZXhdO1xyXG4gICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5lbWl0KHVwZGF0ZWRGaWVsZCk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVGaWVsZHMoKSB7XHJcbiAgICB0aGlzLmZpZWxkc0NoYW5nZS5lbWl0KHRoaXMuZmllbGRzKTtcclxuICAgIHRoaXMudmlzaWJsZUZpZWxkcyA9IHRoaXMuZ2V0VmlzaWJsZUZpZWxkcygpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZUZpZWxkKGZpZWxkOiBQb0R5bmFtaWNGb3JtRmllbGQsIGZpZWxkSW5kZXg6IG51bWJlciwgdmlzaWJsZUZpZWxkOiBQb0R5bmFtaWNGb3JtRmllbGQpIHtcclxuICAgIGNvbnN0IHZhbHVlID0gdGhpcy52YWx1ZVtmaWVsZC5wcm9wZXJ0eV07XHJcblxyXG4gICAgY29uc3QgcHJldmlvdXNEaXNhYmxlZCA9IHZpc2libGVGaWVsZC5kaXNhYmxlZDtcclxuICAgIHZpc2libGVGaWVsZC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICB0aGlzLmNoYW5nZXMuZGV0ZWN0Q2hhbmdlcygpO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHZhbGlkYXRlZEZpZWxkID0gYXdhaXQgdGhpcy52YWxpZGF0aW9uU2VydmljZS5zZW5kRmllbGRDaGFuZ2UoZmllbGQsIHZhbHVlKS50b1Byb21pc2UoKTtcclxuICAgICAgdGhpcy5hcHBseUZpZWxkVmFsaWRhdGlvbihmaWVsZEluZGV4LCB2YWxpZGF0ZWRGaWVsZCk7XHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgdmlzaWJsZUZpZWxkLmRpc2FibGVkID0gcHJldmlvdXNEaXNhYmxlZDtcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcbiJdfQ==