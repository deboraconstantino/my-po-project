import * as tslib_1 from "tslib";
import { AfterContentInit, Component, OnChanges, OnDestroy, OnInit, Renderer2, SimpleChange, ViewChild, ViewContainerRef } from '@angular/core';
import { Router } from '@angular/router';
import { callFunction, isTypeof } from '../../../utils/util';
import { PoLanguageService } from './../../../services/po-language/po-language.service';
import { PoPageContentComponent } from '../po-page-content/po-page-content.component';
import { PoPageListBaseComponent } from './po-page-list-base.component';
/**
 * @docsExtends PoPageListBaseComponent
 *
 * @example
 *
 * <example name="po-page-list-basic" title="Portinari Page List Basic">
 *  <file name="sample-po-page-list-basic/sample-po-page-list-basic.component.html"> </file>
 *  <file name="sample-po-page-list-basic/sample-po-page-list-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-page-list-labs" title="Portinari Page List Labs">
 *  <file name="sample-po-page-list-labs/sample-po-page-list-labs.component.html"> </file>
 *  <file name="sample-po-page-list-labs/sample-po-page-list-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-page-list-hiring-processes" title="Portinari Page List - Hiring Processes">
 *  <file name="sample-po-page-list-hiring-processes/sample-po-page-list-hiring-processes.component.html"> </file>
 *  <file name="sample-po-page-list-hiring-processes/sample-po-page-list-hiring-processes.component.ts"> </file>
 *  <file name="sample-po-page-list-hiring-processes/sample-po-page-list-hiring-processes.service.ts"> </file>
 * </example>
 */
var PoPageListComponent = /** @class */ (function (_super) {
    tslib_1.__extends(PoPageListComponent, _super);
    function PoPageListComponent(viewRef, languageService, renderer, router) {
        var _this = _super.call(this, languageService) || this;
        _this.renderer = renderer;
        _this.router = router;
        _this.limitPrimaryActions = 3;
        _this.isRecalculate = true;
        _this.maxWidthMobile = 480;
        _this.callFunction = callFunction;
        _this.parentRef = viewRef['_view']['component'];
        _this.initializeListeners();
        return _this;
    }
    PoPageListComponent.prototype.ngOnInit = function () {
        this.advancedSearch = this.initializeFixedLiterals();
    };
    PoPageListComponent.prototype.ngAfterContentInit = function () {
        this.setIsMobile();
        this.setDropdownActions();
    };
    PoPageListComponent.prototype.ngOnChanges = function (changes) {
        this.setDropdownActions();
    };
    PoPageListComponent.prototype.ngOnDestroy = function () {
        this.removeListeners();
    };
    PoPageListComponent.prototype.actionIsDisabled = function (action) {
        return isTypeof(action.disabled, 'function') ? action.disabled(action) : action.disabled;
    };
    PoPageListComponent.prototype.callAction = function (item) {
        if (item.url) {
            this.router.navigate([item.url]);
        }
        else if (item.action) {
            callFunction(item.action, this.parentRef);
        }
    };
    PoPageListComponent.prototype.hasPageHeader = function () {
        return !!(this.title || (this.actions && this.actions.length) || (this.breadcrumb && this.breadcrumb.items.length));
    };
    PoPageListComponent.prototype.onResize = function (event) {
        var width = event.target.innerWidth;
        if (width < this.maxWidthMobile) {
            this.isMobile = true;
            this.limitPrimaryActions = 2;
            this.setDropdownActions();
        }
        else {
            this.isMobile = false;
            this.limitPrimaryActions = 3;
            this.setDropdownActions();
        }
    };
    PoPageListComponent.prototype.setIsMobile = function () {
        if (window.innerWidth < this.maxWidthMobile) {
            this.isMobile = true;
            this.limitPrimaryActions = 2;
        }
    };
    PoPageListComponent.prototype.setDropdownActions = function () {
        if (this.actions.length > this.limitPrimaryActions) {
            this.dropdownActions = this.actions.slice(this.limitPrimaryActions - 1);
        }
    };
    PoPageListComponent.prototype.callActionFilter = function (field) {
        this.callFunction(this.filter[field], this.parentRef);
    };
    PoPageListComponent.prototype.onkeypress = function (key) {
        if (key === 13) {
            this.callActionFilter('action');
        }
    };
    PoPageListComponent.prototype.changeModel = function (newModel) {
        this.parentRef[this.filter.ngModel] = newModel;
    };
    // Recebe evento change do disclaimer e recalcula tela
    PoPageListComponent.prototype.onChangeDisclaimerGroup = function (disclaimers) {
        if ((disclaimers && disclaimers.length && this.isRecalculate) || (disclaimers.length === 0 && !this.isRecalculate)) {
            this.poPageContent.recalculateHeaderSize();
            this.isRecalculate = !this.isRecalculate;
        }
        if (this.disclaimerGroup && this.disclaimerGroup.change) {
            this.disclaimerGroup.change(disclaimers);
        }
    };
    PoPageListComponent.prototype.initializeFixedLiterals = function () {
        var literal = {
            pt: {
                advancedSearch: 'Busca avançada'
            },
            en: {
                advancedSearch: 'Advanced search'
            },
            es: {
                advancedSearch: 'Búsqueda avanzada'
            }
        };
        return literal[this.language].advancedSearch;
    };
    PoPageListComponent.prototype.initializeListeners = function () {
        var _this = this;
        this.resizeListener = this.renderer.listen('window', 'resize', function (event) {
            _this.onResize(event);
        });
    };
    PoPageListComponent.prototype.removeListeners = function () {
        this.resizeListener();
    };
    PoPageListComponent.ctorParameters = function () { return [
        { type: ViewContainerRef },
        { type: PoLanguageService },
        { type: Renderer2 },
        { type: Router }
    ]; };
    tslib_1.__decorate([
        ViewChild(PoPageContentComponent, { static: true }),
        tslib_1.__metadata("design:type", PoPageContentComponent)
    ], PoPageListComponent.prototype, "poPageContent", void 0);
    PoPageListComponent = tslib_1.__decorate([
        Component({
            selector: 'po-page-list',
            template: "<po-page>\n\n  <!-- HEADER -->\n  <po-page-header\n    *ngIf=\"hasPageHeader()\"\n    [class.po-page-list-header-padding]=\"filter && !actions.length\"\n    [p-breadcrumb]=\"breadcrumb\"\n    [p-title]=\"title\">\n\n    <!-- OPERATIONS -->\n    <div class=\"po-page-list-operations\">\n      <div class=\"po-page-list-actions\"\n        [class.po-page-list-actions-padding]=\"filter\">\n        <po-button *ngIf=\"actions[0]\"\n          p-type=\"primary\"\n          [p-disabled]=\"actionIsDisabled(actions[0])\"\n          [p-icon]=\"actions[0].icon\"\n          [p-label]=\"actions[0].label\"\n          (p-click)=\"callAction(actions[0])\">\n        </po-button>\n\n        <po-button *ngIf=\"actions[1] && (actions.length === 2 || !isMobile)\"\n          [p-disabled]=\"actionIsDisabled(actions[1])\"\n          [p-label]=\"actions[1].label\"\n          (p-click)=\"callAction(actions[1])\">\n        </po-button>\n\n        <po-button *ngIf=\"actions.length == 3 && actions[2] && !isMobile\"\n          [p-disabled]=\"actionIsDisabled(actions[2])\"\n          [p-label]=\"actions[2].label\"\n          (p-click)=\"callAction(actions[2])\">\n        </po-button>\n\n        <po-dropdown *ngIf=\"actions.length > limitPrimaryActions\"\n          [p-actions]=\"dropdownActions\"\n          [p-label]=\"literals.otherActions\">\n        </po-dropdown>\n      </div>\n\n      <!-- FILTER -->\n      <div class=\"po-page-list-filter-wrapper\" *ngIf=\"filter\">\n\n        <div class=\"po-field-container-content po-page-filter-content\">\n          <div class=\"po-field-icon-container-right\">\n            <span class=\"po-icon po-icon-search po-field-icon\"\n              (click)=\"callActionFilter('action')\">\n            </span>\n          </div>\n\n          <input class=\"po-input po-input-icon-right\"\n            name=\"model\"\n            type=\"text\"\n            [ngModel]=\"parentRef[filter.ngModel]\"\n            [placeholder]=\"filter.placeholder || ''\"\n            (keypress)=\"onkeypress($event.keyCode)\"\n            (ngModelChange)=\"changeModel($event)\">\n        </div>\n\n        <div class=\"po-page-list-filter-search\" *ngIf=\"filter.advancedAction\">\n          <span class=\"po-page-list-filter-search-link\"\n            tabindex=\"0\"\n            (click)=\"callActionFilter('advancedAction')\"\n            (keydown.enter)=\"callActionFilter('advancedAction')\">\n              {{advancedSearch}}\n          </span>\n        </div>\n\n      </div>\n    </div>\n\n    <!-- DISCLAIMER -->\n    <po-disclaimer-group *ngIf=\"!!disclaimerGroup\"\n      [class.po-page-list-disclaimer-group]=\"!!disclaimerGroup?.disclaimers?.length\"\n      [p-disclaimers]=\"disclaimerGroup?.disclaimers\"\n      [p-hide-remove-all]=\"disclaimerGroup?.hideRemoveAll\"\n      [p-title]=\"disclaimerGroup?.title\"\n      (p-change)=\"onChangeDisclaimerGroup($event)\">\n    </po-disclaimer-group>\n\n  </po-page-header>\n\n  <!-- CONTENT -->\n  <po-page-content>\n    <ng-content></ng-content>\n  </po-page-content>\n\n</po-page>\n"
        }),
        tslib_1.__metadata("design:paramtypes", [ViewContainerRef,
            PoLanguageService,
            Renderer2,
            Router])
    ], PoPageListComponent);
    return PoPageListComponent;
}(PoPageListBaseComponent));
export { PoPageListComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcGFnZS1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tcGFnZS9wby1wYWdlLWxpc3QvcG8tcGFnZS1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLGdCQUFnQixFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFDaEgsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRXpDLE9BQU8sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scURBQXFELENBQUM7QUFJeEYsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sOENBQThDLENBQUM7QUFDdEYsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFFeEU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBb0JHO0FBS0g7SUFBeUMsK0NBQXVCO0lBZTlELDZCQUNFLE9BQXlCLEVBQ3pCLGVBQWtDLEVBQzNCLFFBQW1CLEVBQ2xCLE1BQWM7UUFKeEIsWUFNRSxrQkFBTSxlQUFlLENBQUMsU0FHdkI7UUFOUSxjQUFRLEdBQVIsUUFBUSxDQUFXO1FBQ2xCLFlBQU0sR0FBTixNQUFNLENBQVE7UUFkeEIseUJBQW1CLEdBQVcsQ0FBQyxDQUFDO1FBR3hCLG1CQUFhLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLG9CQUFjLEdBQVcsR0FBRyxDQUFDO1FBRXJDLGtCQUFZLEdBQUcsWUFBWSxDQUFDO1FBVzFCLEtBQUksQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFdBQVcs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QSxpQkFJQztRQUhDLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxVQUFDLEtBQWlCO1lBQy9FLEtBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU8sNkNBQWUsR0FBdkI7UUFDRSxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDeEIsQ0FBQzs7Z0JBeEhVLGdCQUFnQjtnQkFDUixpQkFBaUI7Z0JBQ2pCLFNBQVM7Z0JBQ1YsTUFBTTs7SUFONkI7UUFBcEQsU0FBUyxDQUFDLHNCQUFzQixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDOzBDQUFnQixzQkFBc0I7OERBQUM7SUFiaEYsbUJBQW1CO1FBSi9CLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxjQUFjO1lBQ3hCLHMvRkFBNEM7U0FDN0MsQ0FBQztpREFpQlcsZ0JBQWdCO1lBQ1IsaUJBQWlCO1lBQ2pCLFNBQVM7WUFDVixNQUFNO09BbkJiLG1CQUFtQixDQTBJL0I7SUFBRCwwQkFBQztDQUFBLEFBMUlELENBQXlDLHVCQUF1QixHQTBJL0Q7U0ExSVksbUJBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJDb250ZW50SW5pdCwgQ29tcG9uZW50LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT25Jbml0LCBSZW5kZXJlcjIsIFNpbXBsZUNoYW5nZSwgVmlld0NoaWxkLCBWaWV3Q29udGFpbmVyUmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcblxuaW1wb3J0IHsgY2FsbEZ1bmN0aW9uLCBpc1R5cGVvZiB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3V0aWwnO1xuaW1wb3J0IHsgUG9MYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuLy4uLy4uLy4uL3NlcnZpY2VzL3BvLWxhbmd1YWdlL3BvLWxhbmd1YWdlLnNlcnZpY2UnO1xuXG5pbXBvcnQgeyBQb1BhZ2VBY3Rpb24gfSBmcm9tICcuLi9wby1wYWdlLWFjdGlvbi5pbnRlcmZhY2UnO1xuXG5pbXBvcnQgeyBQb1BhZ2VDb250ZW50Q29tcG9uZW50IH0gZnJvbSAnLi4vcG8tcGFnZS1jb250ZW50L3BvLXBhZ2UtY29udGVudC5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9QYWdlTGlzdEJhc2VDb21wb25lbnQgfSBmcm9tICcuL3BvLXBhZ2UtbGlzdC1iYXNlLmNvbXBvbmVudCc7XG5cbi8qKlxuICogQGRvY3NFeHRlbmRzIFBvUGFnZUxpc3RCYXNlQ29tcG9uZW50XG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tcGFnZS1saXN0LWJhc2ljXCIgdGl0bGU9XCJQb3J0aW5hcmkgUGFnZSBMaXN0IEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wYWdlLWxpc3QtYmFzaWMvc2FtcGxlLXBvLXBhZ2UtbGlzdC1iYXNpYy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wYWdlLWxpc3QtYmFzaWMvc2FtcGxlLXBvLXBhZ2UtbGlzdC1iYXNpYy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1wYWdlLWxpc3QtbGFic1wiIHRpdGxlPVwiUG9ydGluYXJpIFBhZ2UgTGlzdCBMYWJzXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wYWdlLWxpc3QtbGFicy9zYW1wbGUtcG8tcGFnZS1saXN0LWxhYnMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tcGFnZS1saXN0LWxhYnMvc2FtcGxlLXBvLXBhZ2UtbGlzdC1sYWJzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXBhZ2UtbGlzdC1oaXJpbmctcHJvY2Vzc2VzXCIgdGl0bGU9XCJQb3J0aW5hcmkgUGFnZSBMaXN0IC0gSGlyaW5nIFByb2Nlc3Nlc1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tcGFnZS1saXN0LWhpcmluZy1wcm9jZXNzZXMvc2FtcGxlLXBvLXBhZ2UtbGlzdC1oaXJpbmctcHJvY2Vzc2VzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXBhZ2UtbGlzdC1oaXJpbmctcHJvY2Vzc2VzL3NhbXBsZS1wby1wYWdlLWxpc3QtaGlyaW5nLXByb2Nlc3Nlcy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tcGFnZS1saXN0LWhpcmluZy1wcm9jZXNzZXMvc2FtcGxlLXBvLXBhZ2UtbGlzdC1oaXJpbmctcHJvY2Vzc2VzLnNlcnZpY2UudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby1wYWdlLWxpc3QnLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tcGFnZS1saXN0LmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBQb1BhZ2VMaXN0Q29tcG9uZW50IGV4dGVuZHMgUG9QYWdlTGlzdEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRJbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT25Jbml0IHtcblxuICBhZHZhbmNlZFNlYXJjaDogc3RyaW5nO1xuICBkcm9wZG93bkFjdGlvbnM6IEFycmF5PFBvUGFnZUFjdGlvbj47XG4gIGlzTW9iaWxlOiBib29sZWFuO1xuICBsaW1pdFByaW1hcnlBY3Rpb25zOiBudW1iZXIgPSAzO1xuICBwYXJlbnRSZWY6IFZpZXdDb250YWluZXJSZWY7XG5cbiAgcHJpdmF0ZSBpc1JlY2FsY3VsYXRlID0gdHJ1ZTtcbiAgcHJpdmF0ZSBtYXhXaWR0aE1vYmlsZTogbnVtYmVyID0gNDgwO1xuXG4gIGNhbGxGdW5jdGlvbiA9IGNhbGxGdW5jdGlvbjtcblxuICBAVmlld0NoaWxkKFBvUGFnZUNvbnRlbnRDb21wb25lbnQsIHsgc3RhdGljOiB0cnVlIH0pIHBvUGFnZUNvbnRlbnQ6IFBvUGFnZUNvbnRlbnRDb21wb25lbnQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgdmlld1JlZjogVmlld0NvbnRhaW5lclJlZixcbiAgICBsYW5ndWFnZVNlcnZpY2U6IFBvTGFuZ3VhZ2VTZXJ2aWNlLFxuICAgIHB1YmxpYyByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIpIHtcblxuICAgIHN1cGVyKGxhbmd1YWdlU2VydmljZSk7XG4gICAgdGhpcy5wYXJlbnRSZWYgPSB2aWV3UmVmWydfdmlldyddWydjb21wb25lbnQnXTtcbiAgICB0aGlzLmluaXRpYWxpemVMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuYWR2YW5jZWRTZWFyY2ggPSB0aGlzLmluaXRpYWxpemVGaXhlZExpdGVyYWxzKCk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5zZXRJc01vYmlsZSgpO1xuICAgIHRoaXMuc2V0RHJvcGRvd25BY3Rpb25zKCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiB7W3Byb3BOYW1lOiBzdHJpbmddOiBTaW1wbGVDaGFuZ2V9KSB7XG4gICAgdGhpcy5zZXREcm9wZG93bkFjdGlvbnMoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMucmVtb3ZlTGlzdGVuZXJzKCk7XG4gIH1cblxuICBhY3Rpb25Jc0Rpc2FibGVkKGFjdGlvbjogYW55KSB7XG4gICAgcmV0dXJuIGlzVHlwZW9mKGFjdGlvbi5kaXNhYmxlZCwgJ2Z1bmN0aW9uJykgPyBhY3Rpb24uZGlzYWJsZWQoYWN0aW9uKSA6IGFjdGlvbi5kaXNhYmxlZDtcbiAgfVxuXG4gIGNhbGxBY3Rpb24oaXRlbTogUG9QYWdlQWN0aW9uKTogdm9pZCB7XG4gICAgaWYgKGl0ZW0udXJsKSB7XG4gICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbaXRlbS51cmxdKTtcbiAgICB9IGVsc2UgaWYgKGl0ZW0uYWN0aW9uKSB7XG4gICAgICBjYWxsRnVuY3Rpb24oaXRlbS5hY3Rpb24sIHRoaXMucGFyZW50UmVmKTtcbiAgICB9XG4gIH1cblxuICBoYXNQYWdlSGVhZGVyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAgISEodGhpcy50aXRsZSB8fCAodGhpcy5hY3Rpb25zICYmIHRoaXMuYWN0aW9ucy5sZW5ndGgpIHx8ICh0aGlzLmJyZWFkY3J1bWIgJiYgdGhpcy5icmVhZGNydW1iLml0ZW1zLmxlbmd0aCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBvblJlc2l6ZShldmVudDogRXZlbnQpOiB2b2lkIHtcbiAgICBjb25zdCB3aWR0aCA9IChldmVudC50YXJnZXQgYXMgV2luZG93KS5pbm5lcldpZHRoO1xuXG4gICAgaWYgKHdpZHRoIDwgdGhpcy5tYXhXaWR0aE1vYmlsZSkge1xuICAgICAgdGhpcy5pc01vYmlsZSA9IHRydWU7XG4gICAgICB0aGlzLmxpbWl0UHJpbWFyeUFjdGlvbnMgPSAyO1xuICAgICAgdGhpcy5zZXREcm9wZG93bkFjdGlvbnMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5pc01vYmlsZSA9IGZhbHNlO1xuICAgICAgdGhpcy5saW1pdFByaW1hcnlBY3Rpb25zID0gMztcbiAgICAgIHRoaXMuc2V0RHJvcGRvd25BY3Rpb25zKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRJc01vYmlsZSgpOiB2b2lkIHtcbiAgICBpZiAod2luZG93LmlubmVyV2lkdGggPCB0aGlzLm1heFdpZHRoTW9iaWxlKSB7XG4gICAgICB0aGlzLmlzTW9iaWxlID0gdHJ1ZTtcbiAgICAgIHRoaXMubGltaXRQcmltYXJ5QWN0aW9ucyA9IDI7XG4gICAgfVxuICB9XG5cbiAgc2V0RHJvcGRvd25BY3Rpb25zKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmFjdGlvbnMubGVuZ3RoID4gdGhpcy5saW1pdFByaW1hcnlBY3Rpb25zKSB7XG4gICAgICB0aGlzLmRyb3Bkb3duQWN0aW9ucyA9IHRoaXMuYWN0aW9ucy5zbGljZSh0aGlzLmxpbWl0UHJpbWFyeUFjdGlvbnMgLSAxKTtcbiAgICB9XG4gIH1cblxuICBjYWxsQWN0aW9uRmlsdGVyKGZpZWxkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmNhbGxGdW5jdGlvbih0aGlzLmZpbHRlcltmaWVsZF0sIHRoaXMucGFyZW50UmVmKTtcbiAgfVxuXG4gIG9ua2V5cHJlc3Moa2V5KSB7XG4gICAgaWYgKGtleSA9PT0gMTMpIHtcbiAgICAgIHRoaXMuY2FsbEFjdGlvbkZpbHRlcignYWN0aW9uJyk7XG4gICAgfVxuICB9XG5cbiAgY2hhbmdlTW9kZWwobmV3TW9kZWwpOiB2b2lkIHtcbiAgICB0aGlzLnBhcmVudFJlZlt0aGlzLmZpbHRlci5uZ01vZGVsXSA9IG5ld01vZGVsO1xuICB9XG5cbiAgLy8gUmVjZWJlIGV2ZW50byBjaGFuZ2UgZG8gZGlzY2xhaW1lciBlIHJlY2FsY3VsYSB0ZWxhXG4gIG9uQ2hhbmdlRGlzY2xhaW1lckdyb3VwKGRpc2NsYWltZXJzKSB7XG4gICAgaWYgKChkaXNjbGFpbWVycyAmJiBkaXNjbGFpbWVycy5sZW5ndGggJiYgdGhpcy5pc1JlY2FsY3VsYXRlKSB8fCAoZGlzY2xhaW1lcnMubGVuZ3RoID09PSAwICYmICF0aGlzLmlzUmVjYWxjdWxhdGUpKSB7XG4gICAgICB0aGlzLnBvUGFnZUNvbnRlbnQucmVjYWxjdWxhdGVIZWFkZXJTaXplKCk7XG4gICAgICB0aGlzLmlzUmVjYWxjdWxhdGUgPSAhdGhpcy5pc1JlY2FsY3VsYXRlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmRpc2NsYWltZXJHcm91cCAmJiB0aGlzLmRpc2NsYWltZXJHcm91cC5jaGFuZ2UpIHtcbiAgICAgIHRoaXMuZGlzY2xhaW1lckdyb3VwLmNoYW5nZShkaXNjbGFpbWVycyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplRml4ZWRMaXRlcmFscygpIHtcbiAgICBjb25zdCBsaXRlcmFsID0ge1xuICAgICAgcHQ6IHtcbiAgICAgICAgYWR2YW5jZWRTZWFyY2g6ICdCdXNjYSBhdmFuw6dhZGEnXG4gICAgICB9LFxuICAgICAgZW46IHtcbiAgICAgICAgYWR2YW5jZWRTZWFyY2g6ICdBZHZhbmNlZCBzZWFyY2gnXG4gICAgICB9LFxuICAgICAgZXM6IHtcbiAgICAgICAgYWR2YW5jZWRTZWFyY2g6ICdCw7pzcXVlZGEgYXZhbnphZGEnXG4gICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiBsaXRlcmFsW3RoaXMubGFuZ3VhZ2VdLmFkdmFuY2VkU2VhcmNoO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplTGlzdGVuZXJzKCkge1xuICAgIHRoaXMucmVzaXplTGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbignd2luZG93JywgJ3Jlc2l6ZScsIChldmVudDogTW91c2VFdmVudCkgPT4ge1xuICAgICAgdGhpcy5vblJlc2l6ZShldmVudCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUxpc3RlbmVycygpIHtcbiAgICB0aGlzLnJlc2l6ZUxpc3RlbmVyKCk7XG4gIH1cblxufVxuIl19