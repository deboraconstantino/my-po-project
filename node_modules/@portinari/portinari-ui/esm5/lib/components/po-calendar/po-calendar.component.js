import * as tslib_1 from "tslib";
import { Component, forwardRef } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { PoCalendarBaseComponent } from './po-calendar-base.component';
import { PoCalendarLangService } from './services/po-calendar.lang.service';
import { PoCalendarService } from './services/po-calendar.service';
import { PoDateService } from '../../services/po-date/po-date.service';
/**
 * @docsExtends PoCalendarBaseComponent
 *
 * @example
 *
 * <example name="po-calendar-basic" title="Portinari Calendar Basic" >
 *  <file name="sample-po-calendar-basic/sample-po-calendar-basic.component.html"> </file>
 *  <file name="sample-po-calendar-basic/sample-po-calendar-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-calendar-labs" title="Portinari Calendar Labs" >
 *  <file name="sample-po-calendar-labs/sample-po-calendar-labs.component.html"> </file>
 *  <file name="sample-po-calendar-labs/sample-po-calendar-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-calendar-ticket-sales" title="Portinari Calendar - Ticket Sales" >
 *  <file name="sample-po-calendar-ticket-sales/sample-po-calendar-ticket-sales.component.html"> </file>
 *  <file name="sample-po-calendar-ticket-sales/sample-po-calendar-ticket-sales.component.ts"> </file>
 * </example>
 */
var PoCalendarComponent = /** @class */ (function (_super) {
    tslib_1.__extends(PoCalendarComponent, _super);
    function PoCalendarComponent(poCalendarService, poCalendarLangService, poDate) {
        var _this = _super.call(this, poDate, poCalendarLangService) || this;
        _this.poCalendarService = poCalendarService;
        return _this;
    }
    PoCalendarComponent_1 = PoCalendarComponent;
    PoCalendarComponent.prototype.ngOnInit = function () {
        this.init();
    };
    PoCalendarComponent.prototype.getBackgroundColor = function (displayValue, propertyValue) {
        return (displayValue === propertyValue) ? 'po-calendar-box-background-selected' : 'po-calendar-box-background';
    };
    PoCalendarComponent.prototype.getDayBackgroundColor = function (date) {
        return this.getDayColor(date, 'background');
    };
    PoCalendarComponent.prototype.getDayForegroundColor = function (date) {
        return this.getDayColor(date, 'foreground');
    };
    PoCalendarComponent.prototype.getForegroundColor = function (displayValue, propertyValue) {
        return (displayValue === propertyValue) ? 'po-calendar-box-foreground-selected' : 'po-calendar-box-foreground';
    };
    PoCalendarComponent.prototype.getMonthLabel = function () {
        return this.poCalendarLangService.getMonthLabel();
    };
    PoCalendarComponent.prototype.getYearLabel = function () {
        return this.poCalendarLangService.getYearLabel();
    };
    PoCalendarComponent.prototype.onNextMonth = function () {
        this.displayMonthNumber < 11 ? this.updateDisplay(this.displayYear, this.displayMonthNumber + 1) :
            this.updateDisplay(this.displayYear + 1, 0);
    };
    PoCalendarComponent.prototype.onPreviousMonth = function () {
        this.displayMonthNumber > 0 ? this.updateDisplay(this.displayYear, this.displayMonthNumber - 1) :
            this.updateDisplay(this.displayYear - 1, 11);
    };
    // Ao selecionar uma data
    PoCalendarComponent.prototype.onSelectDate = function (date) {
        this.date = date;
        this.dateIso = this.poDate.convertDateToISO(date);
        if (this.propagateChange) {
            this.propagateChange(this.dateIso);
        }
        this.change.emit(this.dateIso);
    };
    // Ao selecionar um mês
    PoCalendarComponent.prototype.onSelectMonth = function (year, month) {
        this.selectDay();
        this.updateDisplay(year, month);
    };
    // Ao selecionar um ano
    PoCalendarComponent.prototype.onSelectYear = function (year, month) {
        // Se veio da tela de seleção de mês
        this.lastDisplay === 'month' ? this.selectMonth() : this.selectDay();
        this.currentYear = year;
        this.updateDisplay(year, month);
    };
    PoCalendarComponent.prototype.registerOnChange = function (fn) {
        this.propagateChange = fn;
    };
    PoCalendarComponent.prototype.registerOnTouched = function (func) {
        this.onTouched = func;
    };
    PoCalendarComponent.prototype.registerOnValidatorChange = function (fn) {
        this.validatorChange = fn;
    };
    PoCalendarComponent.prototype.selectDay = function () {
        this.dayVisible = true;
        this.monthVisible = false;
        this.yearVisible = false;
        this.lastDisplay = 'day';
    };
    PoCalendarComponent.prototype.selectMonth = function () {
        this.dayVisible = false;
        this.monthVisible = true;
        this.yearVisible = false;
        this.lastDisplay = 'month';
    };
    PoCalendarComponent.prototype.selectYear = function () {
        this.dayVisible = false;
        this.monthVisible = false;
        this.yearVisible = true;
    };
    PoCalendarComponent.prototype.updateYear = function (value) {
        this.updateDisplay(this.displayYear + value, this.displayMonthNumber);
    };
    PoCalendarComponent.prototype.validateModel = function (model) {
        if (this.validatorChange) {
            this.validatorChange(model);
        }
    };
    PoCalendarComponent.prototype.validate = function (c) {
        return null;
    };
    PoCalendarComponent.prototype.writeValue = function (value) {
        if (value) {
            this.writeDate(value);
        }
        else {
            this.date = undefined;
            this.updateDate(this.today);
        }
    };
    PoCalendarComponent.prototype.addAllYearsInDecade = function (year) {
        var i;
        for (i = year; i < year + 10; i++) {
            this.displayDecade.push(i);
        }
    };
    PoCalendarComponent.prototype.equalsDate = function (date1, date2) {
        try {
            return date1.getFullYear() === date2.getFullYear() &&
                date1.getMonth() === date2.getMonth() &&
                date1.getDate() === date2.getDate();
        }
        catch (error) {
            return false;
        }
    };
    // Obtém um array de todos os anos desta década
    PoCalendarComponent.prototype.getDecadeArray = function (year) {
        this.displayDecade = Array();
        if (year % 10 !== 0) {
            while (year % 10 !== 0) {
                year--;
            }
        }
        this.updateDecade(year);
    };
    PoCalendarComponent.prototype.getColorForDate = function (date, local) {
        return this.poDate.validateDateRange(date, this.minDate, this.maxDate) ? "po-calendar-box-" + local + "-selected" :
            "po-calendar-box-" + local + "-selected-disabled";
    };
    PoCalendarComponent.prototype.getColorForDateRange = function (date, local) {
        return this.poDate.validateDateRange(date, this.minDate, this.maxDate) ? "po-calendar-box-" + local :
            "po-calendar-box-" + local + "-disabled";
    };
    PoCalendarComponent.prototype.getColorForToday = function (date, local) {
        return this.poDate.validateDateRange(date, this.minDate, this.maxDate) ? "po-calendar-box-" + local + "-today" :
            "po-calendar-box-" + local + "-today-disabled";
    };
    PoCalendarComponent.prototype.getDayColor = function (date, local) {
        if (this.equalsDate(date, this.date)) {
            return this.getColorForDate(date, local);
        }
        else if (this.equalsDate(date, this.today)) {
            return this.getColorForToday(date, local);
        }
        else {
            return this.getColorForDateRange(date, local);
        }
    };
    PoCalendarComponent.prototype.init = function () {
        this.date && this.poDate.isValidIso(this.poDate.convertDateToISO(this.date)) ?
            this.updateDate(this.date) : this.updateDate(this.today);
        this.initializeLanguage();
        this.selectDay();
    };
    PoCalendarComponent.prototype.selectDateFromDate = function (date) {
        this.date = date;
        this.onSelectDate(this.date);
    };
    PoCalendarComponent.prototype.selectDateFromIso = function (stringDate) {
        var _a = this.poDate.getDateFromIso(stringDate), year = _a.year, month = _a.month, day = _a.day;
        var date = new Date(year, month - 1, day);
        this.poDate.setYearFrom0To100(date, year);
        this.date = date;
        this.onSelectDate(this.date);
    };
    PoCalendarComponent.prototype.updateDate = function (date) {
        if (date) {
            this.currentMonthNumber = date.getMonth();
            this.currentYear = date.getFullYear();
            this.updateDisplay(this.currentYear, this.currentMonthNumber);
        }
    };
    PoCalendarComponent.prototype.updateDecade = function (year) {
        this.addAllYearsInDecade(year);
        this.displayStartDecade = year;
        this.displayFinalDecade = year + 9;
    };
    PoCalendarComponent.prototype.updateDisplay = function (year, month) {
        var calendarArray = this.poCalendarService.monthDays(year, month);
        this.displayDays = [].concat.apply([], calendarArray);
        this.displayMonthNumber = month;
        this.displayMonth = this.displayMonths[month];
        this.displayYear = year;
        this.getDecadeArray(year);
    };
    PoCalendarComponent.prototype.writeDate = function (value) {
        value instanceof Date ? this.selectDateFromDate(value) : this.writeDateIso(value);
        this.updateDate(this.date);
    };
    PoCalendarComponent.prototype.writeDateIso = function (value) {
        this.poDate.isValidIso(value) ? this.selectDateFromIso(value) : this.date = undefined;
    };
    var PoCalendarComponent_1;
    PoCalendarComponent.ctorParameters = function () { return [
        { type: PoCalendarService },
        { type: PoCalendarLangService },
        { type: PoDateService }
    ]; };
    PoCalendarComponent = PoCalendarComponent_1 = tslib_1.__decorate([
        Component({
            selector: 'po-calendar',
            template: "<div class=\"po-calendar\">\n  <div *ngIf=\"dayVisible\">\n    <div class=\"po-calendar-nav\">\n      <span class=\"po-calendar-nav-left po-icon po-icon-arrow-left\" (click)=\"onPreviousMonth()\"></span>\n      <div class=\"po-calendar-nav-title\" attr-calendar>\n        <span class=\"po-clickable po-mr-1\" (click)=\"selectMonth()\">{{ displayMonth }}</span>\n        <span class=\"po-clickable\" (click)=\"selectYear()\">{{ displayYear }}</span>\n      </div>\n      <span class=\"po-calendar-nav-right po-icon po-icon-arrow-right\" (click)=\"onNextMonth()\"></span>\n    </div>\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\" *ngFor=\"let day of displayWeekDays\">\n            {{ day.toLowerCase() }}\n        </div>\n      </div>\n      <div class=\"po-calendar-content-list-day\">\n        <div *ngFor=\"let day of displayDays\"\n          class=\"po-calendar-day\"\n          [ngClass]=\"getDayBackgroundColor(day)\"\n          (click)=\"onSelectDate(day)\">\n          <span *ngIf=\"day != 0\" [ngClass]=\"getDayForegroundColor(day)\">\n            {{ day.getDate() }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div *ngIf=\"monthVisible\">\n    <div class=\"po-calendar-nav\">\n      <span class=\"po-calendar-nav-left po-icon po-icon-arrow-left\" (click)=\"updateYear(-1)\"></span>\n      <div class=\"po-calendar-nav-title\" attr-calendar>\n        <span class=\"po-clickable\" (click)=\"selectYear()\">{{ displayYear }}</span>\n      </div>\n      <span class=\"po-calendar-nav-right po-icon po-icon-arrow-right\" (click)=\"updateYear(1)\"></span>\n    </div>\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\">\n          {{ getMonthLabel() }}\n        </div>\n      </div>\n      <div class=\"po-calendar-content-list-month\">\n        <div *ngFor=\"let month of displayMonths; let i = index;\" class=\"po-calendar-month\"\n          [ngClass]=\"getBackgroundColor(i, displayMonthNumber)\"\n          (click)=\"onSelectMonth(displayYear, i)\" attr-calendar>\n          <span [ngClass]=\"getForegroundColor(i, displayMonthNumber)\">\n            {{ month }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div *ngIf=\"yearVisible\">\n    <div class=\"po-calendar-nav\">\n      <span class=\"po-calendar-nav-left po-icon po-icon-arrow-left\" (click)=\"updateYear(-10)\"></span>\n      <div class=\"po-calendar-nav-title\">\n        {{ displayStartDecade }} - {{ displayFinalDecade }}\n      </div>\n      <span class=\"po-calendar-nav-right po-icon po-icon-arrow-right\" (click)=\"updateYear(10)\"></span>\n    </div>\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\">\n          {{ getYearLabel() }}\n        </div>\n      </div>\n      <div class=\"po-calendar-content-list-year\">\n        <div *ngFor=\"let year of displayDecade; let i = index;\" class=\"po-calendar-year\"\n          [ngClass]=\"getBackgroundColor(year, currentYear)\"\n          (click)=\"onSelectYear(year, displayMonthNumber)\"attr-calendar>\n          <span [ngClass]=\"getForegroundColor(year, currentYear)\">\n            {{ year }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\n",
            providers: [
                PoCalendarService,
                PoCalendarLangService,
                {
                    provide: NG_VALUE_ACCESSOR,
                    useExisting: forwardRef(function () { return PoCalendarComponent_1; }),
                    multi: true,
                },
                {
                    provide: NG_VALIDATORS,
                    useExisting: forwardRef(function () { return PoCalendarComponent_1; }),
                    multi: true,
                }
            ]
        }),
        tslib_1.__metadata("design:paramtypes", [PoCalendarService,
            PoCalendarLangService,
            PoDateService])
    ], PoCalendarComponent);
    return PoCalendarComponent;
}(PoCalendarBaseComponent));
export { PoCalendarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvcnRpbmFyaS9wb3J0aW5hcmktdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wby1jYWxlbmRhci9wby1jYWxlbmRhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBQzlELE9BQU8sRUFBbUIsYUFBYSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFbkYsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDdkUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDNUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDbkUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBRXZFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBbUJHO0FBbUJIO0lBQXlDLCtDQUF1QjtJQUU5RCw2QkFDVSxpQkFBb0MsRUFDNUMscUJBQTRDLEVBQzVDLE1BQXFCO1FBSHZCLFlBSUUsa0JBQU0sTUFBTSxFQUFFLHFCQUFxQixDQUFDLFNBQ3JDO1FBSlMsdUJBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjs7SUFJOUMsQ0FBQzs0QkFQVSxtQkFBbUI7SUFTOUIsc0NBQVEsR0FBUjtRQUNFLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNkLENBQUM7SUFFRCxnREFBa0IsR0FBbEIsVUFBbUIsWUFBb0IsRUFBRSxhQUFxQjtRQUM1RCxPQUFPLENBQUMsWUFBWSxLQUFLLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDLENBQUMsNEJBQTRCLENBQUM7SUFDakgsQ0FBQztJQUVELG1EQUFxQixHQUFyQixVQUFzQixJQUFVO1FBQzlCLE9BQU8sSUFBSSxD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QVksR0FBcEIsVUFBcUIsS0FBVTtRQUM3QixJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQztJQUN4RixDQUFDOzs7Z0JBcE80QixpQkFBaUI7Z0JBQ3JCLHFCQUFxQjtnQkFDcEMsYUFBYTs7SUFMWixtQkFBbUI7UUFsQi9CLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxhQUFhO1lBQ3ZCLDAwR0FBMkM7WUFDM0MsU0FBUyxFQUFFO2dCQUNULGlCQUFpQjtnQkFDakIscUJBQXFCO2dCQUNyQjtvQkFDRSxPQUFPLEVBQUUsaUJBQWlCO29CQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLGNBQU0sT0FBQSxxQkFBbUIsRUFBbkIsQ0FBbUIsQ0FBQztvQkFDbEQsS0FBSyxFQUFFLElBQUk7aUJBQ1o7Z0JBQ0Q7b0JBQ0UsT0FBTyxFQUFFLGFBQWE7b0JBQ3RCLFdBQVcsRUFBRSxVQUFVLENBQUMsY0FBTSxPQUFBLHFCQUFtQixFQUFuQixDQUFtQixDQUFDO29CQUNsRCxLQUFLLEVBQUUsSUFBSTtpQkFDWjthQUNGO1NBQ0YsQ0FBQztpREFJNkIsaUJBQWlCO1lBQ3JCLHFCQUFxQjtZQUNwQyxhQUFhO09BTFosbUJBQW1CLENBeU8vQjtJQUFELDBCQUFDO0NBQUEsQUF6T0QsQ0FBeUMsdUJBQXVCLEdBeU8vRDtTQXpPWSxtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIGZvcndhcmRSZWYsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sLCBOR19WQUxJREFUT1JTLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcblxuaW1wb3J0IHsgUG9DYWxlbmRhckJhc2VDb21wb25lbnQgfSBmcm9tICcuL3BvLWNhbGVuZGFyLWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IFBvQ2FsZW5kYXJMYW5nU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvcG8tY2FsZW5kYXIubGFuZy5zZXJ2aWNlJztcbmltcG9ydCB7IFBvQ2FsZW5kYXJTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9wby1jYWxlbmRhci5zZXJ2aWNlJztcbmltcG9ydCB7IFBvRGF0ZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9wby1kYXRlL3BvLWRhdGUuc2VydmljZSc7XG5cbi8qKlxuICogQGRvY3NFeHRlbmRzIFBvQ2FsZW5kYXJCYXNlQ29tcG9uZW50XG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tY2FsZW5kYXItYmFzaWNcIiB0aXRsZT1cIlBvcnRpbmFyaSBDYWxlbmRhciBCYXNpY1wiID5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLWNhbGVuZGFyLWJhc2ljL3NhbXBsZS1wby1jYWxlbmRhci1iYXNpYy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1jYWxlbmRhci1iYXNpYy9zYW1wbGUtcG8tY2FsZW5kYXItYmFzaWMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tY2FsZW5kYXItbGFic1wiIHRpdGxlPVwiUG9ydGluYXJpIENhbGVuZGFyIExhYnNcIiA+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1jYWxlbmRhci1sYWJzL3NhbXBsZS1wby1jYWxlbmRhci1sYWJzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLWNhbGVuZGFyLWxhYnMvc2FtcGxlLXBvLWNhbGVuZGFyLWxhYnMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tY2FsZW5kYXItdGlja2V0LXNhbGVzXCIgdGl0bGU9XCJQb3J0aW5hcmkgQ2FsZW5kYXIgLSBUaWNrZXQgU2FsZXNcIiA+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1jYWxlbmRhci10aWNrZXQtc2FsZXMvc2FtcGxlLXBvLWNhbGVuZGFyLXRpY2tldC1zYWxlcy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1jYWxlbmRhci10aWNrZXQtc2FsZXMvc2FtcGxlLXBvLWNhbGVuZGFyLXRpY2tldC1zYWxlcy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby1jYWxlbmRhcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9wby1jYWxlbmRhci5jb21wb25lbnQuaHRtbCcsXG4gIHByb3ZpZGVyczogW1xuICAgIFBvQ2FsZW5kYXJTZXJ2aWNlLFxuICAgIFBvQ2FsZW5kYXJMYW5nU2VydmljZSxcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFBvQ2FsZW5kYXJDb21wb25lbnQpLFxuICAgICAgbXVsdGk6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxJREFUT1JTLFxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gUG9DYWxlbmRhckNvbXBvbmVudCksXG4gICAgICBtdWx0aTogdHJ1ZSxcbiAgICB9XG4gIF1cbn0pXG5leHBvcnQgY2xhc3MgUG9DYWxlbmRhckNvbXBvbmVudCBleHRlbmRzIFBvQ2FsZW5kYXJCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHBvQ2FsZW5kYXJTZXJ2aWNlOiBQb0NhbGVuZGFyU2VydmljZSxcbiAgICBwb0NhbGVuZGFyTGFuZ1NlcnZpY2U6IFBvQ2FsZW5kYXJMYW5nU2VydmljZSxcbiAgICBwb0RhdGU6IFBvRGF0ZVNlcnZpY2UpIHtcbiAgICBzdXBlcihwb0RhdGUsIHBvQ2FsZW5kYXJMYW5nU2VydmljZSk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmluaXQoKTtcbiAgfVxuXG4gIGdldEJhY2tncm91bmRDb2xvcihkaXNwbGF5VmFsdWU6IG51bWJlciwgcHJvcGVydHlWYWx1ZTogbnVtYmVyKSB7XG4gICAgcmV0dXJuIChkaXNwbGF5VmFsdWUgPT09IHByb3BlcnR5VmFsdWUpID8gJ3BvLWNhbGVuZGFyLWJveC1iYWNrZ3JvdW5kLXNlbGVjdGVkJyA6ICdwby1jYWxlbmRhci1ib3gtYmFja2dyb3VuZCc7XG4gIH1cblxuICBnZXREYXlCYWNrZ3JvdW5kQ29sb3IoZGF0ZTogRGF0ZSkge1xuICAgIHJldHVybiB0aGlzLmdldERheUNvbG9yKGRhdGUsICdiYWNrZ3JvdW5kJyk7XG4gIH1cblxuICBnZXREYXlGb3JlZ3JvdW5kQ29sb3IoZGF0ZTogRGF0ZSkge1xuICAgIHJldHVybiB0aGlzLmdldERheUNvbG9yKGRhdGUsICdmb3JlZ3JvdW5kJyk7XG4gIH1cblxuICBnZXRGb3JlZ3JvdW5kQ29sb3IoZGlzcGxheVZhbHVlOiBudW1iZXIsIHByb3BlcnR5VmFsdWU6IG51bWJlcikge1xuICAgIHJldHVybiAoZGlzcGxheVZhbHVlID09PSBwcm9wZXJ0eVZhbHVlKSA/ICdwby1jYWxlbmRhci1ib3gtZm9yZWdyb3VuZC1zZWxlY3RlZCcgOiAncG8tY2FsZW5kYXItYm94LWZvcmVncm91bmQnO1xuICB9XG5cbiAgZ2V0TW9udGhMYWJlbCgpIHtcbiAgICByZXR1cm4gdGhpcy5wb0NhbGVuZGFyTGFuZ1NlcnZpY2UuZ2V0TW9udGhMYWJlbCgpO1xuICB9XG5cbiAgZ2V0WWVhckxhYmVsKCkge1xuICAgIHJldHVybiB0aGlzLnBvQ2FsZW5kYXJMYW5nU2VydmljZS5nZXRZZWFyTGFiZWwoKTtcbiAgfVxuXG4gIG9uTmV4dE1vbnRoKCkge1xuICAgIHRoaXMuZGlzcGxheU1vbnRoTnVtYmVyIDwgMTEgPyB0aGlzLnVwZGF0ZURpc3BsYXkodGhpcy5kaXNwbGF5WWVhciwgdGhpcy5kaXNwbGF5TW9udGhOdW1iZXIgKyAxKSA6XG4gICAgICB0aGlzLnVwZGF0ZURpc3BsYXkodGhpcy5kaXNwbGF5WWVhciArIDEsIDApO1xuICB9XG5cbiAgb25QcmV2aW91c01vbnRoKCkge1xuICAgIHRoaXMuZGlzcGxheU1vbnRoTnVtYmVyID4gMCA/IHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyLCB0aGlzLmRpc3BsYXlNb250aE51bWJlciAtIDEpIDpcbiAgICAgIHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyIC0gMSwgMTEpO1xuICB9XG5cbiAgLy8gQW8gc2VsZWNpb25hciB1bWEgZGF0YVxuICBvblNlbGVjdERhdGUoZGF0ZTogRGF0ZSkge1xuICAgIHRoaXMuZGF0ZSA9IGRhdGU7XG4gICAgdGhpcy5kYXRlSXNvID0gdGhpcy5wb0RhdGUuY29udmVydERhdGVUb0lTTyhkYXRlKTtcbiAgICBpZiAodGhpcy5wcm9wYWdhdGVDaGFuZ2UpIHtcbiAgICAgIHRoaXMucHJvcGFnYXRlQ2hhbmdlKHRoaXMuZGF0ZUlzbyk7XG4gICAgfVxuICAgIHRoaXMuY2hhbmdlLmVtaXQodGhpcy5kYXRlSXNvKTtcbiAgfVxuXG4gIC8vIEFvIHNlbGVjaW9uYXIgdW0gbcOqc1xuICBvblNlbGVjdE1vbnRoKHllYXI6IG51bWJlciwgbW9udGg6IG51bWJlcikge1xuICAgIHRoaXMuc2VsZWN0RGF5KCk7XG4gICAgdGhpcy51cGRhdGVEaXNwbGF5KHllYXIsIG1vbnRoKTtcbiAgfVxuXG4gIC8vIEFvIHNlbGVjaW9uYXIgdW0gYW5vXG4gIG9uU2VsZWN0WWVhcih5ZWFyOiBudW1iZXIsIG1vbnRoOiBudW1iZXIpIHtcbiAgICAvLyBTZSB2ZWlvIGRhIHRlbGEgZGUgc2VsZcOnw6NvIGRlIG3DqnNcbiAgICB0aGlzLmxhc3REaXNwbGF5ID09PSAnbW9udGgnID8gdGhpcy5zZWxlY3RNb250aCgpIDogdGhpcy5zZWxlY3REYXkoKTtcblxuICAgIHRoaXMuY3VycmVudFllYXIgPSB5ZWFyO1xuICAgIHRoaXMudXBkYXRlRGlzcGxheSh5ZWFyLCBtb250aCk7XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLnByb3BhZ2F0ZUNoYW5nZSA9IGZuO1xuICB9XG5cbiAgcmVnaXN0ZXJPblRvdWNoZWQoZnVuYzogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWQgPSBmdW5jO1xuICB9XG5cbiAgcmVnaXN0ZXJPblZhbGlkYXRvckNoYW5nZShmbjogKCkgPT4gdm9pZCkge1xuICAgIHRoaXMudmFsaWRhdG9yQ2hhbmdlID0gZm47XG4gIH1cblxuICBzZWxlY3REYXkoKSB7XG4gICAgdGhpcy5kYXlWaXNpYmxlID0gdHJ1ZTtcbiAgICB0aGlzLm1vbnRoVmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMueWVhclZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLmxhc3REaXNwbGF5ID0gJ2RheSc7XG4gIH1cblxuICBzZWxlY3RNb250aCgpIHtcbiAgICB0aGlzLmRheVZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm1vbnRoVmlzaWJsZSA9IHRydWU7XG4gICAgdGhpcy55ZWFyVmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMubGFzdERpc3BsYXkgPSAnbW9udGgnO1xuICB9XG5cbiAgc2VsZWN0WWVhcigpIHtcbiAgICB0aGlzLmRheVZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm1vbnRoVmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMueWVhclZpc2libGUgPSB0cnVlO1xuICB9XG5cbiAgdXBkYXRlWWVhcih2YWx1ZTogbnVtYmVyKSB7XG4gICAgdGhpcy51cGRhdGVEaXNwbGF5KHRoaXMuZGlzcGxheVllYXIgKyB2YWx1ZSwgdGhpcy5kaXNwbGF5TW9udGhOdW1iZXIpO1xuICB9XG5cbiAgdmFsaWRhdGVNb2RlbChtb2RlbDogYW55KSB7XG4gICAgaWYgKHRoaXMudmFsaWRhdG9yQ2hhbmdlKSB7XG4gICAgICB0aGlzLnZhbGlkYXRvckNoYW5nZShtb2RlbCk7XG4gICAgfVxuICB9XG5cbiAgdmFsaWRhdGUoYzogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnk7IH0ge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KSB7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICB0aGlzLndyaXRlRGF0ZSh2YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZGF0ZSA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMudXBkYXRlRGF0ZSh0aGlzLnRvZGF5KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFkZEFsbFllYXJzSW5EZWNhZGUoeWVhcjogbnVtYmVyKSB7XG4gICAgbGV0IGk7XG4gICAgZm9yIChpID0geWVhcjsgaSA8IHllYXIgKyAxMDsgaSsrKSB7XG4gICAgICB0aGlzLmRpc3BsYXlEZWNhZGUucHVzaChpKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGVxdWFsc0RhdGUoZGF0ZTE6IERhdGUsIGRhdGUyOiBEYXRlKTogYm9vbGVhbiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBkYXRlMS5nZXRGdWxsWWVhcigpID09PSBkYXRlMi5nZXRGdWxsWWVhcigpICYmXG4gICAgICAgIGRhdGUxLmdldE1vbnRoKCkgPT09IGRhdGUyLmdldE1vbnRoKCkgJiZcbiAgICAgICAgZGF0ZTEuZ2V0RGF0ZSgpID09PSBkYXRlMi5nZXREYXRlKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvLyBPYnTDqW0gdW0gYXJyYXkgZGUgdG9kb3Mgb3MgYW5vcyBkZXN0YSBkw6ljYWRhXG4gIHByaXZhdGUgZ2V0RGVjYWRlQXJyYXkoeWVhcikge1xuICAgIHRoaXMuZGlzcGxheURlY2FkZSA9IEFycmF5KCk7XG5cbiAgICBpZiAoeWVhciAlIDEwICE9PSAwKSB7XG4gICAgICB3aGlsZSAoeWVhciAlIDEwICE9PSAwKSB7XG4gICAgICAgIHllYXItLTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy51cGRhdGVEZWNhZGUoeWVhcik7XG4gIH1cblxuICBwcml2YXRlIGdldENvbG9yRm9yRGF0ZShkYXRlOiBEYXRlLCBsb2NhbDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMucG9EYXRlLnZhbGlkYXRlRGF0ZVJhbmdlKGRhdGUsIHRoaXMubWluRGF0ZSwgdGhpcy5tYXhEYXRlKSA/IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0tc2VsZWN0ZWRgIDpcbiAgICAgIGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0tc2VsZWN0ZWQtZGlzYWJsZWRgO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb2xvckZvckRhdGVSYW5nZShkYXRlOiBEYXRlLCBsb2NhbDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMucG9EYXRlLnZhbGlkYXRlRGF0ZVJhbmdlKGRhdGUsIHRoaXMubWluRGF0ZSwgdGhpcy5tYXhEYXRlKSA/IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH1gIDpcbiAgICAgIGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0tZGlzYWJsZWRgO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb2xvckZvclRvZGF5KGRhdGU6IERhdGUsIGxvY2FsOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5wb0RhdGUudmFsaWRhdGVEYXRlUmFuZ2UoZGF0ZSwgdGhpcy5taW5EYXRlLCB0aGlzLm1heERhdGUpID8gYHBvLWNhbGVuZGFyLWJveC0ke2xvY2FsfS10b2RheWAgOlxuICAgICAgYHBvLWNhbGVuZGFyLWJveC0ke2xvY2FsfS10b2RheS1kaXNhYmxlZGA7XG4gIH1cblxuICBwcml2YXRlIGdldERheUNvbG9yKGRhdGU6IERhdGUsIGxvY2FsOiBzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5lcXVhbHNEYXRlKGRhdGUsIHRoaXMuZGF0ZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldENvbG9yRm9yRGF0ZShkYXRlLCBsb2NhbCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmVxdWFsc0RhdGUoZGF0ZSwgdGhpcy50b2RheSkpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldENvbG9yRm9yVG9kYXkoZGF0ZSwgbG9jYWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRDb2xvckZvckRhdGVSYW5nZShkYXRlLCBsb2NhbCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpbml0KCkge1xuICAgIHRoaXMuZGF0ZSAmJiB0aGlzLnBvRGF0ZS5pc1ZhbGlkSXNvKHRoaXMucG9EYXRlLmNvbnZlcnREYXRlVG9JU08odGhpcy5kYXRlKSkgP1xuICAgICAgdGhpcy51cGRhdGVEYXRlKHRoaXMuZGF0ZSkgOiB0aGlzLnVwZGF0ZURhdGUodGhpcy50b2RheSk7XG4gICAgdGhpcy5pbml0aWFsaXplTGFuZ3VhZ2UoKTtcbiAgICB0aGlzLnNlbGVjdERheSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZWxlY3REYXRlRnJvbURhdGUoZGF0ZTogRGF0ZSkge1xuICAgIHRoaXMuZGF0ZSA9IGRhdGU7XG4gICAgdGhpcy5vblNlbGVjdERhdGUodGhpcy5kYXRlKTtcbiAgfVxuXG4gIHByaXZhdGUgc2VsZWN0RGF0ZUZyb21Jc28oc3RyaW5nRGF0ZTogc3RyaW5nKSB7XG4gICAgY29uc3QgeyB5ZWFyLCBtb250aCwgZGF5IH0gPSB0aGlzLnBvRGF0ZS5nZXREYXRlRnJvbUlzbyhzdHJpbmdEYXRlKTtcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoeWVhciwgbW9udGggLSAxLCBkYXkpO1xuICAgIHRoaXMucG9EYXRlLnNldFllYXJGcm9tMFRvMTAwKGRhdGUsIHllYXIpO1xuICAgIHRoaXMuZGF0ZSA9IGRhdGU7XG4gICAgdGhpcy5vblNlbGVjdERhdGUodGhpcy5kYXRlKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlRGF0ZShkYXRlOiBEYXRlKSB7XG4gICAgaWYgKGRhdGUpIHtcbiAgICAgIHRoaXMuY3VycmVudE1vbnRoTnVtYmVyID0gZGF0ZS5nZXRNb250aCgpO1xuICAgICAgdGhpcy5jdXJyZW50WWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICAgIHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmN1cnJlbnRZZWFyLCB0aGlzLmN1cnJlbnRNb250aE51bWJlcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVEZWNhZGUoeWVhcjogbnVtYmVyKSB7XG4gICAgdGhpcy5hZGRBbGxZZWFyc0luRGVjYWRlKHllYXIpO1xuICAgIHRoaXMuZGlzcGxheVN0YXJ0RGVjYWRlID0geWVhcjtcbiAgICB0aGlzLmRpc3BsYXlGaW5hbERlY2FkZSA9IHllYXIgKyA5O1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVEaXNwbGF5KHllYXI6IG51bWJlciwgbW9udGg6IG51bWJlcikge1xuICAgIGNvbnN0IGNhbGVuZGFyQXJyYXkgPSB0aGlzLnBvQ2FsZW5kYXJTZXJ2aWNlLm1vbnRoRGF5cyh5ZWFyLCBtb250aCk7XG4gICAgdGhpcy5kaXNwbGF5RGF5cyA9IFtdLmNvbmNhdC5hcHBseShbXSwgY2FsZW5kYXJBcnJheSk7XG4gICAgdGhpcy5kaXNwbGF5TW9udGhOdW1iZXIgPSBtb250aDtcbiAgICB0aGlzLmRpc3BsYXlNb250aCA9IHRoaXMuZGlzcGxheU1vbnRoc1ttb250aF07XG4gICAgdGhpcy5kaXNwbGF5WWVhciA9IHllYXI7XG4gICAgdGhpcy5nZXREZWNhZGVBcnJheSh5ZWFyKTtcbiAgfVxuXG4gIHByaXZhdGUgd3JpdGVEYXRlKHZhbHVlOiBhbnkpIHtcbiAgICB2YWx1ZSBpbnN0YW5jZW9mIERhdGUgPyB0aGlzLnNlbGVjdERhdGVGcm9tRGF0ZSh2YWx1ZSkgOiB0aGlzLndyaXRlRGF0ZUlzbyh2YWx1ZSk7XG4gICAgdGhpcy51cGRhdGVEYXRlKHRoaXMuZGF0ZSk7XG4gIH1cblxuICBwcml2YXRlIHdyaXRlRGF0ZUlzbyh2YWx1ZTogYW55KSB7XG4gICAgdGhpcy5wb0RhdGUuaXNWYWxpZElzbyh2YWx1ZSkgPyB0aGlzLnNlbGVjdERhdGVGcm9tSXNvKHZhbHVlKSA6IHRoaXMuZGF0ZSA9IHVuZGVmaW5lZDtcbiAgfVxuXG59XG4iXX0=