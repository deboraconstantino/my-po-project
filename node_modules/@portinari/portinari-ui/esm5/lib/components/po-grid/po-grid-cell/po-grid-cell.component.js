import * as tslib_1 from "tslib";
import { Component, Input, ViewChild, ElementRef, ChangeDetectorRef, Output, EventEmitter } from '@angular/core';
var PoGridCellComponent = /** @class */ (function () {
    function PoGridCellComponent(changeDetectorRef) {
        this.changeDetectorRef = changeDetectorRef;
        this._value = '';
        this.edit = false;
        this.editValue = '';
        this.align = 'left';
        this.freeze = false;
        this.tabIndex = -1;
        this.position = '';
        this.readonly = false;
        this.required = false;
        this.valueChange = new EventEmitter();
    }
    Object.defineProperty(PoGridCellComponent.prototype, "width", {
        get: function () {
            return this._width ? this._width + "px" : '100%';
        },
        set: function (value) {
            this._width = value;
            if (this.freeze && !this._width) {
                this._width = 100;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoGridCellComponent.prototype, "value", {
        get: function () {
            return this._value;
        },
        // @Input('p-value') value?: string;
        set: function (value) {
            this._value = value;
            this.valueChange.emit(this._value);
        },
        enumerable: true,
        configurable: true
    });
    PoGridCellComponent.prototype.onKeyDownContent = function (event) {
        // console.log('onKeyDownContent: ', event);
        // BACKSPACE / DELETE
        if ((!event.ctrlKey) && ((event.keyCode === 8) || (event.keyCode === 46))) {
            if (this.readonly) {
                return;
            }
            event.preventDefault();
            this.value = '';
            return;
        }
        // ENTER
        if (event.keyCode === 13) {
            event.preventDefault();
            this.onEditCell(this.value);
            return;
        }
        // A..Z - 0..9
        if ((event.keyCode >= 65) && (event.keyCode <= 90) || (event.keyCode >= 48) && (event.keyCode <= 57)) {
            event.preventDefault();
            this.onEditCell(event.key);
            return;
        }
    };
    PoGridCellComponent.prototype.dblclick = function (event) {
        // console.log('dblclick: ', event);
        event.preventDefault();
        this.onEditCell(this.value);
    };
    PoGridCellComponent.prototype.onBlurInput = function (event) {
        // console.log('onBlurInput: ', event);
        this.value = this.editValue;
        this.editValue = undefined;
        this.edit = false;
    };
    PoGridCellComponent.prototype.onKeyDownInput = function (event) {
        // console.log('onKeyDownInput: ', event);
        // ENTER
        if (event.keyCode === 13) {
            this.value = this.editValue;
            this.editValue = undefined;
            this.edit = false;
            this.changeDetectorRef.detectChanges();
            this.contentElement.nativeElement.focus();
        }
        // ESCAPE
        if (event.keyCode === 27) {
            this.editValue = undefined;
            this.edit = false;
            this.changeDetectorRef.detectChanges();
            this.contentElement.nativeElement.focus();
            event.stopPropagation();
        }
    };
    PoGridCellComponent.prototype.onEditCell = function (value) {
        if (this.readonly) {
            return;
        }
        this.editValue = value;
        this.edit = true;
        this.changeDetectorRef.detectChanges();
        this.inputElement.nativeElement.focus();
    };
    PoGridCellComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    tslib_1.__decorate([
        Input('p-align'),
        tslib_1.__metadata("design:type", String)
    ], PoGridCellComponent.prototype, "align", void 0);
    tslib_1.__decorate([
        Input('p-freeze'),
        tslib_1.__metadata("design:type", Boolean)
    ], PoGridCellComponent.prototype, "freeze", void 0);
    tslib_1.__decorate([
        Input('p-tab-index'),
        tslib_1.__metadata("design:type", Number)
    ], PoGridCellComponent.prototype, "tabIndex", void 0);
    tslib_1.__decorate([
        Input('p-position'),
        tslib_1.__metadata("design:type", String)
    ], PoGridCellComponent.prototype, "position", void 0);
    tslib_1.__decorate([
        Input('p-width'),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], PoGridCellComponent.prototype, "width", null);
    tslib_1.__decorate([
        Input('p-readonly'),
        tslib_1.__metadata("design:type", Boolean)
    ], PoGridCellComponent.prototype, "readonly", void 0);
    tslib_1.__decorate([
        Input('p-required'),
        tslib_1.__metadata("design:type", Boolean)
    ], PoGridCellComponent.prototype, "required", void 0);
    tslib_1.__decorate([
        Output('p-valueChange'),
        tslib_1.__metadata("design:type", Object)
    ], PoGridCellComponent.prototype, "valueChange", void 0);
    tslib_1.__decorate([
        Input('p-value'),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], PoGridCellComponent.prototype, "value", null);
    tslib_1.__decorate([
        ViewChild('inputElement', { static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], PoGridCellComponent.prototype, "inputElement", void 0);
    tslib_1.__decorate([
        ViewChild('contentElement', { static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], PoGridCellComponent.prototype, "contentElement", void 0);
    PoGridCellComponent = tslib_1.__decorate([
        Component({
            selector: 'po-grid-cell',
            template: "<div>\n  <ng-container *ngIf=\"edit; then input; else content\"></ng-container>\n\n  <ng-template #content>\n    <div #contentElement\n      [id]=\"position\"\n      class=\"po-grid-cell-content po-grid-cell-{{ align }} {{ !value && required ? 'po-grid-cell-required' : '' }}\"\n      (keydown)=\"onKeyDownContent($event)\"\n      tabindex=\"{{ readonly ? -1 : 0 }}\"\n      (dblclick)=dblclick($event)>\n      <span>{{ value || '&nbsp;' }}</span>\n    </div>\n  </ng-template>\n\n  <ng-template #input>\n    <input\n      [id]=\"position\"\n      #inputElement class=\"po-grid-cell-input\"\n      [(ngModel)]=\"editValue\"\n      (keydown.arrowup)=\"$event.stopPropagation()\"\n      (keydown.arrowdown)=\"$event.stopPropagation()\"\n      (keydown.arrowleft)=\"$event.stopPropagation()\"\n      (keydown.arrowright)=\"$event.stopPropagation()\"\n      (keydown)=\"onKeyDownInput($event)\"\n      (blur)=\"onBlurInput($event)\">\n\n    <!-- <po-input\n      #inputElement class=\"po-grid-cell-input\"\n      [(ngModel)]=\"editValue\"\n      (keydown)=\"onKeyDownInput($event)\"\n      (p-blur)=\"onBlurInput($event)\">\n    </po-input> -->\n  </ng-template>\n</div>\n\n"
        }),
        tslib_1.__metadata("design:paramtypes", [ChangeDetectorRef])
    ], PoGridCellComponent);
    return PoGridCellComponent;
}());
export { PoGridCellComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZ3JpZC1jZWxsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tZ3JpZC9wby1ncmlkLWNlbGwvcG8tZ3JpZC1jZWxsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBTWpIO0lBNENFLDZCQUFvQixpQkFBb0M7UUFBcEMsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQXhDeEQsV0FBTSxHQUFRLEVBQUUsQ0FBQztRQUNqQixTQUFJLEdBQVksS0FBSyxDQUFDO1FBQ3RCLGNBQVMsR0FBVyxFQUFFLENBQUM7UUFFTCxVQUFLLEdBQVksTUFBTSxDQUFDO1FBRXZCLFdBQU0sR0FBYSxLQUFLLENBQUM7UUFFdEIsYUFBUSxHQUFZLENBQUMsQ0FBQyxDQUFDO1FBRXhCLGFBQVEsR0FBWSxFQUFFLENBQUM7UUFhdkIsYUFBUSxHQUFhLEtBQUssQ0FBQztRQUUzQixhQUFRLEdBQWEsS0FBSyxDQUFDO1FBRXZCLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztJQWFILENBQUM7SUE1QjNDLHNCQUFJLHNDQUFLO2FBTzNCO1lBQ0UsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBSSxJQUFJLENBQUMsTUFBTSxPQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztRQUNuRCxDQUFDO2FBVGlCLFVBQVUsS0FBd0I7WUFDbEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7WUFFcEIsSUFBSSxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtnQkFDL0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxHQUFH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RSxjQUFjO1lBQ3hCLDhwQ0FBNEM7U0FDN0MsQ0FBQztpREE2Q3VDLGlCQUFpQjtPQTVDN0MsbUJBQW1CLENBNkgvQjtJQUFELDBCQUFDO0NBQUEsQUE3SEQsSUE2SEM7U0E3SFksbUJBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgVmlld0NoaWxkLCBFbGVtZW50UmVmLCBDaGFuZ2VEZXRlY3RvclJlZiwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tZ3JpZC1jZWxsJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLWdyaWQtY2VsbC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUG9HcmlkQ2VsbENvbXBvbmVudCB7XG5cbiAgcHJpdmF0ZSBfd2lkdGg6IChzdHJpbmcgfCBudW1iZXIpO1xuXG4gIF92YWx1ZTogYW55ID0gJyc7XG4gIGVkaXQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgZWRpdFZhbHVlOiBzdHJpbmcgPSAnJztcblxuICBASW5wdXQoJ3AtYWxpZ24nKSBhbGlnbj86IHN0cmluZyA9ICdsZWZ0JztcblxuICBASW5wdXQoJ3AtZnJlZXplJykgZnJlZXplPzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBJbnB1dCgncC10YWItaW5kZXgnKSB0YWJJbmRleD86IG51bWJlciA9IC0xO1xuXG4gIEBJbnB1dCgncC1wb3NpdGlvbicpIHBvc2l0aW9uPzogc3RyaW5nID0gJyc7XG5cbiAgQElucHV0KCdwLXdpZHRoJykgc2V0IHdpZHRoKHZhbHVlOiAoc3RyaW5nIHwgbnVtYmVyKSkge1xuICAgIHRoaXMuX3dpZHRoID0gdmFsdWU7XG5cbiAgICBpZiAodGhpcy5mcmVlemUgJiYgIXRoaXMuX3dpZHRoKSB7XG4gICAgICB0aGlzLl93aWR0aCA9IDEwMDtcbiAgICB9XG4gIH1cbiAgZ2V0IHdpZHRoKCk6IChzdHJpbmcgfCBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5fd2lkdGggPyBgJHt0aGlzLl93aWR0aH1weGAgOiAnMTAwJSc7XG4gIH1cblxuICBASW5wdXQoJ3AtcmVhZG9ubHknKSByZWFkb25seT86IGJvb2xlYW4gPSBmYWxzZTtcblxuICBASW5wdXQoJ3AtcmVxdWlyZWQnKSByZXF1aXJlZD86IGJvb2xlYW4gPSBmYWxzZTtcblxuICBAT3V0cHV0KCdwLXZhbHVlQ2hhbmdlJykgdmFsdWVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgLy8gQElucHV0KCdwLXZhbHVlJykgdmFsdWU/OiBzdHJpbmc7XG4gIEBJbnB1dCgncC12YWx1ZScpIHNldCB2YWx1ZSh2YWx1ZTogYW55KSB7XG4gICAgdGhpcy5fdmFsdWUgPSB2YWx1ZTtcbiAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQodGhpcy5fdmFsdWUpO1xuICB9XG4gIGdldCB2YWx1ZSgpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgfVxuXG4gIEBWaWV3Q2hpbGQoJ2lucHV0RWxlbWVudCcsIHsgc3RhdGljOiB0cnVlIH0pIGlucHV0RWxlbWVudDogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnY29udGVudEVsZW1lbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBjb250ZW50RWxlbWVudDogRWxlbWVudFJlZjtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZikgeyB9XG5cbiAgb25LZXlEb3duQ29udGVudChldmVudDogYW55KSB7XG4gICAgLy8gY29uc29sZS5sb2coJ29uS2V5RG93bkNvbnRlbnQ6ICcsIGV2ZW50KTtcblxuICAgIC8vIEJBQ0tTUEFDRSAvIERFTEVURVxuICAgIGlmICgoIWV2ZW50LmN0cmxLZXkpICYmICgoZXZlbnQua2V5Q29kZSA9PT0gOCkgfHwgKGV2ZW50LmtleUNvZGUgPT09IDQ2KSkpIHtcblxuICAgICAgaWYgKHRoaXMucmVhZG9ubHkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy52YWx1ZSA9ICcnO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIEVOVEVSXG4gICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5vbkVkaXRDZWxsKHRoaXMudmFsdWUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIEEuLlogLSAwLi45XG4gICAgaWYgKChldmVudC5rZXlDb2RlID49IDY1KSAmJiAoZXZlbnQua2V5Q29kZSA8PSA5MCkgfHwgKGV2ZW50LmtleUNvZGUgPj0gNDgpICYmIChldmVudC5rZXlDb2RlIDw9IDU3KSkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMub25FZGl0Q2VsbChldmVudC5rZXkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuXG4gIGRibGNsaWNrKGV2ZW50OiBhbnkpIHtcbiAgICAvLyBjb25zb2xlLmxvZygnZGJsY2xpY2s6ICcsIGV2ZW50KTtcblxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICB0aGlzLm9uRWRpdENlbGwodGhpcy52YWx1ZSk7XG4gIH1cblxuICBvbkJsdXJJbnB1dChldmVudDogYW55KSB7XG4gICAgLy8gY29uc29sZS5sb2coJ29uQmx1cklucHV0OiAnLCBldmVudCk7XG5cbiAgICB0aGlzLnZhbHVlID0gdGhpcy5lZGl0VmFsdWU7XG4gICAgdGhpcy5lZGl0VmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5lZGl0ID0gZmFsc2U7XG4gIH1cblxuICBvbktleURvd25JbnB1dChldmVudDogYW55KSB7XG4gICAgLy8gY29uc29sZS5sb2coJ29uS2V5RG93bklucHV0OiAnLCBldmVudCk7XG5cbiAgICAvLyBFTlRFUlxuICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMykge1xuICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuZWRpdFZhbHVlO1xuICAgICAgdGhpcy5lZGl0VmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLmVkaXQgPSBmYWxzZTtcbiAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgdGhpcy5jb250ZW50RWxlbWVudC5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG4gICAgfVxuXG4gICAgLy8gRVNDQVBFXG4gICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDI3KSB7XG4gICAgICB0aGlzLmVkaXRWYWx1ZSA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMuZWRpdCA9IGZhbHNlO1xuICAgICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICB0aGlzLmNvbnRlbnRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgb25FZGl0Q2VsbCh2YWx1ZTogYW55KSB7XG4gICAgaWYgKHRoaXMucmVhZG9ubHkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmVkaXRWYWx1ZSA9IHZhbHVlO1xuICAgIHRoaXMuZWRpdCA9IHRydWU7XG4gICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgdGhpcy5pbnB1dEVsZW1lbnQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICB9XG5cbn1cbiJdfQ==