import * as tslib_1 from "tslib";
import { Component, ContentChild, ElementRef, HostListener, QueryList, ViewChild, ViewChildren } from '@angular/core';
import { animate, AnimationBuilder, AnimationFactory, AnimationPlayer, keyframes, style } from '@angular/animations';
import { PoSlideBaseComponent } from './po-slide-base.component';
import { PoSlideContentTemplateDirective } from './directives/po-slide-content-template.directive';
import { PoSlideItemComponent } from './po-slide-item/po-slide-item.component';
var poSlideDefaultHeight = 336;
var poSlideIntervalMin = 1000;
var poSlideMinHeight = 192;
var poSlideTiming = '250ms ease';
/**
 * @docsExtends PoSlideBaseComponent
 *
 * @example
 * <example name="po-slide-basic" title="Portinari Slide Basic">
 *   <file name="sample-po-slide-basic/sample-po-slide-basic.component.html"> </file>
 *   <file name="sample-po-slide-basic/sample-po-slide-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-slide-labs" title="Portinari Slide Labs">
 *   <file name="sample-po-slide-labs/sample-po-slide-labs.component.html"> </file>
 *   <file name="sample-po-slide-labs/sample-po-slide-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-slide-useful-articles" title="Portinari Slide - Useful articles">
 *   <file name="sample-po-slide-useful-articles/sample-po-slide-useful-articles.component.html"> </file>
 *   <file name="sample-po-slide-useful-articles/sample-po-slide-useful-articles.component.ts"> </file>
 * </example>
 *
 * <example name="po-slide-landscapes" title="Portinari Slide - Landscapes">
 *   <file name="sample-po-slide-landscapes/sample-po-slide-landscapes.component.html"> </file>
 *   <file name="sample-po-slide-landscapes/sample-po-slide-landscapes.component.ts"> </file>
 * </example>
 */
var PoSlideComponent = /** @class */ (function (_super) {
    tslib_1.__extends(PoSlideComponent, _super);
    function PoSlideComponent(builder) {
        var _this = _super.call(this) || this;
        _this.builder = builder;
        _this.isLoaded = false;
        _this.currentSlideIndex = 0;
        _this.slideItems = [];
        return _this;
    }
    Object.defineProperty(PoSlideComponent.prototype, "hasElements", {
        get: function () {
            return !!this.slide.nativeElement.offsetWidth && !!this.itemsElements && !!this.itemsElements.length;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoSlideComponent.prototype, "isImageSlide", {
        get: function () {
            return !this.slideContentTemplate;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoSlideComponent.prototype, "offset", {
        get: function () {
            return this.currentSlideIndex * this.slideItemWidth;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoSlideComponent.prototype, "hasSlides", {
        get: function () {
            return !!this.slides && !!this.slides.length;
        },
        enumerable: true,
        configurable: true
    });
    PoSlideComponent.prototype.onResize = function () {
        if (this.slide) {
            this.setSlideItemWidth();
            this.goToItem(this.currentSlideIndex);
        }
    };
    PoSlideComponent.prototype.ngDoCheck = function () {
        if (!this.isLoaded && this.hasElements) {
            this.setSlideItemWidth();
            this.isLoaded = true;
            if (this.hasSlides) {
                this.startSlide();
            }
        }
    };
    PoSlideComponent.prototype.goToItem = function (index) {
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.currentSlideIndex = index;
        this.animate(this.offset);
    };
    PoSlideComponent.prototype.nextControl = function () {
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.next();
    };
    PoSlideComponent.prototype.next = function () {
        if (this.currentSlideIndex + 1 === this.slideItems.length) {
            this.currentSlideIndex = 0;
            this.animate(0);
            return;
        }
        this.currentSlideIndex = (this.currentSlideIndex + 1) % this.slideItems.length;
        this.animate(this.offset);
    };
    PoSlideComponent.prototype.previous = function () {
        if (this.currentSlideIndex === 0) {
            this.currentSlideIndex = this.slideItems.length - 1;
            this.animate(this.offset);
            return;
        }
        this.currentSlideIndex = ((this.currentSlideIndex - 1) + this.slideItems.length) % this.slideItems.length;
        this.animate(this.offset);
    };
    PoSlideComponent.prototype.previousControl = function () {
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.previous();
    };
    PoSlideComponent.prototype.setSlideHeight = function (height) {
        this.setHeight(height);
    };
    PoSlideComponent.prototype.animate = function (offset) {
        if (this.hasElements) {
            var animation = this.buildTransitionAnimation(offset);
            this.player = animation.create(this.slide.nativeElement);
            this.player.play();
        }
    };
    PoSlideComponent.prototype.buildTransitionAnimation = function (offset) {
        return this.builder.build([
            animate(poSlideTiming, keyframes([style({ transform: "translateX(-" + offset + "px)" })]))
        ]);
    };
    PoSlideComponent.prototype.createArrayForTemplate = function (slides) {
        this.slideItems = tslib_1.__spread(slides);
    };
    PoSlideComponent.prototype.createArrayFromSlides = function (slides) {
        var _this = this;
        var isStringArray = slides.every(function (item) { return typeof item === 'string'; });
        if (isStringArray) {
            slides.forEach(function (element) { return _this.slideItems.push({ image: "" + element }); });
        }
        else {
            this.slideItems = tslib_1.__spread(slides);
        }
    };
    PoSlideComponent.prototype.setDefaultHeight = function (height) {
        if (height && height <= poSlideMinHeight || !height && this.isImageSlide) {
            this.slide.nativeElement.style.height = poSlideDefaultHeight + "px";
            this.imageHeight = poSlideDefaultHeight;
        }
        else {
            this.imageHeight = undefined;
        }
    };
    PoSlideComponent.prototype.setHeight = function (height) {
        if (height && height > poSlideMinHeight) {
            this.slide.nativeElement.style.height = height + "px";
            this.imageHeight = height;
        }
        else {
            this.setDefaultHeight(height);
        }
    };
    PoSlideComponent.prototype.setSlideItemWidth = function () {
        if (this.hasElements) {
            this.slideItemWidth = this.itemsElements.first.itemElement.nativeElement.getBoundingClientRect().width;
        }
    };
    PoSlideComponent.prototype.cancelInterval = function () {
        clearInterval(this.setInterval);
    };
    PoSlideComponent.prototype.setSlideItems = function (slides) {
        if (this.hasSlides) {
            this.slideContentTemplate ? this.createArrayForTemplate(slides) : this.createArrayFromSlides(slides);
        }
        else {
            this.slideItems = [];
            this.cancelInterval();
        }
    };
    PoSlideComponent.prototype.startSlide = function () {
        this.setSlideHeight(this.height);
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.currentSlideIndex = 0;
    };
    PoSlideComponent.prototype.startInterval = function () {
        var _this = this;
        if (this.setInterval) {
            this.cancelInterval();
        }
        this.setInterval = this.hasSlides && this.hasElements ? setInterval(function () { _this.next(); }, this.interval) : undefined;
    };
    PoSlideComponent.ctorParameters = function () { return [
        { type: AnimationBuilder }
    ]; };
    tslib_1.__decorate([
        ContentChild(PoSlideContentTemplateDirective, { static: true }),
        tslib_1.__metadata("design:type", PoSlideContentTemplateDirective)
    ], PoSlideComponent.prototype, "slideContentTemplate", void 0);
    tslib_1.__decorate([
        ViewChild('slide', { static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], PoSlideComponent.prototype, "slide", void 0);
    tslib_1.__decorate([
        ViewChildren(PoSlideItemComponent),
        tslib_1.__metadata("design:type", QueryList)
    ], PoSlideComponent.prototype, "itemsElements", void 0);
    tslib_1.__decorate([
        HostListener('window:resize'),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", []),
        tslib_1.__metadata("design:returntype", void 0)
    ], PoSlideComponent.prototype, "onResize", null);
    PoSlideComponent = tslib_1.__decorate([
        Component({
            selector: 'po-slide',
            template: "<div class=\"po-slide-wrapper\">\n  <div class=\"po-slide-outer\">\n    <div class=\"po-slide-inner\" #slide>\n      <ng-container *ngFor=\"let item of slideItems; let index = index;\">\n        <po-slide-item\n          [p-action]=\"item.action\"\n          [p-data]=\"item\"\n          [p-image]=\"item.image\"\n          [p-image-height]=\"imageHeight\"\n          [p-template]=\"slideContentTemplate\"\n          [p-alt]=\"item.alt\"\n          [p-link]=\"item.link\">\n        </po-slide-item>\n      </ng-container>\n    </div>\n\n    <po-slide-control *ngIf=\"hasSlides && slides.length > 1\" \n      p-control=\"previous\"\n      (p-click)=\"previousControl()\">\n    </po-slide-control>\n\n    <po-slide-control *ngIf=\"hasSlides && slides.length > 1\"\n      p-control=\"next\"\n      (p-click)=\"nextControl()\">\n    </po-slide-control>\n\n  </div>\n\n  <po-slide-circles\n    *ngIf=\"hasSlides && slides.length > 1\"\n    [p-current-slide-index]=\"currentSlideIndex\"\n    [p-items]=\"slideItems\"\n    (p-click)=\"goToItem($event)\">\n  </po-slide-circles>\n</div>\n"
        }),
        tslib_1.__metadata("design:paramtypes", [AnimationBuilder])
    ], PoSlideComponent);
    return PoSlideComponent;
}(PoSlideBaseComponent));
export { PoSlideComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tc2xpZGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvcnRpbmFyaS9wb3J0aW5hcmktdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wby1zbGlkZS9wby1zbGlkZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFZLFVBQVUsRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFaEksT0FBTyxFQUFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXJILE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSwrQkFBK0IsRUFBRSxNQUFNLGtEQUFrRCxDQUFDO0FBRW5HLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBRS9FLElBQU0sb0JBQW9CLEdBQUcsR0FBRyxDQUFDO0FBQ2pDLElBQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFDO0FBQ2hDLElBQU0sZ0JBQWdCLEdBQUcsR0FBRyxDQUFDO0FBQzdCLElBQU0sYUFBYSxHQUFHLFlBQVksQ0FBQztBQUVuQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F1Qkc7QUFLSDtJQUFzQyw0Q0FBb0I7SUF3Q3hELDBCQUFvQixPQUF5QjtRQUE3QyxZQUNFLGlCQUFPLFNBQ1I7UUFGbUIsYUFBTyxHQUFQLE9BQU8sQ0FBa0I7UUF0Q3JDLGNBQVEsR0FBWSxLQUFLLENBQUM7UUFvQmxDLHVCQUFpQixHQUFHLENBQUMsQ0FBQztRQUV0QixnQkFBVSxHQUE2QixFQUFFLENBQUM7O0lBa0IxQyxDQUFDO0lBcENELHNCQUFZLHlDQUFXO2FBQXZCO1lBQ0UsT0FBTyxDQUFDLENBQUMsSUFB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Qzs7Z0JBN0o0QixnQkFBZ0I7O0lBYm9CO1FBQWhFLFlBQVksQ0FBQywrQkFBK0IsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQzswQ0FBdUIsK0JBQStCO2tFQUFDO0lBRWpGO1FBQXJDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7MENBQWdCLFVBQVU7bURBQUM7SUFFNUI7UUFBbkMsWUFBWSxDQUFDLG9CQUFvQixDQUFDOzBDQUF3QixTQUFTOzJEQUF1QjtJQUU1RDtRQUE5QixZQUFZLENBQUMsZUFBZSxDQUFDOzs7O29EQUs3QjtJQXRDVSxnQkFBZ0I7UUFKNUIsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLFVBQVU7WUFDcEIsb2tDQUF3QztTQUN6QyxDQUFDO2lEQXlDNkIsZ0JBQWdCO09BeENsQyxnQkFBZ0IsQ0F1TTVCO0lBQUQsdUJBQUM7Q0FBQSxBQXZNRCxDQUFzQyxvQkFBb0IsR0F1TXpEO1NBdk1ZLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ29udGVudENoaWxkLCBEb0NoZWNrICwgRWxlbWVudFJlZiwgSG9zdExpc3RlbmVyLCBRdWVyeUxpc3QsIFZpZXdDaGlsZCwgVmlld0NoaWxkcmVuIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IGFuaW1hdGUsIEFuaW1hdGlvbkJ1aWxkZXIsIEFuaW1hdGlvbkZhY3RvcnksIEFuaW1hdGlvblBsYXllciwga2V5ZnJhbWVzLCBzdHlsZSB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuXG5pbXBvcnQgeyBQb1NsaWRlQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tc2xpZGUtYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9TbGlkZUNvbnRlbnRUZW1wbGF0ZURpcmVjdGl2ZSB9IGZyb20gJy4vZGlyZWN0aXZlcy9wby1zbGlkZS1jb250ZW50LXRlbXBsYXRlLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBQb1NsaWRlSXRlbSB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1zbGlkZS1pdGVtLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb1NsaWRlSXRlbUNvbXBvbmVudCB9IGZyb20gJy4vcG8tc2xpZGUtaXRlbS9wby1zbGlkZS1pdGVtLmNvbXBvbmVudCc7XG5cbmNvbnN0IHBvU2xpZGVEZWZhdWx0SGVpZ2h0ID0gMzM2O1xuY29uc3QgcG9TbGlkZUludGVydmFsTWluID0gMTAwMDtcbmNvbnN0IHBvU2xpZGVNaW5IZWlnaHQgPSAxOTI7XG5jb25zdCBwb1NsaWRlVGltaW5nID0gJzI1MG1zIGVhc2UnO1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBQb1NsaWRlQmFzZUNvbXBvbmVudFxuICpcbiAqIEBleGFtcGxlXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tc2xpZGUtYmFzaWNcIiB0aXRsZT1cIlBvcnRpbmFyaSBTbGlkZSBCYXNpY1wiPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNsaWRlLWJhc2ljL3NhbXBsZS1wby1zbGlkZS1iYXNpYy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tc2xpZGUtYmFzaWMvc2FtcGxlLXBvLXNsaWRlLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXNsaWRlLWxhYnNcIiB0aXRsZT1cIlBvcnRpbmFyaSBTbGlkZSBMYWJzXCI+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tc2xpZGUtbGFicy9zYW1wbGUtcG8tc2xpZGUtbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tc2xpZGUtbGFicy9zYW1wbGUtcG8tc2xpZGUtbGFicy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1zbGlkZS11c2VmdWwtYXJ0aWNsZXNcIiB0aXRsZT1cIlBvcnRpbmFyaSBTbGlkZSAtIFVzZWZ1bCBhcnRpY2xlc1wiPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNsaWRlLXVzZWZ1bC1hcnRpY2xlcy9zYW1wbGUtcG8tc2xpZGUtdXNlZnVsLWFydGljbGVzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1zbGlkZS11c2VmdWwtYXJ0aWNsZXMvc2FtcGxlLXBvLXNsaWRlLXVzZWZ1bC1hcnRpY2xlcy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1zbGlkZS1sYW5kc2NhcGVzXCIgdGl0bGU9XCJQb3J0aW5hcmkgU2xpZGUgLSBMYW5kc2NhcGVzXCI+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tc2xpZGUtbGFuZHNjYXBlcy9zYW1wbGUtcG8tc2xpZGUtbGFuZHNjYXBlcy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tc2xpZGUtbGFuZHNjYXBlcy9zYW1wbGUtcG8tc2xpZGUtbGFuZHNjYXBlcy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby1zbGlkZScsXG4gIHRlbXBsYXRlVXJsOiAnLi9wby1zbGlkZS5jb21wb25lbnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIFBvU2xpZGVDb21wb25lbnQgZXh0ZW5kcyBQb1NsaWRlQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIERvQ2hlY2sge1xuXG4gIHByaXZhdGUgaXNMb2FkZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBwbGF5ZXI6IEFuaW1hdGlvblBsYXllcjtcbiAgcHJpdmF0ZSBzZXRJbnRlcnZhbDogYW55O1xuXG4gIHByaXZhdGUgZ2V0IGhhc0VsZW1lbnRzKCkge1xuICAgIHJldHVybiAhIXRoaXMuc2xpZGUubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCAmJiAhIXRoaXMuaXRlbXNFbGVtZW50cyAmJiAhIXRoaXMuaXRlbXNFbGVtZW50cy5sZW5ndGg7XG4gIH1cblxuICBwcml2YXRlIGdldCBpc0ltYWdlU2xpZGUoKSB7XG4gICAgcmV0dXJuICF0aGlzLnNsaWRlQ29udGVudFRlbXBsYXRlO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgb2Zmc2V0KCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRTbGlkZUluZGV4ICogdGhpcy5zbGlkZUl0ZW1XaWR0aDtcbiAgfVxuXG4gIGdldCBoYXNTbGlkZXMoKSB7XG4gICAgcmV0dXJuICEhdGhpcy5zbGlkZXMgJiYgISF0aGlzLnNsaWRlcy5sZW5ndGg7XG4gIH1cblxuICBjdXJyZW50U2xpZGVJbmRleCA9IDA7XG4gIGltYWdlSGVpZ2h0OiBudW1iZXI7XG4gIHNsaWRlSXRlbXM6IEFycmF5PFBvU2xpZGVJdGVtIHwgYW55PiA9IFtdO1xuICBzbGlkZUl0ZW1XaWR0aDogbnVtYmVyO1xuXG4gIEBDb250ZW50Q2hpbGQoUG9TbGlkZUNvbnRlbnRUZW1wbGF0ZURpcmVjdGl2ZSwgeyBzdGF0aWM6IHRydWUgfSkgc2xpZGVDb250ZW50VGVtcGxhdGU6IFBvU2xpZGVDb250ZW50VGVtcGxhdGVEaXJlY3RpdmU7XG5cbiAgQFZpZXdDaGlsZCgnc2xpZGUnLCB7IHN0YXRpYzogdHJ1ZSB9KSBwcml2YXRlIHNsaWRlOiBFbGVtZW50UmVmO1xuXG4gIEBWaWV3Q2hpbGRyZW4oUG9TbGlkZUl0ZW1Db21wb25lbnQpIHByaXZhdGUgaXRlbXNFbGVtZW50czogUXVlcnlMaXN0PFBvU2xpZGVJdGVtQ29tcG9uZW50PjtcblxuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6cmVzaXplJykgb25SZXNpemUoKSB7XG4gICAgaWYgKHRoaXMuc2xpZGUpIHtcbiAgICAgIHRoaXMuc2V0U2xpZGVJdGVtV2lkdGgoKTtcbiAgICAgIHRoaXMuZ29Ub0l0ZW0odGhpcy5jdXJyZW50U2xpZGVJbmRleCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBidWlsZGVyOiBBbmltYXRpb25CdWlsZGVyKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nRG9DaGVjaygpIHtcblxuICAgIGlmICghdGhpcy5pc0xvYWRlZCAmJiB0aGlzLmhhc0VsZW1lbnRzKSB7XG5cbiAgICAgIHRoaXMuc2V0U2xpZGVJdGVtV2lkdGgoKTtcbiAgICAgIHRoaXMuaXNMb2FkZWQgPSB0cnVlO1xuXG4gICAgICBpZiAodGhpcy5oYXNTbGlkZXMpIHtcbiAgICAgICAgdGhpcy5zdGFydFNsaWRlKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ29Ub0l0ZW0oaW5kZXg6IG51bWJlcikge1xuXG4gICAgaWYgKHRoaXMuaW50ZXJ2YWwgPiBwb1NsaWRlSW50ZXJ2YWxNaW4pIHtcbiAgICAgIHRoaXMuc3RhcnRJbnRlcnZhbCgpO1xuICAgIH1cblxuICAgIHRoaXMuY3VycmVudFNsaWRlSW5kZXggPSBpbmRleDtcbiAgICB0aGlzLmFuaW1hdGUodGhpcy5vZmZzZXQpO1xuICB9XG5cbiAgbmV4dENvbnRyb2woKSB7XG5cbiAgICBpZiAodGhpcy5pbnRlcnZhbCA+IHBvU2xpZGVJbnRlcnZhbE1pbikge1xuICAgICAgdGhpcy5zdGFydEludGVydmFsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5uZXh0KCk7XG4gIH1cblxuICBuZXh0KCkge1xuICAgIGlmICh0aGlzLmN1cnJlbnRTbGlkZUluZGV4ICsgMSA9PT0gdGhpcy5zbGlkZUl0ZW1zLmxlbmd0aCkge1xuICAgICAgdGhpcy5jdXJyZW50U2xpZGVJbmRleCA9IDA7XG4gICAgICB0aGlzLmFuaW1hdGUoMCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuY3VycmVudFNsaWRlSW5kZXggPSAodGhpcy5jdXJyZW50U2xpZGVJbmRleCArIDEpICUgdGhpcy5zbGlkZUl0ZW1zLmxlbmd0aDtcbiAgICB0aGlzLmFuaW1hdGUodGhpcy5vZmZzZXQpO1xuICB9XG5cbiAgcHJldmlvdXMoKSB7XG4gICAgaWYgKHRoaXMuY3VycmVudFNsaWRlSW5kZXggPT09IDApIHtcbiAgICAgIHRoaXMuY3VycmVudFNsaWRlSW5kZXggPSB0aGlzLnNsaWRlSXRlbXMubGVuZ3RoIC0gMTtcbiAgICAgIHRoaXMuYW5pbWF0ZSh0aGlzLm9mZnNldCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuY3VycmVudFNsaWRlSW5kZXggPSAoKHRoaXMuY3VycmVudFNsaWRlSW5kZXggLSAxKSArIHRoaXMuc2xpZGVJdGVtcy5sZW5ndGgpICUgdGhpcy5zbGlkZUl0ZW1zLmxlbmd0aDtcbiAgICB0aGlzLmFuaW1hdGUodGhpcy5vZmZzZXQpO1xuICB9XG5cbiAgcHJldmlvdXNDb250cm9sKCkge1xuXG4gICAgaWYgKHRoaXMuaW50ZXJ2YWwgPiBwb1NsaWRlSW50ZXJ2YWxNaW4pIHtcbiAgICAgIHRoaXMuc3RhcnRJbnRlcnZhbCgpO1xuICAgIH1cblxuICAgIHRoaXMucHJldmlvdXMoKTtcbiAgfVxuXG4gIHNldFNsaWRlSGVpZ2h0KGhlaWdodDogbnVtYmVyKSB7XG4gICAgdGhpcy5zZXRIZWlnaHQoaGVpZ2h0KTtcbiAgfVxuXG4gIHByaXZhdGUgYW5pbWF0ZShvZmZzZXQ6IG51bWJlcikge1xuICAgIGlmICh0aGlzLmhhc0VsZW1lbnRzKSB7XG4gICAgICBjb25zdCBhbmltYXRpb246IEFuaW1hdGlvbkZhY3RvcnkgPSB0aGlzLmJ1aWxkVHJhbnNpdGlvbkFuaW1hdGlvbihvZmZzZXQpO1xuXG4gICAgICB0aGlzLnBsYXllciA9IGFuaW1hdGlvbi5jcmVhdGUodGhpcy5zbGlkZS5uYXRpdmVFbGVtZW50KTtcbiAgICAgIHRoaXMucGxheWVyLnBsYXkoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGJ1aWxkVHJhbnNpdGlvbkFuaW1hdGlvbihvZmZzZXQ6IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLmJ1aWxkZXIuYnVpbGQoW1xuICAgICAgYW5pbWF0ZShcbiAgICAgICAgcG9TbGlkZVRpbWluZyxcbiAgICAgICAga2V5ZnJhbWVzKFtzdHlsZSh7IHRyYW5zZm9ybTogYHRyYW5zbGF0ZVgoLSR7b2Zmc2V0fXB4KWAgfSldKVxuICAgICAgKVxuICAgIF0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBcnJheUZvclRlbXBsYXRlKHNsaWRlczogQXJyYXk8YW55Pikge1xuICAgIHRoaXMuc2xpZGVJdGVtcyA9IFsuLi5zbGlkZXNdO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBcnJheUZyb21TbGlkZXMoc2xpZGVzOiBBcnJheTxQb1NsaWRlSXRlbSB8IHN0cmluZyB8IGFueT4pIHtcbiAgICBjb25zdCBpc1N0cmluZ0FycmF5ID0gc2xpZGVzLmV2ZXJ5KGl0ZW0gPT4gdHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnKTtcblxuICAgIGlmIChpc1N0cmluZ0FycmF5KSB7XG4gICAgICBzbGlkZXMuZm9yRWFjaChlbGVtZW50ID0+IHRoaXMuc2xpZGVJdGVtcy5wdXNoKHsgaW1hZ2U6IGAke2VsZW1lbnR9YCB9KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2xpZGVJdGVtcyA9IFsuLi48QXJyYXk8UG9TbGlkZUl0ZW0+PnNsaWRlc107XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXREZWZhdWx0SGVpZ2h0KGhlaWdodDogbnVtYmVyKSB7XG4gICAgaWYgKGhlaWdodCAmJiBoZWlnaHQgPD0gcG9TbGlkZU1pbkhlaWdodCB8fCAhaGVpZ2h0ICYmIHRoaXMuaXNJbWFnZVNsaWRlKSB7XG4gICAgICB0aGlzLnNsaWRlLm5hdGl2ZUVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gYCR7cG9TbGlkZURlZmF1bHRIZWlnaHR9cHhgO1xuICAgICAgdGhpcy5pbWFnZUhlaWdodCA9IHBvU2xpZGVEZWZhdWx0SGVpZ2h0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmltYWdlSGVpZ2h0ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0SGVpZ2h0KGhlaWdodDogbnVtYmVyKSB7XG4gICAgaWYgKGhlaWdodCAmJiBoZWlnaHQgPiBwb1NsaWRlTWluSGVpZ2h0KSB7XG4gICAgICB0aGlzLnNsaWRlLm5hdGl2ZUVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0fXB4YDtcbiAgICAgIHRoaXMuaW1hZ2VIZWlnaHQgPSBoZWlnaHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0RGVmYXVsdEhlaWdodChoZWlnaHQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0U2xpZGVJdGVtV2lkdGgoKSB7XG4gICAgaWYgKHRoaXMuaGFzRWxlbWVudHMpIHtcbiAgICAgIHRoaXMuc2xpZGVJdGVtV2lkdGggPSB0aGlzLml0ZW1zRWxlbWVudHMuZmlyc3QuaXRlbUVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgY2FuY2VsSW50ZXJ2YWwoKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLnNldEludGVydmFsKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBzZXRTbGlkZUl0ZW1zKHNsaWRlczogQXJyYXk8UG9TbGlkZUl0ZW0gfCBzdHJpbmcgfCBhbnk+KSB7XG5cbiAgICBpZiAodGhpcy5oYXNTbGlkZXMpIHtcbiAgICAgIHRoaXMuc2xpZGVDb250ZW50VGVtcGxhdGUgPyB0aGlzLmNyZWF0ZUFycmF5Rm9yVGVtcGxhdGUoc2xpZGVzKSA6IHRoaXMuY3JlYXRlQXJyYXlGcm9tU2xpZGVzKHNsaWRlcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2xpZGVJdGVtcyA9IFtdO1xuICAgICAgdGhpcy5jYW5jZWxJbnRlcnZhbCgpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBzdGFydFNsaWRlKCkge1xuXG4gICAgdGhpcy5zZXRTbGlkZUhlaWdodCh0aGlzLmhlaWdodCk7XG5cbiAgICBpZiAodGhpcy5pbnRlcnZhbCA+IHBvU2xpZGVJbnRlcnZhbE1pbikge1xuICAgICAgdGhpcy5zdGFydEludGVydmFsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5jdXJyZW50U2xpZGVJbmRleCA9IDA7XG4gIH1cblxuICBwcm90ZWN0ZWQgc3RhcnRJbnRlcnZhbCgpIHtcblxuICAgIGlmICh0aGlzLnNldEludGVydmFsKSB7XG4gICAgICB0aGlzLmNhbmNlbEludGVydmFsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXRJbnRlcnZhbCA9IHRoaXMuaGFzU2xpZGVzICYmIHRoaXMuaGFzRWxlbWVudHMgPyBzZXRJbnRlcnZhbCgoKSA9PiB7IHRoaXMubmV4dCgpOyB9LCB0aGlzLmludGVydmFsKSA6IHVuZGVmaW5lZDtcbiAgfVxuXG59XG4iXX0=