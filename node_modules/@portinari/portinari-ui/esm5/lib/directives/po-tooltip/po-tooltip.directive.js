import * as tslib_1 from "tslib";
import { Directive, ElementRef, HostListener, OnInit, Renderer2 } from '@angular/core';
import { PoTooltipBaseDirective } from './po-tooltip-base.directive';
import { PoTooltipControlPositionService } from './po-tooltip-control-position.service';
/**
 * @docsExtends PoTooltipBaseDirective
 *
 * @example
 *
 * <example name="po-tooltip-basic" title="Portinari Tooltip Basic" >
 *  <file name="sample-po-tooltip-basic/sample-po-tooltip-basic.component.html"> </file>
 *  <file name="sample-po-tooltip-basic/sample-po-tooltip-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-tooltip-labs" title="Portinari Tooltip Labs" >
 *  <file name="sample-po-tooltip-labs/sample-po-tooltip-labs.component.html"> </file>
 *  <file name="sample-po-tooltip-labs/sample-po-tooltip-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-tooltip-new-user" title="Portinari Tooltip - New User" >
 *  <file name="sample-po-tooltip-new-user/sample-po-tooltip-new-user.component.html"> </file>
 *  <file name="sample-po-tooltip-new-user/sample-po-tooltip-new-user.component.ts"> </file>
 * </example>
 *
 */
var PoTooltipDirective = /** @class */ (function (_super) {
    tslib_1.__extends(PoTooltipDirective, _super);
    function PoTooltipDirective(elementRef, renderer, poControlPosition) {
        var _this = _super.call(this) || this;
        _this.elementRef = elementRef;
        _this.renderer = renderer;
        _this.poControlPosition = poControlPosition;
        _this.tooltipOffset = 8;
        return _this;
    }
    PoTooltipDirective.prototype.ngOnInit = function () {
        this.initScrollEventListenerFunction();
    };
    PoTooltipDirective.prototype.onMouseEnter = function () {
        var _this = this;
        setTimeout(function () {
            if (_this.tooltip) {
                _this.tooltipContent ? _this.showTooltip() : _this.createTooltip();
                _this.removeArrow(_this.arrowDirection);
                _this.poControlPosition.adjustPosition(_this.tooltipPosition);
                _this.arrowDirection = _this.poControlPosition.getArrowDirection();
                _this.addArrow(_this.arrowDirection);
                _this.lastTooltipText = _this.tooltip;
            }
        });
    };
    PoTooltipDirective.prototype.onMouseLeave = function () {
        var _this = this;
        // necessita do timeout para conseguir adicionar ".po-invisible", pois quando tem alguns elementos
        // próximos com tooltips e ficar passando o mouse em cima, os mesmos não estavam ficando invisiveis.
        setTimeout(function () {
            _this.hideTooltip();
        });
    };
    PoTooltipDirective.prototype.addArrow = function (arrowDirection) {
        this.renderer.addClass(this.divArrow, "po-arrow-" + arrowDirection);
    };
    PoTooltipDirective.prototype.addScrollEventListener = function () {
        window.addEventListener('scroll', this.eventListenerFunction, true);
    };
    // Monta a estrutura do tooltip
    PoTooltipDirective.prototype.createTooltip = function () {
        this.tooltipContent = this.renderer.createElement('div');
        this.renderer.addClass(this.tooltipContent, 'po-tooltip');
        this.divArrow = this.renderer.createElement('div');
        this.renderer.addClass(this.divArrow, 'po-tooltip-arrow');
        this.divContent = this.renderer.createElement('div');
        this.renderer.addClass(this.divContent, 'po-tooltip-content');
        this.textContent = this.renderer.createText(this.tooltip);
        this.renderer.appendChild(this.divContent, this.textContent);
        this.renderer.appendChild(this.tooltipContent, this.divArrow);
        this.renderer.appendChild(this.tooltipContent, this.divContent);
        this.renderer.appendChild(this.elementRef.nativeElement, this.tooltipContent);
        this.poControlPosition.setElements(this.tooltipContent, this.tooltipOffset, this.elementRef);
        this.addScrollEventListener();
    };
    PoTooltipDirective.prototype.initScrollEventListenerFunction = function () {
        var _this = this;
        this.eventListenerFunction = function () {
            if (!_this.isHidden) {
                setTimeout(function () {
                    _this.poControlPosition.adjustPosition(_this.tooltipPosition);
                });
            }
        };
    };
    PoTooltipDirective.prototype.hideTooltip = function () {
        if (this.tooltipContent) {
            this.renderer.addClass(this.tooltipContent, 'po-invisible');
            this.isHidden = true;
            this.removeScrollEventListener();
        }
    };
    PoTooltipDirective.prototype.removeArrow = function (arrowDirection) {
        if (this.elementRef.nativeElement.querySelector(".po-arrow-" + arrowDirection)) {
            this.renderer.removeClass(this.divArrow, "po-arrow-" + arrowDirection);
        }
    };
    PoTooltipDirective.prototype.removeScrollEventListener = function () {
        window.removeEventListener('scroll', this.eventListenerFunction, true);
    };
    PoTooltipDirective.prototype.showTooltip = function () {
        this.renderer.removeClass(this.tooltipContent, 'po-invisible');
        this.updateTextContent();
        this.isHidden = false;
        this.addScrollEventListener();
    };
    PoTooltipDirective.prototype.updateTextContent = function () {
        if (this.lastTooltipText !== this.tooltip) {
            this.renderer.removeChild(this.divContent, this.textContent);
            this.textContent = this.renderer.createText(this.tooltip);
            this.renderer.appendChild(this.divContent, this.textContent);
        }
    };
    PoTooltipDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: PoTooltipControlPositionService }
    ]; };
    tslib_1.__decorate([
        HostListener('mouseenter'),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", []),
        tslib_1.__metadata("design:returntype", void 0)
    ], PoTooltipDirective.prototype, "onMouseEnter", null);
    tslib_1.__decorate([
        HostListener('mouseleave'),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", []),
        tslib_1.__metadata("design:returntype", void 0)
    ], PoTooltipDirective.prototype, "onMouseLeave", null);
    PoTooltipDirective = tslib_1.__decorate([
        Directive({
            selector: '[p-tooltip]',
            providers: [PoTooltipControlPositionService]
        }),
        tslib_1.__metadata("design:paramtypes", [ElementRef,
            Renderer2,
            PoTooltipControlPositionService])
    ], PoTooltipDirective);
    return PoTooltipDirective;
}(PoTooltipBaseDirective));
export { PoTooltipDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tdG9vbHRpcC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9ydGluYXJpL3BvcnRpbmFyaS11aS8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL3BvLXRvb2x0aXAvcG8tdG9vbHRpcC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXZGLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ3JFLE9BQU8sRUFBRSwrQkFBK0IsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBRXhGOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQW9CRztBQUtIO0lBQXdDLDhDQUFzQjtJQWE1RCw0QkFBb0IsVUFBc0IsRUFDdEIsUUFBbUIsRUFDbkIsaUJBQWtEO1FBRnRFLFlBSUUsaUJBQU8sU0FDUjtRQUxtQixnQkFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN0QixjQUFRLEdBQVIsUUFBUSxDQUFXO1FBQ25CLHVCQUFpQixHQUFqQixpQkFBaUIsQ0FBaUM7UUFOOUQsbUJBQWEsR0FBVyxDQUFDLENBQUM7O0lBU2xDLENBQUM7SUFFRCxxQ0FBUSxHQUFSO1FBQ0UsSUFBSSxDQUFDLCtCQUErQixFQUFFLENBQUM7SUFDekMsQ0FBQztJQUUyQix5Q0FBWSxHQUFaO1FBQTVCLGlCQWdCQztRQWZDLFVBQVUsQ0FBQztZQUNULElBQUksS0FBSSxDQUFDLE9BQU8sRUFBRTtnQkFDaEIsS0FBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsS0FBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBRWhFLEtBQUksQ0FBQyxXQUFXLENBQUMsS0FBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO2dCQUV0QyxLQUFJLENBQUMsaUJBQWlCLENBQUMsY0FBYyxDQUFDLEtBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztnQkFDNUQsS0FBSSxDQUFDLGNBQWMsR0FBRyxLQUFJLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztnQkFFakUsS0FBSSxDQUFDLFFBQVEsQ0FBQyxLQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7Z0JBRW5DLEtBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSSxDQUFDLE9BQU8sQ0FBQzthQUNyQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBRUwsQ0FBQztJQUUyQix5Q0FBWSxHQUFaO1FBQTVCLGlCQU1DO1FBTEMsa0dBQWtHO1FBQ2xHLG9HQUFvRztRQUNwRyxVQUFVLENBQUM7WUFDVCxLQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU8scUNBQVEsR0FBaEIsVUFBaUIsY0FBYztRQUM3QixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLGNBQVksY0FBZ0IsQ0FBQyxDQUFDO0lBQ3RFLENBQUM7SUFFTyxtREFBc0IsR0FBOUI7UUFDRSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUN0RSxDQUFDO0lBRUQsK0JBQStCO0lBQ3ZCLDBDQUFhLEdBQXJCO1FBQ0UsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBRTFELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbkQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1FBRTFELElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO1FBRTlELElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRTFELElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzdELElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzlELElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2hFLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUU5RSxJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFN0YsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7SUFDaEMsQ0FBQztJQUVPLDREQUErQixHQUF2QztRQUFBLGlCQVFDO1FBUEMsSUFBSSxDQUFDLHFCQUFxQixHQUFHO1lBQzNCLElBQUksQ0FBQyxLQUFJLENBQUMsUUFBUSxFQUFFO2dCQUNsQixVQUFVLENBQUM7b0JBQ1QsS0FBSSxDQUFDLGlCQUFpQixDQUFDLGNBQWMsQ0FBQyxLQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7Z0JBQzlELENBQUMsQ0FBQyxDQUFDO2FBQ0o7UUFDSCxDQUFDLENBQUM7SUFDSixDQUFDO0lBRU8sd0NBQVcsR0FBbkI7UUFDRSxJQUFJLElBQUksQ0FBQyxjQUFjLEVBQUU7WUFDdkIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUM1RCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztZQUVyQixJQUFJLENBQUMseUJBQXlCLEVBQUUsQ0FBQztTQUNsQztJQUNILENBQUM7SUFFTyx3Q0FBVyxHQUFuQixVQUFvQixjQUFjO1FBQ2hDLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLGVBQWEsY0FBZ0IsQ0FBQyxFQUFFO1lBQzlFLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsY0FBWSxjQUFnQixDQUFDLENBQUM7U0FDeEU7SUFDSCxDQUFDO0lBRU8sc0RBQXlCLEdBQWpDO1FBQ0UsTUFBTSxDQUFDLG1CQUFtQixDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMscUJBQXFCLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDekUsQ0FBQztJQUVPLHdDQUFXLEdBQW5CO1FBQ0UsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxjQUFjLENBQUMsQ0FBQztRQUMvRCxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUN6QixJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztRQUV0QixJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztJQUNoQyxDQUFDO0lBRU8sOENBQWlCLEdBQXpCO1FBQ0UsSUFBSSxJQUFJLENBQUMsZUFBZSxLQUFLLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDekMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDN0QsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDMUQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDOUQ7SUFDSCxDQUFDOztnQkEvRytCLFVBQVU7Z0JBQ1osU0FBUztnQkFDQSwrQkFBK0I7O0lBUzFDO1FBQTNCLFlBQVksQ0FBQyxZQUFZLENBQUM7Ozs7MERBZ0IxQjtJQUUyQjtRQUEzQixZQUFZLENBQUMsWUFBWSxDQUFDOzs7OzBEQU0xQjtJQWhEVSxrQkFBa0I7UUFKOUIsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLGFBQWE7WUFDdkIsU0FBUyxFQUFFLENBQUUsK0JBQStCLENBQUU7U0FDL0MsQ0FBQztpREFjZ0MsVUFBVTtZQUNaLFNBQVM7WUFDQSwrQkFBK0I7T0FmM0Qsa0JBQWtCLENBOEg5QjtJQUFELHlCQUFDO0NBQUEsQUE5SEQsQ0FBd0Msc0JBQXNCLEdBOEg3RDtTQTlIWSxrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIEhvc3RMaXN0ZW5lciwgT25Jbml0LCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgUG9Ub29sdGlwQmFzZURpcmVjdGl2ZSB9IGZyb20gJy4vcG8tdG9vbHRpcC1iYXNlLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBQb1Rvb2x0aXBDb250cm9sUG9zaXRpb25TZXJ2aWNlIH0gZnJvbSAnLi9wby10b29sdGlwLWNvbnRyb2wtcG9zaXRpb24uc2VydmljZSc7XG5cbi8qKlxuICogQGRvY3NFeHRlbmRzIFBvVG9vbHRpcEJhc2VEaXJlY3RpdmVcbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby10b29sdGlwLWJhc2ljXCIgdGl0bGU9XCJQb3J0aW5hcmkgVG9vbHRpcCBCYXNpY1wiID5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXRvb2x0aXAtYmFzaWMvc2FtcGxlLXBvLXRvb2x0aXAtYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdG9vbHRpcC1iYXNpYy9zYW1wbGUtcG8tdG9vbHRpcC1iYXNpYy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby10b29sdGlwLWxhYnNcIiB0aXRsZT1cIlBvcnRpbmFyaSBUb29sdGlwIExhYnNcIiA+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby10b29sdGlwLWxhYnMvc2FtcGxlLXBvLXRvb2x0aXAtbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby10b29sdGlwLWxhYnMvc2FtcGxlLXBvLXRvb2x0aXAtbGFicy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby10b29sdGlwLW5ldy11c2VyXCIgdGl0bGU9XCJQb3J0aW5hcmkgVG9vbHRpcCAtIE5ldyBVc2VyXCIgPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdG9vbHRpcC1uZXctdXNlci9zYW1wbGUtcG8tdG9vbHRpcC1uZXctdXNlci5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby10b29sdGlwLW5ldy11c2VyL3NhbXBsZS1wby10b29sdGlwLW5ldy11c2VyLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICovXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbcC10b29sdGlwXScsXG4gIHByb3ZpZGVyczogWyBQb1Rvb2x0aXBDb250cm9sUG9zaXRpb25TZXJ2aWNlIF1cbn0pXG5leHBvcnQgY2xhc3MgUG9Ub29sdGlwRGlyZWN0aXZlIGV4dGVuZHMgUG9Ub29sdGlwQmFzZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgcHJpdmF0ZSBhcnJvd0RpcmVjdGlvbjogc3RyaW5nO1xuICBwcml2YXRlIGRpdkFycm93O1xuICBwcml2YXRlIGRpdkNvbnRlbnQ7XG4gIHByaXZhdGUgaXNIaWRkZW46IGJvb2xlYW47XG4gIHByaXZhdGUgbGFzdFRvb2x0aXBUZXh0OiBzdHJpbmc7XG4gIHByaXZhdGUgdGV4dENvbnRlbnQ7XG4gIHByaXZhdGUgdG9vbHRpcENvbnRlbnQ7XG4gIHByaXZhdGUgdG9vbHRpcE9mZnNldDogbnVtYmVyID0gODtcblxuICBwcml2YXRlIGV2ZW50TGlzdGVuZXJGdW5jdGlvbjogKCkgPT4gdm9pZDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXG4gICAgICAgICAgICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICAgICAgICAgICAgcHJpdmF0ZSBwb0NvbnRyb2xQb3NpdGlvbjogUG9Ub29sdGlwQ29udHJvbFBvc2l0aW9uU2VydmljZSkge1xuXG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuaW5pdFNjcm9sbEV2ZW50TGlzdGVuZXJGdW5jdGlvbigpO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignbW91c2VlbnRlcicpIG9uTW91c2VFbnRlcigpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmICh0aGlzLnRvb2x0aXApIHtcbiAgICAgICAgdGhpcy50b29sdGlwQ29udGVudCA/IHRoaXMuc2hvd1Rvb2x0aXAoKSA6IHRoaXMuY3JlYXRlVG9vbHRpcCgpO1xuXG4gICAgICAgIHRoaXMucmVtb3ZlQXJyb3codGhpcy5hcnJvd0RpcmVjdGlvbik7XG5cbiAgICAgICAgdGhpcy5wb0NvbnRyb2xQb3NpdGlvbi5hZGp1c3RQb3NpdGlvbih0aGlzLnRvb2x0aXBQb3NpdGlvbik7XG4gICAgICAgIHRoaXMuYXJyb3dEaXJlY3Rpb24gPSB0aGlzLnBvQ29udHJvbFBvc2l0aW9uLmdldEFycm93RGlyZWN0aW9uKCk7XG5cbiAgICAgICAgdGhpcy5hZGRBcnJvdyh0aGlzLmFycm93RGlyZWN0aW9uKTtcblxuICAgICAgICB0aGlzLmxhc3RUb29sdGlwVGV4dCA9IHRoaXMudG9vbHRpcDtcbiAgICAgIH1cbiAgICB9KTtcblxuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignbW91c2VsZWF2ZScpIG9uTW91c2VMZWF2ZSgpIHtcbiAgICAvLyBuZWNlc3NpdGEgZG8gdGltZW91dCBwYXJhIGNvbnNlZ3VpciBhZGljaW9uYXIgXCIucG8taW52aXNpYmxlXCIsIHBvaXMgcXVhbmRvIHRlbSBhbGd1bnMgZWxlbWVudG9zXG4gICAgLy8gcHLDs3hpbW9zIGNvbSB0b29sdGlwcyBlIGZpY2FyIHBhc3NhbmRvIG8gbW91c2UgZW0gY2ltYSwgb3MgbWVzbW9zIG7Do28gZXN0YXZhbSBmaWNhbmRvIGludmlzaXZlaXMuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmhpZGVUb29sdGlwKCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFkZEFycm93KGFycm93RGlyZWN0aW9uKSB7XG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmRpdkFycm93LCBgcG8tYXJyb3ctJHthcnJvd0RpcmVjdGlvbn1gKTtcbiAgfVxuXG4gIHByaXZhdGUgYWRkU2Nyb2xsRXZlbnRMaXN0ZW5lcigpIHtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5ldmVudExpc3RlbmVyRnVuY3Rpb24sIHRydWUpO1xuICB9XG5cbiAgLy8gTW9udGEgYSBlc3RydXR1cmEgZG8gdG9vbHRpcFxuICBwcml2YXRlIGNyZWF0ZVRvb2x0aXAoKSB7XG4gICAgdGhpcy50b29sdGlwQ29udGVudCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLnRvb2x0aXBDb250ZW50LCAncG8tdG9vbHRpcCcpO1xuXG4gICAgdGhpcy5kaXZBcnJvdyA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmRpdkFycm93LCAncG8tdG9vbHRpcC1hcnJvdycpO1xuXG4gICAgdGhpcy5kaXZDb250ZW50ID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZGl2Q29udGVudCwgJ3BvLXRvb2x0aXAtY29udGVudCcpO1xuXG4gICAgdGhpcy50ZXh0Q29udGVudCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlVGV4dCh0aGlzLnRvb2x0aXApO1xuXG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLmRpdkNvbnRlbnQsIHRoaXMudGV4dENvbnRlbnQpO1xuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy50b29sdGlwQ29udGVudCwgdGhpcy5kaXZBcnJvdyk7XG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLnRvb2x0aXBDb250ZW50LCB0aGlzLmRpdkNvbnRlbnQpO1xuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsIHRoaXMudG9vbHRpcENvbnRlbnQpO1xuXG4gICAgdGhpcy5wb0NvbnRyb2xQb3NpdGlvbi5zZXRFbGVtZW50cyh0aGlzLnRvb2x0aXBDb250ZW50LCB0aGlzLnRvb2x0aXBPZmZzZXQsIHRoaXMuZWxlbWVudFJlZik7XG5cbiAgICB0aGlzLmFkZFNjcm9sbEV2ZW50TGlzdGVuZXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdFNjcm9sbEV2ZW50TGlzdGVuZXJGdW5jdGlvbigpIHtcbiAgICB0aGlzLmV2ZW50TGlzdGVuZXJGdW5jdGlvbiA9ICgpID0+IHtcbiAgICAgIGlmICghdGhpcy5pc0hpZGRlbikge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0aGlzLnBvQ29udHJvbFBvc2l0aW9uLmFkanVzdFBvc2l0aW9uKHRoaXMudG9vbHRpcFBvc2l0aW9uKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgaGlkZVRvb2x0aXAoKSB7XG4gICAgaWYgKHRoaXMudG9vbHRpcENvbnRlbnQpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy50b29sdGlwQ29udGVudCwgJ3BvLWludmlzaWJsZScpO1xuICAgICAgdGhpcy5pc0hpZGRlbiA9IHRydWU7XG5cbiAgICAgIHRoaXMucmVtb3ZlU2Nyb2xsRXZlbnRMaXN0ZW5lcigpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlQXJyb3coYXJyb3dEaXJlY3Rpb24pIHtcbiAgICBpZiAodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcihgLnBvLWFycm93LSR7YXJyb3dEaXJlY3Rpb259YCkpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2xhc3ModGhpcy5kaXZBcnJvdywgYHBvLWFycm93LSR7YXJyb3dEaXJlY3Rpb259YCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVTY3JvbGxFdmVudExpc3RlbmVyKCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLmV2ZW50TGlzdGVuZXJGdW5jdGlvbiwgdHJ1ZSk7XG4gIH1cblxuICBwcml2YXRlIHNob3dUb29sdGlwKCkge1xuICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2xhc3ModGhpcy50b29sdGlwQ29udGVudCwgJ3BvLWludmlzaWJsZScpO1xuICAgIHRoaXMudXBkYXRlVGV4dENvbnRlbnQoKTtcbiAgICB0aGlzLmlzSGlkZGVuID0gZmFsc2U7XG5cbiAgICB0aGlzLmFkZFNjcm9sbEV2ZW50TGlzdGVuZXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlVGV4dENvbnRlbnQoKSB7XG4gICAgaWYgKHRoaXMubGFzdFRvb2x0aXBUZXh0ICE9PSB0aGlzLnRvb2x0aXApIHtcbiAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2hpbGQodGhpcy5kaXZDb250ZW50LCB0aGlzLnRleHRDb250ZW50KTtcbiAgICAgIHRoaXMudGV4dENvbnRlbnQgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZVRleHQodGhpcy50b29sdGlwKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5kaXZDb250ZW50LCB0aGlzLnRleHRDb250ZW50KTtcbiAgICB9XG4gIH1cblxufVxuIl19