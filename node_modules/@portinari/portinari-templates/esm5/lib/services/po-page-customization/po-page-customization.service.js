/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { from } from 'rxjs';
import { map } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
var PoPageCustomizationService = /** @class */ (function () {
    function PoPageCustomizationService(http) {
        this.http = http;
    }
    /**
     * @template T
     * @param {?} origin
     * @param {?} originalOption
     * @param {?} optionSchema
     * @return {?}
     */
    PoPageCustomizationService.prototype.getCustomOptions = /**
     * @template T
     * @param {?} origin
     * @param {?} originalOption
     * @param {?} optionSchema
     * @return {?}
     */
    function (origin, originalOption, optionSchema) {
        var _this = this;
        return this.createObservable(origin).pipe(map((/**
         * @param {?} newPageOptions
         * @return {?}
         */
        function (newPageOptions) { return _this.mergePageOptions(originalOption, newPageOptions, optionSchema); })));
    };
    /**
     * @template T, K
     * @param {?} objectToChange
     * @param {?} newOptions
     * @return {?}
     */
    PoPageCustomizationService.prototype.changeOriginalOptionsToNewOptions = /**
     * @template T, K
     * @param {?} objectToChange
     * @param {?} newOptions
     * @return {?}
     */
    function (objectToChange, newOptions) {
        Object.keys(newOptions).forEach((/**
         * @param {?} key
         * @return {?}
         */
        function (key) {
            /** @type {?} */
            var value = newOptions[key];
            if (objectToChange[key]) {
                if (Array.isArray(value)) {
                    objectToChange[key] = tslib_1.__spread(value);
                    return;
                }
                if ((typeof (value) === 'number' || typeof (value) === 'string')) {
                    objectToChange[key] = value;
                    return;
                }
                if (typeof (value) === 'object') {
                    objectToChange[key] = tslib_1.__assign({}, value);
                }
            }
        }));
    };
    /**
     * @private
     * @template T
     * @param {?} origin
     * @return {?}
     */
    PoPageCustomizationService.prototype.createObservable = /**
     * @private
     * @template T
     * @param {?} origin
     * @return {?}
     */
    function (origin) {
        if (typeof origin === 'string') {
            return this.http.post(origin, {});
        }
        return from(Promise.resolve(origin()));
    };
    /**
     * @private
     * @template T
     * @param {?} originalOption
     * @param {?} newPageOptions
     * @param {?} optionSchema
     * @return {?}
     */
    PoPageCustomizationService.prototype.mergePageOptions = /**
     * @private
     * @template T
     * @param {?} originalOption
     * @param {?} newPageOptions
     * @param {?} optionSchema
     * @return {?}
     */
    function (originalOption, newPageOptions, optionSchema) {
        var _this = this;
        /** @type {?} */
        var mergePageOptions = optionSchema.schema.reduce((/**
         * @param {?} objWithNewProp
         * @param {?} prop
         * @return {?}
         */
        function (objWithNewProp, prop) {
            var _a;
            return (tslib_1.__assign({}, objWithNewProp, (_a = {}, _a[prop.nameProp] = _this.createNewProp(prop, originalOption, newPageOptions), _a)));
        }), (/** @type {?} */ ({})));
        Object.keys(mergePageOptions).forEach((/**
         * @param {?} key
         * @return {?}
         */
        function (key) { return !mergePageOptions[key] && delete mergePageOptions[key]; }));
        return mergePageOptions;
    };
    /**
     * @private
     * @template T
     * @param {?} prop
     * @param {?} originalOption
     * @param {?} newPageOptions
     * @return {?}
     */
    PoPageCustomizationService.prototype.createNewProp = /**
     * @private
     * @template T
     * @param {?} prop
     * @param {?} originalOption
     * @param {?} newPageOptions
     * @return {?}
     */
    function (prop, originalOption, newPageOptions) {
        if (prop.merge) {
            return this.mergeOptions(originalOption[prop.nameProp], newPageOptions[prop.nameProp], prop.keyForMerge);
        }
        else {
            return newPageOptions[prop.nameProp] || originalOption[prop.nameProp];
        }
    };
    /**
     * @private
     * @template T
     * @param {?} originalOptions
     * @param {?} newOptions
     * @param {?=} filterProp
     * @return {?}
     */
    PoPageCustomizationService.prototype.mergeOptions = /**
     * @private
     * @template T
     * @param {?} originalOptions
     * @param {?} newOptions
     * @param {?=} filterProp
     * @return {?}
     */
    function (originalOptions, newOptions, filterProp) {
        if (!originalOptions && !newOptions) {
            return;
        }
        if (!newOptions) {
            return originalOptions;
        }
        if (!originalOptions) {
            return newOptions;
        }
        if (originalOptions instanceof Array && newOptions instanceof Array) {
            return this.mergeOptionsArray(originalOptions, newOptions, filterProp);
        }
        return tslib_1.__assign({}, originalOptions, newOptions);
    };
    /**
     * @private
     * @template T
     * @param {?} originalOptions
     * @param {?} newOptions
     * @param {?} filterProp
     * @return {?}
     */
    PoPageCustomizationService.prototype.mergeOptionsArray = /**
     * @private
     * @template T
     * @param {?} originalOptions
     * @param {?} newOptions
     * @param {?} filterProp
     * @return {?}
     */
    function (originalOptions, newOptions, filterProp) {
        /** @type {?} */
        var deduplicateNewOptions = newOptions.filter((/**
         * @param {?} newItem
         * @return {?}
         */
        function (newItem) { return !originalOptions.find((/**
         * @param {?} originalItem
         * @return {?}
         */
        function (originalItem) { return originalItem[filterProp] === newItem[filterProp]; })); }));
        /** @type {?} */
        var mergedOriginalOptions = originalOptions.map((/**
         * @param {?} originalItem
         * @return {?}
         */
        function (originalItem) {
            /** @type {?} */
            var newItem = newOptions.find((/**
             * @param {?} newOptionsItem
             * @return {?}
             */
            function (newOptionsItem) { return originalItem[filterProp] === newOptionsItem[filterProp]; })) || originalItem;
            return tslib_1.__assign({}, originalItem, newItem);
        }));
        return tslib_1.__spread(mergedOriginalOptions, deduplicateNewOptions);
    };
    PoPageCustomizationService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    PoPageCustomizationService.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    /** @nocollapse */ PoPageCustomizationService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function PoPageCustomizationService_Factory() { return new PoPageCustomizationService(i0.ɵɵinject(i1.HttpClient)); }, token: PoPageCustomizationService, providedIn: "root" });
    return PoPageCustomizationService;
}());
export { PoPageCustomizationService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PoPageCustomizationService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcGFnZS1jdXN0b21pemF0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9ydGluYXJpL3BvcnRpbmFyaS10ZW1wbGF0ZXMvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvcG8tcGFnZS1jdXN0b21pemF0aW9uL3BvLXBhZ2UtY3VzdG9taXphdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFjLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN4QyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7OztBQUtyQztJQU1FLG9DQUFvQixJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO0lBQUksQ0FBQzs7Ozs7Ozs7SUFFekMscURBQWdCOzs7Ozs7O0lBQWhCLFVBQW9CLE1BQXFCLEVBQUUsY0FBaUIsRUFBRSxZQUEyQztRQUF6RyxpQkFJQztRQUhDLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFJLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FDMUMsR0FBRzs7OztRQUFDLFVBQUEsY0FBYyxJQUFJLE9BQUEsS0FBSSxDQUFDLGdCQUFnQixDQUFJLGNBQWMsRUFBRSxjQUFjLEVBQUUsWUFBWSxDQUFDLEVBQXRFLENBQXNFLEVBQUMsQ0FDOUYsQ0FBQztJQUNKLENBQUM7Ozs7Ozs7SUFFRCxzRUFBaUM7Ozs7OztJQUFqQyxVQUF3QyxjQUFpQixFQUFFLFVBQWE7UUFDdEUsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPOzs7O1FBQUMsVUFBQSxHQUFHOztnQkFDM0IsS0FBSyxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUM7WUFDN0IsSUFBSSxjQUFjLENBQUMsR0FBRyxDQUFDLEVBQUU7Z0JBQ3ZC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QUssVUFBVSxFQUFFO0lBRTdDLENBQUM7Ozs7Ozs7OztJQUVPLHNEQUFpQjs7Ozs7Ozs7SUFBekIsVUFBNkIsZUFBeUIsRUFBRSxVQUFvQixFQUFFLFVBQW1COztZQUN6RixxQkFBcUIsR0FBRyxVQUFVLENBQUMsTUFBTTs7OztRQUM3QyxVQUFBLE9BQU8sSUFBSSxPQUFBLENBQUMsZUFBZSxDQUFDLElBQUk7Ozs7UUFBQyxVQUFBLFlBQVksSUFBSSxPQUFBLFlBQVksQ0FBQyxVQUFVLENBQUMsS0FBSyxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQWhELENBQWdELEVBQUMsRUFBdkYsQ0FBdUYsRUFBQzs7WUFDL0YscUJBQXFCLEdBQUcsZUFBZSxDQUFDLEdBQUc7Ozs7UUFBQyxVQUFBLFlBQVk7O2dCQUNwRCxPQUFPLEdBQUcsVUFBVSxDQUFDLElBQUk7Ozs7WUFBQyxVQUFBLGNBQWMsSUFBSSxPQUFBLFlBQVksQ0FBQyxVQUFVLENBQUMsS0FBSyxjQUFjLENBQUMsVUFBVSxDQUFDLEVBQXZELENBQXVELEVBQUMsSUFBSSxZQUFZO1lBQzFILDRCQUFXLFlBQVksRUFBSyxPQUFPLEVBQUU7UUFDdkMsQ0FBQyxFQUNGO1FBQ0Qsd0JBQVcscUJBQXFCLEVBQUsscUJBQXFCLEVBQUU7SUFDOUQsQ0FBQzs7Z0JBekZGLFVBQVUsU0FBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkI7Ozs7Z0JBWFEsVUFBVTs7O3FDQUFuQjtDQW1HQyxBQTFGRCxJQTBGQztTQXRGWSwwQkFBMEI7Ozs7OztJQUV6QiwwQ0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBmcm9tIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgUG9QYWdlRHluYW1pY09wdGlvbnNTY2hlbWEsIFBvUGFnZUR5bmFtaWNPcHRpb25zUHJvcCB9IGZyb20gJy4vcG8tcGFnZS1keW5hbWljLW9wdGlvbnMuaW50ZXJmYWNlJztcclxuXHJcbnR5cGUgdXJsT3JGdW5jdGlvbiA9IHN0cmluZyB8IEZ1bmN0aW9uIDtcclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICBwcm92aWRlZEluOiAncm9vdCdcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBQb1BhZ2VDdXN0b21pemF0aW9uU2VydmljZSB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cENsaWVudCkgeyB9XHJcblxyXG4gIGdldEN1c3RvbU9wdGlvbnM8VD4ob3JpZ2luOiB1cmxPckZ1bmN0aW9uLCBvcmlnaW5hbE9wdGlvbjogVCwgb3B0aW9uU2NoZW1hOiBQb1BhZ2VEeW5hbWljT3B0aW9uc1NjaGVtYTxUPik6IE9ic2VydmFibGU8VD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlT2JzZXJ2YWJsZTxUPihvcmlnaW4pLnBpcGUoXHJcbiAgICAgIG1hcChuZXdQYWdlT3B0aW9ucyA9PiB0aGlzLm1lcmdlUGFnZU9wdGlvbnM8VD4ob3JpZ2luYWxPcHRpb24sIG5ld1BhZ2VPcHRpb25zLCBvcHRpb25TY2hlbWEpKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGNoYW5nZU9yaWdpbmFsT3B0aW9uc1RvTmV3T3B0aW9uczxULCBLPihvYmplY3RUb0NoYW5nZTogVCwgbmV3T3B0aW9uczogSykge1xyXG4gICAgT2JqZWN0LmtleXMobmV3T3B0aW9ucykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICBjb25zdCB2YWx1ZSA9IG5ld09wdGlvbnNba2V5XTtcclxuICAgICAgaWYgKG9iamVjdFRvQ2hhbmdlW2tleV0pIHtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcclxuICAgICAgICAgIG9iamVjdFRvQ2hhbmdlW2tleV0gPSBbLi4udmFsdWVdO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoKHR5cGVvZiAodmFsdWUpID09PSAnbnVtYmVyJyB8fCB0eXBlb2YgKHZhbHVlKSA9PT0gJ3N0cmluZycpKSB7XHJcbiAgICAgICAgICBvYmplY3RUb0NoYW5nZVtrZXldID0gdmFsdWU7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgKHZhbHVlKSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgIG9iamVjdFRvQ2hhbmdlW2tleV0gPSB7IC4uLnZhbHVlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY3JlYXRlT2JzZXJ2YWJsZTxUPihvcmlnaW46IHVybE9yRnVuY3Rpb24pOiBPYnNlcnZhYmxlPFQ+IHtcclxuICAgIGlmICh0eXBlb2Ygb3JpZ2luID09PSAnc3RyaW5nJykge1xyXG4gICAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8VD4ob3JpZ2luLCB7fSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZnJvbShQcm9taXNlLnJlc29sdmUob3JpZ2luKCkpKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgbWVyZ2VQYWdlT3B0aW9uczxUPihvcmlnaW5hbE9wdGlvbjogVCwgbmV3UGFnZU9wdGlvbnM6IFQsIG9wdGlvblNjaGVtYTogUG9QYWdlRHluYW1pY09wdGlvbnNTY2hlbWE8VD4pIHtcclxuXHJcbiAgICBjb25zdCBtZXJnZVBhZ2VPcHRpb25zOiBUID0gb3B0aW9uU2NoZW1hLnNjaGVtYS5yZWR1Y2UoXHJcbiAgICAgIChvYmpXaXRoTmV3UHJvcCwgcHJvcCkgPT5cclxuICAgICAgKHsuLi5vYmpXaXRoTmV3UHJvcCwgW3Byb3AubmFtZVByb3BdOiB0aGlzLmNyZWF0ZU5ld1Byb3AocHJvcCwgb3JpZ2luYWxPcHRpb24sIG5ld1BhZ2VPcHRpb25zKX0pXHJcbiAgICAgICwge30gYXMgVCk7XHJcblxyXG4gICAgT2JqZWN0LmtleXMobWVyZ2VQYWdlT3B0aW9ucykuZm9yRWFjaChrZXkgPT4gIW1lcmdlUGFnZU9wdGlvbnNba2V5XSAmJiBkZWxldGUgbWVyZ2VQYWdlT3B0aW9uc1trZXldKTtcclxuXHJcbiAgICByZXR1cm4gbWVyZ2VQYWdlT3B0aW9ucztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY3JlYXRlTmV3UHJvcDxUPihwcm9wOiBQb1BhZ2VEeW5hbWljT3B0aW9uc1Byb3A8VD4sIG9yaWdpbmFsT3B0aW9uOiBULCBuZXdQYWdlT3B0aW9uczogVCkge1xyXG4gICAgaWYgKHByb3AubWVyZ2UpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5tZXJnZU9wdGlvbnMob3JpZ2luYWxPcHRpb25bcHJvcC5uYW1lUHJvcF0sIG5ld1BhZ2VPcHRpb25zW3Byb3AubmFtZVByb3BdLCBwcm9wLmtleUZvck1lcmdlICApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIG5ld1BhZ2VPcHRpb25zW3Byb3AubmFtZVByb3BdIHx8IG9yaWdpbmFsT3B0aW9uW3Byb3AubmFtZVByb3BdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBtZXJnZU9wdGlvbnM8VD4ob3JpZ2luYWxPcHRpb25zOiAoQXJyYXk8VD4gfCBUKSAsIG5ld09wdGlvbnM6IChBcnJheTxUPiB8IFQpICwgZmlsdGVyUHJvcD86IGtleW9mIFQpIHtcclxuXHJcbiAgICBpZiAoIW9yaWdpbmFsT3B0aW9ucyAmJiAhbmV3T3B0aW9ucykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIW5ld09wdGlvbnMpIHtcclxuICAgICAgcmV0dXJuIG9yaWdpbmFsT3B0aW9ucztcclxuICAgIH1cclxuICAgIGlmICghb3JpZ2luYWxPcHRpb25zKSB7XHJcbiAgICAgIHJldHVybiBuZXdPcHRpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChvcmlnaW5hbE9wdGlvbnMgaW5zdGFuY2VvZiBBcnJheSAmJiBuZXdPcHRpb25zIGluc3RhbmNlb2YgQXJyYXkgKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLm1lcmdlT3B0aW9uc0FycmF5KG9yaWdpbmFsT3B0aW9ucywgbmV3T3B0aW9ucywgZmlsdGVyUHJvcCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsuLi5vcmlnaW5hbE9wdGlvbnMsIC4uLm5ld09wdGlvbnN9O1xyXG5cclxuICB9XHJcblxyXG4gIHByaXZhdGUgbWVyZ2VPcHRpb25zQXJyYXk8VD4ob3JpZ2luYWxPcHRpb25zOiBBcnJheTxUPiwgbmV3T3B0aW9uczogQXJyYXk8VD4sIGZpbHRlclByb3A6IGtleW9mIFQpIHtcclxuICAgIGNvbnN0IGRlZHVwbGljYXRlTmV3T3B0aW9ucyA9IG5ld09wdGlvbnMuZmlsdGVyKFxyXG4gICAgICBuZXdJdGVtID0+ICFvcmlnaW5hbE9wdGlvbnMuZmluZChvcmlnaW5hbEl0ZW0gPT4gb3JpZ2luYWxJdGVtW2ZpbHRlclByb3BdID09PSBuZXdJdGVtW2ZpbHRlclByb3BdKSk7XHJcbiAgICBjb25zdCBtZXJnZWRPcmlnaW5hbE9wdGlvbnMgPSBvcmlnaW5hbE9wdGlvbnMubWFwKG9yaWdpbmFsSXRlbSA9PiB7XHJcbiAgICAgICAgY29uc3QgbmV3SXRlbSA9IG5ld09wdGlvbnMuZmluZChuZXdPcHRpb25zSXRlbSA9PiBvcmlnaW5hbEl0ZW1bZmlsdGVyUHJvcF0gPT09IG5ld09wdGlvbnNJdGVtW2ZpbHRlclByb3BdKSB8fCBvcmlnaW5hbEl0ZW07XHJcbiAgICAgICAgcmV0dXJuIHsuLi5vcmlnaW5hbEl0ZW0sIC4uLm5ld0l0ZW19O1xyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgcmV0dXJuIFsuLi5tZXJnZWRPcmlnaW5hbE9wdGlvbnMsIC4uLmRlZHVwbGljYXRlTmV3T3B0aW9uc107XHJcbiAgfVxyXG59XHJcbiJdfQ==