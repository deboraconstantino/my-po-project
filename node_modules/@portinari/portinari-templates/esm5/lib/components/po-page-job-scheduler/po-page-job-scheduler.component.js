/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ActivatedRoute, Router } from '@angular/router';
import { Component, ViewChild, ViewEncapsulation } from '@angular/core';
import { PoDialogService, PoNotificationService, PoStepperStatus } from '@portinari/portinari-ui';
import * as util from './../../utils/util';
import { PoPageJobSchedulerInternal } from './po-page-job-scheduler-internal';
import { PoPageJobSchedulerBaseComponent } from './po-page-job-scheduler-base.component';
import { poPageJobSchedulerLiteralsDefault } from './po-page-job-scheduler-literals';
import { PoPageJobSchedulerLookupService } from './po-page-job-scheduler-lookup.service';
import { PoPageJobSchedulerService } from './po-page-job-scheduler.service';
/**
 * \@docsExtends PoPageJobSchedulerBaseComponent
 *
 * \@example
 *
 * <example name="po-page-job-scheduler-basic" title="Portinari Page Job Scheduler Basic">
 *  <file name="sample-po-page-job-scheduler-basic/sample-po-page-job-scheduler-basic.component.html"> </file>
 *  <file name="sample-po-page-job-scheduler-basic/sample-po-page-job-scheduler-basic.component.ts"> </file>
 * </example>
 *
 */
var PoPageJobSchedulerComponent = /** @class */ (function (_super) {
    tslib_1.__extends(PoPageJobSchedulerComponent, _super);
    function PoPageJobSchedulerComponent(poPageDynamicLookupService, activatedRoute, poDialogService, poNotification, router, poPageJobSchedulerService) {
        var _this = _super.call(this, poPageJobSchedulerService) || this;
        _this.poPageDynamicLookupService = poPageDynamicLookupService;
        _this.activatedRoute = activatedRoute;
        _this.poDialogService = poDialogService;
        _this.poNotification = poNotification;
        _this.router = router;
        _this.isEdit = false;
        _this.literals = tslib_1.__assign({}, poPageJobSchedulerLiteralsDefault[util.poLocaleDefault], poPageJobSchedulerLiteralsDefault[util.browserLanguage()]);
        _this.parameters = [];
        _this.step = 1;
        _this.backPageAction = {
            label: _this.literals.back,
            action: _this.nextStepOperation.bind(_this, 'back'),
            disabled: _this.isDisabledBack.bind(_this)
        };
        _this.concludePageActions = [
            {
                label: _this.literals.conclude,
                action: _this.confirmJobScheduler.bind(_this)
            },
            tslib_1.__assign({}, _this.backPageAction)
        ];
        _this.nextPageActions = [
            {
                label: _this.literals.next,
                action: _this.nextStepOperation.bind(_this, 'next'),
                disabled: _this.isDisabledAdvance.bind(_this)
            },
            tslib_1.__assign({}, _this.backPageAction)
        ];
        _this.jobSchedulerActions = tslib_1.__spread(_this.nextPageActions);
        _this.steps = [
            { label: _this.literals.scheduling },
            { label: _this.literals.parameterization },
            { label: _this.literals.conclude }
        ];
        return _this;
    }
    Object.defineProperty(PoPageJobSchedulerComponent.prototype, "stepperOrientation", {
        get: /**
         * @return {?}
         */
        function () {
            return window.innerWidth > 481 && window.innerWidth < 960 ? 'horizontal' : 'vertical';
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PoPageJobSchedulerComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var paramId = this.activatedRoute.snapshot.params['id'];
        this.isEdit = !!paramId;
        this.poPageJobSchedulerService.configServiceApi({ endpoint: this.serviceApi });
        this.loadData(paramId);
    };
    /**
     * @param {?} currentStep
     * @param {?} nextStep
     * @return {?}
     */
    PoPageJobSchedulerComponent.prototype.changePageActionsBySteps = /**
     * @param {?} currentStep
     * @param {?} nextStep
     * @return {?}
     */
    function (currentStep, nextStep) {
        /** @type {?} */
        var stepsLength = this.steps.length;
        if (nextStep === stepsLength) {
            this.jobSchedulerActions = tslib_1.__spread(this.concludePageActions);
        }
        else if (currentStep === stepsLength && nextStep < currentStep) {
            this.jobSchedulerActions = tslib_1.__spread(this.nextPageActions);
        }
    };
    /**
     * @param {?} stepNumber
     * @return {?}
     */
    PoPageJobSchedulerComponent.prototype.nextStep = /**
     * @param {?} stepNumber
     * @return {?}
     */
    function (stepNumber) {
        if (stepNumber > 1 && this.schedulerExecution.form.invalid) {
            this.markAsDirtyInvalidControls(this.schedulerExecution.form.controls);
            return;
        }
        if (stepNumber > 2 && (this.schedulerParameters && this.schedulerParameters.form && this.schedulerParameters.form.invalid)) {
            this.markAsDirtyInvalidControls(this.schedulerParameters.form.controls);
            return;
        }
        this.changePageActionsBySteps(this.step, stepNumber);
        /** @type {?} */
        var steps = this.steps[this.step - 1];
        this.step = stepNumber;
        if (steps) {
            steps.status = PoStepperStatus.Done;
        }
    };
    /**
     * @param {?} process
     * @return {?}
     */
    PoPageJobSchedulerComponent.prototype.onChangeProcess = /**
     * @param {?} process
     * @return {?}
     */
    function (process) {
        if (process.existAPI && process.processId) {
            this.getParametersByProcess(process.processId);
            if (!this.isEdit) {
                this.model.executionParameter = {};
            }
            return;
        }
    };
    /**
     * @private
     * @return {?}
     */
    PoPageJobSchedulerComponent.prototype.confirmJobScheduler = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var paramId = this.activatedRoute.snapshot.params['id'];
        /** @type {?} */
        var confirmMessage = paramId ? this.literals.confirmUpdateMessage : this.literals.confirmSaveMessage;
        this.poDialogService.confirm({
            title: this.literals.confirmation,
            message: confirmMessage,
            confirm: (/**
             * @return {?}
             */
            function () {
                /** @type {?} */
                var model = Object.assign({}, _this.model);
                _this.save(model, paramId);
            })
        });
    };
    /**
     * @private
     * @param {?} msgSuccess
     * @param {?} saveOperation
     * @return {?}
     */
    PoPageJobSchedulerComponent.prototype.emitSuccessMessage = /**
     * @private
     * @param {?} msgSuccess
     * @param {?} saveOperation
     * @return {?}
     */
    function (msgSuccess, saveOperation) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, saveOperation.toPromise()];
                    case 1:
                        _a.sent();
                        this.poNotification.success(msgSuccess);
                        this.resetJobSchedulerForm();
                        return [2 /*return*/];
                }
            });
        });
    };
    /**
     * @private
     * @param {?} process
     * @return {?}
     */
    PoPageJobSchedulerComponent.prototype.getParametersByProcess = /**
     * @private
     * @param {?} process
     * @return {?}
     */
    function (process) {
        var _this = this;
        this.poPageJobSchedulerService.getParametersByProcess(process).subscribe((/**
         * @param {?} parameters
         * @return {?}
         */
        function (parameters) {
            _this.parameters = parameters;
        }));
    };
    /**
     * @private
     * @return {?}
     */
    PoPageJobSchedulerComponent.prototype.isDisabledAdvance = /**
     * @private
     * @return {?}
     */
    function () {
        return this.schedulerExecution ? this.schedulerExecution.form.invalid : false;
    };
    /**
     * @private
     * @return {?}
     */
    PoPageJobSchedulerComponent.prototype.isDisabledBack = /**
     * @private
     * @return {?}
     */
    function () {
        return this.step === 1;
    };
    /**
     * @private
     * @param {?=} operation
     * @return {?}
     */
    PoPageJobSchedulerComponent.prototype.nextStepOperation = /**
     * @private
     * @param {?=} operation
     * @return {?}
     */
    function (operation) {
        /** @type {?} */
        var stepNumber = operation === 'back' ? this.step - 1 : this.step + 1;
        this.nextStep(stepNumber);
    };
    /**
     * @private
     * @return {?}
     */
    PoPageJobSchedulerComponent.prototype.resetJobSchedulerForm = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.schedulerExecution.form.reset();
        // radiogroup n√£o estava atribuindo novo valor, fica vermelho sem o timetout.
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.model = new PoPageJobSchedulerInternal();
            _this.step = 1;
            _this.steps.forEach((/**
             * @param {?} step
             * @return {?}
             */
            function (step) {
                step.status = PoStepperStatus.Default;
            }));
            _this.jobSchedulerActions = tslib_1.__spread(_this.nextPageActions);
        }));
    };
    /**
     * @private
     * @param {?} model
     * @param {?} paramId
     * @return {?}
     */
    PoPageJobSchedulerComponent.prototype.save = /**
     * @private
     * @param {?} model
     * @param {?} paramId
     * @return {?}
     */
    function (model, paramId) {
        /** @type {?} */
        var saveOperation = paramId
            ? this.poPageJobSchedulerService.updateResource(paramId, model)
            : this.poPageJobSchedulerService.createResource(model);
        /** @type {?} */
        var msgSuccess = paramId ? this.literals.saveNotificationSuccessUpdate : this.literals.saveNotificationSuccessSave;
        this.emitSuccessMessage(msgSuccess, saveOperation);
    };
    PoPageJobSchedulerComponent.decorators = [
        { type: Component, args: [{
                    selector: 'po-page-job-scheduler',
                    template: "<po-page-default\r\n  [p-actions]=\"jobSchedulerActions\"\r\n  [p-breadcrumb]=\"breadcrumb\"\r\n  [p-title]=\"title\">\r\n\r\n  <div class=\"po-row\">\r\n\r\n    <po-stepper\r\n      class=\"po-lg-3 po-xl-2\"\r\n      p-sequential=\"true\"\r\n      [p-orientation]=\"stepperOrientation\"\r\n      [p-step]=\"step\"\r\n      [p-steps]=\"steps\"\r\n      (p-change-step)=\"nextStep($event)\">\r\n    </po-stepper>\r\n\r\n    <po-container class=\"po-lg-8 po-xl-6\">\r\n      <form #formScheduler=\"ngForm\">\r\n        <div class=\"po-row\">\r\n          <po-page-job-scheduler-execution [hidden]=\"step !== 1\"\r\n            #schedulerExecution\r\n            class=\"po-md-12\"\r\n            [p-is-edit]=\"isEdit\"\r\n            [p-literals]=\"literals\"\r\n            [p-value]=\"model\"\r\n            (p-change-process)=\"onChangeProcess($event)\">\r\n          </po-page-job-scheduler-execution>\r\n\r\n          <po-page-job-scheduler-parameters *ngIf=\"step === 2\"\r\n            #schedulerParameters\r\n            class=\"po-md-12\"\r\n            [p-literals]=\"literals\"\r\n            [p-parameters]=\"parameters || []\"\r\n            [(p-value)]=\"model.executionParameter\">\r\n          </po-page-job-scheduler-parameters>\r\n\r\n          <po-page-job-scheduler-summary *ngIf=\"step === 3\"\r\n            class=\"po-md-12\"\r\n            [p-literals]=\"literals\"\r\n            [p-parameters]=\"parameters\"\r\n            [p-value]=\"model\">\r\n          </po-page-job-scheduler-summary>\r\n        </div>\r\n      </form>\r\n    </po-container>\r\n  </div>\r\n\r\n</po-page-default>\r\n",
                    encapsulation: ViewEncapsulation.None,
                    styles: ["\n    po-container .po-container {\n      overflow-y: unset;\n    }\n  "]
                }] }
    ];
    /** @nocollapse */
    PoPageJobSchedulerComponent.ctorParameters = function () { return [
        { type: PoPageJobSchedulerLookupService },
        { type: ActivatedRoute },
        { type: PoDialogService },
        { type: PoNotificationService },
        { type: Router },
        { type: PoPageJobSchedulerService }
    ]; };
    PoPageJobSchedulerComponent.propDecorators = {
        schedulerExecution: [{ type: ViewChild, args: ['schedulerExecution', { static: true },] }],
        schedulerParameters: [{ type: ViewChild, args: ['schedulerParameters', { static: true },] }]
    };
    return PoPageJobSchedulerComponent;
}(PoPageJobSchedulerBaseComponent));
export { PoPageJobSchedulerComponent };
if (false) {
    /** @type {?} */
    PoPageJobSchedulerComponent.prototype.isEdit;
    /** @type {?} */
    PoPageJobSchedulerComponent.prototype.literals;
    /** @type {?} */
    PoPageJobSchedulerComponent.prototype.parameters;
    /** @type {?} */
    PoPageJobSchedulerComponent.prototype.saveOperation;
    /** @type {?} */
    PoPageJobSchedulerComponent.prototype.step;
    /**
     * @type {?}
     * @private
     */
    PoPageJobSchedulerComponent.prototype.backPageAction;
    /**
     * @type {?}
     * @private
     */
    PoPageJobSchedulerComponent.prototype.concludePageActions;
    /**
     * @type {?}
     * @private
     */
    PoPageJobSchedulerComponent.prototype.nextPageActions;
    /** @type {?} */
    PoPageJobSchedulerComponent.prototype.jobSchedulerActions;
    /** @type {?} */
    PoPageJobSchedulerComponent.prototype.steps;
    /** @type {?} */
    PoPageJobSchedulerComponent.prototype.schedulerExecution;
    /** @type {?} */
    PoPageJobSchedulerComponent.prototype.schedulerParameters;
    /** @type {?} */
    PoPageJobSchedulerComponent.prototype.poPageDynamicLookupService;
    /**
     * @type {?}
     * @private
     */
    PoPageJobSchedulerComponent.prototype.activatedRoute;
    /**
     * @type {?}
     * @private
     */
    PoPageJobSchedulerComponent.prototype.poDialogService;
    /**
     * @type {?}
     * @private
     */
    PoPageJobSchedulerComponent.prototype.poNotification;
    /**
     * @type {?}
     * @private
     */
    PoPageJobSchedulerComponent.prototype.router;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcGFnZS1qb2Itc2NoZWR1bGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb3J0aW5hcmkvcG9ydGluYXJpLXRlbXBsYXRlcy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLXBhZ2Utam9iLXNjaGVkdWxlci9wby1wYWdlLWpvYi1zY2hlZHVsZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUtoRixPQUFPLEVBQ0wsZUFBZSxFQUVmLHFCQUFxQixFQUdyQixlQUFlLEVBQ2hCLE1BQU0seUJBQXlCLENBQUM7QUFFakMsT0FBTyxLQUFLLElBQUksTUFBTSxvQkFBb0IsQ0FBQztBQUczQyxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUM5RSxPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUN6RixPQUFPLEVBQUUsaUNBQWlDLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNyRixPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUN6RixPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQzs7Ozs7Ozs7Ozs7O0FBYTVFO0lBVWlELHVEQUErQjtJQStDOUUscUNBQ1MsMEJBQTJELEVBQzFELGNBQThCLEVBQzlCLGVBQWdDLEVBQ2hDLGNBQXFDLEVBQ3JDLE1BQWMsRUFDdEIseUJBQW9EO1FBTnRELFlBT0ksa0JBQU0seUJBQXlCLENBQUMsU0FDakM7UUFQTSxnQ0FBMEIsR0FBMUIsMEJBQTBCLENBQWlDO1FBQzFELG9CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixxQkFBZSxHQUFmLGVBQWUsQ0FBaUI7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ImltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOZ0Zvcm0gfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcblxyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcblxyXG5pbXBvcnQge1xyXG4gIFBvRGlhbG9nU2VydmljZSxcclxuICBQb0R5bmFtaWNGb3JtRmllbGQsXHJcbiAgUG9Ob3RpZmljYXRpb25TZXJ2aWNlLFxyXG4gIFBvUGFnZUFjdGlvbixcclxuICBQb1N0ZXBwZXJJdGVtLFxyXG4gIFBvU3RlcHBlclN0YXR1c1xyXG59IGZyb20gJ0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpJztcclxuXHJcbmltcG9ydCAqIGFzIHV0aWwgZnJvbSAnLi8uLi8uLi91dGlscy91dGlsJztcclxuXHJcbmltcG9ydCB7IFBvSm9iU2NoZWR1bGVySW50ZXJuYWwgfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tam9iLXNjaGVkdWxlci1pbnRlcm5hbC5pbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBQb1BhZ2VKb2JTY2hlZHVsZXJJbnRlcm5hbCB9IGZyb20gJy4vcG8tcGFnZS1qb2Itc2NoZWR1bGVyLWludGVybmFsJztcclxuaW1wb3J0IHsgUG9QYWdlSm9iU2NoZWR1bGVyQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tcGFnZS1qb2Itc2NoZWR1bGVyLWJhc2UuY29tcG9uZW50JztcclxuaW1wb3J0IHsgcG9QYWdlSm9iU2NoZWR1bGVyTGl0ZXJhbHNEZWZhdWx0IH0gZnJvbSAnLi9wby1wYWdlLWpvYi1zY2hlZHVsZXItbGl0ZXJhbHMnO1xyXG5pbXBvcnQgeyBQb1BhZ2VKb2JTY2hlZHVsZXJMb29rdXBTZXJ2aWNlIH0gZnJvbSAnLi9wby1wYWdlLWpvYi1zY2hlZHVsZXItbG9va3VwLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBQb1BhZ2VKb2JTY2hlZHVsZXJTZXJ2aWNlIH0gZnJvbSAnLi9wby1wYWdlLWpvYi1zY2hlZHVsZXIuc2VydmljZSc7XHJcblxyXG4vKipcclxuICogQGRvY3NFeHRlbmRzIFBvUGFnZUpvYlNjaGVkdWxlckJhc2VDb21wb25lbnRcclxuICpcclxuICogQGV4YW1wbGVcclxuICpcclxuICogPGV4YW1wbGUgbmFtZT1cInBvLXBhZ2Utam9iLXNjaGVkdWxlci1iYXNpY1wiIHRpdGxlPVwiUG9ydGluYXJpIFBhZ2UgSm9iIFNjaGVkdWxlciBCYXNpY1wiPlxyXG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wYWdlLWpvYi1zY2hlZHVsZXItYmFzaWMvc2FtcGxlLXBvLXBhZ2Utam9iLXNjaGVkdWxlci1iYXNpYy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XHJcbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXBhZ2Utam9iLXNjaGVkdWxlci1iYXNpYy9zYW1wbGUtcG8tcGFnZS1qb2Itc2NoZWR1bGVyLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XHJcbiAqIDwvZXhhbXBsZT5cclxuICpcclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAncG8tcGFnZS1qb2Itc2NoZWR1bGVyJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcG8tcGFnZS1qb2Itc2NoZWR1bGVyLmNvbXBvbmVudC5odG1sJyxcclxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxyXG4gIHN0eWxlczogW2BcclxuICAgIHBvLWNvbnRhaW5lciAucG8tY29udGFpbmVyIHtcclxuICAgICAgb3ZlcmZsb3cteTogdW5zZXQ7XHJcbiAgICB9XHJcbiAgYF1cclxufSlcclxuZXhwb3J0IGNsYXNzIFBvUGFnZUpvYlNjaGVkdWxlckNvbXBvbmVudCBleHRlbmRzIFBvUGFnZUpvYlNjaGVkdWxlckJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICBpc0VkaXQgPSBmYWxzZTtcclxuICBsaXRlcmFscyA9IHtcclxuICAgIC4uLnBvUGFnZUpvYlNjaGVkdWxlckxpdGVyYWxzRGVmYXVsdFt1dGlsLnBvTG9jYWxlRGVmYXVsdF0sXHJcbiAgICAuLi5wb1BhZ2VKb2JTY2hlZHVsZXJMaXRlcmFsc0RlZmF1bHRbdXRpbC5icm93c2VyTGFuZ3VhZ2UoKV1cclxuICB9O1xyXG4gIHBhcmFtZXRlcnM6IEFycmF5PFBvRHluYW1pY0Zvcm1GaWVsZD4gPSBbXTtcclxuICBzYXZlT3BlcmF0aW9uOiBPYnNlcnZhYmxlPGFueT47XHJcbiAgc3RlcDogbnVtYmVyID0gMTtcclxuXHJcbiAgcHJpdmF0ZSBiYWNrUGFnZUFjdGlvbjogUG9QYWdlQWN0aW9uID0ge1xyXG4gICAgbGFiZWw6IHRoaXMubGl0ZXJhbHMuYmFjayxcclxuICAgIGFjdGlvbjogdGhpcy5uZXh0U3RlcE9wZXJhdGlvbi5iaW5kKHRoaXMsICdiYWNrJyksXHJcbiAgICBkaXNhYmxlZDogdGhpcy5pc0Rpc2FibGVkQmFjay5iaW5kKHRoaXMpXHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSBjb25jbHVkZVBhZ2VBY3Rpb25zOiBBcnJheTxQb1BhZ2VBY3Rpb24+ID0gW1xyXG4gICAge1xyXG4gICAgICBsYWJlbDogdGhpcy5saXRlcmFscy5jb25jbHVkZSxcclxuICAgICAgYWN0aW9uOiB0aGlzLmNvbmZpcm1Kb2JTY2hlZHVsZXIuYmluZCh0aGlzKVxyXG4gICAgfSxcclxuICAgIHsgLi4udGhpcy5iYWNrUGFnZUFjdGlvbiB9XHJcbiAgXTtcclxuXHJcbiAgcHJpdmF0ZSBuZXh0UGFnZUFjdGlvbnM6IEFycmF5PFBvUGFnZUFjdGlvbj4gPSBbXHJcbiAgICB7XHJcbiAgICAgIGxhYmVsOiB0aGlzLmxpdGVyYWxzLm5leHQsXHJcbiAgICAgIGFjdGlvbjogdGhpcy5uZXh0U3RlcE9wZXJhdGlvbi5iaW5kKHRoaXMsICduZXh0JyksXHJcbiAgICAgIGRpc2FibGVkOiB0aGlzLmlzRGlzYWJsZWRBZHZhbmNlLmJpbmQodGhpcylcclxuICAgIH0sXHJcbiAgICB7IC4uLnRoaXMuYmFja1BhZ2VBY3Rpb24gfVxyXG4gIF07XHJcblxyXG4gIGpvYlNjaGVkdWxlckFjdGlvbnM6IEFycmF5PFBvUGFnZUFjdGlvbj4gPSBbXHJcbiAgICAuLi50aGlzLm5leHRQYWdlQWN0aW9uc1xyXG4gIF07XHJcblxyXG4gIHJlYWRvbmx5IHN0ZXBzOiBBcnJheTxQb1N0ZXBwZXJJdGVtPiA9IFtcclxuICAgIHsgbGFiZWw6IHRoaXMubGl0ZXJhbHMuc2NoZWR1bGluZyB9LFxyXG4gICAgeyBsYWJlbDogdGhpcy5saXRlcmFscy5wYXJhbWV0ZXJpemF0aW9uIH0sXHJcbiAgICB7IGxhYmVsOiB0aGlzLmxpdGVyYWxzLmNvbmNsdWRlIH1cclxuICBdO1xyXG5cclxuICBAVmlld0NoaWxkKCdzY2hlZHVsZXJFeGVjdXRpb24nLCB7IHN0YXRpYzogdHJ1ZSB9KSBzY2hlZHVsZXJFeGVjdXRpb246IHsgZm9ybTogTmdGb3JtIH07XHJcbiAgQFZpZXdDaGlsZCgnc2NoZWR1bGVyUGFyYW1ldGVycycsIHsgc3RhdGljOiB0cnVlIH0pIHNjaGVkdWxlclBhcmFtZXRlcnM6IHsgZm9ybTogTmdGb3JtIH07XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIHBvUGFnZUR5bmFtaWNMb29rdXBTZXJ2aWNlOiBQb1BhZ2VKb2JTY2hlZHVsZXJMb29rdXBTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUsXHJcbiAgICBwcml2YXRlIHBvRGlhbG9nU2VydmljZTogUG9EaWFsb2dTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBwb05vdGlmaWNhdGlvbjogUG9Ob3RpZmljYXRpb25TZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcclxuICAgIHBvUGFnZUpvYlNjaGVkdWxlclNlcnZpY2U6IFBvUGFnZUpvYlNjaGVkdWxlclNlcnZpY2UpIHtcclxuICAgICAgc3VwZXIocG9QYWdlSm9iU2NoZWR1bGVyU2VydmljZSk7XHJcbiAgICB9XHJcblxyXG4gIGdldCBzdGVwcGVyT3JpZW50YXRpb24oKTogJ2hvcml6b250YWwnIHwgJ3ZlcnRpY2FsJyB7XHJcbiAgICByZXR1cm4gd2luZG93LmlubmVyV2lkdGggPiA0ODEgJiYgd2luZG93LmlubmVyV2lkdGggPCA5NjAgPyAnaG9yaXpvbnRhbCcgOiAndmVydGljYWwnO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBjb25zdCBwYXJhbUlkID0gdGhpcy5hY3RpdmF0ZWRSb3V0ZS5zbmFwc2hvdC5wYXJhbXNbJ2lkJ107XHJcblxyXG4gICAgdGhpcy5pc0VkaXQgPSAhIXBhcmFtSWQ7XHJcblxyXG4gICAgdGhpcy5wb1BhZ2VKb2JTY2hlZHVsZXJTZXJ2aWNlLmNvbmZpZ1NlcnZpY2VBcGkoeyBlbmRwb2ludDogdGhpcy5zZXJ2aWNlQXBpIH0pO1xyXG5cclxuICAgIHRoaXMubG9hZERhdGEocGFyYW1JZCk7XHJcbiAgfVxyXG5cclxuICBjaGFuZ2VQYWdlQWN0aW9uc0J5U3RlcHMoY3VycmVudFN0ZXA6IG51bWJlciwgbmV4dFN0ZXA6IG51bWJlcikge1xyXG4gICAgY29uc3Qgc3RlcHNMZW5ndGggPSB0aGlzLnN0ZXBzLmxlbmd0aDtcclxuXHJcbiAgICBpZiAobmV4dFN0ZXAgPT09IHN0ZXBzTGVuZ3RoKSB7XHJcbiAgICB0aGlzLmpvYlNjaGVkdWxlckFjdGlvbnMgPSBbIC4uLnRoaXMuY29uY2x1ZGVQYWdlQWN0aW9ucyBdO1xyXG5cclxuICAgIH0gZWxzZSBpZiAoY3VycmVudFN0ZXAgPT09IHN0ZXBzTGVuZ3RoICYmIG5leHRTdGVwIDwgY3VycmVudFN0ZXApIHtcclxuXHJcbiAgICB0aGlzLmpvYlNjaGVkdWxlckFjdGlvbnMgPSBbIC4uLnRoaXMubmV4dFBhZ2VBY3Rpb25zIF07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZXh0U3RlcChzdGVwTnVtYmVyOiBudW1iZXIpIHtcclxuXHJcbiAgICBpZiAoc3RlcE51bWJlciA+IDEgJiYgdGhpcy5zY2hlZHVsZXJFeGVjdXRpb24uZm9ybS5pbnZhbGlkKSB7XHJcbiAgICAgIHRoaXMubWFya0FzRGlydHlJbnZhbGlkQ29udHJvbHModGhpcy5zY2hlZHVsZXJFeGVjdXRpb24uZm9ybS5jb250cm9scyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoc3RlcE51bWJlciA+IDIgJiYgKHRoaXMuc2NoZWR1bGVyUGFyYW1ldGVycyAmJiB0aGlzLnNjaGVkdWxlclBhcmFtZXRlcnMuZm9ybSAmJiB0aGlzLnNjaGVkdWxlclBhcmFtZXRlcnMuZm9ybS5pbnZhbGlkKSkge1xyXG4gICAgICB0aGlzLm1hcmtBc0RpcnR5SW52YWxpZENvbnRyb2xzKHRoaXMuc2NoZWR1bGVyUGFyYW1ldGVycy5mb3JtLmNvbnRyb2xzKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY2hhbmdlUGFnZUFjdGlvbnNCeVN0ZXBzKHRoaXMuc3RlcCwgc3RlcE51bWJlcik7XHJcblxyXG4gICAgY29uc3Qgc3RlcHMgPSB0aGlzLnN0ZXBzW3RoaXMuc3RlcCAtIDFdO1xyXG4gICAgdGhpcy5zdGVwID0gc3RlcE51bWJlcjtcclxuXHJcbiAgICBpZiAoc3RlcHMpIHtcclxuICAgICAgc3RlcHMuc3RhdHVzID0gUG9TdGVwcGVyU3RhdHVzLkRvbmU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvbkNoYW5nZVByb2Nlc3MocHJvY2VzczogeyBwcm9jZXNzSWQ6IHN0cmluZywgZXhpc3RBUEk6IGJvb2xlYW4gfSkge1xyXG4gICAgaWYgKHByb2Nlc3MuZXhpc3RBUEkgJiYgcHJvY2Vzcy5wcm9jZXNzSWQpIHtcclxuICAgICAgdGhpcy5nZXRQYXJhbWV0ZXJzQnlQcm9jZXNzKHByb2Nlc3MucHJvY2Vzc0lkKTtcclxuXHJcbiAgICAgIGlmICghdGhpcy5pc0VkaXQpIHtcclxuICAgICAgICB0aGlzLm1vZGVsLmV4ZWN1dGlvblBhcmFtZXRlciA9IHt9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjb25maXJtSm9iU2NoZWR1bGVyKCkge1xyXG4gICAgY29uc3QgcGFyYW1JZCA9IHRoaXMuYWN0aXZhdGVkUm91dGUuc25hcHNob3QucGFyYW1zWydpZCddO1xyXG5cclxuICAgIGNvbnN0IGNvbmZpcm1NZXNzYWdlID0gcGFyYW1JZCA/IHRoaXMubGl0ZXJhbHMuY29uZmlybVVwZGF0ZU1lc3NhZ2UgOiB0aGlzLmxpdGVyYWxzLmNvbmZpcm1TYXZlTWVzc2FnZTtcclxuXHJcbiAgICB0aGlzLnBvRGlhbG9nU2VydmljZS5jb25maXJtKHtcclxuICAgICAgdGl0bGU6IHRoaXMubGl0ZXJhbHMuY29uZmlybWF0aW9uLFxyXG4gICAgICBtZXNzYWdlOiBjb25maXJtTWVzc2FnZSxcclxuICAgICAgY29uZmlybTogKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1vZGVsID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5tb2RlbCk7XHJcblxyXG4gICAgICAgIHRoaXMuc2F2ZShtb2RlbCwgcGFyYW1JZCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgZW1pdFN1Y2Nlc3NNZXNzYWdlKG1zZ1N1Y2Nlc3M6IGFueSwgc2F2ZU9wZXJhdGlvbjogT2JzZXJ2YWJsZTxhbnk+KSB7XHJcbiAgICBhd2FpdCBzYXZlT3BlcmF0aW9uLnRvUHJvbWlzZSgpO1xyXG4gICAgdGhpcy5wb05vdGlmaWNhdGlvbi5zdWNjZXNzKG1zZ1N1Y2Nlc3MpO1xyXG4gICAgdGhpcy5yZXNldEpvYlNjaGVkdWxlckZvcm0oKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0UGFyYW1ldGVyc0J5UHJvY2Vzcyhwcm9jZXNzOiBhbnkpIHtcclxuXHJcbiAgICB0aGlzLnBvUGFnZUpvYlNjaGVkdWxlclNlcnZpY2UuZ2V0UGFyYW1ldGVyc0J5UHJvY2Vzcyhwcm9jZXNzKS5zdWJzY3JpYmUocGFyYW1ldGVycyA9PiB7XHJcbiAgICAgIHRoaXMucGFyYW1ldGVycyA9IHBhcmFtZXRlcnM7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlzRGlzYWJsZWRBZHZhbmNlKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc2NoZWR1bGVyRXhlY3V0aW9uID8gdGhpcy5zY2hlZHVsZXJFeGVjdXRpb24uZm9ybS5pbnZhbGlkIDogZmFsc2U7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlzRGlzYWJsZWRCYWNrKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc3RlcCA9PT0gMTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgbmV4dFN0ZXBPcGVyYXRpb24ob3BlcmF0aW9uPzogJ2JhY2snIHwgJ25leHQnKSB7XHJcbiAgICBjb25zdCBzdGVwTnVtYmVyID0gb3BlcmF0aW9uID09PSAnYmFjaycgPyB0aGlzLnN0ZXAgLSAxIDogdGhpcy5zdGVwICsgMTtcclxuXHJcbiAgICB0aGlzLm5leHRTdGVwKHN0ZXBOdW1iZXIpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZXNldEpvYlNjaGVkdWxlckZvcm0oKSB7XHJcbiAgICB0aGlzLnNjaGVkdWxlckV4ZWN1dGlvbi5mb3JtLnJlc2V0KCk7XHJcblxyXG4gICAgLy8gcmFkaW9ncm91cCBuw6NvIGVzdGF2YSBhdHJpYnVpbmRvIG5vdm8gdmFsb3IsIGZpY2EgdmVybWVsaG8gc2VtIG8gdGltZXRvdXQuXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdGhpcy5tb2RlbCA9IG5ldyBQb1BhZ2VKb2JTY2hlZHVsZXJJbnRlcm5hbCgpO1xyXG5cclxuICAgICAgdGhpcy5zdGVwID0gMTtcclxuICAgICAgdGhpcy5zdGVwcy5mb3JFYWNoKHN0ZXAgPT4ge1xyXG4gICAgICAgIHN0ZXAuc3RhdHVzID0gUG9TdGVwcGVyU3RhdHVzLkRlZmF1bHQ7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgdGhpcy5qb2JTY2hlZHVsZXJBY3Rpb25zID0gWy4uLnRoaXMubmV4dFBhZ2VBY3Rpb25zXTtcclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2F2ZShtb2RlbDogUG9Kb2JTY2hlZHVsZXJJbnRlcm5hbCwgcGFyYW1JZCkge1xyXG4gICAgY29uc3Qgc2F2ZU9wZXJhdGlvbiA9IHBhcmFtSWRcclxuICAgICAgPyB0aGlzLnBvUGFnZUpvYlNjaGVkdWxlclNlcnZpY2UudXBkYXRlUmVzb3VyY2UocGFyYW1JZCwgbW9kZWwpXHJcbiAgICAgIDogdGhpcy5wb1BhZ2VKb2JTY2hlZHVsZXJTZXJ2aWNlLmNyZWF0ZVJlc291cmNlKG1vZGVsKTtcclxuXHJcbiAgICBjb25zdCBtc2dTdWNjZXNzID0gcGFyYW1JZCA/IHRoaXMubGl0ZXJhbHMuc2F2ZU5vdGlmaWNhdGlvblN1Y2Nlc3NVcGRhdGUgOiB0aGlzLmxpdGVyYWxzLnNhdmVOb3RpZmljYXRpb25TdWNjZXNzU2F2ZTtcclxuXHJcbiAgICB0aGlzLmVtaXRTdWNjZXNzTWVzc2FnZShtc2dTdWNjZXNzLCBzYXZlT3BlcmF0aW9uKTtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==