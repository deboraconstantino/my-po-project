/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, ViewContainerRef } from '@angular/core';
import { NgForm } from '@angular/forms';
import { ActivatedRoute, Router } from '@angular/router';
import { PoComponentInjectorService, PoModalComponent } from '@portinari/portinari-ui';
import { browserLanguage, isExternalLink, isTypeof, poLocaleDefault } from '../../utils/util';
import { PoModalPasswordRecoveryComponent } from '../po-modal-password-recovery/po-modal-password-recovery.component';
import { PoModalPasswordRecoveryType } from '../po-modal-password-recovery/enums/po-modal-password-recovery-type.enum';
import { PoPageChangePasswordBaseComponent } from './po-page-change-password-base.component';
import { poPageChangePasswordLiterals } from './literals/i18n/po-page-change-password-literals';
import { PoPageChangePasswordService } from './po-page-change-password.service';
/**
 * \@docsExtends PoPageChangePasswordBaseComponent
 *
 * \@example
 *
 * <example name="po-page-change-password-basic" title="Portinari Page Change Password Basic">
 *  <file name="sample-po-page-change-password-basic/sample-po-page-change-password-basic.component.html"> </file>
 *  <file name="sample-po-page-change-password-basic/sample-po-page-change-password-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-page-change-password-labs" title="Portinari Page Change Password Labs">
 *  <file name="sample-po-page-change-password-labs/sample-po-page-change-password-labs.component.html"> </file>
 *  <file name="sample-po-page-change-password-labs/sample-po-page-change-password-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-page-change-password-modify" title="Portinari Page Change Password Modify">
 *  <file name="sample-po-page-change-password-modify/sample-po-page-change-password-modify.component.html"> </file>
 *  <file name="sample-po-page-change-password-modify/sample-po-page-change-password-modify.component.ts"> </file>
 * </example>
 *
 * <example name="po-page-change-password-create" title="Portinari Page Change Password Create">
 *  <file name="sample-po-page-change-password-create/sample-po-page-change-password-create.component.html"> </file>
 *  <file name="sample-po-page-change-password-create/sample-po-page-change-password-create.component.ts"> </file>
 * </example>
 *
 * <example name="po-page-change-password-request" title="Portinari Page Change Password Request">
 *  <file name="sample-po-page-change-password-request/sample-po-page-change-password-request.component.html"> </file>
 *  <file name="sample-po-page-change-password-request/sample-po-page-change-password-request.component.ts"> </file>
 * </example>
 */
export class PoPageChangePasswordComponent extends PoPageChangePasswordBaseComponent {
    /**
     * @param {?} activatedRoute
     * @param {?} route
     * @param {?} router
     * @param {?} service
     * @param {?} poComponentInjector
     * @param {?} viewRef
     */
    constructor(activatedRoute, route, router, service, poComponentInjector, viewRef) {
        super();
        this.activatedRoute = activatedRoute;
        this.route = route;
        this.router = router;
        this.service = service;
        this.poComponentInjector = poComponentInjector;
        this.literals = Object.assign({}, poPageChangePasswordLiterals[poLocaleDefault], poPageChangePasswordLiterals[browserLanguage()]);
        this.componentRef = null;
        this.modalAction = {
            action: this.navigateTo.bind(this, this.urlHome),
            label: this.literals.enterSystemButton
        };
        this.parentRef = viewRef['_view']['component'];
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        if (this.urlNewPassword) {
            this.subscribeToTokenParameter();
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.newPasswordSubscription) {
            this.newPasswordSubscription.unsubscribe();
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.checkingForRouteMetadata(this.activatedRoute.snapshot.data);
    }
    /**
     * @param {?} url
     * @return {?}
     */
    navigateTo(url) {
        isExternalLink(url) ? window.open(url) : this.router.navigate([url || '/']);
    }
    /**
     * @param {?} recovery
     * @return {?}
     */
    onForgotPasswordClick(recovery) {
        if (isTypeof(recovery, 'function')) {
            recovery();
        }
        else {
            this.createModalPasswordRecoveryComponent(recovery);
        }
    }
    /**
     * @return {?}
     */
    onLoginSubmit() {
        /** @type {?} */
        const form = this.getLoginForm();
        if (this.urlNewPassword) {
            this.postUrlNewPassword(form);
        }
        else if (this.submit && this.submit.observers.length) {
            this.emitSubmit(form);
        }
    }
    /**
     * Abre uma modal de confirmação com texto, imagem e botão que redireciona para o link definido na propriedade `p-url-home`
     * @return {?}
     */
    openConfirmation() {
        this.modal.open();
    }
    /**
     * @return {?}
     */
    validatePassword() {
        /** @type {?} */
        const controls = this.passwordForm.form.controls;
        /** @type {?} */
        const controlConfirmPassword = controls['confirmPassword'];
        /** @type {?} */
        const controlNewPassword = controls['newPassword'];
        if (!this.newPassword) {
            this.setFormErrors({ 'required': true }, [controlNewPassword]);
        }
        else if (!this.confirmPassword) {
            this.setFormErrors({ 'required': true }, [controlConfirmPassword]);
        }
        else if (this.newPassword && this.confirmPassword && this.newPassword !== this.confirmPassword) {
            this.setFormErrors({ 'equalPassword': true }, [controlNewPassword, controlConfirmPassword]);
        }
        else {
            this.setFormErrors(null, [controlConfirmPassword, controlNewPassword]);
        }
        if (this.requirements.length && this.requirements.find((/**
         * @param {?} requirement
         * @return {?}
         */
        requirement => this.validateRequirement(requirement) === false))) {
            this.setFormErrors({ 'requirement': true }, [controlNewPassword]);
        }
    }
    /**
     * @param {?} requirement
     * @return {?}
     */
    validateRequirement(requirement) {
        return typeof requirement.status === 'function' ? requirement.status.call(this.parentRef, this.newPassword) : requirement.status;
    }
    /**
     * @private
     * @param {?} object
     * @param {?} property
     * @return {?}
     */
    checkingForMetadataProperty(object, property) {
        if (Object.prototype.hasOwnProperty.call(object, property)) {
            return object[property];
        }
    }
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    checkingForRouteMetadata(data) {
        if (Object.keys(data).length !== 0) {
            this.urlNewPassword = this.checkingForMetadataProperty(data, 'serviceApi') || this.urlNewPassword;
            this.recovery = this.checkingForMetadataProperty(data, 'recovery') || this.recovery;
            this.hideCurrentPassword = this.checkingForMetadataProperty(data, 'hideCurrentPassword') || this.hideCurrentPassword;
        }
    }
    /**
     * @private
     * @param {?} recovery
     * @return {?}
     */
    createModalPasswordRecoveryComponent(recovery) {
        if (this.componentRef) {
            this.poComponentInjector.destroyComponentInApplication(this.componentRef);
        }
        this.componentRef = this.poComponentInjector.createComponentInApplication(PoModalPasswordRecoveryComponent);
        this.componentRef.instance.recovery = recovery.url;
        this.componentRef.instance.contactEmail = recovery.contactMail;
        this.componentRef.instance.phoneMask = recovery.phoneMask;
        this.componentRef.instance.type = recovery.type || PoModalPasswordRecoveryType.Email;
        this.componentRef.changeDetectorRef.detectChanges();
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.componentRef.instance.open();
        }));
    }
    /**
     * @private
     * @param {?} form
     * @return {?}
     */
    emitSubmit(form) {
        this.submit.emit(form);
    }
    /**
     * @private
     * @return {?}
     */
    getLoginForm() {
        return {
            currentPassword: this.currentPassword,
            newPassword: this.newPassword
        };
    }
    /**
     * @private
     * @param {?} form
     * @return {?}
     */
    postUrlNewPassword(form) {
        form['token'] = this.token;
        this.service.post(this.urlNewPassword, form).subscribe((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            if (response.status === 204) {
                this.openConfirmation();
            }
        }));
    }
    /**
     * @private
     * @param {?} error
     * @param {?=} controls
     * @return {?}
     */
    setFormErrors(error, controls) {
        controls.forEach((/**
         * @param {?} control
         * @return {?}
         */
        control => {
            control.setErrors(error);
        }));
    }
    /**
     * @private
     * @return {?}
     */
    subscribeToTokenParameter() {
        this.route.queryParams.subscribe((/**
         * @param {?} params
         * @return {?}
         */
        params => {
            /** @type {?} */
            const token = params['token'];
            if (token) {
                this.token = token;
            }
        }));
    }
}
PoPageChangePasswordComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-page-change-password',
                template: "<div class=\"po-page-change-password-wrapper\" #pageChangePassword>\n  <div class=\"po-page-change-password-container\">\n    <po-page-background class=\"po-page-change-password\"\n      [p-logo]=\"logo\"\n      [p-secondary-logo]=\"secondaryLogo\">\n\n      <div class=\"po-page-blocked-user-header po-row\">\n        <div class=\"po-md-12\">{{literals.createNewPassword}}</div>\n        <div class=\"po-md-12 po-text-center po-font-text\">\n          {{literals.createNewPasswordPhrase}}\n        </div>\n      </div>\n\n      <form #passwordForm=\"ngForm\">\n\n        <div class=\"po-row po-mt-3 po-mt-sm-1\">\n          <div class=\"po-md-6\"\n            [ngClass]=\"{'po-offset-md-3 po-offset-lg-3 po-offset-xl-3': !showRequirements}\">\n            <div *ngIf=\"!hideCurrentPassword\">\n              <po-password\n                name=\"currentPassword\"\n                [(ngModel)]=\"currentPassword\"\n                p-required\n                [p-label]=\"literals.currentPassword\">\n              </po-password>\n            </div>\n            <div *ngIf=\"!hideCurrentPassword && recovery\" class=\"po-text-center po-mb-sm-1 po-mb-2\">\n              <a *ngIf=\"recoveryUrlType === 'internalLink'\"\n                class=\"po-font-text-bold po-page-change-password-forgot-password\"\n                [routerLink]=\"recovery\">\n                {{literals.forgotPassword}}\n              </a>\n              <a *ngIf=\"recoveryUrlType === 'externalLink'\"\n                class=\"po-font-text-bold po-page-change-password-forgot-password\"\n                [href]=\"recovery\">\n                {{literals.forgotPassword}}\n              </a>\n              <a *ngIf=\"!recoveryUrlType\"\n                class=\"po-font-text-bold po-page-change-password-forgot-password po-clickable\"\n                (click)=\"onForgotPasswordClick(recovery)\">\n                {{literals.forgotPassword}}\n              </a>\n            </div>\n            <div>\n              <po-password\n                name=\"newPassword\"\n                [(ngModel)]=\"newPassword\"\n                p-required\n                [p-label]=\"literals.newPassword\"\n                (p-change-model)=\"validatePassword()\">\n              </po-password>\n            </div>\n            <div>\n              <po-password\n                name=\"confirmPassword\"\n                [(ngModel)]=\"confirmPassword\"\n                p-required\n                [p-label]=\"literals.confirmPassword\"\n                (p-change-model)=\"validatePassword()\">\n              </po-password>\n            </div>\n          </div>\n          <div *ngIf=\"showRequirements\"\n            class=\"po-md-6 po-page-change-password-required-container\">\n            <po-container>\n              <ul class=\"po-page-change-password-required-list\">\n                <li class=\"po-page-change-password-required-item\">\n                  <p class=\"po-mb-1 po-font-text-bold po-page-change-password-required-title\">\n                    {{literals?.requirements}}\n                  </p>\n                </li>\n                <li *ngFor=\"let requirement of requirements\"\n                  class=\"po-page-change-password-required-item\">\n                  <span class=\"po-icon po-page-change-password-required-icon\"\n                    [ngClass]=\"validateRequirement(requirement) ? 'po-icon-ok po-page-change-password-required-ok' : 'po-icon-minus po-page-change-password-required-minus'\">\n                  </span>\n                  <p class=\"po-page-change-password-required-text po-font-text\">\n                    {{requirement.requirement}}\n                  </p>\n                </li>\n              </ul>\n            </po-container>\n          </div>\n        </div>\n      </form>\n\n      <po-divider class=\"po-sm-12\"></po-divider>\n\n      <div class=\"po-page-change-password-tips po-row\">\n        <div class=\"po-md-2 po-mr-3\">\n          <img\n            class=\"po-page-change-password-lock-image po-mb-3\"\n            alt=\"Blocked user image\"\n            src=\"./assets/images/big-lock.svg\"\n          />\n        </div>\n        <div class=\"po-md-9 po-page-change-password-tips-text\">\n          <div class=\"po-font-text-bold po-pb-1\">{{literals.safetyTips}}</div>\n          <div class=\"po-font-text-small\">\n            <div class=\"po-row po-pb-1\">{{literals.safetyTipsPhrase}}</div>\n            <div class=\"po-row po-pb-1\">\u2022 {{literals.safetyTipsFirst}}</div>\n            <div class=\"po-row po-pb-1\">\u2022 {{literals.safetyTipsSecond}}</div>\n            <div class=\"po-row po-pb-1\">\u2022 {{literals.safetyTipsThird}}</div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"po-page-change-password-buttons po-row\">\n\n        <po-divider class=\"po-sm-12 po-mobile-only\"></po-divider>\n\n        <po-button *ngIf=\"!hideCurrentPassword\"\n          class=\"po-sm-6 po-mb-sm-1\"\n          [p-label]=\"literals.backButton\"\n          (p-click)=\"navigateTo(urlBack)\">\n        </po-button>\n\n        <po-button\n          [ngClass]=\"hideCurrentPassword ? 'po-md-12':'po-sm-6'\"\n          p-type=\"primary\"\n          [p-disabled]=\"passwordForm.invalid\"\n          [p-label]=\"literals.saveButton\"\n          (p-click)=\"onLoginSubmit()\">\n        </po-button>\n\n      </div>\n\n    </po-page-background>\n\n  </div>\n</div>\n\n<po-modal\n  [p-primary-action]=\"modalAction\"\n  p-hide-close\n  p-size=\"auto\"\n  [p-title]=\"hideCurrentPassword ? literals.passwordSuccessfullyCreated : literals.passwordSuccessfullyUpdated\">\n\n  <div class=\"po-text-center\">\n    <img\n      alt=\"Blocked user image\"\n      class=\"po-page-change-password-lock-image po-mb-3\"\n      src=\"./assets/images/success.svg\"\n    />\n  </div>\n</po-modal>\n"
            }] }
];
/** @nocollapse */
PoPageChangePasswordComponent.ctorParameters = () => [
    { type: ActivatedRoute },
    { type: ActivatedRoute },
    { type: Router },
    { type: PoPageChangePasswordService },
    { type: PoComponentInjectorService },
    { type: ViewContainerRef }
];
PoPageChangePasswordComponent.propDecorators = {
    modal: [{ type: ViewChild, args: [PoModalComponent, { static: true },] }],
    pageChangePassword: [{ type: ViewChild, args: ['pageChangePassword', { read: ViewContainerRef, static: true },] }],
    passwordForm: [{ type: ViewChild, args: ['passwordForm', { read: NgForm, static: true },] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    PoPageChangePasswordComponent.prototype.newPasswordSubscription;
    /** @type {?} */
    PoPageChangePasswordComponent.prototype.literals;
    /**
     * @type {?}
     * @private
     */
    PoPageChangePasswordComponent.prototype.componentRef;
    /** @type {?} */
    PoPageChangePasswordComponent.prototype.modalAction;
    /** @type {?} */
    PoPageChangePasswordComponent.prototype.parentRef;
    /** @type {?} */
    PoPageChangePasswordComponent.prototype.modal;
    /** @type {?} */
    PoPageChangePasswordComponent.prototype.pageChangePassword;
    /** @type {?} */
    PoPageChangePasswordComponent.prototype.passwordForm;
    /**
     * @type {?}
     * @private
     */
    PoPageChangePasswordComponent.prototype.activatedRoute;
    /**
     * @type {?}
     * @private
     */
    PoPageChangePasswordComponent.prototype.route;
    /**
     * @type {?}
     * @private
     */
    PoPageChangePasswordComponent.prototype.router;
    /**
     * @type {?}
     * @private
     */
    PoPageChangePasswordComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    PoPageChangePasswordComponent.prototype.poComponentInjector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcGFnZS1jaGFuZ2UtcGFzc3dvcmQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvcnRpbmFyaS9wb3J0aW5hcmktdGVtcGxhdGVzLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tcGFnZS1jaGFuZ2UtcGFzc3dvcmQvcG8tcGFnZS1jaGFuZ2UtcGFzc3dvcmQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWlCLFNBQVMsRUFBbUMsU0FBUyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZILE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4QyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBSXpELE9BQU8sRUFBRSwwQkFBMEIsRUFBaUIsZ0JBQWdCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUV0RyxPQUFPLEVBQUUsZUFBZSxFQUFFLGNBQWMsRUFBRSxRQUFRLEVBQUUsZUFBZSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFFOUYsT0FBTyxFQUFFLGdDQUFnQyxFQUFFLE1BQU0sb0VBQW9FLENBQUM7QUFDdEgsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sMEVBQTBFLENBQUM7QUFFdkgsT0FBTyxFQUFFLGlDQUFpQyxFQUFFLE1BQU0sMENBQTBDLENBQUM7QUFDN0YsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFHaEcsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFxQ2hGLE1BQU0sT0FBTyw2QkFBOEIsU0FBUSxpQ0FBaUM7Ozs7Ozs7OztJQTBCbEYsWUFDVSxjQUE4QixFQUM5QixLQUFxQixFQUNyQixNQUFjLEVBQ2QsT0FBb0MsRUFDcEMsbUJBQStDLEVBQ3ZELE9BQXlCO1FBQ3ZC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S0FBSyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUM7WUFFN0IsSUFBSSxLQUFLLEVBQUU7Z0JBQ1QsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7YUFDcEI7UUFDSCxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7OztZQWxMRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLHlCQUF5QjtnQkFDbkMsZ3RMQUF1RDthQUN4RDs7OztZQWxEUSxjQUFjO1lBQWQsY0FBYztZQUFFLE1BQU07WUFldEIsMkJBQTJCO1lBWDNCLDBCQUEwQjtZQU40QyxnQkFBZ0I7OztvQkE0RTVGLFNBQVMsU0FBQyxnQkFBZ0IsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7aUNBQzVDLFNBQVMsU0FBQyxvQkFBb0IsRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzJCQUN4RSxTQUFTLFNBQUMsY0FBYyxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzs7Ozs7O0lBdEJ6RCxnRUFBOEM7O0lBRTlDLGlEQU9JOzs7OztJQUVKLHFEQUErQzs7SUFFL0Msb0RBR0U7O0lBRUYsa0RBQWU7O0lBRWYsOENBQXVFOztJQUN2RSwyREFBZ0g7O0lBQ2hILHFEQUFnRjs7Ozs7SUFHOUUsdURBQXNDOzs7OztJQUN0Qyw4Q0FBNkI7Ozs7O0lBQzdCLCtDQUFzQjs7Ozs7SUFDdEIsZ0RBQTRDOzs7OztJQUM1Qyw0REFBdUQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDb21wb25lbnQsIENvbXBvbmVudFJlZiwgT25EZXN0cm95LCBPbkluaXQsIFZpZXdDaGlsZCwgVmlld0NvbnRhaW5lclJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTmdGb3JtIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUsIFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5cbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBQb0NvbXBvbmVudEluamVjdG9yU2VydmljZSwgUG9Nb2RhbEFjdGlvbiwgUG9Nb2RhbENvbXBvbmVudCB9IGZyb20gJ0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpJztcblxuaW1wb3J0IHsgYnJvd3Nlckxhbmd1YWdlLCBpc0V4dGVybmFsTGluaywgaXNUeXBlb2YsIHBvTG9jYWxlRGVmYXVsdCB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnO1xuXG5pbXBvcnQgeyBQb01vZGFsUGFzc3dvcmRSZWNvdmVyeUNvbXBvbmVudCB9IGZyb20gJy4uL3BvLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5L3BvLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb01vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGUgfSBmcm9tICcuLi9wby1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS9lbnVtcy9wby1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS10eXBlLmVudW0nO1xuaW1wb3J0IHsgUG9QYWdlQ2hhbmdlUGFzc3dvcmQgfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tcGFnZS1jaGFuZ2UtcGFzc3dvcmQuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvUGFnZUNoYW5nZVBhc3N3b3JkQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tcGFnZS1jaGFuZ2UtcGFzc3dvcmQtYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgcG9QYWdlQ2hhbmdlUGFzc3dvcmRMaXRlcmFscyB9IGZyb20gJy4vbGl0ZXJhbHMvaTE4bi9wby1wYWdlLWNoYW5nZS1wYXNzd29yZC1saXRlcmFscyc7XG5pbXBvcnQgeyBQb1BhZ2VDaGFuZ2VQYXNzd29yZFJlY292ZXJ5IH0gZnJvbSAnLi9pbnRlcmZhY2VzL3BvLXBhZ2UtY2hhbmdlLXBhc3N3b3JkLXJlY292ZXJ5LmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb1BhZ2VDaGFuZ2VQYXNzd29yZFJlcXVpcmVtZW50IH0gZnJvbSAnLi9pbnRlcmZhY2VzL3BvLXBhZ2UtY2hhbmdlLXBhc3N3b3JkLXJlcXVpcmVtZW50LmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb1BhZ2VDaGFuZ2VQYXNzd29yZFNlcnZpY2UgfSBmcm9tICcuL3BvLXBhZ2UtY2hhbmdlLXBhc3N3b3JkLnNlcnZpY2UnO1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBQb1BhZ2VDaGFuZ2VQYXNzd29yZEJhc2VDb21wb25lbnRcbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1wYWdlLWNoYW5nZS1wYXNzd29yZC1iYXNpY1wiIHRpdGxlPVwiUG9ydGluYXJpIFBhZ2UgQ2hhbmdlIFBhc3N3b3JkIEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wYWdlLWNoYW5nZS1wYXNzd29yZC1iYXNpYy9zYW1wbGUtcG8tcGFnZS1jaGFuZ2UtcGFzc3dvcmQtYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tcGFnZS1jaGFuZ2UtcGFzc3dvcmQtYmFzaWMvc2FtcGxlLXBvLXBhZ2UtY2hhbmdlLXBhc3N3b3JkLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXBhZ2UtY2hhbmdlLXBhc3N3b3JkLWxhYnNcIiB0aXRsZT1cIlBvcnRpbmFyaSBQYWdlIENoYW5nZSBQYXNzd29yZCBMYWJzXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wYWdlLWNoYW5nZS1wYXNzd29yZC1sYWJzL3NhbXBsZS1wby1wYWdlLWNoYW5nZS1wYXNzd29yZC1sYWJzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXBhZ2UtY2hhbmdlLXBhc3N3b3JkLWxhYnMvc2FtcGxlLXBvLXBhZ2UtY2hhbmdlLXBhc3N3b3JkLWxhYnMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tcGFnZS1jaGFuZ2UtcGFzc3dvcmQtbW9kaWZ5XCIgdGl0bGU9XCJQb3J0aW5hcmkgUGFnZSBDaGFuZ2UgUGFzc3dvcmQgTW9kaWZ5XCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wYWdlLWNoYW5nZS1wYXNzd29yZC1tb2RpZnkvc2FtcGxlLXBvLXBhZ2UtY2hhbmdlLXBhc3N3b3JkLW1vZGlmeS5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wYWdlLWNoYW5nZS1wYXNzd29yZC1tb2RpZnkvc2FtcGxlLXBvLXBhZ2UtY2hhbmdlLXBhc3N3b3JkLW1vZGlmeS5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1wYWdlLWNoYW5nZS1wYXNzd29yZC1jcmVhdGVcIiB0aXRsZT1cIlBvcnRpbmFyaSBQYWdlIENoYW5nZSBQYXNzd29yZCBDcmVhdGVcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXBhZ2UtY2hhbmdlLXBhc3N3b3JkLWNyZWF0ZS9zYW1wbGUtcG8tcGFnZS1jaGFuZ2UtcGFzc3dvcmQtY3JlYXRlLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXBhZ2UtY2hhbmdlLXBhc3N3b3JkLWNyZWF0ZS9zYW1wbGUtcG8tcGFnZS1jaGFuZ2UtcGFzc3dvcmQtY3JlYXRlLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXBhZ2UtY2hhbmdlLXBhc3N3b3JkLXJlcXVlc3RcIiB0aXRsZT1cIlBvcnRpbmFyaSBQYWdlIENoYW5nZSBQYXNzd29yZCBSZXF1ZXN0XCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wYWdlLWNoYW5nZS1wYXNzd29yZC1yZXF1ZXN0L3NhbXBsZS1wby1wYWdlLWNoYW5nZS1wYXNzd29yZC1yZXF1ZXN0LmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXBhZ2UtY2hhbmdlLXBhc3N3b3JkLXJlcXVlc3Qvc2FtcGxlLXBvLXBhZ2UtY2hhbmdlLXBhc3N3b3JkLXJlcXVlc3QuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tcGFnZS1jaGFuZ2UtcGFzc3dvcmQnLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tcGFnZS1jaGFuZ2UtcGFzc3dvcmQuY29tcG9uZW50Lmh0bWwnXG59KVxuXG5leHBvcnQgY2xhc3MgUG9QYWdlQ2hhbmdlUGFzc3dvcmRDb21wb25lbnQgZXh0ZW5kcyBQb1BhZ2VDaGFuZ2VQYXNzd29yZEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3ksIE9uSW5pdCB7XG5cbiAgcHJpdmF0ZSBuZXdQYXNzd29yZFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gIHJlYWRvbmx5IGxpdGVyYWxzOiB7IGJhY2tCdXR0b246IHN0cmluZywgY29uZmlybVBhc3N3b3JkOiBzdHJpbmcsIGNyZWF0ZU5ld1Bhc3N3b3JkOiBzdHJpbmcsIGNyZWF0ZU5ld1Bhc3N3b3JkUGhyYXNlOiBzdHJpbmcsXG4gICAgY3VycmVudFBhc3N3b3JkOiBzdHJpbmcsIGVudGVyU3lzdGVtQnV0dG9uOiBzdHJpbmcsIGZvcmdvdFBhc3N3b3JkOiBzdHJpbmcsIG5ld1Bhc3N3b3JkOiBzdHJpbmcsIHBhc3N3b3JkU3VjY2Vzc2Z1bGx5Q3JlYXRlZDogc3RyaW5nLFxuICAgIHBhc3N3b3JkU3VjY2Vzc2Z1bGx5VXBkYXRlZDogc3RyaW5nLCByZXF1aXJlbWVudHM6IHN0cmluZywgc2FmZXR5VGlwczogc3RyaW5nLCBzYWZldHlUaXBzUGhyYXNlOiBzdHJpbmcsIHNhZmV0eVRpcHNGaXJzdDogc3RyaW5nLFxuICAgIHNhZmV0eVRpcHNTZWNvbmQ6IHN0cmluZywgc2FmZXR5VGlwc1RoaXJkOiBzdHJpbmcsIHNhdmVCdXR0b246IHN0cmluZyB9ID1cbiAgICB7XG4gICAgICAuLi5wb1BhZ2VDaGFuZ2VQYXNzd29yZExpdGVyYWxzW3BvTG9jYWxlRGVmYXVsdF0sXG4gICAgICAuLi5wb1BhZ2VDaGFuZ2VQYXNzd29yZExpdGVyYWxzW2Jyb3dzZXJMYW5ndWFnZSgpXSxcbiAgICB9O1xuXG4gIHByaXZhdGUgY29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8YW55PiA9IG51bGw7XG5cbiAgbW9kYWxBY3Rpb246IFBvTW9kYWxBY3Rpb24gPSB7XG4gICAgYWN0aW9uOiB0aGlzLm5hdmlnYXRlVG8uYmluZCh0aGlzLCB0aGlzLnVybEhvbWUpLFxuICAgIGxhYmVsOiB0aGlzLmxpdGVyYWxzLmVudGVyU3lzdGVtQnV0dG9uXG4gIH07XG5cbiAgcGFyZW50UmVmOiBhbnk7XG5cbiAgQFZpZXdDaGlsZChQb01vZGFsQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KSBtb2RhbDogUG9Nb2RhbENvbXBvbmVudDtcbiAgQFZpZXdDaGlsZCgncGFnZUNoYW5nZVBhc3N3b3JkJywgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmLCBzdGF0aWM6IHRydWUgfSkgcGFnZUNoYW5nZVBhc3N3b3JkOiBWaWV3Q29udGFpbmVyUmVmO1xuICBAVmlld0NoaWxkKCdwYXNzd29yZEZvcm0nLCB7IHJlYWQ6IE5nRm9ybSwgc3RhdGljOiB0cnVlIH0pIHBhc3N3b3JkRm9ybTogTmdGb3JtO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlLFxuICAgIHByaXZhdGUgcm91dGU6IEFjdGl2YXRlZFJvdXRlLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgcHJpdmF0ZSBzZXJ2aWNlOiBQb1BhZ2VDaGFuZ2VQYXNzd29yZFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBwb0NvbXBvbmVudEluamVjdG9yOiBQb0NvbXBvbmVudEluamVjdG9yU2VydmljZSxcbiAgICB2aWV3UmVmOiBWaWV3Q29udGFpbmVyUmVmKSB7XG4gICAgICBzdXBlcigpO1xuICAgICAgdGhpcy5wYXJlbnRSZWYgPSB2aWV3UmVmWydfdmlldyddWydjb21wb25lbnQnXTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICBpZiAodGhpcy51cmxOZXdQYXNzd29yZCkge1xuICAgICAgdGhpcy5zdWJzY3JpYmVUb1Rva2VuUGFyYW1ldGVyKCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMubmV3UGFzc3dvcmRTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMubmV3UGFzc3dvcmRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmNoZWNraW5nRm9yUm91dGVNZXRhZGF0YSh0aGlzLmFjdGl2YXRlZFJvdXRlLnNuYXBzaG90LmRhdGEpO1xuICB9XG5cbiAgbmF2aWdhdGVUbyh1cmw6IHN0cmluZykge1xuICAgIGlzRXh0ZXJuYWxMaW5rKHVybCkgPyAgd2luZG93Lm9wZW4odXJsKSA6IHRoaXMucm91dGVyLm5hdmlnYXRlKFt1cmwgfHwgJy8nXSk7XG4gIH1cblxuICBvbkZvcmdvdFBhc3N3b3JkQ2xpY2socmVjb3ZlcnkpOiB2b2lkIHtcbiAgICBpZiAoaXNUeXBlb2YocmVjb3ZlcnksICdmdW5jdGlvbicpKSB7XG4gICAgICByZWNvdmVyeSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNyZWF0ZU1vZGFsUGFzc3dvcmRSZWNvdmVyeUNvbXBvbmVudChyZWNvdmVyeSk7XG4gICAgfVxuICB9XG5cbiAgb25Mb2dpblN1Ym1pdCgpOiB2b2lkIHtcblxuICAgIGNvbnN0IGZvcm0gPSB0aGlzLmdldExvZ2luRm9ybSgpO1xuXG4gICAgaWYgKHRoaXMudXJsTmV3UGFzc3dvcmQpIHtcbiAgICAgIHRoaXMucG9zdFVybE5ld1Bhc3N3b3JkKGZvcm0pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5zdWJtaXQgJiYgdGhpcy5zdWJtaXQub2JzZXJ2ZXJzLmxlbmd0aCkge1xuICAgICAgdGhpcy5lbWl0U3VibWl0KGZvcm0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBYnJlIHVtYSBtb2RhbCBkZSBjb25maXJtYcOnw6NvIGNvbSB0ZXh0bywgaW1hZ2VtIGUgYm90w6NvIHF1ZSByZWRpcmVjaW9uYSBwYXJhIG8gbGluayBkZWZpbmlkbyBuYSBwcm9wcmllZGFkZSBgcC11cmwtaG9tZWBcdTAwMWNcbiAgICovXG4gIG9wZW5Db25maXJtYXRpb24oKSB7XG4gICAgdGhpcy5tb2RhbC5vcGVuKCk7XG4gIH1cblxuICB2YWxpZGF0ZVBhc3N3b3JkKCkge1xuICAgIGNvbnN0IGNvbnRyb2xzID0gIHRoaXMucGFzc3dvcmRGb3JtLmZvcm0uY29udHJvbHM7XG4gICAgY29uc3QgY29udHJvbENvbmZpcm1QYXNzd29yZCA9IGNvbnRyb2xzWydjb25maXJtUGFzc3dvcmQnXTtcbiAgICBjb25zdCBjb250cm9sTmV3UGFzc3dvcmQgPSBjb250cm9sc1snbmV3UGFzc3dvcmQnXTtcblxuICAgIGlmICghdGhpcy5uZXdQYXNzd29yZCkge1xuICAgICAgdGhpcy5zZXRGb3JtRXJyb3JzKHsncmVxdWlyZWQnOiB0cnVlfSwgW2NvbnRyb2xOZXdQYXNzd29yZF0pO1xuICAgIH0gZWxzZSBpZiAoIXRoaXMuY29uZmlybVBhc3N3b3JkKSB7XG4gICAgICB0aGlzLnNldEZvcm1FcnJvcnMoeydyZXF1aXJlZCc6IHRydWV9LCBbY29udHJvbENvbmZpcm1QYXNzd29yZF0pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5uZXdQYXNzd29yZCAmJiB0aGlzLmNvbmZpcm1QYXNzd29yZCAmJiB0aGlzLm5ld1Bhc3N3b3JkICE9PSB0aGlzLmNvbmZpcm1QYXNzd29yZCkge1xuICAgICAgdGhpcy5zZXRGb3JtRXJyb3JzKHsnZXF1YWxQYXNzd29yZCc6IHRydWV9LCBbY29udHJvbE5ld1Bhc3N3b3JkLCBjb250cm9sQ29uZmlybVBhc3N3b3JkXSk7XG4gICAgfSAgZWxzZSB7XG4gICAgICB0aGlzLnNldEZvcm1FcnJvcnMobnVsbCwgW2NvbnRyb2xDb25maXJtUGFzc3dvcmQsIGNvbnRyb2xOZXdQYXNzd29yZF0pO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJlcXVpcmVtZW50cy5sZW5ndGggJiYgdGhpcy5yZXF1aXJlbWVudHMuZmluZChyZXF1aXJlbWVudCA9PiAgdGhpcy52YWxpZGF0ZVJlcXVpcmVtZW50KHJlcXVpcmVtZW50KSA9PT0gZmFsc2UpKSB7XG4gICAgICB0aGlzLnNldEZvcm1FcnJvcnMoeydyZXF1aXJlbWVudCc6IHRydWV9LCBbY29udHJvbE5ld1Bhc3N3b3JkXSk7XG4gICAgfVxuICB9XG5cbiAgdmFsaWRhdGVSZXF1aXJlbWVudChyZXF1aXJlbWVudDogUG9QYWdlQ2hhbmdlUGFzc3dvcmRSZXF1aXJlbWVudCkge1xuICAgIHJldHVybiB0eXBlb2YgcmVxdWlyZW1lbnQuc3RhdHVzID09PSAnZnVuY3Rpb24nID8gcmVxdWlyZW1lbnQuc3RhdHVzLmNhbGwodGhpcy5wYXJlbnRSZWYsIHRoaXMubmV3UGFzc3dvcmQpIDogcmVxdWlyZW1lbnQuc3RhdHVzO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGVja2luZ0Zvck1ldGFkYXRhUHJvcGVydHkob2JqZWN0LCBwcm9wZXJ0eSkge1xuICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSkpIHtcbiAgICAgIHJldHVybiBvYmplY3RbcHJvcGVydHldO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tpbmdGb3JSb3V0ZU1ldGFkYXRhKGRhdGEpIHtcbiAgICBpZiAoT2JqZWN0LmtleXMoZGF0YSkubGVuZ3RoICE9PSAwKSB7XG4gICAgICB0aGlzLnVybE5ld1Bhc3N3b3JkID0gdGhpcy5jaGVja2luZ0Zvck1ldGFkYXRhUHJvcGVydHkoZGF0YSwgJ3NlcnZpY2VBcGknKSB8fCB0aGlzLnVybE5ld1Bhc3N3b3JkO1xuICAgICAgdGhpcy5yZWNvdmVyeSA9IHRoaXMuY2hlY2tpbmdGb3JNZXRhZGF0YVByb3BlcnR5KGRhdGEsICdyZWNvdmVyeScpIHx8IHRoaXMucmVjb3Zlcnk7XG4gICAgICB0aGlzLmhpZGVDdXJyZW50UGFzc3dvcmQgPSB0aGlzLmNoZWNraW5nRm9yTWV0YWRhdGFQcm9wZXJ0eShkYXRhLCAnaGlkZUN1cnJlbnRQYXNzd29yZCcpIHx8IHRoaXMuaGlkZUN1cnJlbnRQYXNzd29yZDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZU1vZGFsUGFzc3dvcmRSZWNvdmVyeUNvbXBvbmVudChyZWNvdmVyeTogUG9QYWdlQ2hhbmdlUGFzc3dvcmRSZWNvdmVyeSkge1xuICAgIGlmICh0aGlzLmNvbXBvbmVudFJlZikge1xuICAgICAgdGhpcy5wb0NvbXBvbmVudEluamVjdG9yLmRlc3Ryb3lDb21wb25lbnRJbkFwcGxpY2F0aW9uKHRoaXMuY29tcG9uZW50UmVmKTtcbiAgICB9XG5cbiAgICB0aGlzLmNvbXBvbmVudFJlZiA9IHRoaXMucG9Db21wb25lbnRJbmplY3Rvci5jcmVhdGVDb21wb25lbnRJbkFwcGxpY2F0aW9uKFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5Q29tcG9uZW50KTtcbiAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5yZWNvdmVyeSA9IHJlY292ZXJ5LnVybDtcbiAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5jb250YWN0RW1haWwgPSByZWNvdmVyeS5jb250YWN0TWFpbDtcbiAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5waG9uZU1hc2sgPSByZWNvdmVyeS5waG9uZU1hc2s7XG4gICAgdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2UudHlwZSA9IHJlY292ZXJ5LnR5cGUgfHwgUG9Nb2RhbFBhc3N3b3JkUmVjb3ZlcnlUeXBlLkVtYWlsO1xuICAgIHRoaXMuY29tcG9uZW50UmVmLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlLm9wZW4oKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZW1pdFN1Ym1pdChmb3JtOiBQb1BhZ2VDaGFuZ2VQYXNzd29yZCkge1xuICAgIHRoaXMuc3VibWl0LmVtaXQoZm9ybSk7XG4gIH1cblxuICBwcml2YXRlIGdldExvZ2luRm9ybSgpOiBQb1BhZ2VDaGFuZ2VQYXNzd29yZCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGN1cnJlbnRQYXNzd29yZDogdGhpcy5jdXJyZW50UGFzc3dvcmQsXG4gICAgICBuZXdQYXNzd29yZDogdGhpcy5uZXdQYXNzd29yZFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIHBvc3RVcmxOZXdQYXNzd29yZChmb3JtOiBQb1BhZ2VDaGFuZ2VQYXNzd29yZCkge1xuXG4gICAgZm9ybVsndG9rZW4nXSA9IHRoaXMudG9rZW47XG5cbiAgICB0aGlzLnNlcnZpY2UucG9zdCh0aGlzLnVybE5ld1Bhc3N3b3JkLCBmb3JtKS5zdWJzY3JpYmUocmVzcG9uc2UgPT4ge1xuICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjA0KSB7XG4gICAgICAgIHRoaXMub3BlbkNvbmZpcm1hdGlvbigpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRGb3JtRXJyb3JzKGVycm9yOiBhbnksIGNvbnRyb2xzPzogQXJyYXk8YW55Pikge1xuICAgIGNvbnRyb2xzLmZvckVhY2goY29udHJvbCA9PiB7XG4gICAgICBjb250cm9sLnNldEVycm9ycyhlcnJvcik7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHN1YnNjcmliZVRvVG9rZW5QYXJhbWV0ZXIoKSB7XG4gICAgdGhpcy5yb3V0ZS5xdWVyeVBhcmFtcy5zdWJzY3JpYmUocGFyYW1zID0+IHtcbiAgICAgIGNvbnN0IHRva2VuID0gcGFyYW1zWyd0b2tlbiddO1xuXG4gICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgdGhpcy50b2tlbiA9IHRva2VuO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbn1cbiJdfQ==